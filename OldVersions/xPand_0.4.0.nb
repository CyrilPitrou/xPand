(* Content-type: application/mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 7.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       145,          7]
NotebookDataLength[   1248908,      25577]
NotebookOptionsPosition[   1235560,      25168]
NotebookOutlinePosition[   1236058,      25188]
CellTagsIndexPosition[   1236015,      25185]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[TextData[{
 "       ",
 StyleBox["xPand",
  FontSize->36],
 StyleBox["    (ing)",
  FontSize->24],
 "      ",
 StyleBox["P",
  FontSize->24],
 StyleBox["erturbations",
  FontSize->24,
  FontColor->GrayLevel[0]],
 StyleBox[" A",
  FontSize->24],
 StyleBox["re",
  FontSize->24,
  FontColor->GrayLevel[0]],
 StyleBox[" N",
  FontSize->24],
 StyleBox["ot",
  FontSize->24,
  FontColor->GrayLevel[0]],
 StyleBox[" D",
  FontSize->24],
 StyleBox["ifficult",
  FontSize->24,
  FontColor->GrayLevel[0]],
 StyleBox["  ",
  FontSize->24],
 StyleBox["          (I",
  FontSize->16],
 StyleBox["n",
  FontSize->16,
  FontColor->GrayLevel[0]],
 StyleBox[" N",
  FontSize->16],
 StyleBox["ewtonian",
  FontSize->16,
  FontColor->GrayLevel[0]],
 StyleBox[" G",
  FontSize->16],
 StyleBox["auge)",
  FontSize->16,
  FontColor->GrayLevel[0]],
 " "
}], "Title",
 InitializationCell->True,
 CellChangeTimes->{{3.437591402814958*^9, 3.437591414632804*^9}, {
   3.4375918842065573`*^9, 3.437591893851018*^9}, {3.437599196946991*^9, 
   3.437599260708293*^9}, {3.437599363233343*^9, 3.437599369598157*^9}, {
   3.4375994324417458`*^9, 3.43759947008809*^9}, {3.5096141364888477`*^9, 
   3.5096141392291307`*^9}, {3.562468047053856*^9, 3.562468047168108*^9}, {
   3.562552148214155*^9, 3.562552176992413*^9}, 3.562787425030383*^9},
 FontSize->48],

Cell[CellGroupData[{

Cell["Authors", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{
  3.5081861140031013`*^9, {3.564153494319269*^9, 3.56415349447615*^9}},
 FontSize->18],

Cell["\<\
This package is designed for the theory of perturbations in relativistic \
cosmology. 
It allows for the calculation of perturbations for all types of Bianchi \
(homogeneous) cosmologies, at any order and in several gauges. 
        
Version 0.4.0   (08/02/2013)\
\>", "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.430882257658573*^9, 3.430882310397239*^9}, {
   3.430882363388032*^9, 3.430882475708933*^9}, {3.430882667665706*^9, 
   3.430882673890522*^9}, {3.430883087839756*^9, 3.430883091927251*^9}, {
   3.43088317757655*^9, 3.430883203201062*^9}, 3.430883250900247*^9, {
   3.430883286503335*^9, 3.430883317576798*^9}, {3.430884947758275*^9, 
   3.430884956563778*^9}, {3.437588465127049*^9, 3.4375885077668333`*^9}, 
   3.437590302022478*^9, {3.43759191536969*^9, 3.4375919298720093`*^9}, {
   3.437599288342101*^9, 3.437599303194003*^9}, {3.4376005122346*^9, 
   3.437600519047333*^9}, {3.4376417470664663`*^9, 3.437641764169319*^9}, {
   3.509469926793436*^9, 3.509469941056539*^9}, {3.509532004684936*^9, 
   3.509532004982584*^9}, {3.5096133495005093`*^9, 3.50961339076305*^9}, {
   3.509614148133279*^9, 3.509614188844008*^9}, {3.5098172396435966`*^9, 
   3.509817240201056*^9}, {3.5098623058138533`*^9, 3.509862309156074*^9}, {
   3.5124824250542593`*^9, 3.512482427678319*^9}, {3.561409775386816*^9, 
   3.5614098019056683`*^9}, {3.561409864350379*^9, 3.561409864863459*^9}, {
   3.56255228643886*^9, 3.562552352489148*^9}, {3.562717226104286*^9, 
   3.562717230429227*^9}, 3.56278741714504*^9, 3.5632520891877327`*^9, {
   3.56351498867691*^9, 3.563514990150546*^9}, {3.564153495829927*^9, 
   3.564153593557458*^9}, {3.564475708814005*^9, 3.564475726420034*^9}, {
   3.5646835868764277`*^9, 3.564683587275317*^9}, {3.564765180281913*^9, 
   3.5647651806421022`*^9}, {3.56483315394378*^9, 3.564833154069873*^9}, {
   3.564945133264626*^9, 3.564945136015992*^9}, {3.565096565522705*^9, 
   3.56509656670361*^9}, {3.566040056187467*^9, 3.566040061498473*^9}, {
   3.5663134714803267`*^9, 3.566313482875348*^9}, {3.566895655596964*^9, 
   3.566895658802538*^9}, {3.566920877657857*^9, 3.566920877880777*^9}, {
   3.56722449149198*^9, 3.567224491673954*^9}, {3.567402552153159*^9, 
   3.567402552533368*^9}, {3.567486106615217*^9, 3.5674861069413843`*^9}, {
   3.567575292414461*^9, 3.567575292879902*^9}, {3.568273282464094*^9, 
   3.56827328570392*^9}, {3.568313420348884*^9, 3.56831343083941*^9}, 
   3.5683134763616056`*^9, {3.569328726538806*^9, 3.569328729941369*^9}},
 FontSize->14],

Cell[TextData[{
 "\n It is developed by Cyril ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["Pitrou", "1"], TraditionalForm]]],
 ", Xavier ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["Roy", "2"], TraditionalForm]]],
 " and Obinna ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["Umeh", "2"], TraditionalForm]]],
 ".\n \t\n ",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["", "1"], TraditionalForm]]],
 StyleBox["Institute of Astrophysics of Paris (IAP), France",
  FontSize->13],
 "\n",
 StyleBox["Email: pitrou@iap.fr",
  FontSize->13],
 "\n",
 StyleBox[ButtonBox["http://www2.iap.fr/users/pitrou/xpand.htm",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://www2.iap.fr/users/pitrou/xpand.htm"], None},
  ButtonNote->"http://www2.iap.fr/users/pitrou/xpand.htm"],
  FontSize->13],
 "\n\n",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["", "2"], TraditionalForm]]],
 StyleBox[" Department of Mathematics and Applied Mathematics, Cape Town \
University, Rondebosch 7701, South Africa",
  FontSize->13],
 "\n",
 StyleBox["Emails: xavier.roy@uct.ac.za / obinnah.umeh@uct.ac.za",
  FontSize->13],
 "\n \t\n \t\nDetails of the general algorithm and methods for perturbations \
about any space-time background can be found on a dedicated ",
 ButtonBox["publication",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://arxiv.org/abs/1302.6174"], None},
  ButtonNote->"http://arxiv.org/abs/1302.6174"],
 " or on the ",
 ButtonBox["xPand webpage.",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://www2.iap.fr/users/pitrou/xpand.htm"], None},
  ButtonNote->"http://www2.iap.fr/users/pitrou/xpand.htm"]
}], "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.430882257658573*^9, 3.430882310397239*^9}, {
   3.430882363388032*^9, 3.430882475708933*^9}, {3.430882667665706*^9, 
   3.430882673890522*^9}, {3.430883087839756*^9, 3.430883091927251*^9}, {
   3.43088317757655*^9, 3.430883203201062*^9}, 3.430883250900247*^9, {
   3.430883286503335*^9, 3.430883317576798*^9}, {3.430884947758275*^9, 
   3.430884956563778*^9}, {3.437588465127049*^9, 3.4375885077668333`*^9}, {
   3.437590302022478*^9, 3.4375903165795727`*^9}, {3.437590428765594*^9, 
   3.4375904287665863`*^9}, {3.43760034804326*^9, 3.437600353265369*^9}, {
   3.500268281131447*^9, 3.500268282171681*^9}, {3.503339084874587*^9, 
   3.503339208464801*^9}, {3.508083889441839*^9, 3.508083915332033*^9}, {
   3.508186099972085*^9, 3.508186102818864*^9}, 3.508478311496361*^9, {
   3.509456218466661*^9, 3.509456219089184*^9}, {3.5094699441137667`*^9, 
   3.509470017480309*^9}, {3.512377752766466*^9, 3.5123777552088223`*^9}, {
   3.561409805329268*^9, 3.5614098353838873`*^9}, {3.561409986569435*^9, 
   3.561409988095694*^9}, 3.561955869709519*^9, {3.562041933874949*^9, 
   3.562041945569683*^9}, {3.563252112482176*^9, 3.56325215196675*^9}, {
   3.563252194294607*^9, 3.563252226773293*^9}, {3.563281021208193*^9, 
   3.5632810690052156`*^9}, {3.563769299651071*^9, 3.563769369109243*^9}, {
   3.56415360128861*^9, 3.564153668623509*^9}, {3.5683134342153*^9, 
   3.5683134472926483`*^9}, {3.56831402930229*^9, 3.568314034538612*^9}, {
   3.5708457947681503`*^9, 3.570845864421324*^9}},
 FontSize->14],

Cell[TextData[{
 "This algorithm is based on the xAct/xPert package developed by \nD. ",
 Cell[BoxData[
  FormBox["Brizuela", TraditionalForm]]],
 " and Jos\[EAcute] M. Mart\[IAcute]n-Garc\[IAcute]a.",
 StyleBox["\n ",
  FontSize->13],
 StyleBox[ButtonBox["http://www.xact.es",
  BaseStyle->"Hyperlink",
  ButtonData->{
    URL["http://metric.iem.csic.es/Martin-Garcia/"], None}],
  FontSize->13],
 "\n\t\nIt is tested so far for xAct_1.0.5 and xPert_1.0.3, under Mathematica \
7.0, 8.0 and 9.0."
}], "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.404118545048814*^9, 3.404118553303886*^9}, 
   3.430882331308447*^9, {3.430882479044812*^9, 3.430882488826072*^9}, {
   3.430883077166673*^9, 3.430883077777542*^9}, {3.437576646988041*^9, 
   3.437576652487088*^9}, 3.437588536435915*^9, {3.437590456427647*^9, 
   3.437590456428359*^9}, 3.437591936761574*^9, {3.4376003749604893`*^9, 
   3.437600383767234*^9}, {3.508083845555977*^9, 3.508083857138771*^9}, {
   3.509614202246841*^9, 3.509614216165332*^9}, {3.5614098408402023`*^9, 
   3.561409870654375*^9}, {3.563281008072917*^9, 3.563281011174609*^9}, 
   3.56376937508445*^9, {3.564153676249159*^9, 3.5641538098574142`*^9}, {
   3.564765159543447*^9, 3.564765163572624*^9}, {3.568273290462908*^9, 
   3.568273349252117*^9}, {3.5682734030731077`*^9, 3.568273404410741*^9}, {
   3.568313450204279*^9, 3.568313460954167*^9}, {3.568367161064969*^9, 
   3.568367166261533*^9}},
 FontSize->14],

Cell[CellGroupData[{

Cell["Dates and versions", "Subsubsection",
 CellChangeTimes->{
  3.5641538121053658`*^9, {3.570012090145392*^9, 3.570012091104332*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Date", "[", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "2013", ",", "2", ",", "11", ",", "14", ",", "41", ",", 
   "31.252953`8.247466039537173"}], "}"}]], "Output",
 CellChangeTimes->{
  3.562552532743935*^9, 3.562552973492467*^9, 3.5625560031864653`*^9, {
   3.562556228849872*^9, 3.562556241433791*^9}, 3.562556396541422*^9, 
   3.562556491570347*^9, 3.562556565315771*^9, {3.562558881005723*^9, 
   3.562558927504074*^9}, 3.5625612599806843`*^9, 3.562561324583569*^9, 
   3.562561627917095*^9, 3.562561731388115*^9, 3.562561769406747*^9, 
   3.562562184591188*^9, 3.562562461357089*^9, 3.562562522600019*^9, 
   3.5625635259081917`*^9, 3.562563903420786*^9, 3.562569790078642*^9, 
   3.562569863108399*^9, 3.562569938052822*^9, 3.5625700674602203`*^9, 
   3.562573718689252*^9, 3.562578603695532*^9, 3.5625786768418617`*^9, 
   3.562582466974018*^9, 3.562582718894225*^9, 3.5625841069517107`*^9, 
   3.56258570635534*^9, 3.5625893626499968`*^9, 3.562592442016486*^9, 
   3.562593660446835*^9, 3.5625937417586946`*^9, 3.562594021787403*^9, 
   3.562594329209159*^9, 3.562606975941544*^9, 3.562647133312469*^9, 
   3.562647355799148*^9, 3.562649645746079*^9, 3.562650024840262*^9, 
   3.562650380470942*^9, 3.562650466489506*^9, 3.562650550876956*^9, 
   3.562655952650239*^9, 3.562717224366132*^9, 3.563199229802071*^9, 
   3.5634611041320677`*^9, 3.5637729585510893`*^9, 3.563773055914489*^9, 
   3.563773879120965*^9, 3.563773931799306*^9, 3.56377399168235*^9, 
   3.566896731178919*^9, 3.566896787785975*^9, 3.566921572807166*^9, 
   3.5669228707844152`*^9, 3.567224498607489*^9, 3.567224544252295*^9, 
   3.567402566768997*^9, 3.567486112498641*^9, 3.5683127570295057`*^9, 
   3.568312864915592*^9, 3.5683129145476313`*^9, 3.569132388831676*^9, 
   3.569230308195918*^9, 3.569340249200603*^9, 3.56934051146202*^9, 
   3.569340729745475*^9, 3.569418992697261*^9, 3.569578891285349*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"xAct`xPand`$Version", "=", 
   RowBox[{"{", 
    RowBox[{"\"\<0.4.0\>\"", ",", 
     RowBox[{"{", 
      RowBox[{"2013", ",", "2", ",", "8"}], "}"}]}], "}"}]}], ";"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.562552397083179*^9, 3.5625523977550087`*^9}, {
   3.562552436636456*^9, 3.562552443243224*^9}, {3.562819354160604*^9, 
   3.562819359093958*^9}, {3.563514984406945*^9, 3.563514986519065*^9}, {
   3.563772731634348*^9, 3.5637727322562237`*^9}, {3.5641538183190317`*^9, 
   3.564153819219706*^9}, {3.564478947621584*^9, 3.56447894789338*^9}, {
   3.56468359258062*^9, 3.5646835930606537`*^9}, {3.564765183276622*^9, 
   3.564765183708397*^9}, {3.5648331618325357`*^9, 3.5648331619528637`*^9}, {
   3.564945140626355*^9, 3.564945140867507*^9}, {3.565096579125257*^9, 
   3.5650965797652283`*^9}, {3.566040067492031*^9, 3.566040070907132*^9}, {
   3.566313500566721*^9, 3.566313500949387*^9}, {3.566895662797139*^9, 
   3.5668956657167397`*^9}, {3.566920882627448*^9, 3.566920882987788*^9}, {
   3.5672245007428703`*^9, 3.567224501029275*^9}, {3.567402568994403*^9, 
   3.567402569472371*^9}, {3.567486114367866*^9, 3.567486114713307*^9}, {
   3.567575299731448*^9, 3.5675753004022207`*^9}, {3.568101609827272*^9, 
   3.568101609909484*^9}, {3.568101648979208*^9, 3.568101649425325*^9}, {
   3.5682969313159647`*^9, 3.5682969333636827`*^9}, 3.568312690574925*^9, {
   3.569328735225648*^9, 3.569328749616193*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"xAct`xPand`$xTensorVersionExpected", "=", 
   RowBox[{"{", 
    RowBox[{"\"\<1.0.5\>\"", ",", 
     RowBox[{"{", 
      RowBox[{"2013", ",", "1", ",", "27"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xAct`xPand`$xPertVersionExpected", "=", 
   RowBox[{"{", 
    RowBox[{"\"\<1.0.3\>\"", ",", 
     RowBox[{"{", 
      RowBox[{"2013", ",", "1", ",", "27"}], "}"}]}], "}"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562552400410852*^9, 3.5625524012905273`*^9}, {
  3.562552445834515*^9, 3.5625524566970053`*^9}, {3.562552497805254*^9, 
  3.562552544790278*^9}, {3.5637727244039583`*^9, 3.5637727280188713`*^9}, {
  3.5681016125311213`*^9, 3.568101643475387*^9}, {3.568312692752027*^9, 
  3.568312694846402*^9}, {3.569328739265242*^9, 3.5693287557358932`*^9}}],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["1. Initialization", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{
  3.5081861140031013`*^9, {3.564140600125454*^9, 3.564140600263605*^9}, {
   3.564141496177951*^9, 3.564141537270952*^9}, 3.5641538330283947`*^9},
 FontColor->RGBColor[
  0.20389105058365758`, 0.38530556191348136`, 0.9685969329365988]],

Cell[CellGroupData[{

Cell["1.1. GPL", "Subsubsection",
 CellChangeTimes->{{3.564336108612508*^9, 3.564336132364553*^9}, {
  3.566462990005126*^9, 3.5664629941251383`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"xPand", ":", " ", 
    RowBox[{
     RowBox[{
     "Cosmological", " ", "perturbations", " ", "about", " ", "homogeneous", 
      " ", "space"}], "-", "times"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Copyright", " ", 
      RowBox[{"(", "C", ")"}], " ", "2012"}], "-", 
     RowBox[{"2013", " ", "Cyril", " ", "Pitrou"}]}], ",", " ", 
    RowBox[{"Xavier", " ", "Roy", " ", "and", " ", "Obinna", " ", "Umeh"}]}], 
   " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
     "This", " ", "program", " ", "is", " ", "free", " ", "software"}], ";", 
     " ", 
     RowBox[{"you", " ", "can", " ", "redistribute", " ", "it", " ", 
      RowBox[{"and", "/", "or"}], "\[IndentingNewLine]", " ", "modify", " ", 
      "it", " ", "under", " ", "the", " ", "terms", " ", "of", " ", "the", 
      " ", "GNU", " ", "General", " ", "Public", " ", "License", " ", "as", 
      "\[IndentingNewLine]", " ", "published", " ", "by", " ", "the", " ", 
      "Free", " ", "Software", " ", "Foundation"}], ";", " ", 
     RowBox[{
     "either", " ", "version", " ", "2", " ", "of", "\[IndentingNewLine]", 
      " ", "the", " ", "License"}]}], ",", 
    RowBox[{"or", " ", 
     RowBox[{"(", 
      RowBox[{"at", " ", "your", " ", "option"}], ")"}], " ", "any", " ", 
     "later", " ", 
     RowBox[{
     "version", ".", "\[IndentingNewLine]", "\[IndentingNewLine]", "This"}], 
     " ", "program", " ", "is", " ", "distributed", " ", "in", " ", "the", 
     " ", "hope", " ", "that", " ", "it", " ", "will", " ", "be", " ", 
     "useful"}], ",", "\[IndentingNewLine]", "  ", 
    RowBox[{
     RowBox[{"but", " ", "WITHOUT", " ", "ANY", " ", "WARRANTY"}], ";", " ", 
     RowBox[{
     "without", " ", "even", " ", "the", " ", "implied", " ", "warranty", " ",
       "of", "\[IndentingNewLine]", " ", "MERCHANTABILITY", " ", "or", " ", 
      "FITNESS", " ", "FOR", " ", "A", " ", "PARTICULAR", " ", 
      RowBox[{"PURPOSE", ".", " ", "See"}], " ", "the", " ", "GNU", 
      "\[IndentingNewLine]", " ", "General", " ", "Public", " ", "License", 
      " ", "for", " ", "more", " ", 
      RowBox[{
      "details", ".", "\[IndentingNewLine]", "\[IndentingNewLine]", "You"}], 
      " ", "should", " ", "have", " ", "received", " ", "a", " ", "copy", " ",
       "of", " ", "the", " ", "GNU", " ", "General", " ", "Public", " ", 
      "License", "\[IndentingNewLine]", " ", "along", " ", "with", " ", 
      "this", " ", "program"}], ";", " ", 
     RowBox[{"if", " ", "not"}]}], ",", " ", 
    RowBox[{
    "write", " ", "to", " ", "the", " ", "Free", " ", "Software", 
     "\[IndentingNewLine]", " ", "Foundation"}], ",", " ", 
    RowBox[{"Inc", "."}], ",", " ", 
    RowBox[{
     RowBox[{"59", " ", "Temple", " ", "Place"}], "-", 
     RowBox[{"Suite", " ", "330"}]}], ",", " ", "Boston", ",", " ", 
    RowBox[{
     RowBox[{"MA", " ", "02111"}], "-", "1307"}], ",", "\[IndentingNewLine]", 
    "  ", 
    RowBox[{"USA", "."}]}], " ", "\[IndentingNewLine]", "*)"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.563130226575314*^9, 3.563130256766747*^9}, 
   3.563163497637722*^9, {3.5641538475908422`*^9, 3.564153860340702*^9}, 
   3.564165648468161*^9}],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["1.2. Info package", "Subsubsection",
 CellChangeTimes->{{3.564336108612508*^9, 3.564336132364553*^9}}],

Cell["\<\
(* :Title: xPand *)

(* :Author: Cyril Pitrou, Xavier Roy and Obinna Umeh *)

(* :Summary: Computer algebra for cosmological perturbations around \
homogenous space-times *)

(* :Brief Discussion:
   - Background 3+1 splitting of space-time;
   - Spatial sections are homogeneous (Friedmann-Lemaitre or Bianchi of all \
types) *)
  
(* :Context: xAct`xPand` *)

(* :Package Version: 0.4.0 *)

(* :Copyright: Cyril Pitrou, Xavier Roy and Obinna Umeh (2012-2013) *)

(* :History: see xPand.History *)

(* :Keywords: *)

(* :Source: xPand.nb *)

(* :Warning: *)

(* :Mathematica Version: 7.0 and later *)

(* :Limitations: *)\
\>", "Input",
 PageWidth->PaperWidth,
 CellMargins->{{60, -272}, {Inherited, Inherited}},
 InitializationCell->True,
 CellChangeTimes->{{3.5625525600084133`*^9, 3.562552744879931*^9}, {
   3.563130263406415*^9, 3.563130265892454*^9}, {3.563281081894951*^9, 
   3.5632810822653923`*^9}, {3.5637728775612383`*^9, 3.563772882824073*^9}, {
   3.5641538688849707`*^9, 3.564153910508574*^9}, {3.564327009020319*^9, 
   3.56432701362709*^9}, {3.564336568855268*^9, 3.56433657455896*^9}, 
   3.564478964654008*^9, {3.564833166397423*^9, 3.564833166517662*^9}, {
   3.564945143519391*^9, 3.564945143696176*^9}, {3.566895675290893*^9, 
   3.566895675443235*^9}, {3.5683126972764893`*^9, 3.568312710748597*^9}, {
   3.57000608793533*^9, 3.570006088073471*^9}}],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["1.3. Begin package", "Subsubsection",
 CellChangeTimes->{
  3.56415393191016*^9, {3.564336135244946*^9, 3.56433613529312*^9}}],

Cell["\<\

Decide what is the last package being read:\
\>", "Text",
 CellChangeTimes->{
  3.56415393326823*^9, {3.5663135641486797`*^9, 3.566313565442597*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Unevaluated", "[", "xAct`xCore`Private`$LastPackage", "]"}], "===",
      "xAct`xCore`Private`$LastPackage"}], ",", 
    RowBox[{"xAct`xCore`Private`$LastPackage", "=", "\"\<xAct`xPand`\>\""}]}],
    "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5625529270513163`*^9, 3.562552928440583*^9}, {
   3.56377274518673*^9, 3.563772745842136*^9}, 3.568312702460052*^9}],

Cell[CellGroupData[{

Cell[BoxData["xAct`xCore`Private`$LastPackage"], "Input",
 CellChangeTimes->{{3.568312819153059*^9, 3.568312819894372*^9}}],

Cell[BoxData["\<\"xAct`xPand`\"\>"], "Output",
 CellChangeTimes->{{3.56831282079213*^9, 3.5683128288124447`*^9}, 
   3.5683128651304073`*^9, 3.568312914756071*^9, 3.56913238909202*^9, 
   3.5692303084396772`*^9, 3.569340249439742*^9, 3.569340511674168*^9, 
   3.569340730006061*^9, 3.56941899293507*^9, 3.5695788915545197`*^9}]
}, Open  ]],

Cell["\<\

Explicit (not hidden) import of other packages:\
\>", "Text",
 CellChangeTimes->{3.5641539368037977`*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Off", "[", 
  StyleBox[
   RowBox[{"General", "::", "nostdvar"}], "MessageName"], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Off", "[", 
  StyleBox[
   RowBox[{"General", "::", "nostdopt"}], "MessageName"], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"BeginPackage", "[", 
  RowBox[{"\"\<xAct`xPand`\>\"", ",", 
   RowBox[{"{", 
    RowBox[{
    "\"\<xAct`xPert`\>\"", ",", "\"\<xAct`xTensor`\>\"", ",", 
     "\"\<xAct`xPerm`\>\"", ",", "\"\<xAct`xCore`\>\"", ",", 
     "\"\<xAct`ExpressionManipulation`\>\""}], "}"}]}], "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562552940377385*^9, 3.562552951541499*^9}, {
   3.562553021922873*^9, 3.5625530260332413`*^9}, {3.56377246991614*^9, 
   3.563772477648355*^9}, 3.563773821052526*^9, 3.568312722099021*^9}],

Cell[CellGroupData[{

Cell[BoxData["\<\"------------------------------------------------------------\
\"\>"], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.56957889237156*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Package xAct`xPerm`  version \"\>", 
   "\[InvisibleSpace]", "\<\"1.2.0\"\>", "\[InvisibleSpace]", "\<\", \"\>", 
   "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2013", ",", "1", ",", "27"}], "}"}]}],
  SequenceForm["Package xAct`xPerm`  version ", "1.2.0", ", ", {2013, 1, 27}],
  
  Editable->False]], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578892374031*^9}],

Cell[BoxData["\<\"CopyRight (C) 2003-2013, Jose M. Martin-Garcia, under the \
General Public License.\"\>"], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.5695788924468527`*^9}],

Cell[BoxData["\<\"Connecting to external mac executable...\"\>"], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578892491479*^9}],

Cell[BoxData["\<\"Connection established.\"\>"], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578892621193*^9}],

Cell[BoxData["\<\"------------------------------------------------------------\
\"\>"], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.5695788926237288`*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Package xAct`xTensor`  version \"\>", 
   "\[InvisibleSpace]", "\<\"1.0.5\"\>", "\[InvisibleSpace]", "\<\", \"\>", 
   "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2013", ",", "1", ",", "27"}], "}"}]}],
  SequenceForm[
  "Package xAct`xTensor`  version ", "1.0.5", ", ", {2013, 1, 27}],
  Editable->False]], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578892626164*^9}],

Cell[BoxData["\<\"CopyRight (C) 2002-2013, Jose M. Martin-Garcia, under the \
General Public License.\"\>"], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578892629135*^9}],

Cell[BoxData["\<\"------------------------------------------------------------\
\"\>"], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.5695788930375423`*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Package xAct`xPert`  version \"\>", 
   "\[InvisibleSpace]", "\<\"1.0.3\"\>", "\[InvisibleSpace]", "\<\", \"\>", 
   "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2013", ",", "1", ",", "27"}], "}"}]}],
  SequenceForm["Package xAct`xPert`  version ", "1.0.3", ", ", {2013, 1, 27}],
  
  Editable->False]], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.5695788930401077`*^9}],

Cell[BoxData["\<\"CopyRight (C) 2005-2013, David Brizuela, Jose M. \
Martin-Garcia and Guillermo A. Mena Marugan, under the General Public \
License.\"\>"], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578893043168*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"** Variable \"\>", "\[InvisibleSpace]", "$PrePrint", 
   "\[InvisibleSpace]", "\<\" assigned value \"\>", "\[InvisibleSpace]", 
   "ScreenDollarIndices"}],
  SequenceForm[
  "** Variable ", $PrePrint, " assigned value ", 
   xAct`xTensor`ScreenDollarIndices],
  Editable->False]], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.56957889304602*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"** Variable \"\>", "\[InvisibleSpace]", "$CovDFormat", 
   "\[InvisibleSpace]", "\<\" changed from \"\>", 
   "\[InvisibleSpace]", "\<\"Prefix\"\>", "\[InvisibleSpace]", "\<\" to \"\>",
    "\[InvisibleSpace]", "\<\"Postfix\"\>"}],
  SequenceForm[
  "** Variable ", xAct`xTensor`$CovDFormat, " changed from ", "Prefix", 
   " to ", "Postfix"],
  Editable->False]], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578893064823*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"** Option \"\>", "\[InvisibleSpace]", "AllowUpperDerivatives", 
   "\[InvisibleSpace]", "\<\" of \"\>", "\[InvisibleSpace]", "ContractMetric",
    "\[InvisibleSpace]", "\<\" changed from \"\>", "\[InvisibleSpace]", 
   "False", "\[InvisibleSpace]", "\<\" to \"\>", "\[InvisibleSpace]", "True"}],
  SequenceForm[
  "** Option ", xAct`xTensor`AllowUpperDerivatives, " of ", 
   xAct`xTensor`ContractMetric, " changed from ", False, " to ", True],
  Editable->False]], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578893067524*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"** Option \"\>", "\[InvisibleSpace]", "MetricOn", 
   "\[InvisibleSpace]", "\<\" of \"\>", "\[InvisibleSpace]", "MakeRule", 
   "\[InvisibleSpace]", "\<\" changed from \"\>", "\[InvisibleSpace]", "None",
    "\[InvisibleSpace]", "\<\" to \"\>", "\[InvisibleSpace]", "All"}],
  SequenceForm[
  "** Option ", xAct`xTensor`MetricOn, " of ", xAct`xTensor`MakeRule, 
   " changed from ", None, " to ", All],
  Editable->False]], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578893070115*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"** Option \"\>", "\[InvisibleSpace]", "ContractMetrics", 
   "\[InvisibleSpace]", "\<\" of \"\>", "\[InvisibleSpace]", "MakeRule", 
   "\[InvisibleSpace]", "\<\" changed from \"\>", "\[InvisibleSpace]", 
   "False", "\[InvisibleSpace]", "\<\" to \"\>", "\[InvisibleSpace]", "True"}],
  SequenceForm[
  "** Option ", xAct`xTensor`ContractMetrics, " of ", xAct`xTensor`MakeRule, 
   " changed from ", False, " to ", True],
  Editable->False]], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578893072344*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"** \"\>", "\[InvisibleSpace]", "DefInertHead", 
   "\[InvisibleSpace]", "\<\": Defining \"\>", 
   "\[InvisibleSpace]", "\<\"inert head \"\>", "\[InvisibleSpace]", 
   "Perturbation", "\[InvisibleSpace]", "\<\". \"\>", 
   "\[InvisibleSpace]", "\<\"\"\>"}],
  SequenceForm[
  "** ", xAct`xTensor`DefInertHead, ": Defining ", "inert head ", 
   xAct`xPert`Perturbation, ". ", ""],
  Editable->False]], "Print",
 CellChangeTimes->{3.569340730298388*^9, 3.569418994474983*^9, 
  3.569578893074585*^9}]
}, Open  ]],

Cell[BoxData["\<\"xAct`xPand`\"\>"], "Output",
 CellChangeTimes->{3.5637729589907227`*^9, 3.563773058117197*^9, 
  3.563773882426632*^9, 3.563773933715438*^9, 3.56377399392796*^9, 
  3.566896803195484*^9, 3.5669215973940763`*^9, 3.567224523461831*^9, 
  3.567224562459388*^9, 3.567402590870983*^9, 3.5674861336458397`*^9, 
  3.568312757274601*^9, 3.5683128685614233`*^9, 3.568312915603241*^9, 
  3.569132391531726*^9, 3.56923031000935*^9, 3.569340251885202*^9, 
  3.569340511711244*^9, 3.569340730771847*^9, 3.569418995096188*^9, 
  3.5695788930772676`*^9}]
}, Open  ]],

Cell[TextData[{
 "\nCheck version of ",
 StyleBox["xTensor",
  FontSlant->"Italic"],
 ". We simply compare dates:"
}], "Text",
 CellChangeTimes->{3.56415394051602*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"Not", "@", 
     RowBox[{"OrderedQ", "@", 
      RowBox[{"Map", "[", 
       RowBox[{"Last", ",", 
        RowBox[{"{", 
         RowBox[{"$xTensorVersionExpected", ",", "xAct`xTensor`$Version"}], 
         "}"}]}], "]"}]}]}], ",", 
    RowBox[{"Throw", "@", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"General", "::", "versions"}], ",", "\"\<xTensor\>\"", ",", 
       "xAct`xTensor`$Version", ",", "$xTensorVersionExpected"}], "]"}]}]}], 
   "]"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"Not", "@", 
    RowBox[{"OrderedQ", "@", 
     RowBox[{"Map", "[", 
      RowBox[{"Last", ",", 
       RowBox[{"{", 
        RowBox[{"$xPertVersionExpected", ",", "xAct`xPert`$Version"}], 
        "}"}]}], "]"}]}]}], ",", 
   RowBox[{"Throw", "@", 
    RowBox[{"Message", "[", 
     RowBox[{
      RowBox[{"General", "::", "versions"}], ",", "\"\<xPert\>\"", ",", 
      "xAct`xPert`$Version", ",", "$xPertVersionExpected"}], "]"}]}]}], 
  "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562553046006856*^9, 3.562553070180779*^9}}],

Cell["\<\

Welcome message:\
\>", "Text",
 CellChangeTimes->{3.5641539429319057`*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", "xAct`xCore`Private`bars", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{"\"\<Package xAct`xPand`  version \>\"", ",", 
    RowBox[{"$Version", "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<, \>\"", ",", 
    RowBox[{"$Version", "[", 
     RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
  "Print", "[", 
   "\"\<CopyRight (C) 2012-2013, Cyril Pitrou, Xavier Roy and Obinna Umeh \
under the General Public License.\>\"", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562553154024989*^9, 3.562553173876451*^9}, {
   3.563130284471521*^9, 3.5631302849006157`*^9}, {3.563772846332551*^9, 
   3.563772854833514*^9}, {3.5641539473305483`*^9, 3.564153950521927*^9}, 
   3.5683127272148857`*^9, {3.568312943792427*^9, 3.568312944614451*^9}, {
   3.5683129936639547`*^9, 3.5683129943577633`*^9}}],

Cell[CellGroupData[{

Cell[BoxData["\<\"------------------------------------------------------------\
\"\>"], "Print",
 CellChangeTimes->{
  3.562553179987041*^9, 3.562555499879972*^9, {3.562555833899654*^9, 
   3.5625558866162577`*^9}, 3.562556004506695*^9, {3.562556229931622*^9, 
   3.562556242532566*^9}, 3.562556397605195*^9, 3.562556492698071*^9, 
   3.5625565664125*^9, {3.5625588821188297`*^9, 3.5625589286343307`*^9}, 
   3.5625612607618437`*^9, 3.562561325481876*^9, 3.562561629149737*^9, 
   3.562561732701233*^9, 3.562561770739531*^9, 3.562562185870612*^9, 
   3.562562462636037*^9, 3.5625625229012203`*^9, 3.562562627225905*^9, 
   3.5625626928934593`*^9, {3.56256349891257*^9, 3.56256352665823*^9}, 
   3.5625638740842037`*^9, 3.562563904519319*^9, 3.562569792505844*^9, 
   3.562569864721155*^9, 3.56256993944808*^9, 3.56257006864361*^9, 
   3.562573719998117*^9, 3.5625786048800097`*^9, 3.562578677527556*^9, 
   3.5625824698459387`*^9, 3.562582719920228*^9, {3.562584092890295*^9, 
   3.562584107652495*^9}, 3.5625857073713837`*^9, 3.562589363830873*^9, 
   3.562592444509306*^9, 3.5625936613304987`*^9, 3.562593743797674*^9, 
   3.562594022588525*^9, 3.562594330791333*^9, 3.562606980015998*^9, 
   3.562647139209915*^9, 3.562647357096485*^9, 3.5626496464509087`*^9, 
   3.562650025523471*^9, 3.562650381204863*^9, 3.562650467238332*^9, 
   3.5626505511580276`*^9, 3.562655954703244*^9, 3.562717226413599*^9, 
   3.5631992318445272`*^9, 3.56346110501401*^9, 3.563772959090917*^9, 
   3.563773058363509*^9, 3.563773882619458*^9, 3.5637739339312563`*^9, 
   3.563773994165015*^9, 3.566896762011654*^9, 3.566896811709149*^9, 
   3.5669216022261677`*^9, 3.567224568553499*^9, 3.567402595002575*^9, 
   3.567486137401651*^9, 3.568312757338923*^9, 3.5683128687717047`*^9, 
   3.568312915669744*^9, 3.569132391736622*^9, 3.569230310146019*^9, 
   3.569340252067342*^9, 3.569340511775485*^9, 3.56934073090466*^9, 
   3.569418995264007*^9, 3.5695788932780867`*^9}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Package xAct`xPand`  version \"\>", 
   "\[InvisibleSpace]", "\<\"0.4.0\"\>", "\[InvisibleSpace]", "\<\", \"\>", 
   "\[InvisibleSpace]", 
   RowBox[{"{", 
    RowBox[{"2013", ",", "2", ",", "8"}], "}"}]}],
  SequenceForm["Package xAct`xPand`  version ", "0.4.0", ", ", {2013, 2, 8}],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.562553179987041*^9, 3.562555499879972*^9, {3.562555833899654*^9, 
   3.5625558866162577`*^9}, 3.562556004506695*^9, {3.562556229931622*^9, 
   3.562556242532566*^9}, 3.562556397605195*^9, 3.562556492698071*^9, 
   3.5625565664125*^9, {3.5625588821188297`*^9, 3.5625589286343307`*^9}, 
   3.5625612607618437`*^9, 3.562561325481876*^9, 3.562561629149737*^9, 
   3.562561732701233*^9, 3.562561770739531*^9, 3.562562185870612*^9, 
   3.562562462636037*^9, 3.5625625229012203`*^9, 3.562562627225905*^9, 
   3.5625626928934593`*^9, {3.56256349891257*^9, 3.56256352665823*^9}, 
   3.5625638740842037`*^9, 3.562563904519319*^9, 3.562569792505844*^9, 
   3.562569864721155*^9, 3.56256993944808*^9, 3.56257006864361*^9, 
   3.562573719998117*^9, 3.5625786048800097`*^9, 3.562578677527556*^9, 
   3.5625824698459387`*^9, 3.562582719920228*^9, {3.562584092890295*^9, 
   3.562584107652495*^9}, 3.5625857073713837`*^9, 3.562589363830873*^9, 
   3.562592444509306*^9, 3.5625936613304987`*^9, 3.562593743797674*^9, 
   3.562594022588525*^9, 3.562594330791333*^9, 3.562606980015998*^9, 
   3.562647139209915*^9, 3.562647357096485*^9, 3.5626496464509087`*^9, 
   3.562650025523471*^9, 3.562650381204863*^9, 3.562650467238332*^9, 
   3.5626505511580276`*^9, 3.562655954703244*^9, 3.562717226413599*^9, 
   3.5631992318445272`*^9, 3.56346110501401*^9, 3.563772959090917*^9, 
   3.563773058363509*^9, 3.563773882619458*^9, 3.5637739339312563`*^9, 
   3.563773994165015*^9, 3.566896762011654*^9, 3.566896811709149*^9, 
   3.5669216022261677`*^9, 3.567224568553499*^9, 3.567402595002575*^9, 
   3.567486137401651*^9, 3.568312757338923*^9, 3.5683128687717047`*^9, 
   3.568312915669744*^9, 3.569132391736622*^9, 3.569230310146019*^9, 
   3.569340252067342*^9, 3.569340511775485*^9, 3.56934073090466*^9, 
   3.569418995264007*^9, 3.5695788932801332`*^9}],

Cell[BoxData["\<\"CopyRight (C) 2012-2013, Cyril Pitrou, Xavier Roy and \
Obinna Umeh under the General Public License.\"\>"], "Print",
 CellChangeTimes->{
  3.562553179987041*^9, 3.562555499879972*^9, {3.562555833899654*^9, 
   3.5625558866162577`*^9}, 3.562556004506695*^9, {3.562556229931622*^9, 
   3.562556242532566*^9}, 3.562556397605195*^9, 3.562556492698071*^9, 
   3.5625565664125*^9, {3.5625588821188297`*^9, 3.5625589286343307`*^9}, 
   3.5625612607618437`*^9, 3.562561325481876*^9, 3.562561629149737*^9, 
   3.562561732701233*^9, 3.562561770739531*^9, 3.562562185870612*^9, 
   3.562562462636037*^9, 3.5625625229012203`*^9, 3.562562627225905*^9, 
   3.5625626928934593`*^9, {3.56256349891257*^9, 3.56256352665823*^9}, 
   3.5625638740842037`*^9, 3.562563904519319*^9, 3.562569792505844*^9, 
   3.562569864721155*^9, 3.56256993944808*^9, 3.56257006864361*^9, 
   3.562573719998117*^9, 3.5625786048800097`*^9, 3.562578677527556*^9, 
   3.5625824698459387`*^9, 3.562582719920228*^9, {3.562584092890295*^9, 
   3.562584107652495*^9}, 3.5625857073713837`*^9, 3.562589363830873*^9, 
   3.562592444509306*^9, 3.5625936613304987`*^9, 3.562593743797674*^9, 
   3.562594022588525*^9, 3.562594330791333*^9, 3.562606980015998*^9, 
   3.562647139209915*^9, 3.562647357096485*^9, 3.5626496464509087`*^9, 
   3.562650025523471*^9, 3.562650381204863*^9, 3.562650467238332*^9, 
   3.5626505511580276`*^9, 3.562655954703244*^9, 3.562717226413599*^9, 
   3.5631992318445272`*^9, 3.56346110501401*^9, 3.563772959090917*^9, 
   3.563773058363509*^9, 3.563773882619458*^9, 3.5637739339312563`*^9, 
   3.563773994165015*^9, 3.566896762011654*^9, 3.566896811709149*^9, 
   3.5669216022261677`*^9, 3.567224568553499*^9, 3.567402595002575*^9, 
   3.567486137401651*^9, 3.568312757338923*^9, 3.5683128687717047`*^9, 
   3.568312915669744*^9, 3.569132391736622*^9, 3.569230310146019*^9, 
   3.569340252067342*^9, 3.569340511775485*^9, 3.56934073090466*^9, 
   3.569418995264007*^9, 3.569578893282691*^9}]
}, Open  ]]
}, Open  ]],

Cell["\<\

We specify the context xAct`xPand` to avoid overriding the Disclaimer of the \
other packages. However, we need to turn off the message General:shdw \
temporarily:\
\>", "Text",
 CellChangeTimes->{{3.5637728341933823`*^9, 3.56377283613558*^9}, {
   3.564153954070693*^9, 3.564153975383004*^9}, 3.568312735994898*^9}],

Cell[BoxData[{
 RowBox[{"Off", "[", 
  RowBox[{"General", "::", "shdw"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xAct`xPand`Disclaimer", "[", "]"}], ":=", 
  RowBox[{
  "Print", "[", 
   "\"\<These are points 11 and 12 of the General Public \
License:\\n\\nBECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO \
WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT \
WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES \
PROVIDE THE PROGRAM `AS IS\.b4 WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED \
OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF \
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO \
THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM \
PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR \
CORRECTION.\\n\\nIN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO \
IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY \
AND/OR REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR \
DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES \
ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT \
LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED \
BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER \
PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE \
POSSIBILITY OF SUCH DAMAGES.\>\"", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"On", "[", 
  RowBox[{"General", "::", "shdw"}], "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.563772801384728*^9, 3.563772804845406*^9}, 
   3.56831273777137*^9}],

Cell["\<\

If this is the last package show the GPL short disclaimer:\
\>", "Text",
 CellChangeTimes->{3.564153980902731*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"xAct`xCore`Private`$LastPackage", "===", "\"\<xAct`xPand`\>\""}],
     ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Unset", "[", "xAct`xCore`Private`$LastPackage", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "xAct`xCore`Private`bars", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", 
      "\"\<These packages come with ABSOLUTELY NO WARRANTY; for details type \
Disclaimer[]. This is free software, and you are welcome to redistribute it \
under certain conditions. See the General Public License for details.\>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "xAct`xCore`Private`bars", "]"}]}]}], "]"}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5625531931375713`*^9, 3.562553194065544*^9}}],

Cell[CellGroupData[{

Cell[BoxData["\<\"------------------------------------------------------------\
\"\>"], "Print",
 CellChangeTimes->{3.56831286885458*^9, 3.568312915754528*^9, 
  3.5691323918025217`*^9, 3.5692303102127523`*^9, 3.569340252133966*^9, 
  3.569340511841601*^9, 3.569340730955434*^9, 3.569418995329475*^9, 
  3.569578893344865*^9}],

Cell[BoxData["\<\"These packages come with ABSOLUTELY NO WARRANTY; for \
details type Disclaimer[]. This is free software, and you are welcome to \
redistribute it under certain conditions. See the General Public License for \
details.\"\>"], "Print",
 CellChangeTimes->{3.56831286885458*^9, 3.568312915754528*^9, 
  3.5691323918025217`*^9, 3.5692303102127523`*^9, 3.569340252133966*^9, 
  3.569340511841601*^9, 3.569340730955434*^9, 3.569418995329475*^9, 
  3.5695788933468237`*^9}],

Cell[BoxData["\<\"------------------------------------------------------------\
\"\>"], "Print",
 CellChangeTimes->{3.56831286885458*^9, 3.568312915754528*^9, 
  3.5691323918025217`*^9, 3.5692303102127523`*^9, 3.569340252133966*^9, 
  3.569340511841601*^9, 3.569340730955434*^9, 3.569418995329475*^9, 
  3.569578893351346*^9}]
}, Open  ]]
}, Open  ]],

Cell["\<\

Note that symbols in the Global` context cannot be accessed while building \
the package:\
\>", "Text",
 CellChangeTimes->{3.564153983484934*^9}],

Cell[CellGroupData[{

Cell[BoxData["$ContextPath"], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"xAct`xPand`\"\>", ",", "\<\"xAct`xPert`\"\>", 
   ",", "\<\"xAct`xTensor`\"\>", ",", "\<\"xAct`xPerm`\"\>", 
   ",", "\<\"xAct`xCore`\"\>", ",", "\<\"xAct`ExpressionManipulation`\"\>", 
   ",", "\<\"System`\"\>"}], "}"}]], "Output",
 CellChangeTimes->{
  3.5625532123573303`*^9, 3.5625560047394447`*^9, {3.562556230183785*^9, 
   3.56255624276406*^9}, 3.562556397840287*^9, 3.562556492916194*^9, 
   3.5625565666615143`*^9, {3.562558882321142*^9, 3.562558928832423*^9}, 
   3.562561260864613*^9, 3.562561325622175*^9, 3.562561629264456*^9, 
   3.562561732819145*^9, 3.562561770840642*^9, 3.5625621860104322`*^9, 
   3.562562462770973*^9, 3.5625625230017548`*^9, 3.5625635267603903`*^9, 
   3.5625639046543827`*^9, 3.56256979262337*^9, 3.5625698648800097`*^9, 
   3.562569939566805*^9, 3.5625700687411213`*^9, 3.562573720131959*^9, 
   3.5625786049945602`*^9, 3.56257867764419*^9, 3.5625824699502897`*^9, 
   3.562582720199745*^9, 3.562584107774702*^9, 3.5625857075888987`*^9, 
   3.5625893639428587`*^9, 3.562592444647667*^9, 3.562593661469187*^9, 
   3.562593743927189*^9, 3.562594022726338*^9, 3.562594330929617*^9, 
   3.562606980150258*^9, 3.56264713928402*^9, 3.562647357214281*^9, 
   3.56264964658529*^9, 3.5626500256585007`*^9, 3.56265038133969*^9, 
   3.5626504673761177`*^9, 3.562650551293325*^9, 3.56265595493504*^9, 
   3.5627172265209837`*^9, 3.56319923198864*^9, 3.563461105114284*^9, 
   3.563772959277302*^9, 3.563773058483693*^9, 3.563773882736054*^9, 
   3.563773934097595*^9, 3.563773994280879*^9, 3.568312757420226*^9, 
   3.568312868891025*^9, 3.568312915805675*^9, 3.56913239183775*^9, 
   3.569230310248746*^9, 3.569340252168614*^9, 3.56934051187748*^9, 
   3.569340731006524*^9, 3.569418995365943*^9, 3.569578893381198*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["$Context"], "Input"],

Cell[BoxData["\<\"xAct`xPand`\"\>"], "Output",
 CellChangeTimes->{3.563772959371908*^9, 3.563773058542807*^9, 
  3.5637738827994823`*^9, 3.563773934160265*^9, 3.563773994346141*^9, 
  3.5683127574539843`*^9, 3.568312868926086*^9, 3.568312915920314*^9, 
  3.569132391872232*^9, 3.569230310281806*^9, 3.569340252202302*^9, 
  3.56934051191469*^9, 3.569340731042157*^9, 3.569418995398271*^9, 
  3.569578893418063*^9}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["1.4. Set up", "Subsubsection",
 CellChangeTimes->{{3.5637739209539337`*^9, 3.5637739219128532`*^9}, {
  3.5641540048550253`*^9, 3.56415400507726*^9}, {3.564336114460581*^9, 
  3.564336139644967*^9}}],

Cell["\<\

Prefix format for derivatives:\
\>", "Text",
 CellChangeTimes->{{3.562553308104231*^9, 3.562553311710389*^9}, 
   3.5641539973193197`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$CovDFormat", "=", "\"\<Prefix\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Message", "[", 
   RowBox[{
    RowBox[{"General", "::", "nostdvar"}], ",", "\"\<$CovDFormat\>\"", ",", 
    "\"\<Prefix\>\""}], "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562553235018519*^9, 3.5625532398018427`*^9}}],

Cell["\<\

We do not modify the option MathLink of CanonicalPerm:\
\>", "Text",
 CellChangeTimes->{
  3.5641540083412533`*^9, {3.56447901386908*^9, 3.564479014178851*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Options", "[", "CanonicalPerm", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"MathLink", "\[RuleDelayed]", "$xpermQ"}], ",", 
   RowBox[{"TimeVerbose", "\[Rule]", "False"}], ",", 
   RowBox[{"xPermVerbose", "\[Rule]", "False"}], ",", 
   RowBox[{"OrderedBase", "\[Rule]", "True"}]}], "}"}]], "Output",
 CellChangeTimes->{
  3.5625533631904488`*^9, 3.5625560048504868`*^9, {3.5625562302590723`*^9, 
   3.562556242851038*^9}, 3.562556397922977*^9, 3.562556492999221*^9, 
   3.5625565667455873`*^9, {3.562558882418198*^9, 3.562558928932693*^9}, 
   3.5625612609615173`*^9, 3.562561325930965*^9, 3.562561629445573*^9, 
   3.562561733051848*^9, 3.562561770941*^9, 3.56256218613505*^9, 
   3.56256246286837*^9, 3.562562523099234*^9, 3.56256352685815*^9, 
   3.562563904750989*^9, 3.5625697927205772`*^9, 3.5625698650054207`*^9, 
   3.562569939665036*^9, 3.562570068855172*^9, 3.5625737202274113`*^9, 
   3.562578605091386*^9, 3.5625786777251368`*^9, 3.562582470064712*^9, 
   3.562582720318016*^9, 3.562584107856476*^9, 3.5625857076708317`*^9, 
   3.562589364040847*^9, 3.5625924447752542`*^9, 3.562593661743279*^9, 
   3.562593744040038*^9, 3.562594022988534*^9, 3.562594331055098*^9, 
   3.5626069802637453`*^9, 3.562647139338552*^9, 3.562647357316032*^9, 
   3.562649646731385*^9, 3.5626500257543507`*^9, 3.5626503814370527`*^9, 
   3.562650467490608*^9, 3.562650551379038*^9, 3.5626559551951942`*^9, 
   3.562717226778099*^9, 3.5631992321249866`*^9, 3.563461105311162*^9, 
   3.563772959533711*^9, 3.563773058615245*^9, 3.563773882899284*^9, 
   3.56377393436139*^9, 3.563773994414784*^9, 3.568312757519898*^9, 
   3.568312869003972*^9, 3.5683129159862547`*^9, 3.5691323919360657`*^9, 
   3.5692303103463793`*^9, 3.569340252249666*^9, 3.56934051197783*^9, 
   3.569340731120585*^9, 3.569418995448105*^9, 3.5695788934626007`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["$xpermQ"], "Input"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{
  3.5625533652189283`*^9, 3.5625560048840103`*^9, {3.5625562302972383`*^9, 
   3.562556242899356*^9}, 3.562556397955022*^9, 3.56255649303189*^9, 
   3.562556566778192*^9, {3.562558882456213*^9, 3.562558928971656*^9}, 
   3.562561260996649*^9, 3.5625613259694853`*^9, 3.562561629517474*^9, 
   3.5625617331213627`*^9, 3.562561770972074*^9, 3.5625621861749163`*^9, 
   3.562562462940372*^9, 3.562562523133766*^9, 3.562563526897966*^9, 
   3.5625639047849903`*^9, 3.562569792759293*^9, 3.562569865043049*^9, 
   3.562569939698372*^9, 3.562570068911572*^9, 3.562573720261026*^9, 
   3.5625786051274147`*^9, 3.562578677765235*^9, 3.562582470099092*^9, 
   3.562582720352235*^9, 3.562584107886443*^9, 3.562585707708542*^9, 
   3.562589364079637*^9, 3.562592444811549*^9, 3.562593661777379*^9, 
   3.56259374407843*^9, 3.5625940230192947`*^9, 3.562594331110475*^9, 
   3.5626069803028708`*^9, 3.562647139353806*^9, 3.5626473573462143`*^9, 
   3.5626496467663107`*^9, 3.562650025794262*^9, 3.562650381471428*^9, 
   3.5626504675212727`*^9, 3.562650551409761*^9, 3.562655955249443*^9, 
   3.56271722681912*^9, 3.563199232193672*^9, 3.563461105348495*^9, 
   3.563772959584772*^9, 3.563773058678854*^9, 3.563773882965764*^9, 
   3.563773934405519*^9, 3.5637739944753237`*^9, 3.568312757558927*^9, 
   3.5683128690424147`*^9, 3.568312916019198*^9, 3.56913239197156*^9, 
   3.56923031038203*^9, 3.56934025228913*^9, 3.569340512027932*^9, 
   3.569340731171919*^9, 3.569418995481159*^9, 3.569578893529962*^9}]
}, Open  ]],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["1.5. Usage and error messages", "Subsubsection",
 CellChangeTimes->{{3.563741690004548*^9, 3.5637416903089542`*^9}, {
  3.564154013615282*^9, 3.564154013925009*^9}, {3.564336117540654*^9, 
  3.564336142564766*^9}, {3.564744389235794*^9, 3.564744391223597*^9}}],

Cell["\<\
Contents: 
\tVersions
\tBooleans
\tError messages
\tFunctions
\tLists of fields
\tPredefined fields
\tReserved words and protected names
\tTypes of gauge
\tTypes of manifold\
\>", "Text",
 CellChangeTimes->{{3.564737589063151*^9, 3.564737715863504*^9}, 
   3.56474446663629*^9, {3.564750319139655*^9, 3.564750320359291*^9}, {
   3.567239212241198*^9, 3.567239213085224*^9}}],

Cell["\<\

Versions:\
\>", "Text",
 CellChangeTimes->{3.5641540163331623`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"**", " ", "VERSIONS"}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"$Version", "::", "usage"}], "=", 
     "\"\<$Version is a global variable giving the version of the package \
xPand in use.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$xTensorVersionExpected", "::", "usage"}], "=", 
     "\"\<$xTensorVersionExpected is a global variable giving the oldest \
possible version of the package xTensor which is required by the version of \
the package xPand in use.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$xPertVersionExpected", "::", "usage"}], "=", 
     "\"\<$xPertVersionExpected is a global variable giving the oldest \
possible version of the package xPert which is required by the version of the \
package xPand in use.\>\""}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562553443366825*^9, 3.562553471001751*^9}, {
   3.562559589531906*^9, 3.562559738308002*^9}, {3.562559781847436*^9, 
   3.562559851058937*^9}, {3.56265080153127*^9, 3.5626508933976917`*^9}, 
   3.5626586506798573`*^9, {3.5643363643982363`*^9, 3.564336372351531*^9}, {
   3.5644133260481997`*^9, 3.564413327822729*^9}, 3.564479033636413*^9}],

Cell["\<\

Booleans:\
\>", "Text",
 CellChangeTimes->{{3.5626586528243504`*^9, 3.562658664628631*^9}, {
  3.564154020861205*^9, 3.5641540227968197`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"**", " ", "BOOLEANS"}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"BackgroundFieldMethod", "::", "usage"}], " ", "=", " ", 
     "\"\<BackgroundFieldMethod is a boolean option, set by default to \
'False'. If set to 'True', then only the first order of the metric \
perturbation is kept, and it therefore stands for the total metric \
perturbation. \n\nThis option should be placed at the begining of the \
notebook, right after loading the xPand package.\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Recently", " ", 
      RowBox[{"implemented", ".", " ", "Does"}], " ", "not", " ", "work", " ", 
      RowBox[{"correctly", ".", " ", "CP"}], " ", "needs", " ", "to", " ", 
      "fix", " ", 
      RowBox[{"that", ".", " ", "To"}], " ", "be", " ", "checked"}], "..."}], 
    " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$CacheRules", "::", "usage"}], " ", "=", " ", 
     "\"\<If set to 'True', the rules are remembered. This is potentially \
dangerous, so default is 'False'.\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"This", " ", "is", " ", 
     RowBox[{"obsolete", ".", " ", "This"}], " ", "will", " ", "have", " ", 
     "to", " ", "be", " ", 
     RowBox[{"erased", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$ConformalTime", "::", "usage"}], " ", "=", " ", 
     "\"\<If set to 'True' (default value), then the prime ' stands for the \
Lie derivative along the vector 'n' normal to the spatial slices. If the time \
coordinate is taken to be the proper time of the Eulerian observers \
(identified by the normal vector), then the Lie derivative along 'n' \
corresponds to the partial time derivative with respect to the conformal \
time, namely: \!\(\*SubscriptBox[\(\[ScriptCapitalL]\), \(n\)]\) .. = \
\[PartialD]/\[PartialD]\[Eta] .. . \n\nThe second Label-Index (LI) of \
projected tensors represents the number of Lie derivatives along 'n' that are \
applied to them. It also corresponds to the number of partial derivatives \
with respect to conformal time. \n\nIn the cases for which we prefer to use \
the cosmic time, we can choose to employ the second LI not for the number of \
\!\(\*SubscriptBox[\(\[ScriptCapitalL]\), \(n\)]\), but rather for the number \
of 1/a \!\(\*SubscriptBox[\(\[ScriptCapitalL]\), \(n\)]\), where 'a' is the \
scale factor. This is done by setting '$ConformalTime' to 'False'. The label \
index then indicates a derivative with respect to cosmic time.\n\nThe output \
format of the second LI is a prime for a conformal time derivative, and a dot \
for a cosmic time derivative.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$FirstOrderVectorPerturbations", "::", "usage"}], " ", "=", 
     " ", "\"\<Boolean option to decide if first order vector modes should be \
included. Default is 'True'.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$FirstOrderTensorPerturbations", "::", "usage"}], " ", "=", 
     " ", "\"\<Boolean option to decide if first order tensor modes should be \
included. Default is 'True'.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$OpenConstantsOfStructure", "::", "usage"}], " ", "=", " ", 
     "\"\<Boolean value to decide if the constants of structure should be \
parameterized as in Ellis & MacCallum (1969). If 'False', then the constants \
of structure are kept general. If 'True', then the parameterization is: \
\!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \(\(jk\)\(\\\ \)\)]\)= \
\!\(\*SubscriptBox[\(\[Epsilon]\), \(jkl\)]\)\!\(\*SuperscriptBox[\(N\), \(li\
\)]\) + \!\(\*SubscriptBox[\(A\), \([j\)]\)\!\(\*SubscriptBox[SuperscriptBox[\
\(\[Delta]\), \(i\)], \(\(k\)\(]\)\)]\).\>\""}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$SortCovDAutomatic", "::", "usage"}], " ", "=", " ", 
     "\"\<Boolean value to decide whether or not xTensor should commute \
automatically the induced derivatives. Default is 'True' in order to optimize \
the canonicalization of expression. Note that some adhoc commutation \
relations defined in '$CommutecdRules' are also applied in order to enforce \
the transverse properties of vector and tensor fields, on the one hand, and \
the appearance of Laplacians, on the other hand.\>\""}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562553443366825*^9, 3.562553471001751*^9}, {
   3.562559589531906*^9, 3.562559738308002*^9}, {3.562559781847436*^9, 
   3.562559851058937*^9}, {3.56265080153127*^9, 3.5626508933976917`*^9}, {
   3.5626586506798573`*^9, 3.5626586671364737`*^9}, {3.562868690638712*^9, 
   3.5628686944512863`*^9}, {3.562937615927443*^9, 3.562937619402076*^9}, {
   3.5631974508709097`*^9, 3.563197454931546*^9}, {3.563281103619205*^9, 
   3.563281176406497*^9}, {3.563516306646535*^9, 3.56351641963629*^9}, {
   3.56361564741297*^9, 3.563615670678566*^9}, {3.563617032793202*^9, 
   3.563617061631577*^9}, {3.563695753384753*^9, 3.5636957707884483`*^9}, {
   3.5637396562372713`*^9, 3.563740007261181*^9}, {3.564154047630416*^9, 
   3.564154278881774*^9}, {3.5641543343656397`*^9, 3.564154334628578*^9}, {
   3.5641596668389587`*^9, 3.56415967155739*^9}, {3.564159721500881*^9, 
   3.5641597218206663`*^9}, {3.5641597669959707`*^9, 3.564159783054566*^9}, {
   3.5641598312572927`*^9, 3.5641598327021*^9}, {3.564165524024472*^9, 
   3.5641655416621037`*^9}, {3.5643363965772676`*^9, 3.564336403385483*^9}, {
   3.564413329664513*^9, 3.56441333141681*^9}, 3.5644791012405643`*^9, {
   3.5644819137791567`*^9, 3.5644819142346573`*^9}, {3.564750347899493*^9, 
   3.5647504648959427`*^9}, {3.5647505437233753`*^9, 
   3.5647505449639673`*^9}, {3.565249389915386*^9, 3.565249393249385*^9}, {
   3.5652579172938213`*^9, 3.565258008647024*^9}, {3.567402632223963*^9, 
   3.567402633168914*^9}, {3.567402663521368*^9, 3.567402676921792*^9}}],

Cell["\<\

Error messages:\
\>", "Text",
 CellChangeTimes->{{3.5625600230638037`*^9, 3.562560027109066*^9}, 
   3.564317453569652*^9, {3.564336125452752*^9, 3.56433612740521*^9}, 
   3.564391659253798*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "ERROR"}], " ", "MESSAGES"}], " ", "***)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"*", " ", "SetSlicing"}], " ", "**)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SetSlicing", "::", "dimension"}], " ", "=", " ", 
     "\"\<The dimension of the manifold is `1`; it is too small to perform a \
slicing.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SetSlicing", "::", "invalidnormalvector"}], " ", "=", " ", 
     "\"\<The normal vector `1` used to perform the background slicing should \
have only one index, belonging to the VBundle of the manifold. To avoid \
issues, it is possible to not predefine the normal vector and let the \
function SetSlicing define it automatically.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", " ",
      "error", " ", "message", " ", "is", " ", "not", " ", "yet", " ", 
     RowBox[{"used", "."}]}], " ", "**********)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SetSlicing", "::", "ninds"}], " ", "=", " ", 
     "\"\<The number of indices is insufficient to define the (N-1)+1 \
splitting. Use at least `1` indices.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SetSlicing", "::", "noambientmetric"}], " ", "=", " ", 
     "\"\<The ambient metric `1` was not previously defined as a metric. \
Define an ambient metric first, and then call SetSlicing.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", " ",
      "error", " ", "message", " ", "does", " ", "not", " ", "seem", " ", 
     RowBox[{"correct", ".", " ", "It"}], " ", "should", " ", "be", " ", 
     RowBox[{"modified", "."}]}], " ", "**********)"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SetSlicing", "::", "signature"}], " ", "=", " ", 
     "\"\<The signature of the metric `1` should be -1 in order to perform a \
(N-1)+1 background splitting along a time-like vector. This comes from the \
fact that in the current version, the norm of the time-like vectors is fixed \
to -1.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"*", " ", "DefProjectedTensor"}], " ", "**)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", " ",
      "error", " ", "message", " ", "is", " ", "not", " ", "used", " ", 
     RowBox[{"anymore", "."}]}], " ", "**********)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DefProjectedTensor", "::", "invalidindices"}], " ", "=", " ", 
     "\"\<No label-index needs to be given for the definition of projected \
tensors. They are automatically added by subroutines.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DefProjectedTensor", "::", "notdownindices"}], " ", "=", " ", 
     "\"\<In order to be defined, the projected tensor `1` has to be written \
with down indices.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"*", " ", "DefProjectedTensorProperties"}], " ", "**)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DefProjectedTensorProperties", "::", "symmetrictensors"}], "=", 
     "\"\<The current version of DefProjectedTensorProperties can only add \
properties to tensors that are, at least, fully symmetric.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"*", " ", "ExtractComponents"}], " ", "**)"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExtractComponents", "::", "invalidprojector"}], " ", "=", " ", 
     "\"\<One of the projectors in `1` is not valid. The possible projectors \
are: 'Time' or '*NameOfNormalVector*', and 'Space' or \
'*NameOfInducedMetric*'.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"*", " ", "RulesSplitCovDsOfTensor"}], " ", "**)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RulesSplitCovDsOfTensor", "::", "maxcovdnumber"}], " ", "=", 
     " ", "\"\<The number of CovDs was larger than `1`. The last (optional) \
argument of RulesSplitCovDsOfTensor needs to be set to a larger value in \
order to split correctly all covariant derivatives.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"*", " ", "ToxPand"}], " ", "**)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", 
      " ", "two", " ", "error", " ", "messages", " ", "are", " ", "not", " ", 
      "yet", " ", 
      RowBox[{"edited", ".", " ", "The"}], " ", "first", " ", "one", " ", 
      "is", " ", "not", " ", "referred", " ", "to"}], ",", " ", 
     RowBox[{
     "and", " ", "the", " ", "utility", " ", "of", " ", "the", " ", "second", 
      " ", "one", " ", "has", " ", "to", " ", "be", " ", 
      RowBox[{"discussed", "."}]}]}], " ", "**********)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToxPand", "::", "invalidindices"}], " ", "=", " ", 
     "\"\<Incorrect indices for tensor `1`\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToxPand", "::", "invalidconffactor"}], " ", "=", " ", 
     "\"\<A conformal factor should have two label indices, one for the \
perturbation order which is always zero, and one for the number of Lie \
derivatives along u. And in the argument of SplitGaugeChange, you need only \
to put the name of the conformal factor (this is not a[LI[0],LI[0]] but just \
a).\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xPand", "::", "makeboxes"}], " ", "=", " ", 
     "\"\<For anisotropic manifolds, the second label-index can be only \
interpreted as a Lie derivative for indices down.\>\""}], ";"}]}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.562560029732225*^9, 3.562560058049931*^9}, {
   3.5625601776298733`*^9, 3.5625601780058327`*^9}, 3.5625606364657507`*^9, {
   3.562562306098507*^9, 3.562562306419628*^9}, {3.562651113200535*^9, 
   3.562651131517353*^9}, {3.5626603333894787`*^9, 3.562660350408598*^9}, {
   3.562679314741693*^9, 3.562679317235173*^9}, {3.562756084215317*^9, 
   3.562756084780752*^9}, {3.563101677784556*^9, 3.56310168457961*^9}, {
   3.563282733044833*^9, 3.5632827457207117`*^9}, {3.5635160267827053`*^9, 
   3.5635160596046343`*^9}, {3.56371321431415*^9, 3.563713219676538*^9}, {
   3.563733283089192*^9, 3.56373329228699*^9}, {3.563872278063883*^9, 
   3.563872294405508*^9}, 3.564114539738331*^9, {3.564317485953806*^9, 
   3.5643174873829613`*^9}, {3.5643178945941887`*^9, 3.564318062054636*^9}, {
   3.564322696304241*^9, 3.5643227059409018`*^9}, {3.5643229209863157`*^9, 
   3.5643229278417053`*^9}, {3.564323052405993*^9, 3.564323142765626*^9}, {
   3.564323250282939*^9, 3.564323279840042*^9}, {3.564323362345091*^9, 
   3.564323379409501*^9}, {3.5643234938291397`*^9, 3.564323502011854*^9}, {
   3.564323558395585*^9, 3.564323638780513*^9}, {3.564323673575623*^9, 
   3.5643236743009243`*^9}, {3.564323796013287*^9, 3.564323805673365*^9}, {
   3.564323867786749*^9, 3.564323869623001*^9}, {3.564324256144696*^9, 
   3.5643242568691797`*^9}, {3.5643242873702583`*^9, 
   3.5643245076172123`*^9}, {3.564324562275865*^9, 3.564324715218631*^9}, {
   3.564336459692466*^9, 3.564336465802782*^9}, {3.564413334706476*^9, 
   3.5644133576332817`*^9}, {3.5644783753177643`*^9, 3.5644783965871*^9}, {
   3.5647445532187757`*^9, 3.5647445565999517`*^9}, {3.564751246871222*^9, 
   3.564751491261908*^9}, {3.5647515230340548`*^9, 3.564751524625208*^9}, {
   3.564763733391553*^9, 3.564763839768227*^9}, {3.5647638833921967`*^9, 
   3.564763969324724*^9}, {3.564764069208085*^9, 3.564764076008936*^9}, {
   3.564764159518464*^9, 3.5647641651177483`*^9}, {3.564764215319429*^9, 
   3.5647642564621687`*^9}, {3.564764299313512*^9, 3.564764559613078*^9}, {
   3.564764657314281*^9, 3.564764683290351*^9}, {3.564764729244894*^9, 
   3.564764729499342*^9}, 3.564764839550539*^9, {3.564764926890691*^9, 
   3.564765065145566*^9}, {3.5647652532686872`*^9, 3.564765272938899*^9}, {
   3.564765466070223*^9, 3.56476546617486*^9}, {3.564765504222645*^9, 
   3.564765504698318*^9}, {3.564765539798319*^9, 3.564765572563232*^9}, {
   3.564765737768839*^9, 3.56476575290934*^9}, {3.5647658108931103`*^9, 
   3.564765836127644*^9}, {3.5647658884033546`*^9, 3.564765892252067*^9}, {
   3.564810634358597*^9, 3.564810778669835*^9}, {3.564810952836647*^9, 
   3.564810999813388*^9}, {3.5648110381221333`*^9, 3.5648110781077633`*^9}, {
   3.564811173952166*^9, 3.56481123176198*^9}, {3.564811422702827*^9, 
   3.564811445867722*^9}, {3.566107891775495*^9, 3.566107940266493*^9}, {
   3.566313683721601*^9, 3.5663137028779793`*^9}, {3.566463053451673*^9, 
   3.566463061579854*^9}, {3.5664631207039757`*^9, 3.56646314328238*^9}, {
   3.566463222938423*^9, 3.566463280930386*^9}, {3.5664638727296963`*^9, 
   3.566463910443672*^9}, {3.5664639449304867`*^9, 3.566463948280567*^9}, {
   3.566464027285829*^9, 3.566464068402873*^9}, {3.5664691403905773`*^9, 
   3.566469142042242*^9}, {3.566473923148158*^9, 3.5664739242334423`*^9}, {
   3.566532930314022*^9, 3.566532943174261*^9}, 3.5665329787335987`*^9, {
   3.5665334066983213`*^9, 3.566533411153132*^9}, {3.566554338623487*^9, 
   3.5665543660813847`*^9}, {3.5672246028933887`*^9, 3.567224603426874*^9}, {
   3.567402787795672*^9, 3.567402804568277*^9}, {3.5674028350593233`*^9, 
   3.56740283518501*^9}, {3.567402906163595*^9, 3.567402906464418*^9}, {
   3.567402959787294*^9, 3.567403203704307*^9}, {3.567487184294199*^9, 
   3.5674872005979424`*^9}, {3.568550533213417*^9, 3.568550534566237*^9}, {
   3.569132329603216*^9, 3.56913234943994*^9}, 3.569664274971068*^9}],

Cell["\<\

Functions:\
\>", "Text",
 CellChangeTimes->{{3.562658668547049*^9, 3.562658672041497*^9}, {
  3.564154282974319*^9, 3.564154284649679*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"**", " ", "FUNCTIONS"}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SetSlicing", "::", "usage"}], " ", "=", " ", 
     "\"\<SetSlicing[g,n,nNorm,h,cd,{cdPost,cdPre},SpaceTimeType]. \n\nGiven \
a background manifold of dimension 'N' and an ambient metric 'g' on that \
manifold, this function performs a (N-1)+1 slicing. \n\nMore precisely, it \
builds the induced metric 'h' on the hypersurfaces, the associated covariant \
derivative 'cd', and the vector 'n' normal to these hypersurfaces. It also \
sets the type 'SpaceTimeType' for the hypersurfaces. The latter argument can \
take a value among {Anisotropic, BianchiB, BianchiA, BianchiI, FLCurved, \
FLFlat, Minkowski}. The norm 'nNorm' of the vector 'n' is set by default to \
-1 if omitted.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$CommutecdRules", "::", "usage"}], " ", "=", " ", 
     "\"\<Set of remembered rules for the commutation of the induced \
derivatives of the hypersurfaces. This is used to handle the successive \
operations of two, three or four induced derivatices.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Conformal", "::", "usage"}], " ", "=", " ", 
     "\"\<Conformal[metricfinal][metric1,metric2][expr] performs a conformal \
transformation of 'expr' from 'metric1' to 'metric2' and expresses the result \
in terms of 'metricfinal' (along with its associated covariant derivative and \
curvature tensors). If needed, the function first reformulates 'expr' in \
terms of 'metric1'. The two metrics 'metric1' and 'metric2' have to be \
conformally related by DefConformalMetric. \n\n\
Conformal[metric1,metric2][expr] provides the final result with respect to \
the ambient metric, which is the first metric defined on the manifold.\>\""}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ConformalWeight", "::", "usage"}], " ", "=", " ", 
     "\"\<ConformalWeight[tensor[inds]] specifies the power of the conformal \
factor applied in the conformal transformation of the tensor 'tensor'. It \
corresponds to the number of down indices, minus the number of up indices, \
plus the quantity ConformalWeight[tensor] (without the indices). The latter \
is set by default to zero. \n\nFor instance, in the setting \
ConformalWeight[tensor] = 0, we have: \
ConformalWeight[tensor[\[Alpha],\[Beta]]] = -2, and ConformalWeight[tensor[-\
\[Alpha],-\[Beta]]] = 2.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DefConformalMetric", "::", "usage"}], " ", "=", " ", 
     "\"\<DefConformalMetric[g,S] defines a metric conformally related to \
'g', with the conformal factor 'S'. The new metric is named 'gS2', and its \
inverse is given by 'Inv[gS2]'. If other metrics are conformally related to \
'g', then 'gS2' is related to them by transitivity of the conformal \
transformation. \n\nWhen calling the function SetSlicing, the conformal \
factor is chosen to be the scale factor 'a[h]' (or, equivalently, 'ah'). The \
constructed metric 'gah2' then corresponds to the 'real' background metric \
(i.e. the one that would be obtained from the physical metric of the \
manifold).\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DefMetricFields", "::", "usage"}], " ", "=", " ", 
     "\"\<DefMetricFields[g,gpert,h,parameter] defines the perturbed metric \
'gpert' from its background value 'g'. The argument 'h' is the induced metric \
on the spatial hypersurfaces, and the optional argument 'parameter' (set by \
default to \[Epsilon]) is the symbol used in the perturbative expansions. \
Several tensors that are used to decompose 'gpert' are defined when calling \
this function.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DefMatterFields", "::", "usage"}], " ", "=", " ", 
     "\"\<DefMatterFields[uf,ufpert,h,parameter] defines the perturbed vector \
field 'ufpert' from its background value 'uf'. The argument 'h' is the \
induced metric on the spatial hypersurfaces, and the optional argument \
'parameter' (set by default to \[Epsilon]) is the symbol used in the \
perturbative expansions. Several tensors that are used to decompose 'ufpert' \
are defined when calling this function.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DefProjectedTensor", "::", "usage"}], " ", "=", " ", 
     "\"\<DefProjectedTensor[Name[inds],h,options] defines a projected tensor \
on the spatial hypersurfaces. \n\n'Name' refers to the name of the tensor, \
and 'inds' (which has to be with down indices) defines its rank. The argument \
'h' is the induced metric on the spatial hypersurfaces. \n\nThere exist 3 \
types of options. \n\nThe first type is: 'TensorProperties', by default set \
to 'Transverse', 'Traceless' and 'SymmetricTensor'. These can be overwritten \
with 'TensorProperties->ListOfProperties', where 'ListOfProperties' is a list \
whose elements can be: 'Transverse', 'Traceless' and 'SymmetricTensor'. \n\n\
The second option is: 'SpaceTimesOfDefinition', by default set to \
'Background' and 'Perturbed'. These can be also overwritten with \
'SpaceTimesOfDefinition->SpaceTimesList', where 'SpaceTimesList' is a list \
whose elements can be: 'Background' and 'Perturbed'. \n\nThe last option is: \
'PrintAs', by default set to 'Identity'. This can be overwritten with \
'PrintAs->String', in order to specify the output form of the tensor.\>\""}], 
    " ", ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExtractComponents", "::", "usage"}], " ", "=", " ", 
     "\"\<ExtractComponents[expr,h,ListOfProjectors,ListOfFreeIndices] \
projects 'expr' along its time component(s) (i.e. along the vector normal to \
the hypersurfaces) and along its space component(s) (i.e. onto the \
hypersurfaces), being defined by the background slicing associated with the \
induced metric 'h'. \n\n'ListOfProjectors' is a list whose elements are \
among: 'Time' (or, equivalently, '*NameOfNormalVector*') and 'Space' (or, \
equivalently, '*NameOfInducedMetric*'). The length of the list has to equal \
the rank of the tensors of 'expr'. The free indices (in canonical order) of \
'expr' are then projected according to the 'ListOfProjectors'. \n\n\
'ListOfFreeIndices' is the list of free indices on which the ListOfProjectors \
is to be applied. If this is omitted, then it is the list of free indices in \
alphabetic order. \n\nWhen the argument 'ListOfProjectors' is omitted, all \
the projections for rank-0 to rank-2 tensors are displayed in a table.\>\""}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", 
      " ", "command"}], ",", " ", "ExtractOrder", ",", " ", 
     RowBox[{
      RowBox[{"will", " ", "have", " ", "to", " ", "be", " ", "re"}], "-", 
      RowBox[{"edited", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
         "a", " ", "check", " ", "of", " ", "the", " ", "command", " ", "is", 
          " ", "in", " ", "order"}], ")"}], "."}]}]}]}], " ", "**********)"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ExtractOrder", "::", "usage"}], " ", "=", " ", 
     "\"\<ExtractOrder[expr,order] displays the expression at order 'order' \
of 'expr'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IndicesUp", "::", "usage"}], " ", "=", " ", 
     "\"\<IndicesUp[expr] raises the indices of all the tensors of 'expr' \
using the ambient metric.\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IndicesDown", "::", "usage"}], " ", "=", " ", 
     "\"\<IndicesDown[expr] lowers the indices of all the tensors of 'expr' \
using the ambient inverse metric.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", 
      " ", "command"}], ",", " ", "SplitMatter", ",", " ", 
     RowBox[{
      RowBox[{"will", " ", "have", " ", "to", " ", "be", " ", "re"}], "-", 
      RowBox[{"edited", "."}]}]}], " ", "**********)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SplitMatter", "::", "usage"}], " ", "=", " ", 
     "\"\<SplitMatter[uf,ufpert,normuf,h,gauge,order,tiltspecification] \
builds the rules to split the perturbed four-velocity 'ufpert' (with index \
up) in a given 'gauge', and according to the background slicing associated \
with the induced metric 'h'. The rules are computed to the order 'order'. \n\n\
'normuf' is the squared norm of the four-velocity 'uf' (usually taken as -1), \
and the optional argument 'tiltspecification' (set by default to 'NotTilted') \
allows for a tilt between the fluid four-velocity and the vector normal to \
the hypersurfaces. \n\nThe perturbations of all the fields that depend on \
'uf' are also computed.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", 
      " ", "command"}], ",", " ", "SplitMetric", ",", " ", 
     RowBox[{
      RowBox[{"will", " ", "have", " ", "to", " ", "be", " ", "re"}], "-", 
      RowBox[{"edited", "."}]}]}], " ", "**********)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SplitMetric", "::", "usage"}], " ", "=", " ", 
     "\"\<SplitMetric[g,gpert,h,gauge] builds the rules to split the \
perturbed metric 'gpert' in a given gauge and according to the background \
slicing associated with the induced metric 'h'.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$MyRules", "::", "usage"}], " ", "=", " ", 
     "\"\<List of global rules that are remembered by xPand.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"ConstantsDecompositionRules", "::", "usage"}], " ", "=", " ", 
      "\"\<ConstantsDecompositionRules[h] provides the rules to transform the \
constants of structure according to the Bianchi type of the homogeneous \
hypersurfaces associated with the induced metric 'h'. This option is only \
valid for three-dimensional hypersurfaces. \n\nThe parametrization follows \
Ellis & MacCallum (1969), that is, the constants of structure are decomposed \
as: \!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \(\(jk\)\(\\\ \)\)]\)= \
\!\(\*SubscriptBox[\(\[Epsilon]\), \(jkl\)]\)\!\(\*SuperscriptBox[\(N\), \(li\
\)]\) + \!\(\*SubscriptBox[\(A\), \([j\)]\)\!\(\*SubscriptBox[SuperscriptBox[\
\(\[Delta]\), \(i\)], \(\(k\)\(]\)\)]\).\>\""}], ";"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToBianchiType", "::", "usage"}], " ", "=", " ", 
     "\"\<ToBianchiType[h][expr] applies to expr the necessary rules to \
express the constants of structure according to the Bianchi type of the \
homogeneous hypersurfaces associated with the induced metric 'h'. This option \
is only valid for three-dimensional hypersurfaces. \n\nThe parametrization \
follows Ellis & MacCallum (1969), that is, the constants of structure are \
decomposed as: \!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \(\(jk\)\(\\\ \
\)\)]\)= \!\(\*SubscriptBox[\(\[Epsilon]\), \
\(jkl\)]\)\!\(\*SuperscriptBox[\(N\), \(li\)]\) + \!\(\*SubscriptBox[\(A\), \
\([j\)]\)\!\(\*SubscriptBox[SuperscriptBox[\(\[Delta]\), \(i\)], \(\(k\)\(]\)\
\)]\).\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"ConstantsOfStructureRules", "::", "usage"}], " ", "=", " ", 
      "\"\<ConstantsOfStructureRules[h]. \n\nGiven an induced metric h \
corresponding to a non trivial Bianchi type, ConstantsOfStructureRules[h] \
gives all the rules to express the Riemann, the Ricci and the Ricci scalar in \
function of the constants of structure of the spatial sections.\>\""}], ";"}],
     "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToConstantsOfStructure", "::", "usage"}], " ", "=", " ", 
     "\"\<ToConstantsOfStructure[h][expr]. \n\nGiven an induced metric h \
corresponding to a non trivial Bianchi type, ToConstantsOfStructure[h][expr] \
applies to expr all the rules to express the Riemann, the Ricci and the Ricci \
scalar in function of the constants of structure of the spatial \
sections.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", 
       " ", "command"}], ",", " ", "RulesCovDsOfTensor", ",", " ", 
      RowBox[{"is", " ", "not", " ", "yet", " ", 
       RowBox[{"defined", "."}]}]}], " ", "**********)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"RulesCovDsOfTensor", "::", "usage"}], " ", "=", " ", 
      "\"\<\>\""}], ";"}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"**", "**", "**", "**", "**", "**", "**"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToCosmicTime", "::", "usage"}], " ", "=", " ", 
     "\"\<Transforms an expression where the second label index of projected \
tensor means \!\(\*SubscriptBox[\(\[ScriptCapitalL]\), SuperscriptBox[\(n\), \
\(\[Alpha]\)]]\), that is a derivative with respect to conformal time, into \
an expression where the second index means '1/a *\!\(\*SubscriptBox[\(\
\[ScriptCapitalL]\), SuperscriptBox[\(n\), \(\[Alpha]\)]]\)', that is a \
derivative with respect to cosmic time. The global variable $ConformalTime is \
set to False in the process.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToConformalTime", "::", "usage"}], " ", "=", " ", 
     "\"\<Transforms an expression where the second label index of projected \
tensor means '1/a * \!\(\*SubscriptBox[\(\[ScriptCapitalL]\), SuperscriptBox[\
\(n\), \(\[Alpha]\)]]\)', that is a derivative with respect to cosmic time, \
into an expression where the second index means '\!\(\*SubscriptBox[\(\
\[ScriptCapitalL]\), SuperscriptBox[\(n\), \(\[Alpha]\)]]\)', that is a \
derivative with respect to conformal time. The global variable $ConformalTime \
is set to True in the process.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", 
      " ", "command"}], ",", " ", "RulesVelocitySpatial", ",", " ", 
     RowBox[{"is", " ", "not", " ", "yet", " ", 
      RowBox[{"edited", "."}]}]}], " ", "**********)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RulesVelocitySpatial", "::", "usage"}], " ", "=", " ", 
     "\"\<RulesVelocitySpatial[h,uf,duf,NormVectorSquare,gauge,order,\
tiltedvalue] gives the standard rules for the spatial velocity in a given \
gauge. h is the induced metric, uf and duf are the fluid velocity and its \
perturbation. NormVectorSquare is the norm squared of velocity, and gauge is \
the gauge choice. Order is the order up to which the perturbations are \
computed. The last argument, which can be '\\\"Tilted\\\"' or '\\\"NotTiled\\\
\"' is by default set to \\\"NotTilted\\\" and is optional.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SplitGaugeChange", "::", "usage"}], " ", "=", " ", 
     "\"\<SplitGaugeChange[expr,ListPairs,\[Xi],h,order] performs a gauge \
transformation of order 'order' on 'expr', with a conformal transformation of \
conformal factor 'a[h]', and splits the result according to the background \
slicing associated with the induced metric 'h'. \n\n'\[Xi]' is the general \
vector field used for the gauge transformation. It must have a Label-Index \
(LI) for the order of perturbation (i.e. it has to be of the form \
\[Xi][LI[order],index]). 'ListPairs' is the list of rules used for the \
background slicing. \n\nThe theory and formulas for the power expansion of \
gauge transformation was developed by Bruni et al. in: Class. Quantum Grav. \
14, 2585 (1997).\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", 
      " ", "command"}], ",", " ", "SplitFieldsAndGaugeChange", ",", " ", 
     RowBox[{"is", " ", "not", " ", "yet", " ", 
      RowBox[{"edited", "."}]}]}], " ", "**********)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SplitFieldsAndGaugeChange", "::", "usage"}], " ", "=", " ", 
     "\"\<SplitFieldsAndGaugeChange[expr,g,dg,uf,duf,h,order,\
tiltspecification] performs a gauge transformation on expr where expr must \
involve metric perturbations (or curvature tensor associated with this \
metric) or matter field perturbation such as the fluid velocity, and splits \
the results according to the most general gauge choice. \\nh is the induced \
metric, and refers to the background n+1 splitting. g is the metric and dg is \
the metric perturbation. uf is the fluid velocity and duf is the fluid \
velocity perturbation (when index is up). \\n\[Xi] is the general vector \
field used for the gauge transformation which must have a label index for the \
order of perturbation (it is of the form \[Xi][LI[order],Index]), and order \
is the order of the gauge transformation. 'tiltspecification' is optional and \
by default is \\\"NotTilted\\\". \\nThe theory and formulas for the power \
expansion of changes of gauge was developed by Bruni et al. in reference \
Class. Quantum Grav. 14, 2585 (1997).\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"SplitPerturbationsOld", "::", "usage"}], " ", "=", " ", 
      "\"\<This is the old version of SplitPerturbations. It is obsolete, and \
it will have to be removed.\>\""}], ";"}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SplitPerturbations", "::", "usage"}], "=", 
     "\"\<SplitPerturbations[expr,ListPairs,h] splits the expression 'expr', \
using the list of rules 'ListPairs', according to the background slicing \
associated with the induced metric 'h'.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", 
      " ", "command"}], ",", " ", "ToMetric", ",", " ", 
     RowBox[{
      RowBox[{"will", " ", "have", " ", "to", " ", "be", " ", "re"}], "-", 
      RowBox[{"edited", " ", "after", " ", "its", " ", 
       RowBox[{"modification", ".", " ", 
        RowBox[{"**", "**", "**", "**"}]}], "*"}]}]}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToMetric", "::", "usage"}], " ", "=", " ", 
     "\"\<ToMetric[expr,metric] formulates 'expr' in terms of 'metric', and \
its associated covariant derivative and curvature tensors.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToxPand", "::", "usage"}], " ", "=", " ", 
     "\"\<xPand[expr,gpert,uf,ufpert,h,gauge,order,tiltspecification]. \n\n\
This function first performs on 'expr' a conformal transformation with the \
scale factor 'a[h]' (except for a Minkowski 'SpaceType'); then it perturbs \
the result up to the order 'order' by means of xPert tools; and finally, it \
splits the result using the rules associated with the 'gauge', and according \
to the background slicing associated with the induced metric 'h'. \
'tiltspecification' is optional and by default is \\\"NotTilted\\\" \n\nAll \
the perturbed fields are derived from the perturbed metric 'gpert' and the \
perturbed fluid four-velocity 'ufpert'.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ToxPandFromRules", "::", "usage"}], " ", "=", " ", 
     "\"\<ToxPandFromRules[expr,ListPairs,h,order]. \n\nThis function first \
performs on 'expr' a conformal transformation with the scale factor 'a[h]' \
(except for a Minkowski 'SpaceType'); then it perturbs the result up to the \
order 'order' by means of xPert tools; and finally, it splits the result \
using the list of rules 'ListPairs' and according to the background slicing \
associated with the induced metric 'h'. \n\nCompared to the function ToxPand, \
the present function requires to give the rules for the splitting of the \
perturbations.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"VisualizeTensor", "::", "usage"}], " ", "=", " ", 
     "\"\<VisualizeTensor[expr,h] displays in a table the projections of \
'expr' along its time components (i.e. along the vector normal to the \
hypersurfaces) and along its space components (i.e. onto the hypersurfaces), \
being defined by the background slicing associated with the induced metric \
'h'. \n\n'expr' has to be an expression involving tensors of rank 2 \
only.\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "VisualizeTensor", " ", "will", " ", "be", " ", "put", " ", "as", " ", 
      "private"}], ",", " ", 
     RowBox[{
     "since", " ", "the", " ", "function", " ", "ExtractComponents", " ", 
      "already", " ", "handle", " ", 
      RowBox[{"this", "."}]}]}], " ", "*)"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562553443366825*^9, 3.562553471001751*^9}, {
   3.562559589531906*^9, 3.562559738308002*^9}, {3.562559781847436*^9, 
   3.562559851058937*^9}, {3.56265080153127*^9, 3.5626508933976917`*^9}, {
   3.5626586506798573`*^9, 3.5626587318827667`*^9}, 3.562664755959345*^9, {
   3.5626690606709146`*^9, 3.562669098919758*^9}, {3.562679276302835*^9, 
   3.562679307783956*^9}, {3.5627550656900587`*^9, 3.5627550705303087`*^9}, {
   3.562760806795751*^9, 3.562760809823243*^9}, {3.5627611508141003`*^9, 
   3.562761160602457*^9}, {3.56276165452522*^9, 3.5627616583800573`*^9}, {
   3.562761705013288*^9, 3.562761708864526*^9}, 3.5627877728124723`*^9, {
   3.562907058377377*^9, 3.562907067397357*^9}, {3.562907214560246*^9, 
   3.562907228236397*^9}, {3.56290763039528*^9, 3.5629076683497353`*^9}, 
   3.562911641097884*^9, {3.5629117611610327`*^9, 3.5629117745217743`*^9}, {
   3.562933116801978*^9, 3.5629333364594717`*^9}, {3.562933376868229*^9, 
   3.562933511705208*^9}, {3.562937905227179*^9, 3.562937937422718*^9}, {
   3.563101490473027*^9, 3.56310149400908*^9}, {3.563102273653607*^9, 
   3.563102276274551*^9}, {3.563125146050902*^9, 3.56312515612149*^9}, {
   3.5631252434631042`*^9, 3.5631252436292057`*^9}, {3.5631254250131397`*^9, 
   3.563125441986418*^9}, {3.56312566035299*^9, 3.5631256907574587`*^9}, {
   3.563167485955957*^9, 3.563167506583559*^9}, {3.5631716782086067`*^9, 
   3.5631716959522448`*^9}, {3.5631724217994967`*^9, 
   3.5631724224625063`*^9}, {3.563172681562428*^9, 3.563172693133833*^9}, {
   3.5632811990360107`*^9, 3.563281403297917*^9}, {3.5632818531850863`*^9, 
   3.5632818888396*^9}, {3.56351084306551*^9, 3.563511347428422*^9}, {
   3.563515018781344*^9, 3.5635150222538853`*^9}, {3.563515054748885*^9, 
   3.563515801384571*^9}, {3.563515841442799*^9, 3.563515866087612*^9}, {
   3.563515905387251*^9, 3.563515996386401*^9}, 3.563516522773631*^9, {
   3.563516925128433*^9, 3.563517233735999*^9}, {3.563527093932537*^9, 
   3.5635270977878323`*^9}, {3.563529704172472*^9, 3.5635297114319973`*^9}, {
   3.563541878337162*^9, 3.563541891661199*^9}, {3.563543076394692*^9, 
   3.563543080836103*^9}, {3.5635454894613123`*^9, 3.563545496042321*^9}, {
   3.5635595329773493`*^9, 3.563559646661497*^9}, {3.5635597614861403`*^9, 
   3.563559770663628*^9}, {3.5635601367299547`*^9, 3.5635601453012466`*^9}, {
   3.563606219407949*^9, 3.5636063232904787`*^9}, {3.563606357772438*^9, 
   3.563606420174781*^9}, {3.563606577571329*^9, 3.563606597089178*^9}, 
   3.563606662096511*^9, {3.563608159170896*^9, 3.563608214885701*^9}, {
   3.5636085015456133`*^9, 3.563608502968152*^9}, {3.5636100515031443`*^9, 
   3.56361005288127*^9}, {3.563734055990178*^9, 3.5637340645018883`*^9}, {
   3.563740021198794*^9, 3.563740196012589*^9}, {3.563740226694858*^9, 
   3.563740648097619*^9}, {3.563740702807115*^9, 3.563740797153434*^9}, {
   3.5637690215370293`*^9, 3.5637692580969543`*^9}, {3.563769491087626*^9, 
   3.563769513688384*^9}, {3.56377011464046*^9, 3.563770139740532*^9}, 
   3.563772996279595*^9, {3.563774190748207*^9, 3.5637742623970757`*^9}, {
   3.563774347659696*^9, 3.563774354173292*^9}, {3.563779165210161*^9, 
   3.563779166782565*^9}, {3.563787391705875*^9, 3.56378739481249*^9}, {
   3.5638586598245163`*^9, 3.5638587426415663`*^9}, {3.563858773266245*^9, 
   3.563858873878541*^9}, {3.563863983337139*^9, 3.563864289476221*^9}, {
   3.563864320788108*^9, 3.563864473561088*^9}, {3.5638649454063473`*^9, 
   3.563865032601419*^9}, {3.56386521042868*^9, 3.563865217629204*^9}, {
   3.563866136418993*^9, 3.563866137194799*^9}, {3.563866169387919*^9, 
   3.56386617906177*^9}, 3.563866356002823*^9, {3.563866434955368*^9, 
   3.563866454861375*^9}, {3.563947762459425*^9, 3.5639479505021343`*^9}, {
   3.563947987130604*^9, 3.5639479922533607`*^9}, {3.5639480258840313`*^9, 
   3.563948124991087*^9}, {3.564114535088655*^9, 3.564114536981721*^9}, {
   3.5641148883576593`*^9, 3.564114978209754*^9}, {3.5641150948500443`*^9, 
   3.564115113894712*^9}, {3.564134901354436*^9, 3.564134905449253*^9}, {
   3.5641586033457603`*^9, 3.564159419866342*^9}, {3.564159486026084*^9, 
   3.564159519930744*^9}, {3.564159562937245*^9, 3.564159613022708*^9}, {
   3.5641598777823753`*^9, 3.5641598970295687`*^9}, {3.564159934755579*^9, 
   3.564159957551117*^9}, {3.564163244666382*^9, 3.564163265516526*^9}, {
   3.564163384401672*^9, 3.56416357754569*^9}, {3.564163633104162*^9, 
   3.564163729186708*^9}, {3.564163772857565*^9, 3.564163911016787*^9}, {
   3.564164306463333*^9, 3.564164307085026*^9}, {3.564164428139895*^9, 
   3.564164548751237*^9}, {3.56416467464885*^9, 3.5641647351666594`*^9}, {
   3.564164768395327*^9, 3.5641648411641817`*^9}, {3.564164944614246*^9, 
   3.564164979005899*^9}, {3.564165073043795*^9, 3.5641650812415743`*^9}, {
   3.5641651673142977`*^9, 3.564165168150168*^9}, {3.564165498319647*^9, 
   3.564165501363227*^9}, {3.564203512146106*^9, 3.564203569167046*^9}, {
   3.564203619884842*^9, 3.564203627322456*^9}, {3.564203722238833*^9, 
   3.564203906000577*^9}, {3.564203985715515*^9, 3.5642040278977613`*^9}, {
   3.5642040858680573`*^9, 3.564204103555622*^9}, {3.564204229036559*^9, 
   3.564204331538404*^9}, {3.564204379527317*^9, 3.564204552835088*^9}, {
   3.564204633599608*^9, 3.564204751524764*^9}, {3.564204816693112*^9, 
   3.564204973163177*^9}, {3.564205052897027*^9, 3.564205053331992*^9}, {
   3.564205230245809*^9, 3.5642052313419857`*^9}, 3.564205305682188*^9, 
   3.56420544383593*^9, {3.564205690063746*^9, 3.564205745248176*^9}, {
   3.564205775949409*^9, 3.5642060176830397`*^9}, {3.5642060553480597`*^9, 
   3.564206097652376*^9}, {3.5642062105487223`*^9, 3.564206417990171*^9}, {
   3.564211417260929*^9, 3.5642114574745893`*^9}, {3.5642116140482683`*^9, 
   3.564211633409243*^9}, {3.564211664433313*^9, 3.564211834695198*^9}, {
   3.564211925288456*^9, 3.564211997490337*^9}, {3.564212034698732*^9, 
   3.564212035056316*^9}, {3.564212695991907*^9, 3.5642127742695847`*^9}, {
   3.564212856048903*^9, 3.5642128999593983`*^9}, {3.564212945306126*^9, 
   3.564213125055097*^9}, {3.5642132126744423`*^9, 3.5642132218945913`*^9}, {
   3.564213301815557*^9, 3.564213357262388*^9}, {3.5642134264441347`*^9, 
   3.564213554264587*^9}, {3.5642137542331753`*^9, 3.564213783422406*^9}, {
   3.564221940183956*^9, 3.564221940783445*^9}, {3.5642220034878063`*^9, 
   3.5642224304900227`*^9}, {3.564222511628745*^9, 3.564222752064909*^9}, {
   3.564222824177664*^9, 3.564222829257764*^9}, {3.564222917869787*^9, 
   3.564222932040552*^9}, {3.564223210689006*^9, 3.564223243867062*^9}, {
   3.5642232860913363`*^9, 3.564223469737*^9}, {3.5642235249663754`*^9, 
   3.5642236054916143`*^9}, {3.564223686596931*^9, 3.564223826946189*^9}, {
   3.564223857345813*^9, 3.564223902374258*^9}, {3.564223958719907*^9, 
   3.564224023391098*^9}, {3.564224066010305*^9, 3.564224134494163*^9}, {
   3.5642241667677307`*^9, 3.5642241668765287`*^9}, {3.564224439811207*^9, 
   3.564224484811442*^9}, {3.564224552625773*^9, 3.564224624252924*^9}, {
   3.5642246603191757`*^9, 3.564224752237091*^9}, {3.564224859092738*^9, 
   3.564224900741485*^9}, {3.564225180055809*^9, 3.5642252117987947`*^9}, {
   3.56422526950132*^9, 3.564225335577875*^9}, {3.5642254366815243`*^9, 
   3.564225499832471*^9}, {3.564226444529022*^9, 3.564226506281934*^9}, {
   3.564226590080986*^9, 3.5642267130477743`*^9}, {3.564227056647779*^9, 
   3.564227080811625*^9}, {3.564227119037781*^9, 3.5642271437613153`*^9}, {
   3.564227182231945*^9, 3.56422719113762*^9}, {3.564227356453258*^9, 
   3.564227590084059*^9}, {3.564227635266506*^9, 3.564227673679326*^9}, {
   3.564227793895451*^9, 3.5642278827086563`*^9}, {3.5642282129588127`*^9, 
   3.564228281499483*^9}, {3.564233173531561*^9, 3.564233190254004*^9}, {
   3.564233241387582*^9, 3.5642332591883287`*^9}, 3.564233327640328*^9, {
   3.564233358752537*^9, 3.564233380445706*^9}, {3.564233497125876*^9, 
   3.564233540445373*^9}, {3.564233604236726*^9, 3.564233715127677*^9}, {
   3.5642340178618927`*^9, 3.5642340189186172`*^9}, {3.564234069008663*^9, 
   3.564234243059017*^9}, {3.564234273244392*^9, 3.564234447923205*^9}, {
   3.564234479366685*^9, 3.564234628332713*^9}, {3.564234660703847*^9, 
   3.564234684654735*^9}, {3.564234816965022*^9, 3.564235222693164*^9}, {
   3.5642358925517797`*^9, 3.5642359017960463`*^9}, {3.564235947990738*^9, 
   3.564236210341404*^9}, {3.5642367786167183`*^9, 3.56423678032379*^9}, {
   3.5642368197587337`*^9, 3.564236860293639*^9}, {3.564237008944833*^9, 
   3.564237156146985*^9}, {3.564237213166074*^9, 3.564237224918459*^9}, {
   3.564237258399967*^9, 3.564237259181938*^9}, {3.564237631404978*^9, 
   3.5642376357408237`*^9}, {3.5642378297113132`*^9, 3.564237835985609*^9}, {
   3.564237870015677*^9, 3.5642379162959347`*^9}, {3.564238078823537*^9, 
   3.564238111702571*^9}, {3.564238164423737*^9, 3.5642382121819887`*^9}, {
   3.5642382691562033`*^9, 3.564238288345542*^9}, {3.564238494144094*^9, 
   3.5642384956081133`*^9}, {3.564238539022628*^9, 3.564238585838037*^9}, {
   3.5642387428772707`*^9, 3.564238749856357*^9}, {3.5642388068396177`*^9, 
   3.56423883291903*^9}, {3.564238869500249*^9, 3.564238879977789*^9}, 
   3.564238941729607*^9, {3.56423915260471*^9, 3.564239212491806*^9}, {
   3.564239428701635*^9, 3.5642394316097317`*^9}, {3.564239469320505*^9, 
   3.564239475203236*^9}, {3.5642395890574837`*^9, 3.564239613203722*^9}, {
   3.564243684877118*^9, 3.564243692322234*^9}, {3.5642437248538027`*^9, 
   3.564243758181775*^9}, {3.564243799801915*^9, 3.564244052731367*^9}, {
   3.564244167905869*^9, 3.564244305502899*^9}, {3.56424437751334*^9, 
   3.564244380261697*^9}, {3.564244420224312*^9, 3.564244455909905*^9}, {
   3.564244492302848*^9, 3.564244516811198*^9}, {3.5642448937495613`*^9, 
   3.5642448960911016`*^9}, {3.564244956570883*^9, 3.5642449639756527`*^9}, {
   3.5642451678221283`*^9, 3.564245386397833*^9}, {3.564245417248684*^9, 
   3.564245502864065*^9}, 3.564245624285174*^9, {3.564245708559351*^9, 
   3.5642458482384*^9}, {3.564245900075734*^9, 3.5642460580593643`*^9}, {
   3.564246205751975*^9, 3.564246229873581*^9}, {3.564246266165165*^9, 
   3.564246267491156*^9}, {3.5642463452645903`*^9, 3.564246346678602*^9}, {
   3.564246377656362*^9, 3.5642464346631527`*^9}, {3.564246571624957*^9, 
   3.564246573214654*^9}, {3.564246627277301*^9, 3.5642466572984657`*^9}, {
   3.564246763471249*^9, 3.564246839756981*^9}, {3.564295421845009*^9, 
   3.564295427435728*^9}, {3.56429556473834*^9, 3.5642955668261766`*^9}, {
   3.5642960867674026`*^9, 3.5642961190293503`*^9}, {3.564296948227564*^9, 
   3.5642969614468822`*^9}, {3.564297082694166*^9, 3.564297107578446*^9}, {
   3.564297221128552*^9, 3.564297221405455*^9}, {3.56429735679652*^9, 
   3.56429736895584*^9}, {3.5642974407577667`*^9, 3.5642975031626863`*^9}, {
   3.5642975823276453`*^9, 3.5642975832620173`*^9}, {3.564297653669279*^9, 
   3.564297881083331*^9}, {3.564297914702091*^9, 3.5642979298384943`*^9}, {
   3.564297970779722*^9, 3.564297971341249*^9}, {3.5643106956285753`*^9, 
   3.564311030457024*^9}, {3.564311105220994*^9, 3.564311160320285*^9}, {
   3.564311195022007*^9, 3.5643117892386103`*^9}, {3.564312059511779*^9, 
   3.564312061288155*^9}, {3.5643125983408833`*^9, 3.564312644591177*^9}, {
   3.5643127568358192`*^9, 3.564312769867469*^9}, {3.564312865584957*^9, 
   3.564312867623892*^9}, {3.564312922970189*^9, 3.5643129250081577`*^9}, {
   3.564312989918983*^9, 3.564312999497602*^9}, {3.56431314280194*^9, 
   3.564313152679701*^9}, {3.564313226209818*^9, 3.564313228142584*^9}, {
   3.564313267921727*^9, 3.564313270958852*^9}, {3.564313356665105*^9, 
   3.5643133585942917`*^9}, {3.5643134018952513`*^9, 3.564313401987162*^9}, {
   3.564313451438569*^9, 3.564313451842712*^9}, {3.564313494147833*^9, 
   3.564313704781139*^9}, {3.56431378929681*^9, 3.5643138238084106`*^9}, {
   3.564313874228127*^9, 3.5643139210514936`*^9}, {3.564314207448915*^9, 
   3.564314249174694*^9}, {3.564314315254957*^9, 3.5643143241160097`*^9}, {
   3.564314454913268*^9, 3.564314563619822*^9}, {3.5643145998608637`*^9, 
   3.564314601011961*^9}, {3.564314708480592*^9, 3.5643147270647097`*^9}, {
   3.564314791903569*^9, 3.56431479557006*^9}, {3.564314848668776*^9, 
   3.564314852514842*^9}, {3.564315340047933*^9, 3.564315371857523*^9}, 
   3.56431540280858*^9, {3.5643154779714413`*^9, 3.564315488203981*^9}, {
   3.564316291050829*^9, 3.564316348768797*^9}, {3.564316387399272*^9, 
   3.564316666600835*^9}, {3.5643167056063147`*^9, 3.5643169725588284`*^9}, {
   3.564317029857806*^9, 3.564317141659194*^9}, {3.564317196421364*^9, 
   3.564317246432084*^9}, {3.564317297019435*^9, 3.5643174505343447`*^9}, {
   3.5643364382413*^9, 3.5643364440601187`*^9}, 3.564336661864984*^9, {
   3.5643892759105864`*^9, 3.564389279440503*^9}, {3.564391000410862*^9, 
   3.564391044602503*^9}, {3.564399199268713*^9, 3.564399209854978*^9}, {
   3.564399245079712*^9, 3.564399247080413*^9}, {3.564399588441098*^9, 
   3.564399600743545*^9}, {3.5643996556718807`*^9, 3.564399657829817*^9}, {
   3.564410657585782*^9, 3.564410661002036*^9}, {3.564413361887123*^9, 
   3.564413369475387*^9}, {3.5644199271110363`*^9, 3.5644199307097387`*^9}, {
   3.56447169483123*^9, 3.56447171402678*^9}, 3.564471750035503*^9, {
   3.564478324277829*^9, 3.5644783418421707`*^9}, {3.56448033914879*^9, 
   3.564480375872942*^9}, {3.5644804238373823`*^9, 3.564480458362556*^9}, {
   3.5644805096835012`*^9, 3.564480533674769*^9}, {3.564480568403071*^9, 
   3.5644807980963917`*^9}, {3.564480904843615*^9, 3.564481122423585*^9}, {
   3.564481305396922*^9, 3.564481419884508*^9}, {3.564481515378001*^9, 
   3.564481542206457*^9}, {3.564481609326675*^9, 3.5644818370279093`*^9}, {
   3.564481919701481*^9, 3.564481919802055*^9}, {3.5644819627298737`*^9, 
   3.564482146786133*^9}, {3.564482959679943*^9, 3.5644829602255373`*^9}, {
   3.5644830290513363`*^9, 3.5644830318134813`*^9}, {3.564483126819542*^9, 
   3.564483246057579*^9}, {3.564483435785993*^9, 3.56448359798258*^9}, {
   3.564483637549582*^9, 3.564483690332859*^9}, {3.564483784135898*^9, 
   3.5644838583387136`*^9}, {3.564483920127347*^9, 3.564483953845992*^9}, {
   3.564484266562826*^9, 3.5644843374376698`*^9}, {3.564484423127514*^9, 
   3.5644844608207912`*^9}, {3.564484824966741*^9, 3.5644850495231323`*^9}, {
   3.564485081568488*^9, 3.564485097562405*^9}, {3.564485153054637*^9, 
   3.564485326944014*^9}, {3.564487266268037*^9, 3.564487284117867*^9}, {
   3.564502741211955*^9, 3.564502849970489*^9}, {3.564640862348002*^9, 
   3.5646409883011312`*^9}, {3.564727745569132*^9, 3.5647278166170053`*^9}, {
   3.56472789362317*^9, 3.5647280481788588`*^9}, {3.5647280906529303`*^9, 
   3.564728509969749*^9}, {3.564745874592525*^9, 3.564745893053871*^9}, 
   3.564745942730328*^9, {3.564746005228444*^9, 3.5647460055177603`*^9}, 
   3.564746036379883*^9, {3.564750625636746*^9, 3.564750632066259*^9}, {
   3.564750686250931*^9, 3.564750692038692*^9}, {3.5647507981639833`*^9, 
   3.564750910514406*^9}, {3.564751010592016*^9, 3.564751012186173*^9}, {
   3.564751047751926*^9, 3.56475105166529*^9}, {3.5647558582415113`*^9, 
   3.564755864090479*^9}, {3.564756548259591*^9, 3.5647565529046173`*^9}, {
   3.564756587257538*^9, 3.564756594672967*^9}, 3.564756750993867*^9, {
   3.564766272733913*^9, 3.564766273339539*^9}, {3.564768983742859*^9, 
   3.564769019894731*^9}, {3.564769061122923*^9, 3.564769092041669*^9}, {
   3.564810819700615*^9, 3.5648108299814043`*^9}, {3.5648154514961443`*^9, 
   3.564815504085864*^9}, {3.5649452595400877`*^9, 3.5649453086172953`*^9}, {
   3.5649453486407347`*^9, 3.5649453652394857`*^9}, {3.565097095066175*^9, 
   3.5650970959422283`*^9}, {3.565097132870823*^9, 3.5650971346402473`*^9}, {
   3.5650974863261747`*^9, 3.5650975004072227`*^9}, {3.565249401370311*^9, 
   3.565249405016636*^9}, {3.5659457305010023`*^9, 3.565945733437622*^9}, {
   3.567239046755569*^9, 3.567239059234437*^9}, {3.567403222522978*^9, 
   3.5674033127411633`*^9}, {3.567403382401865*^9, 3.56740351541094*^9}, {
   3.567403549958256*^9, 3.567403562638874*^9}, {3.567403607500309*^9, 
   3.567403652010145*^9}, {3.5683661884609203`*^9, 3.5683661900218067`*^9}, {
   3.568367296907819*^9, 3.568367442555911*^9}, {3.568367562203998*^9, 
   3.568367563611053*^9}, 3.568367708999172*^9, {3.569132351050219*^9, 
   3.569132352921936*^9}, {3.569132571317746*^9, 3.569132572578414*^9}, {
   3.5691327934971037`*^9, 3.569132795076577*^9}, {3.569230266679016*^9, 
   3.569230269641056*^9}, {3.5693295367966337`*^9, 3.5693295688077507`*^9}, {
   3.5693404480815563`*^9, 3.569340449889079*^9}, {3.569340703142234*^9, 
   3.569340704088889*^9}, {3.569413605036563*^9, 3.5694136055029497`*^9}, {
   3.5694189444808273`*^9, 3.569418947517651*^9}, {3.569577872662868*^9, 
   3.569577873500532*^9}, {3.5695779090977592`*^9, 3.5695780219042063`*^9}, {
   3.569578064781761*^9, 3.569578143582624*^9}, {3.569578579058025*^9, 
   3.569578579547761*^9}, {3.569735122985539*^9, 3.5697351244831543`*^9}, {
   3.569735281913055*^9, 3.569735300287932*^9}, {3.569735374656679*^9, 
   3.56973539559334*^9}, {3.5697540502230997`*^9, 3.5697540526480427`*^9}, {
   3.569754138909457*^9, 3.569754143962998*^9}, {3.570009800108219*^9, 
   3.570009990906546*^9}, {3.5700102368875713`*^9, 3.570010259052781*^9}, {
   3.5705109713903503`*^9, 3.5705109722293158`*^9}, {3.570511184034911*^9, 
   3.570511184135831*^9}, {3.578892347677198*^9, 3.5788924245037413`*^9}, {
   3.5789795047100697`*^9, 3.578979547726213*^9}, {3.5789796004677353`*^9, 
   3.578979625723805*^9}, {3.579841295937181*^9, 3.579841298811802*^9}}],

Cell["\<\

Lists of fields:\
\>", "Text",
 CellChangeTimes->{{3.563522085441022*^9, 3.563522094258869*^9}, {
   3.564335793999036*^9, 3.564335794720602*^9}, {3.564336527655406*^9, 
   3.564336528995829*^9}, 3.5643368207766113`*^9, 3.5646762730741377`*^9, 
   3.564729645459111*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "LISTS"}], " ", "OF", " ", "FIELDS"}], " ", "***)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"$ListFieldsBackgroundOnly", "::", "usage"}], "=", 
     "\"\<$ListFieldsBackgroundOnly[h], with 'h' being the induced metric on \
the hypersurfaces, is the list of fields that live on the background only. It \
is automatically defined when calling the function SetSlicing.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"$ListFieldsPerturbedOnly", "::", "usage"}], "=", 
     "\"\<$ListFieldsPerturbedOnly[h], with 'h' being the induced metric on \
the hypersurfaces, is the list of fields that live on the perturbed manifold \
only. It contains the metric perturbations. It is automatically defined when \
calling the function DefMetricFields.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"$ListFieldsBackgroundAndPerturbed", "::", "usage"}], "=", 
     "\"\<$ListFieldsBackgroundAndPerturbed[h,uf], with 'h' and 'uf' being \
respectively the induced metric on the hypersurfaces and the fluid \
four-velocity, is the list of fields that live on the background manifold and \
that can be perturbed. It is automatically defined when calling the function \
DefMatterFields.\>\""}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.56350529076859*^9, 3.563505346972734*^9}, {
   3.56350546468531*^9, 3.563505490084202*^9}, {3.563505741595703*^9, 
   3.563505760291872*^9}, 3.563522100266913*^9, {3.563522149559826*^9, 
   3.56352216646793*^9}, {3.563740876472687*^9, 3.56374106364205*^9}, 
   3.563779168517213*^9, {3.564336531437531*^9, 3.5643365426692753`*^9}, {
   3.564384062936235*^9, 3.564384076293379*^9}, {3.5643841342028313`*^9, 
   3.564384145369009*^9}, {3.5643911323137217`*^9, 3.564391176182884*^9}, {
   3.564413375870893*^9, 3.5644133775346537`*^9}, 3.5646762717709427`*^9, 
   3.564728951781151*^9, 3.564730471489954*^9, 3.564811475339241*^9, {
   3.5672298877320023`*^9, 3.567229901476104*^9}, {3.56722993427076*^9, 
   3.567229936693384*^9}, {3.567230204372322*^9, 3.5672302309249363`*^9}, {
   3.56723070326289*^9, 3.567230708228593*^9}, {3.567230871811322*^9, 
   3.567230874622961*^9}, {3.567232608007985*^9, 3.567232628738997*^9}, {
   3.567232739000162*^9, 3.567232965821619*^9}, {3.567233046477715*^9, 
   3.567233121095764*^9}, {3.567233288544669*^9, 3.567233289558195*^9}, {
   3.567233340870678*^9, 3.5672333799646807`*^9}, {3.5672334137925158`*^9, 
   3.567233418510089*^9}, {3.5672334702261353`*^9, 3.567233616019978*^9}, {
   3.567239620812318*^9, 3.5672396778627777`*^9}, 3.5691323540436573`*^9}],

Cell["\<\

Predefined fields:

The energy density and the pressure of the fluid only depend on the fluid \
four-velocity. 
The spatial and time components of the fluid four-velocity depend on (i) the \
fluid four-velocity, and (ii) the induced metric (as it defines the spatial \
projection and is uniquely related to the time projection). 
All the other fields depend (solely) on the choice of the background slicing; \
hence they depend on the associated induced metric. \
\>", "Text",
 CellChangeTimes->{{3.563529090936079*^9, 3.563529093770158*^9}, {
   3.563858894295355*^9, 3.5638590715146112`*^9}, 3.564391185953149*^9, {
   3.564391216151209*^9, 3.5643912611665287`*^9}, {3.564391297789402*^9, 
   3.56439147258327*^9}, {3.564391529934012*^9, 3.564391634724803*^9}, {
   3.564391674141296*^9, 3.5643917893136387`*^9}, {3.564391828455962*^9, 
   3.5643919200504713`*^9}, {3.5643919594078093`*^9, 3.564392117197917*^9}, {
   3.564392168755937*^9, 3.5643922599451933`*^9}, {3.5643923574597893`*^9, 
   3.564392598892552*^9}, {3.56439270543536*^9, 3.56439271831857*^9}, {
   3.564392762986224*^9, 3.564392819600333*^9}, {3.564392950230152*^9, 
   3.564392965611907*^9}, {3.564393103769288*^9, 3.5643931081189833`*^9}, {
   3.564393142931077*^9, 3.5643932350825157`*^9}, {3.564393593047206*^9, 
   3.5643935950724163`*^9}, {3.5643936262726707`*^9, 
   3.5643936921735983`*^9}, {3.564393923872634*^9, 3.564394001215111*^9}, {
   3.564396053746252*^9, 3.5643961094927473`*^9}, {3.564410242396784*^9, 
   3.5644102436247396`*^9}, {3.564411572849244*^9, 3.564411640088475*^9}, {
   3.564419566173736*^9, 3.5644196920081263`*^9}, {3.5644197240597477`*^9, 
   3.5644198653723183`*^9}, {3.5644212175230017`*^9, 3.564421325976513*^9}, 
   3.5647296561507587`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "PREDEFINED"}], " ", 
    RowBox[{"FIELDS", ":", " ", 
     RowBox[{"Geometrical", " ", "quantities"}]}]}], " ", "***)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"a", "::", "usage"}], " ", "=", " ", 
     "\"\<a[h] is the scale factor of the spatial hypersurfaces whose induced \
metric is given by 'h'. It is automatically defined when calling the function \
SetSlicing. \n\nThe command a[h] also builds the symbol 'ah', so one can use \
a[h] or, equivalently, ah. \n\nThe default printed form of a[h][] is: \
'a'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"H", "::", "usage"}], " ", "=", " ", 
     "\"\<H[h] is the Hubble factor of the spatial hypersurfaces whose \
induced metric is given by 'h'. It is automatically defined when calling the \
function SetSlicing. \n\nThe command H[h] also builds the symbol 'Hh', so one \
can use H[h] or, equivalently, Hh. \n\nThe default printed form of H[h][] is: \
'\[ScriptCapitalH]'.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Connection", "::", "usage"}], " ", "=", " ", 
     "\"\<Connection[h][index,index,index] are the coefficients of the \
connection associated with the induced metric 'h'. They are automatically \
defined when calling the function SetSlicing. \n\nThe command Connection[h] \
builds the symbol 'Connectionh', so one can use \
Connection[h][index,index,index] or, equivalently, \
Connectionh[index,index,index].\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CS", "::", "usage"}], " ", "=", " ", 
     "\"\<CS[h][index,index,index] are the constants of structure on the \
hypersurfaces associated with the induced metric 'h'. They are automatically \
defined when calling the function SetSlicing. \n\nThe command CS[h] builds \
the symbol 'CSh', so one can use CS[h][index,index,index] or, equivalently, \
CSh[index,index,index]. \n\nThe default printed form of \
CS[h][-index,-index,-index] is: '\!\(\*SubscriptBox[\(C\), \(index\\\ index\\\
\ index\)]\)'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"nt", "::", "usage"}], " ", "=", " ", 
     "\"\<nt[h][index,index] is the symmetric tensor part involved in the \
decomposition of the constants of structure: \
\!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \(\(jk\)\(\\\ \)\)]\)= \
\!\(\*SubscriptBox[\(\[Epsilon]\), \(jkl\)]\)\!\(\*SuperscriptBox[\(N\), \(li\
\)]\) + \!\(\*SubscriptBox[\(A\), \([j\)]\)\!\(\*SubscriptBox[SuperscriptBox[\
\(\[Delta]\), \(i\)], \(\(k\)\(]\)\)]\), in Ellis and MacCallum (1969). It is \
automatically defined when calling the function SetSlicing for Bianchi \
space-times of type other then I. The presence as an argument of the induced \
metric 'h' is reminiscent of the choice of the background slicing. \n\nThe \
command nt[h] builds the symbol 'nth', so one can use nt[h][index,index] or, \
equivalently, nth[index,index]. \n\nThe default printed form of \
nt[h][-index,-index] is: '\!\(\*SubscriptBox[\(N\), \(index\\\ index\)]\)'.\>\
\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"av", "::", "usage"}], " ", "=", " ", 
     "\"\<av[h][index] is the 'vector' part involved in the decomposition of \
the constants of structure: \!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \
\(\(jk\)\(\\\ \)\)]\)= \!\(\*SubscriptBox[\(\[Epsilon]\), \
\(jkl\)]\)\!\(\*SuperscriptBox[\(N\), \(li\)]\) + \!\(\*SubscriptBox[\(A\), \
\([j\)]\)\!\(\*SubscriptBox[SuperscriptBox[\(\[Delta]\), \(i\)], \(\(k\)\(]\)\
\)]\), in Ellis & MacCallum (1969). It is automatically defined when calling \
the function SetSlicing for Bianchi space-times of type other than I. The \
presence as an argument of the induced metric 'h' is reminiscent of the \
choice of the background slicing.\n\nThe command av[h] builds the symbol \
'avh', so one can use av[h][index] or, equivalently, avh[index]. \n\nThe \
default printed form of av[h][-index] is: '\!\(\*SubscriptBox[\(A\), \
\(index\)]\)'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[ScriptK]", "::", "usage"}], " ", "=", " ", 
     "\"\<\[ScriptK][h] is the (constant) curvature parameter of the \
isotropic and homogeneous hypersurfaces associated with the induced metric \
'h'. It is automatically defined when calling the function SetSlicing for \
Friedmann-Lemaitre cosmologies. \n\nThe command \[ScriptK][h] also builds the \
symbol '\[ScriptK]h', so one can use \[ScriptK][h] or, equivalently, \
\[ScriptK]h. \n\nThe default printed form of \[ScriptK][h][] is: \
\[ScriptK].\>\""}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.563529098620056*^9, {3.563529572905963*^9, 3.5635295754676533`*^9}, {
   3.5635297169900007`*^9, 3.5635297193338947`*^9}, {3.5635299616211767`*^9, 
   3.5635299638000298`*^9}, {3.563530688722741*^9, 3.563530690756474*^9}, {
   3.563541591680825*^9, 3.5635416000818853`*^9}, {3.563541666651371*^9, 
   3.563541670239068*^9}, {3.5637410732568293`*^9, 3.5637412855719624`*^9}, {
   3.563741322380003*^9, 3.563741607340045*^9}, {3.563769685771495*^9, 
   3.563769725749654*^9}, {3.563779114008175*^9, 3.5637791154236383`*^9}, {
   3.563858607908971*^9, 3.563858608189933*^9}, {3.563882166214254*^9, 
   3.5638821776289043`*^9}, {3.564392263234823*^9, 3.564392263480352*^9}, {
   3.564392368141141*^9, 3.564392368437698*^9}, {3.564393722008823*^9, 
   3.5643937628150587`*^9}, {3.564393857361744*^9, 3.56439385815298*^9}, {
   3.564395932210751*^9, 3.564395983005815*^9}, {3.564396021460018*^9, 
   3.564396038943891*^9}, {3.564396147673544*^9, 3.564396241415987*^9}, {
   3.564396603194503*^9, 3.564396698867875*^9}, {3.564396769708329*^9, 
   3.564396816555092*^9}, {3.564397222382143*^9, 3.564397378870277*^9}, {
   3.564397456919639*^9, 3.564397475706501*^9}, {3.564397554048832*^9, 
   3.564397571999413*^9}, {3.56439760897882*^9, 3.564397711648943*^9}, {
   3.564397798190178*^9, 3.564398048882742*^9}, {3.564398088492824*^9, 
   3.564398099710856*^9}, {3.564398142198896*^9, 3.5643981558529167`*^9}, {
   3.564398251287224*^9, 3.564398253598948*^9}, {3.564398284639246*^9, 
   3.564398294223792*^9}, {3.564398340407454*^9, 3.564398416464369*^9}, {
   3.564398470660391*^9, 3.5643984858356447`*^9}, {3.5643985182778807`*^9, 
   3.564398540579883*^9}, {3.564398618951847*^9, 3.564398713549178*^9}, {
   3.56439879783613*^9, 3.564398806519412*^9}, {3.5643988821652327`*^9, 
   3.5643989175158787`*^9}, {3.564398974143949*^9, 3.5643991358247643`*^9}, {
   3.564399169415123*^9, 3.564399179959343*^9}, {3.564399719610601*^9, 
   3.5643997698099546`*^9}, {3.564399903299595*^9, 3.5644001009718103`*^9}, {
   3.564400134442177*^9, 3.564400147251369*^9}, {3.564400200322465*^9, 
   3.5644002162155657`*^9}, {3.5644102595471907`*^9, 3.564410292507016*^9}, {
   3.5644103293344584`*^9, 3.564410531965232*^9}, {3.564410563781719*^9, 
   3.564410627211535*^9}, {3.564410667579928*^9, 3.564410697131487*^9}, {
   3.564411655406416*^9, 3.564411713593401*^9}, {3.564411770261319*^9, 
   3.564411792780678*^9}, {3.564412311952675*^9, 3.564412375795704*^9}, {
   3.564412406686892*^9, 3.5644125890097103`*^9}, {3.564412633973001*^9, 
   3.564412672819117*^9}, {3.564412716318192*^9, 3.564412741935102*^9}, {
   3.5644128650017138`*^9, 3.564412865798403*^9}, {3.564413018077672*^9, 
   3.564413018810719*^9}, {3.564413183506721*^9, 3.564413317021476*^9}, {
   3.5644133931155663`*^9, 3.5644135713696833`*^9}, 3.5644136090100613`*^9, {
   3.564413671611712*^9, 3.564413742026853*^9}, {3.564413792535685*^9, 
   3.564413792668976*^9}, {3.5644199188915663`*^9, 3.564419936026825*^9}, {
   3.564420084215021*^9, 3.5644201493383102`*^9}, {3.564420225757457*^9, 
   3.564420269865443*^9}, {3.564420304680749*^9, 3.564420491794313*^9}, {
   3.564420574453224*^9, 3.564420586156839*^9}, {3.564420656365575*^9, 
   3.5644207261797647`*^9}, {3.564420784550645*^9, 3.564420846837594*^9}, {
   3.564420904607929*^9, 3.5644209114823437`*^9}, {3.564420985189136*^9, 
   3.5644211258064337`*^9}, {3.5644211597267637`*^9, 
   3.5644211861645823`*^9}, {3.564421342246716*^9, 3.5644217181158857`*^9}, {
   3.56464099647338*^9, 3.564640996770115*^9}, {3.564641073907185*^9, 
   3.564641097868968*^9}, {3.564641139743664*^9, 3.564641614789955*^9}, {
   3.564641663000211*^9, 3.5646417405634527`*^9}, {3.564641793716207*^9, 
   3.564641795441558*^9}, {3.564641900701276*^9, 3.564641928916485*^9}, {
   3.564676169666953*^9, 3.564676240933457*^9}, {3.5646765427052402`*^9, 
   3.564677345717458*^9}, {3.564677489586341*^9, 3.5646775768929777`*^9}, {
   3.564678203869955*^9, 3.5646782056146297`*^9}, {3.564678257619134*^9, 
   3.564678277322136*^9}, {3.564678311850184*^9, 3.564678312217794*^9}, {
   3.5646783953744698`*^9, 3.564678535104558*^9}, {3.564678869234044*^9, 
   3.564678894352254*^9}, {3.5646789896485147`*^9, 3.564678990798492*^9}, {
   3.5646791062584248`*^9, 3.5646791083280573`*^9}, {3.564679215164433*^9, 
   3.564679373133335*^9}, {3.564680136700993*^9, 3.564680137405488*^9}, {
   3.56468074504186*^9, 3.564681427972633*^9}, {3.5647462523599577`*^9, 
   3.56474628550168*^9}, {3.564755952104638*^9, 3.5647559581997557`*^9}, {
   3.564766375874447*^9, 3.564766394787353*^9}, {3.564766443579328*^9, 
   3.564766493885976*^9}, {3.564766542223796*^9, 3.564766543395938*^9}, {
   3.564766592261353*^9, 3.564766603885126*^9}, {3.564766653250749*^9, 
   3.564766732474419*^9}, {3.564766807515518*^9, 3.564766817407099*^9}, {
   3.564766848663518*^9, 3.564766883674157*^9}, {3.564767025783601*^9, 
   3.564767026179976*^9}, {3.564767088345784*^9, 3.564767138005394*^9}, {
   3.564767721309101*^9, 3.56476772156953*^9}, {3.564773826505233*^9, 
   3.5647742307805023`*^9}, {3.564774260972692*^9, 3.5647745597570877`*^9}, {
   3.564775590816765*^9, 3.564775602868701*^9}, 3.564775649976816*^9, {
   3.564775973389181*^9, 3.564775997644332*^9}, {3.5647761203893948`*^9, 
   3.564776176814426*^9}, {3.5647763662507973`*^9, 3.564776367065769*^9}, {
   3.56477651786665*^9, 3.5647765642753487`*^9}, {3.564776667758099*^9, 
   3.564776702439014*^9}, {3.564776768335742*^9, 3.564776768723634*^9}, {
   3.564776974143614*^9, 3.564777005819934*^9}, {3.5648115106775*^9, 
   3.564812278619575*^9}, {3.564812379517459*^9, 3.564812516616415*^9}, {
   3.56491406430632*^9, 3.564914125578043*^9}, {3.564914205997487*^9, 
   3.5649142298285913`*^9}, {3.5649142644004097`*^9, 3.564914301030965*^9}, {
   3.5649150395794888`*^9, 3.564915115607502*^9}, {3.564915484655713*^9, 
   3.56491562018213*^9}, {3.564979151514997*^9, 3.564979171052451*^9}, 
   3.564982127473015*^9, {3.564982184913395*^9, 3.564982205234683*^9}, {
   3.5652494137773867`*^9, 3.565249425204674*^9}, {3.56913235508057*^9, 
   3.569132359696357*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "PREDEFINED"}], " ", 
    RowBox[{"FIELDS", ":", " ", 
     RowBox[{
     "Scalar", " ", "field", " ", "and", " ", "fluid", " ", 
      "quantities"}]}]}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[CurlyPhi]", "::", "usage"}], " ", "=", " ", 
     "\"\<\[CurlyPhi][LI[p],LI[q]] is a general scalar field, automatically \
defined when calling the function DefMatterFields. \n\nThe first Label-Index \
(LI) gives the order 'p' of '\[CurlyPhi]' (hence, for p = 0, '\[CurlyPhi]' \
corresponds to the background value of the scalar field). The second LI \
represents the number 'q' of Lie derivatives along the vector normal to the \
hypersurfaces acting on the 'p'-order of '\[CurlyPhi]'. \n\nThe commands \
\[CurlyPhi][] and \[CurlyPhi][LI[p]] are defined to be equal to \
\[CurlyPhi][LI[0],LI[0]] and \[CurlyPhi][LI[p],LI[0]], respectively.\>\""}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Rho]", "::", "usage"}], " ", "=", " ", 
     "\"\<\[Rho][uf][LI[p],LI[q]] is the energy density of the fluid, \
automatically defined when calling the function DefMatterFields. It depends \
on the fluid four-velocity 'uf'. \n\nThe first Label-Index (LI) gives the \
order 'p' of '\[Rho]' (hence, for p = 0, '\[Rho]' corresponds to the \
background value of the energy density). The second LI represents the number \
'q' of Lie derivatives along the vector normal to the hypersurfaces acting on \
the 'p'-order of '\[Rho]'. \n\nThe commands \[Rho][uf][] and \
\[Rho][uf][LI[p]] are defined to be equal to \[Rho][uf][LI[0],LI[0]] and \
\[Rho][uf][LI[p],LI[0]], respectively. \n\nThe command \[Rho][uf] builds the \
symbol '\[Rho]uf', so one can use \[Rho][uf][LI[p],LI[q]] or, equivalently, \
\[Rho]uf[LI[p],LI[q]].\>\""}], ";"}], "\[IndentingNewLine]", "\t", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"P", "::", "usage"}], " ", "=", " ", 
     "\"\<P[uf][LI[p],LI[q]] is the pressure of the fluid, automatically \
defined when calling the function DefMatterFields. It depends on the fluid \
four-velocity 'uf'. \n\nThe first Label-Index (LI) gives the order 'p' of 'P' \
(hence, for p = 0, 'P' corresponds to the background value of the pressure). \
The second LI represents the number 'q' of Lie derivatives along the vector \
normal to the hypersurfaces acting on the 'p'-order of 'P'. \n\nThe commands \
P[uf][] and P[uf][LI[p]] are defined to be equal to P[uf][LI[0],LI[0]] and \
P[uf][LI[p],LI[0]], respectively. \n\nThe command P[uf] builds the symbol \
'Puf', so one can use P[uf][LI[p],LI[q]] or, equivalently, \
Puf[LI[p],LI[q]].\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"\[CapitalPi]", "::", "usage"}], " ", "=", " ", 
      "\"\<\[CapitalPi][uf][LI[p],LI[q],index,index] is the anisotropic \
stress tensor of the fluid, automatically defined when calling the function \
DefMatterFields. It depends on the fluid four-velocity 'uf'. \n\nThe first \
Label-Index (LI) gives the order 'p' of '\[CapitalPi]' (hence, for p = 0, '\
\[CapitalPi]' corresponds to the (vanishing) background value of the \
anisotropic stress). The second LI represents the number 'q' of Lie \
derivatives along the vector normal to the hypersurfaces acting on the \
'p'-order of '\[CapitalPi]'. \n\nThe commands \[CapitalPi][uf][index,index] \
and \[CapitalPi][uf][LI[p],index,index] are defined to be equal to \
\[CapitalPi][uf][LI[0],LI[0],index,index] and \
\[CapitalPi][uf][LI[p],LI[0],index,index], respectively. \n\nThe command \
\[CapitalPi][uf] builds the symbol '\[CapitalPi]uf', so one can use \
\[CapitalPi][uf][LI[p],LI[q],index,index] or, equivalently, \
\[CapitalPi]uf[LI[p],LI[q],index,index].\>\""}], ";"}], " ", 
    "*)"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.563529098620056*^9, {3.563529572905963*^9, 3.5635295754676533`*^9}, {
   3.5635297169900007`*^9, 3.5635297193338947`*^9}, {3.5635299616211767`*^9, 
   3.5635299638000298`*^9}, {3.563530688722741*^9, 3.563530690756474*^9}, {
   3.563541591680825*^9, 3.5635416000818853`*^9}, {3.563541666651371*^9, 
   3.563541670239068*^9}, {3.5637410732568293`*^9, 3.5637412855719624`*^9}, {
   3.563741322380003*^9, 3.563741607340045*^9}, {3.563769685771495*^9, 
   3.563769725749654*^9}, {3.563779114008175*^9, 3.5637791154236383`*^9}, {
   3.563858607908971*^9, 3.563858608189933*^9}, {3.563882166214254*^9, 
   3.5638821776289043`*^9}, {3.564392263234823*^9, 3.564392263480352*^9}, {
   3.564392368141141*^9, 3.564392368437698*^9}, {3.564393722008823*^9, 
   3.5643937628150587`*^9}, {3.564393857361744*^9, 3.56439385815298*^9}, {
   3.564395932210751*^9, 3.564395983005815*^9}, {3.564396021460018*^9, 
   3.564396038943891*^9}, {3.564396147673544*^9, 3.564396241415987*^9}, {
   3.564396603194503*^9, 3.564396698867875*^9}, {3.564396769708329*^9, 
   3.564396816555092*^9}, {3.564397222382143*^9, 3.564397378870277*^9}, {
   3.564397456919639*^9, 3.564397475706501*^9}, {3.564397554048832*^9, 
   3.564397571999413*^9}, {3.56439760897882*^9, 3.564397711648943*^9}, {
   3.564397798190178*^9, 3.564398048882742*^9}, {3.564398088492824*^9, 
   3.564398099710856*^9}, {3.564398142198896*^9, 3.5643981558529167`*^9}, {
   3.564398251287224*^9, 3.564398253598948*^9}, {3.564398284639246*^9, 
   3.564398294223792*^9}, {3.564398340407454*^9, 3.564398416464369*^9}, {
   3.564398470660391*^9, 3.5643984858356447`*^9}, {3.5643985182778807`*^9, 
   3.564398540579883*^9}, {3.564398618951847*^9, 3.564398713549178*^9}, {
   3.56439879783613*^9, 3.564398806519412*^9}, {3.5643988821652327`*^9, 
   3.5643989175158787`*^9}, {3.564398974143949*^9, 3.5643991358247643`*^9}, {
   3.564399169415123*^9, 3.564399179959343*^9}, {3.564399719610601*^9, 
   3.5643997698099546`*^9}, {3.564399903299595*^9, 3.5644001009718103`*^9}, {
   3.564400134442177*^9, 3.564400147251369*^9}, {3.564400200322465*^9, 
   3.5644002162155657`*^9}, {3.5644102595471907`*^9, 3.564410292507016*^9}, {
   3.5644103293344584`*^9, 3.564410531965232*^9}, {3.564410563781719*^9, 
   3.564410627211535*^9}, {3.564410667579928*^9, 3.564410697131487*^9}, {
   3.564411655406416*^9, 3.564411713593401*^9}, {3.564411770261319*^9, 
   3.564411792780678*^9}, {3.564412311952675*^9, 3.564412375795704*^9}, {
   3.564412406686892*^9, 3.5644125890097103`*^9}, {3.564412633973001*^9, 
   3.564412672819117*^9}, {3.564412716318192*^9, 3.564412741935102*^9}, {
   3.5644128650017138`*^9, 3.564412865798403*^9}, {3.564413018077672*^9, 
   3.564413018810719*^9}, {3.564413183506721*^9, 3.564413317021476*^9}, {
   3.5644133931155663`*^9, 3.5644135713696833`*^9}, 3.5644136090100613`*^9, {
   3.564413671611712*^9, 3.564413742026853*^9}, {3.564413792535685*^9, 
   3.564413792668976*^9}, {3.5644199188915663`*^9, 3.564419936026825*^9}, 
   3.564420084215021*^9, {3.564420495712131*^9, 3.564420517966017*^9}, {
   3.564421723540777*^9, 3.5644218823039637`*^9}, {3.564641949704521*^9, 
   3.564641954960586*^9}, {3.564677333491714*^9, 3.564677334059116*^9}, {
   3.5646775850062933`*^9, 3.564677657453298*^9}, {3.564677714671916*^9, 
   3.564677717780787*^9}, 3.564677762912032*^9, {3.56467780318633*^9, 
   3.564677814519187*^9}, {3.564677859790596*^9, 3.56467801289601*^9}, {
   3.5646781217033987`*^9, 3.5646781824786997`*^9}, {3.564679419266523*^9, 
   3.5646794444105*^9}, {3.564679570722095*^9, 3.5646796485076847`*^9}, {
   3.5646796961584167`*^9, 3.564679861734617*^9}, {3.564681431699543*^9, 
   3.564681661531746*^9}, {3.5646817009146023`*^9, 3.564682032759364*^9}, {
   3.564767735358409*^9, 3.56476774432788*^9}, {3.5647677903605137`*^9, 
   3.564767886025894*^9}, {3.564767932381274*^9, 3.5647680565181837`*^9}, {
   3.564768124636098*^9, 3.5647682616255302`*^9}, {3.564774565527379*^9, 
   3.5647746265765457`*^9}, {3.56477468818675*^9, 3.564774748874424*^9}, {
   3.5647747841518307`*^9, 3.5647750779133453`*^9}, {3.564775176136991*^9, 
   3.564775184423254*^9}, {3.564775222339225*^9, 3.564775388701743*^9}, {
   3.5647754454509697`*^9, 3.564775447022889*^9}, {3.5647755032401867`*^9, 
   3.564775515439823*^9}, {3.564775678135952*^9, 3.5647756989486856`*^9}, {
   3.5647759519027567`*^9, 3.564775966239109*^9}, {3.564776202589739*^9, 
   3.564776205933406*^9}, {3.564776582732881*^9, 3.564776588849329*^9}, {
   3.564776622482438*^9, 3.564776649162181*^9}, {3.564777039438895*^9, 
   3.56477704340007*^9}, {3.56481255279244*^9, 3.564812565751875*^9}, {
   3.5648126921472883`*^9, 3.564812992974002*^9}, {3.564813026901284*^9, 
   3.564813144277815*^9}, {3.5648131769430313`*^9, 3.564813355900416*^9}, {
   3.564813388916429*^9, 3.564813499859603*^9}, {3.56481354221953*^9, 
   3.564813552021624*^9}, {3.56482724275243*^9, 3.564827265541851*^9}, {
   3.565097096871982*^9, 3.5650970996521273`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "PREDEFINED"}], " ", 
    RowBox[{"FIELDS", ":", " ", 
     RowBox[{
      RowBox[{"Perturbed", " ", "fluid", " ", "four"}], "-", "velocity"}]}]}],
    " ", "***)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"V0", "::", "usage"}], " ", "=", " ", 
     "\"\<V0[h,uf][LI[p],LI[q]] is the time part of the perturbed fluid \
four-velocity 'ufpert' (with index up): ufpert = V0 \[Times] \
'*NameOfNormalVector*' + Vspat. It is automatically defined when calling the \
function DefMatterFields. It depends on the choice of the background slicing, \
and hence on the induced metric 'h'. \n\nThe first Label-Index (LI) gives the \
order 'p' of 'V0' (hence, if the fluid is not tilted in the background, 'V0' \
equals 1 for p = 0). The second LI represents the number 'q' of Lie \
derivatives along the vector normal to the hypersurfaces acting on the \
'p'-order of 'V0'. \n\nThe commands V0[h,uf][] and V0[h,uf][LI[p]] are \
defined to be equal to V0[h,uf][LI[0],LI[0]] and V0[h,uf][LI[p],LI[0]], \
respectively. \n\nThe command V0[h,uf] builds the symbol 'V0huf', so one can \
use V0[h,uf][LI[p],LI[q]] or, equivalently, V0huf[LI[p],LI[q]]. \n\nThe \
default printed form of V0[h,uf][] is: 'V0'.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Vspat", "::", "usage"}], " ", "=", " ", 
     "\"\<Vspat[h,uf][LI[p],LI[q],index] is the spatial part of the perturbed \
fluid four-velocity 'ufpert' (with index up): ufpert = V0 \[Times] \
'*NameOfNormalVector*' + Vspat. It is automatically defined when calling the \
function DefMatterFields. It depends on the choice of the background slicing, \
and hence on the induced metric 'h'. \n\nThe first Label-Index (LI) gives the \
order 'p' of 'Vspat' (hence, if the fluid is not tilted in the background, \
'Vspat' is null for p = 0). The second LI represents the number 'q' of Lie \
derivatives along the vector normal to the hypersurfaces acting on the \
'p'-order of 'Vspat'. \n\nThe commands Vspat[h,uf][index] and \
Vspat[h,uf][LI[p],index] are defined to be equal to \
Vspat[h,uf][LI[0],LI[0],index] and Vspat[h,uf][LI[p],LI[0],index], \
respectively. \n\nThe command Vspat[h,uf] builds the symbol 'Vspathuf', so \
one can use Vspat[h,uf][LI[p],LI[q],index] or, equivalently, \
Vspathuf[LI[p],LI[q],index]. \n\nThe default printed form of \
Vspat[h,uf][-index] is: '\!\(\*SubscriptBox[\(\[ScriptCapitalV]\), \(index\)]\
\)'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Vs", "::", "usage"}], " ", "=", " ", 
     "\"\<Vs[h,uf][LI[p],LI[q]] is the scalar part of the scalar-vector \
decomposition of 'Vspat', where 'Vspat' is the spatial part of the perturbed \
fluid four-velocity 'ufpert' (with index up). It is automatically defined \
when calling the function DefMatterFields. It depends on the choice of the \
background slicing, and hence on the induced metric 'h'. \n\nThe first \
Label-Index (LI) gives the order 'p' of 'Vs' (hence, if the fluid is not \
tilted in the background, 'Vs' is null for p = 0). The second LI represents \
the number 'q' of Lie derivatives along the vector normal to the \
hypersurfaces acting on the 'p'-order of 'Vs'. \n\nThe commands Vs[h,uf][] \
and Vs[h,uf][LI[p]] are defined to be equal to Vs[h,uf][LI[0],LI[0]] and \
Vs[h,uf][LI[p],LI[0]], respectively. \n\nThe command Vs[h,uf] builds the \
symbol 'Vshuf', so one can use Vs[h,uf][LI[p],LI[q]] or, equivalently, \
Vshuf[LI[p],LI[q]]. \n\nThe default printed form of Vs[h,uf][] is: \
'V'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Vv", "::", "usage"}], " ", "=", " ", 
     "\"\<Vv[h,uf][LI[p],LI[q],index] is the vector part of the scalar-vector \
decomposition of 'Vspat', where 'Vspat' is the spatial part of the perturbed \
fluid four-velocity 'ufpert' (with index up). It is automatically defined \
when calling the function DefMatterFields. It depends on the choice of the \
background slicing, and hence on the induced metric 'h'. \n\nThe first \
Label-Index (LI) gives the order 'p' of 'Vv' (hence, if the fluid is not \
tilted in the background, 'Vv' is null for p = 0). The second LI represents \
the number 'q' of Lie derivatives along the vector normal to the \
hypersurfaces acting on the 'p'-order of 'Vv'. \n\nThe commands \
Vv[h,uf][index] and Vv[h,uf][LI[p],index] are defined to be equal to \
Vv[h,uf][LI[0],LI[0],index] and Vv[h,uf][LI[p],LI[0],index], respectively. \n\
\nThe command Vv[h,uf] builds the symbol 'Vvhuf', so one can use \
Vv[h,uf][LI[p],LI[q],index] or, equivalently, Vvhuf[LI[p],LI[q],index]. \n\n\
The default printed form of Vv[h,uf][-index] is: '\!\(\*SubscriptBox[\(V\), \
\(index\)]\)'.\>\""}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.563529098620056*^9, {3.563529572905963*^9, 3.5635295754676533`*^9}, {
   3.5635297169900007`*^9, 3.5635297193338947`*^9}, {3.5635299616211767`*^9, 
   3.5635299638000298`*^9}, {3.563530688722741*^9, 3.563530690756474*^9}, {
   3.563541591680825*^9, 3.5635416000818853`*^9}, {3.563541666651371*^9, 
   3.563541670239068*^9}, {3.5637410732568293`*^9, 3.5637412855719624`*^9}, {
   3.563741322380003*^9, 3.563741607340045*^9}, {3.563769685771495*^9, 
   3.563769725749654*^9}, {3.563779114008175*^9, 3.5637791154236383`*^9}, {
   3.563858607908971*^9, 3.563858608189933*^9}, {3.563882166214254*^9, 
   3.5638821776289043`*^9}, {3.564392263234823*^9, 3.564392263480352*^9}, {
   3.564392368141141*^9, 3.564392368437698*^9}, {3.564393722008823*^9, 
   3.5643937628150587`*^9}, {3.564393857361744*^9, 3.56439385815298*^9}, {
   3.564395932210751*^9, 3.564395983005815*^9}, {3.564396021460018*^9, 
   3.564396038943891*^9}, {3.564396147673544*^9, 3.564396241415987*^9}, {
   3.564396603194503*^9, 3.564396698867875*^9}, {3.564396769708329*^9, 
   3.564396816555092*^9}, {3.564397222382143*^9, 3.564397378870277*^9}, {
   3.564397456919639*^9, 3.564397475706501*^9}, {3.564397554048832*^9, 
   3.564397571999413*^9}, {3.56439760897882*^9, 3.564397711648943*^9}, {
   3.564397798190178*^9, 3.564398048882742*^9}, {3.564398088492824*^9, 
   3.564398099710856*^9}, {3.564398142198896*^9, 3.5643981558529167`*^9}, {
   3.564398251287224*^9, 3.564398253598948*^9}, {3.564398284639246*^9, 
   3.564398294223792*^9}, {3.564398340407454*^9, 3.564398416464369*^9}, {
   3.564398470660391*^9, 3.5643984858356447`*^9}, {3.5643985182778807`*^9, 
   3.564398540579883*^9}, {3.564398618951847*^9, 3.564398713549178*^9}, {
   3.56439879783613*^9, 3.564398806519412*^9}, {3.5643988821652327`*^9, 
   3.5643989175158787`*^9}, {3.564398974143949*^9, 3.5643991358247643`*^9}, {
   3.564399169415123*^9, 3.564399179959343*^9}, {3.564399719610601*^9, 
   3.5643997698099546`*^9}, {3.564399903299595*^9, 3.5644001009718103`*^9}, {
   3.564400134442177*^9, 3.564400147251369*^9}, {3.564400200322465*^9, 
   3.5644002162155657`*^9}, {3.5644102595471907`*^9, 3.564410292507016*^9}, {
   3.5644103293344584`*^9, 3.564410531965232*^9}, {3.564410563781719*^9, 
   3.564410627211535*^9}, {3.564410667579928*^9, 3.564410697131487*^9}, {
   3.564411655406416*^9, 3.564411713593401*^9}, {3.564411770261319*^9, 
   3.564411792780678*^9}, {3.564412311952675*^9, 3.564412375795704*^9}, {
   3.564412406686892*^9, 3.5644125890097103`*^9}, {3.564412633973001*^9, 
   3.564412672819117*^9}, {3.564412716318192*^9, 3.564412741935102*^9}, {
   3.5644128650017138`*^9, 3.564412865798403*^9}, {3.564413018077672*^9, 
   3.564413018810719*^9}, {3.564413183506721*^9, 3.564413317021476*^9}, {
   3.5644133931155663`*^9, 3.5644135713696833`*^9}, 3.5644136090100613`*^9, {
   3.564413671611712*^9, 3.5644137061090384`*^9}, {3.564413742653338*^9, 
   3.564413750675702*^9}, 3.5644205230958567`*^9, {3.564421898173778*^9, 
   3.564421998316634*^9}, {3.564422083342361*^9, 3.564422283262789*^9}, {
   3.564422335870987*^9, 3.5644223381951437`*^9}, {3.564422418930624*^9, 
   3.5644224630457373`*^9}, {3.564422634497167*^9, 3.5644227123066397`*^9}, {
   3.564422767680588*^9, 3.5644227720631657`*^9}, {3.564422931553533*^9, 
   3.564422993901774*^9}, {3.564423109220652*^9, 3.564423168769437*^9}, {
   3.5644819222110653`*^9, 3.5644819265704327`*^9}, {3.564491028470038*^9, 
   3.5644910816997967`*^9}, {3.564491225986388*^9, 3.564491233644656*^9}, {
   3.564492187582405*^9, 3.564492285738456*^9}, {3.5644923196658583`*^9, 
   3.564492424150014*^9}, {3.5645021909628363`*^9, 3.56450220192564*^9}, {
   3.564502246375134*^9, 3.564502698921*^9}, {3.564502880222183*^9, 
   3.564502945089793*^9}, {3.5645029764864693`*^9, 3.564503005054616*^9}, {
   3.5645033960609283`*^9, 3.5645033991469803`*^9}, {3.564557831466339*^9, 
   3.564557885335993*^9}, {3.564557933488639*^9, 3.5645580243621902`*^9}, {
   3.564558208600602*^9, 3.564558303899622*^9}, {3.564558345121336*^9, 
   3.564558447521845*^9}, {3.56455866554214*^9, 3.5645586768205442`*^9}, {
   3.564558758107863*^9, 3.564558773844144*^9}, {3.564558914144479*^9, 
   3.564559005624351*^9}, {3.564559233091774*^9, 3.564559257711677*^9}, 
   3.564559369624856*^9, {3.564565894755919*^9, 3.564565895196515*^9}, {
   3.564569814168777*^9, 3.56456995292348*^9}, {3.564569996909898*^9, 
   3.564570045598658*^9}, {3.564642426656394*^9, 3.564642467581551*^9}, {
   3.564676352789338*^9, 3.5646764231119843`*^9}, {3.564676457027916*^9, 
   3.564676503780702*^9}, {3.564679867216126*^9, 3.564679869679984*^9}, {
   3.564679912152546*^9, 3.564679924614562*^9}, {3.564682106991287*^9, 
   3.5646826108872423`*^9}, {3.564682718144792*^9, 3.564683096668076*^9}, {
   3.564768317982237*^9, 3.564768572585277*^9}, {3.56477570369983*^9, 
   3.5647757042888813`*^9}, {3.564776293389592*^9, 3.564776354914633*^9}, {
   3.564776640263112*^9, 3.564776640848888*^9}, {3.564776712947692*^9, 
   3.5647767649274797`*^9}, {3.564813554350326*^9, 3.564813637875742*^9}, {
   3.564813700247191*^9, 3.564813717025289*^9}, {3.564813779717916*^9, 
   3.56481380644715*^9}, {3.564813844580675*^9, 3.564814697091174*^9}, {
   3.564827271382*^9, 3.564827285549451*^9}, {3.564914475452423*^9, 
   3.564914496945704*^9}, {3.564914589795046*^9, 3.5649146361776447`*^9}, {
   3.56491471774787*^9, 3.5649147263883877`*^9}, {3.564914820802863*^9, 
   3.564914829718857*^9}, {3.564914890571062*^9, 3.5649149052019777`*^9}, {
   3.564914938557164*^9, 3.56491498393832*^9}, {3.564915320941133*^9, 
   3.564915321074695*^9}, {3.564915647183475*^9, 3.5649156876099463`*^9}, {
   3.565097101026147*^9, 3.565097104006165*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "PREDEFINED"}], " ", 
    RowBox[{"FIELDS", ":", " ", 
     RowBox[{"Perturbation", " ", "of", " ", "the", " ", "metric"}]}]}], " ", 
   "***)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "*", " ", "Time", " ", "component", " ", "of", " ", "the", " ", "metric", 
    " ", "perturbation"}], " ", "**)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[Phi]", "::", "usage"}], " ", "=", " ", 
     "\"\<\[Phi][h][LI[p],LI[q]] is the first Bardeen potential, \
corresponding to the 00 component of the metric perturbation. It is \
automatically defined when calling the function DefMetricFields. It depends \
on the choice of the background slicing, and hence on the induced metric 'h'. \
\n\nThe first Label-Index (LI) gives the order 'p' of the perturbation \
'\[Phi]' (hence '\[Phi]' is null for p = 0). The second LI represents the \
number 'q' of Lie derivatives along the vector normal to the hypersurfaces \
acting on the 'p'-order of '\[Phi]'. \n\nThe commands \[Phi][h][] and \
\[Phi][h][LI[p]] are defined to be equal to \[Phi][h][LI[0],LI[0]] and \
\[Phi][h][LI[p],LI[0]], respectively. \n\nThe command \[Phi][h] builds the \
symbol '\[Phi]h', so one can use \[Phi][h][LI[p],LI[q]] or, equivalently, \
\[Phi]h[LI[p],LI[q]].\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "*", " ", "0", "i", " ", "components", " ", "of", " ", "the", " ", 
     "metric", " ", "perturbation"}], " ", "**)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Bs", "::", "usage"}], " ", "=", " ", 
     "\"\<Bs[h][LI[p],LI[q]] is the scalar part of the scalar-vector \
decomposition of the 0i components of the metric perturbation. It is \
automatically defined when calling the function DefMetricFields. It depends \
on the choice of the background slicing, and hence on the induced metric 'h'. \
\n\nThe first Label-Index (LI) gives the order 'p' of the perturbation 'Bs' \
(hence 'Bs' is null for p = 0). The second LI represents the number 'q' of \
Lie derivatives along the vector normal to the hypersurfaces acting on the \
'p'-order of 'Bs'. \n\nThe commands Bs[h][] and Bs[h][LI[p]] are defined to \
be equal to Bs[h][LI[0],LI[0]] and Bs[h][LI[p],LI[0]], respectively. \n\nThe \
command Bs[h] builds the symbol 'Bsh', so one can use Bs[h][LI[p],LI[q]] or, \
equivalently, Bsh[LI[p],LI[q]]. \n\nThe default printed form of Bs[h][] is: \
'B'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Bv", "::", "usage"}], " ", "=", " ", 
     "\"\<Bv[h][LI[p],LI[q],index] is the vector part of the scalar-vector \
decomposition of the 0i components of the metric perturbation. It is \
automatically defined when calling the function DefMetricFields. It depends \
on the choice of the background slicing, and hence on the induced metric 'h'. \
\n\nThe first Label-Index (LI) gives the order 'p' of the perturbation 'Bv' \
(hence 'Bv' is null for p = 0). The second LI represents the number 'q' of \
Lie derivatives along the vector normal to the hypersurfaces acting on the \
'p'-order of 'Bv'. \n\nThe commands Bv[h][index] and Bv[h][LI[p],index] are \
defined to be equal to Bv[h][LI[0],LI[0],index] and Bv[h][LI[p],LI[0],index], \
respectively. \n\nThe command Bv[h] builds the symbol 'Bvh', so one can use \
Bv[h][LI[p],LI[q],index] or, equivalently, Bvh[LI[p],LI[q],index]. \n\nThe \
default printed form of Bv[h][-index] is: '\!\(\*SubscriptBox[\(B\), \
\(index\)]\)'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "*", " ", "Spatial", " ", "components", " ", "of", " ", "the", " ", 
     "metric", " ", "perturbation"}], " ", "**)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "::", "usage"}], " ", "=", " ", 
     "\"\<\[Psi][h][LI[p],LI[q]] is the second Bardeen potential, present in \
the spatial components of the metric perturbation. It is automatically \
defined when calling the function DefMetricFields. It depends on the choice \
of the background slicing, and hence on the induced metric 'h'. \n\nThe first \
Label-Index (LI) gives the order 'p' of the perturbation '\[Psi]' (hence '\
\[Psi]' is null for p = 0). The second LI represents the number 'q' of Lie \
derivatives along the vector normal to the hypersurfaces acting on the \
'p'-order of '\[Psi]'. \n\nThe commands \[Psi][h][] and \[Psi][h][LI[p]] are \
defined to be equal to \[Psi][h][LI[0],LI[0]] and \[Psi][h][LI[p],LI[0]], \
respectively. \n\nThe command \[Psi][h] builds the symbol '\[Psi]h', so one \
can use \[Psi][h][LI[p],LI[q]] or, equivalently, \[Psi]h[LI[p],LI[q]].\>\""}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Es", "::", "usage"}], " ", "=", " ", 
     "\"\<Es[h][LI[p],LI[q]] is the scalar part of the scalar-vector-tensor \
decomposition of the spatial components of the metric perturbation. It is \
automatically defined when calling the function DefMetricFields. It depends \
on the choice of the background slicing, and hence on the induced metric 'h'. \
\n\nThe first Label-Index (LI) gives the order 'p' of the perturbation 'Es' \
(hence 'Es' is null for p = 0). The second LI represents the number 'q' of \
Lie derivatives along the vector normal to the hypersurfaces acting on the \
'p'-order of 'Es'. \n\nThe commands Es[h][] and Es[h][LI[p]] are defined to \
be equal to Es[h][LI[0],LI[0]] and Es[h][LI[p],LI[0]], respectively. \n\nThe \
command Es[h] builds the symbol 'Esh', so one can use Es[h][LI[p],LI[q]] or, \
equivalently, Esh[LI[p],LI[q]]. \n\nThe default printed form of Es[h][] is: \
'E'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ev", "::", "usage"}], " ", "=", " ", 
     "\"\<Ev[h][LI[p],LI[q],index] is the vector part of the \
scalar-vector-tensor decomposition of the spatial components of the metric \
perturbation. It is automatically defined when calling the function \
DefMetricFields. It depends on the choice of the background slicing, and \
hence on the induced metric 'h'. \n\nThe first Label-Index (LI) gives the \
order 'p' of the perturbation 'Ev' (hence 'Ev' is null for p = 0). The second \
LI represents the number 'q' of Lie derivatives along the vector normal to \
the hypersurfaces acting on the 'p'-order of 'Ev'. \n\nThe commands \
Ev[h][index] and Ev[h][LI[p],index] are defined to be equal to \
Ev[h][LI[0],LI[0],index] and Ev[h][LI[p],LI[0],index], respectively. \n\nThe \
command Ev[h] builds the symbol 'Evh', so one can use \
Ev[h][LI[p],LI[q],index] or, equivalently, Evh[LI[p],LI[q],index]. \n\nThe \
default printed form of Ev[h][-index] is: '\!\(\*SubscriptBox[\(E\), \
\(index\)]\)'.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Et", "::", "usage"}], " ", "=", " ", 
     "\"\<Et[h][LI[p],LI[q],index,index] is the tensor part of the \
scalar-vector-tensor decomposition of the spatial components of the metric \
perturbation. It is automatically defined when calling the function \
DefMetricFields. It depends on the choice of the background slicing, and \
hence on the induced metric 'h'. \n\nThe first Label-Index (LI) gives the \
order 'p' of the perturbation 'Et' (hence 'Et' is null for p = 0). The second \
LI represents the number 'q' of Lie derivatives along the vector normal to \
the hypersurfaces acting on the 'p'-order of 'Et'. \n\nThe commands \
Et[h][index,index] and Et[h][LI[p],index,index] are defined to be equal to \
Et[h][LI[0],LI[0],index,index] and Et[h][LI[p],LI[0],index,index], \
respectively. \n\nThe command Et[h] builds the symbol 'Eth', so one can use \
Et[h][LI[p],LI[q],index,index] or, equivalently, \
Eth[LI[p],LI[q],index,index]. \n\nThe default printed form of \
Et[h][-index,-index] is: '\!\(\*SubscriptBox[\(E\), \(index\\\ index\)]\)'.\>\
\""}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.563529098620056*^9, {3.563529572905963*^9, 3.5635295754676533`*^9}, {
   3.5635297169900007`*^9, 3.5635297193338947`*^9}, {3.5635299616211767`*^9, 
   3.5635299638000298`*^9}, {3.563530688722741*^9, 3.563530690756474*^9}, {
   3.563541591680825*^9, 3.5635416000818853`*^9}, {3.563541666651371*^9, 
   3.563541670239068*^9}, {3.5637410732568293`*^9, 3.5637412855719624`*^9}, {
   3.563741322380003*^9, 3.563741607340045*^9}, {3.563769685771495*^9, 
   3.563769725749654*^9}, {3.563779114008175*^9, 3.5637791154236383`*^9}, {
   3.563858607908971*^9, 3.563858608189933*^9}, {3.563882166214254*^9, 
   3.5638821776289043`*^9}, {3.564392263234823*^9, 3.564392263480352*^9}, {
   3.564392368141141*^9, 3.564392368437698*^9}, {3.564393722008823*^9, 
   3.5643937628150587`*^9}, {3.564393857361744*^9, 3.56439385815298*^9}, {
   3.564395932210751*^9, 3.564395983005815*^9}, {3.564396021460018*^9, 
   3.564396038943891*^9}, {3.564396147673544*^9, 3.564396241415987*^9}, {
   3.564396603194503*^9, 3.564396698867875*^9}, {3.564396769708329*^9, 
   3.564396816555092*^9}, {3.564397222382143*^9, 3.564397378870277*^9}, {
   3.564397456919639*^9, 3.564397475706501*^9}, {3.564397554048832*^9, 
   3.564397571999413*^9}, {3.56439760897882*^9, 3.564397711648943*^9}, {
   3.564397798190178*^9, 3.564398048882742*^9}, {3.564398088492824*^9, 
   3.564398099710856*^9}, {3.564398142198896*^9, 3.5643981558529167`*^9}, {
   3.564398251287224*^9, 3.564398253598948*^9}, {3.564398284639246*^9, 
   3.564398294223792*^9}, {3.564398340407454*^9, 3.564398416464369*^9}, {
   3.564398470660391*^9, 3.5643984858356447`*^9}, {3.5643985182778807`*^9, 
   3.564398540579883*^9}, {3.564398618951847*^9, 3.564398713549178*^9}, {
   3.56439879783613*^9, 3.564398806519412*^9}, {3.5643988821652327`*^9, 
   3.5643989175158787`*^9}, {3.564398974143949*^9, 3.5643991358247643`*^9}, {
   3.564399169415123*^9, 3.564399179959343*^9}, {3.564399719610601*^9, 
   3.5643997698099546`*^9}, {3.564399903299595*^9, 3.5644001009718103`*^9}, {
   3.564400134442177*^9, 3.564400147251369*^9}, {3.564400200322465*^9, 
   3.5644002162155657`*^9}, {3.5644102595471907`*^9, 3.564410292507016*^9}, {
   3.5644103293344584`*^9, 3.564410531965232*^9}, {3.564410563781719*^9, 
   3.564410627211535*^9}, {3.564410667579928*^9, 3.564410697131487*^9}, {
   3.564411655406416*^9, 3.564411713593401*^9}, {3.564411770261319*^9, 
   3.564411792780678*^9}, {3.564412311952675*^9, 3.564412375795704*^9}, {
   3.564412406686892*^9, 3.5644125890097103`*^9}, {3.564412633973001*^9, 
   3.564412672819117*^9}, {3.564412716318192*^9, 3.564412741935102*^9}, {
   3.5644128650017138`*^9, 3.564412865798403*^9}, {3.564413018077672*^9, 
   3.564413018810719*^9}, {3.564413183506721*^9, 3.564413317021476*^9}, {
   3.5644133931155663`*^9, 3.5644135713696833`*^9}, {3.5644136090100613`*^9, 
   3.564413666503631*^9}, {3.564413755736477*^9, 3.564413758783787*^9}, 
   3.564420538817382*^9, {3.564422787797164*^9, 3.564422813384872*^9}, {
   3.564423025310295*^9, 3.564423032168993*^9}, {3.564423182180241*^9, 
   3.564423209967835*^9}, {3.564481928180863*^9, 3.56448193646207*^9}, {
   3.5645022037129593`*^9, 3.564502217143939*^9}, {3.564502248777173*^9, 
   3.564502251473465*^9}, {3.564557895070984*^9, 3.5645579006732073`*^9}, {
   3.564679886680853*^9, 3.564679887237905*^9}, {3.564679927826344*^9, 
   3.564679947639411*^9}, {3.564682641318076*^9, 3.5646826902954407`*^9}, {
   3.564683099232254*^9, 3.564683195398546*^9}, {3.5646832426199827`*^9, 
   3.56468346171481*^9}, {3.564683739114478*^9, 3.5646837407214823`*^9}, {
   3.564683889897045*^9, 3.5646839848714647`*^9}, {3.564728537560635*^9, 
   3.564728782209586*^9}, {3.564728871514022*^9, 3.564728891981147*^9}, {
   3.564728962223443*^9, 3.564729279389246*^9}, {3.564729354355659*^9, 
   3.564729585989011*^9}, {3.564729766461317*^9, 3.564729794124013*^9}, {
   3.564729835001053*^9, 3.56472992164503*^9}, {3.56473034259163*^9, 
   3.5647304319652357`*^9}, {3.5647304806747217`*^9, 3.564730754855097*^9}, {
   3.564756060975391*^9, 3.564756066081397*^9}, {3.564756102851763*^9, 
   3.564756110547967*^9}, {3.5647686130555277`*^9, 3.564768736572648*^9}, {
   3.564768772324894*^9, 3.564768886248212*^9}, {3.564814706360751*^9, 
   3.56481504652754*^9}, {3.564817550084219*^9, 3.564817634054422*^9}, {
   3.564817682588854*^9, 3.564818024971764*^9}, {3.564818057885179*^9, 
   3.564818231546802*^9}, {3.5648182786055937`*^9, 3.564818413726636*^9}, {
   3.564818454696724*^9, 3.564818514979146*^9}, 3.5648185474443502`*^9, {
   3.56482729222505*^9, 3.564827319385317*^9}, {3.564923667723948*^9, 
   3.564923930342387*^9}, {3.565097135812565*^9, 3.565097141248589*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"**", " ", "PREDEFINED"}], " ", 
     RowBox[{"FIELDS", ":", " ", 
      RowBox[{"Gauge", " ", "vector"}]}]}], ",", " ", 
    RowBox[{
    "its", " ", "decomposition", " ", "and", " ", "perturbation", " ", 
     "parameter"}]}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[Xi]", "::", "usage"}], " ", "=", " ", 
     "\"\<\[Xi][h][LI[order],index] is the general vector field used in a \
gauge transformation. It is automatically defined when calling the function \
SplitFieldsAndGaugeChange. It depends on the choice of the background \
slicing, and hence on the induced metric 'h'. \n\nThe Label-Index (LI) gives \
the order 'order' of the vector field '\[Xi]' (hence '\[Xi]' is null for p = \
0). \n\nThe command \[Xi][h] builds the symbol '\[Xi]h', so one can use \
\[Xi][h][LI[order],index] or, equivalently, \[Xi]h[LI[order],index].\>\""}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"T", "::", "usage"}], " ", "=", " ", 
     "\"\<T[h][LI[p],LI[q]] is the factor of the time component of the vector \
field '\[Xi]' used in a gauge transformation. It is automatically defined \
when calling the function DefMetricFields. It depends on the choice of the \
background slicing, and hence on the induced metric 'h'. \n\nThe first \
Label-Index (LI) gives the order 'p' of 'T' (hence 'T' is null for p = 0). \
The second LI represents the number 'q' of Lie derivatives along the vector \
normal to the hypersurfaces acting on the 'p'-order of 'T'. \n\nThe commands \
T[h][] and T[h][LI[p]] are defined to be equal to T[h][LI[0],LI[0]] and \
T[h][LI[p],LI[0]], respectively. \n\nThe command T[h] builds the symbol 'Th', \
so one can use T[h][LI[p],LI[q]] or, equivalently, Th[LI[p],LI[q]]. \n\nThe \
default printed form of T[h][] is: 'T'.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ls", "::", "usage"}], " ", "=", " ", 
     "\"\<Ls[h][LI[p],LI[q]] is the scalar part of the scalar-vector \
decomposition of the spatial component of the vector field '\[Xi]' used in a \
gauge transformation. It is automatically defined when calling the function \
DefMetricFields. It depends on the choice of the background slicing, and \
hence on the induced metric 'h'. \n\nThe first Label-Index (LI) gives the \
order 'p' of 'Ls' (hence 'Ls' is null for p = 0). The second LI represents \
the number 'q' of Lie derivatives along the vector normal to the \
hypersurfaces acting on the 'p'-order of 'Ls'. \n\nThe commands Ls[h][] and \
Ls[h][LI[p]] are defined to be equal to Ls[h][LI[0],LI[0]] and \
Ls[h][LI[p],LI[0]], respectively. \n\nThe command Ls[h] builds the symbol \
'Lsh', so one can use Ls[h][LI[p],LI[q]] or, equivalently, Lsh[LI[p],LI[q]]. \
\n\nThe default printed form of Ls[h][] is: 'L'.\>\""}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Lv", "::", "usage"}], " ", "=", " ", 
     "\"\<Lv[h][LI[p],LI[q],index] is the vector part of the scalar-vector \
decomposition of the spatial component of the vector field '\[Xi]' used in a \
gauge transformation. It is automatically defined when calling the function \
DefMetricFields. It depends on the choice of the background slicing, and \
hence on the induced metric 'h'. \n\nThe first Label-Index (LI) gives the \
order 'p' of 'Lv' (hence 'Lv' is null for p = 0). The second LI represents \
the number 'q' of Lie derivatives along the vector normal to the \
hypersurfaces acting on the 'p'-order of 'Lv'. \n\nThe commands Lv[h][index] \
and Lv[h][LI[p],index] are defined to be equal to Lv[h][LI[0],LI[0],index] \
and Lv[h][LI[p],LI[0],index], respectively. \n\nThe command Lv[h] builds the \
symbol 'Lvh', so one can use Lv[h][LI[p],LI[q],index] or, equivalently, \
Lvh[LI[p],LI[q],index]. \n\nThe default printed form of Lv[h][-index] is: '\!\
\(\*SubscriptBox[\(L\), \(index\)]\)'.\>\""}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Epsilon]", "::", "usage"}], " ", "=", " ", 
     "\"\<\[Epsilon] is the default perturbation parameter. It is \
automatically defined when calling either the function DefMetricFields or the \
function DefMatterFields.\>\""}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.563529098620056*^9, {3.563529572905963*^9, 3.5635295754676533`*^9}, {
   3.5635297169900007`*^9, 3.5635297193338947`*^9}, {3.5635299616211767`*^9, 
   3.5635299638000298`*^9}, {3.563530688722741*^9, 3.563530690756474*^9}, {
   3.563541591680825*^9, 3.5635416000818853`*^9}, {3.563541666651371*^9, 
   3.563541670239068*^9}, {3.5637410732568293`*^9, 3.5637412855719624`*^9}, {
   3.563741322380003*^9, 3.563741607340045*^9}, {3.563769685771495*^9, 
   3.563769725749654*^9}, {3.563779114008175*^9, 3.5637791154236383`*^9}, {
   3.563858607908971*^9, 3.563858608189933*^9}, {3.563882166214254*^9, 
   3.5638821776289043`*^9}, {3.564392263234823*^9, 3.564392263480352*^9}, {
   3.564392368141141*^9, 3.564392368437698*^9}, {3.564393722008823*^9, 
   3.5643937628150587`*^9}, {3.564393857361744*^9, 3.56439385815298*^9}, {
   3.564395932210751*^9, 3.564395983005815*^9}, {3.564396021460018*^9, 
   3.564396038943891*^9}, {3.564396147673544*^9, 3.564396241415987*^9}, {
   3.564396603194503*^9, 3.564396698867875*^9}, {3.564396769708329*^9, 
   3.564396816555092*^9}, {3.564397222382143*^9, 3.564397378870277*^9}, {
   3.564397456919639*^9, 3.564397475706501*^9}, {3.564397554048832*^9, 
   3.564397571999413*^9}, {3.56439760897882*^9, 3.564397711648943*^9}, {
   3.564397798190178*^9, 3.564398048882742*^9}, {3.564398088492824*^9, 
   3.564398099710856*^9}, {3.564398142198896*^9, 3.5643981558529167`*^9}, {
   3.564398251287224*^9, 3.564398253598948*^9}, {3.564398284639246*^9, 
   3.564398294223792*^9}, {3.564398340407454*^9, 3.564398416464369*^9}, {
   3.564398470660391*^9, 3.5643984858356447`*^9}, {3.5643985182778807`*^9, 
   3.564398540579883*^9}, {3.564398618951847*^9, 3.564398713549178*^9}, {
   3.56439879783613*^9, 3.564398806519412*^9}, {3.5643988821652327`*^9, 
   3.5643989175158787`*^9}, {3.564398974143949*^9, 3.5643991358247643`*^9}, {
   3.564399169415123*^9, 3.564399179959343*^9}, {3.564399719610601*^9, 
   3.5643997698099546`*^9}, {3.564399903299595*^9, 3.5644001009718103`*^9}, {
   3.564400134442177*^9, 3.564400147251369*^9}, {3.564400200322465*^9, 
   3.5644002162155657`*^9}, {3.5644102595471907`*^9, 3.564410292507016*^9}, {
   3.5644103293344584`*^9, 3.564410531965232*^9}, {3.564410563781719*^9, 
   3.564410627211535*^9}, {3.564410667579928*^9, 3.564410697131487*^9}, {
   3.564411655406416*^9, 3.564411713593401*^9}, {3.564411770261319*^9, 
   3.564411792780678*^9}, {3.564412311952675*^9, 3.564412375795704*^9}, {
   3.564412406686892*^9, 3.5644125890097103`*^9}, {3.564412633973001*^9, 
   3.564412672819117*^9}, {3.564412716318192*^9, 3.564412741935102*^9}, {
   3.5644128650017138`*^9, 3.564412865798403*^9}, {3.564413018077672*^9, 
   3.564413018810719*^9}, {3.564413183506721*^9, 3.564413317021476*^9}, {
   3.5644133931155663`*^9, 3.5644135713696833`*^9}, {3.5644136090100613`*^9, 
   3.564413662145602*^9}, {3.564413764085457*^9, 3.564413766245195*^9}, 
   3.564413827468876*^9, 3.56442054394109*^9, {3.564422820022813*^9, 
   3.564422841958858*^9}, {3.564423217531955*^9, 3.564423273391405*^9}, {
   3.564423518583952*^9, 3.5644235540526543`*^9}, {3.564481937913382*^9, 
   3.5644819419948273`*^9}, {3.564502218600556*^9, 3.564502220210928*^9}, {
   3.564502252875269*^9, 3.564502253817992*^9}, {3.56473076294202*^9, 
   3.564730837423813*^9}, {3.564736358434758*^9, 3.564736406298356*^9}, {
   3.5647364732785177`*^9, 3.5647366885035152`*^9}, {3.564737012521624*^9, 
   3.564737262617128*^9}, {3.564737306859103*^9, 3.564737553073962*^9}, {
   3.564769206541567*^9, 3.5647692248287153`*^9}, {3.564769320003582*^9, 
   3.564769434500121*^9}, {3.564818557003539*^9, 3.564818700862385*^9}, {
   3.564822829434896*^9, 3.564823000488267*^9}, {3.564823040692*^9, 
   3.564823047931202*^9}, {3.564823118578292*^9, 3.564823135059011*^9}, {
   3.564824270521771*^9, 3.564824277302703*^9}, {3.5648243495950603`*^9, 
   3.5648243634885273`*^9}, {3.564827326923787*^9, 3.564827363891508*^9}, 
   3.5648274204714737`*^9, {3.564915739101211*^9, 3.564915741012186*^9}, {
   3.5649240421203213`*^9, 3.5649240436115*^9}, {3.5649240800654793`*^9, 
   3.5649241866635933`*^9}, 3.5650971050109*^9, {3.5650971423033867`*^9, 
   3.565097145365108*^9}, {3.56722738802265*^9, 3.5672273914656277`*^9}, 
   3.569735126391011*^9}],

Cell["\<\

Reserved words and protected names:\
\>", "Text",
 CellChangeTimes->{{3.5635229304102583`*^9, 3.563522934501562*^9}, {
   3.5643248631569433`*^9, 3.5643248651643*^9}, {3.56433578886655*^9, 
   3.56433579078337*^9}, {3.5643360876039953`*^9, 3.5643360894997807`*^9}, {
   3.564336166070917*^9, 3.5643361788217077`*^9}, 3.564729647974413*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "RESERVED"}], " ", "WORDS", " ", "AND", " ", 
    "PROTECTED", " ", "NAMES"}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Background", "::", "usage"}], " ", "=", " ", 
     "\"\<Reserved word. See DefProjectedTensor.\>\""}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Perturbed", "::", "usage"}], " ", "=", " ", 
     "\"\<Reserved word. See DefProjectedTensor.\>\""}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Time", "::", "usage"}], " ", "=", " ", 
     RowBox[{
      RowBox[{
      "\"\<Reserved word. See ExtractComponents.\>\"", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"SymmetricTensor", "::", "usage"}]}], " ", "=", " ", 
      "\"\<Protected name. A parameter to define tensors.\>\""}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Traceless", "::", "usage"}], " ", "=", " ", 
     "\"\<Protected name. A parameter to define tensors.\>\""}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Transverse", "::", "usage"}], " ", "=", " ", 
     "\"\<Protected name. A parameter to define tensors.\>\""}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Tilted", "::", "usage"}], " ", "=", " ", "\"\<\>\""}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"NotTilted", "::", "usage"}], " ", "=", " ", "\"\<\>\""}], ";"}],
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SpaceTimesOfDefinition", "::", "usage"}], " ", "=", " ", 
     "\"\<\>\""}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"TensorProperties", "::", "usage"}], " ", "=", " ", "\"\<\>\""}],
     ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.564336181612681*^9, 3.564336193355089*^9}, {
   3.564336269380516*^9, 3.564336346346805*^9}, {3.5643364930577507`*^9, 
   3.564336506806356*^9}, {3.5644133797053556`*^9, 3.564413381481346*^9}, {
   3.565692152993175*^9, 3.565692162004987*^9}, {3.5668969130085382`*^9, 
   3.566896926508583*^9}, {3.566901798212887*^9, 3.5669017990571337`*^9}, {
   3.5693288432866077`*^9, 3.5693288470621557`*^9}, {3.56932983819291*^9, 
   3.5693298395879803`*^9}, 3.570510973864128*^9, 3.57051118423438*^9}],

Cell["\<\

Types of gauge:\
\>", "Text",
 CellChangeTimes->{{3.5635229304102583`*^9, 3.563522934501562*^9}, {
   3.5643248631569433`*^9, 3.5643248651643*^9}, {3.56433578886655*^9, 
   3.56433579078337*^9}, {3.56433615941334*^9, 3.564336159525279*^9}, 
   3.5647296505426807`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "TYPES"}], " ", "OF", " ", "GAUGE"}], " ", "***)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"AnyGauge", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of gauge to be used as argument of the function SplitMetric.\>\
\""}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ComovingGauge", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of gauge to be used as argument of the function SplitMetric.\>\
\""}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"FlatGauge", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of gauge to be used as argument of the function SplitMetric.\>\
\""}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"IsoDensityGauge", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of gauge to be used as argument of the function SplitMetric.\>\
\""}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"NewtonGauge", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of gauge to be used as argument of the function SplitMetric.\>\
\""}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"SynchronousGauge", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of gauge to be used as argument of the function SplitMetric.\>\
\""}], ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"$ListOfGauges", "::", "usage"}], " ", "=", " ", 
   "\"\<Possible gauges are: AnyGauge, ComovingGauge, FlatGauge, \
IsoDensityGauge, NewtonGauge and SynchronousGauge.\>\""}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5635229370171137`*^9, 3.563522996989089*^9}, {
   3.5636067952237473`*^9, 3.5636068064437523`*^9}, {3.563858635661462*^9, 
   3.563858639788064*^9}, {3.5639474032136593`*^9, 3.563947413488793*^9}, 
   3.5641145416506777`*^9, {3.564334519836548*^9, 3.564334540699595*^9}, {
   3.564334584946018*^9, 3.564334598729265*^9}, {3.5643346776676073`*^9, 
   3.564334683003619*^9}, {3.564335799078397*^9, 3.564336068281583*^9}, {
   3.564336202242153*^9, 3.564336202626926*^9}, {3.564336289267378*^9, 
   3.564336351284656*^9}, {3.5643364828791227`*^9, 3.564336490469473*^9}, {
   3.5644133850130444`*^9, 3.564413386557354*^9}, {3.5648275011063833`*^9, 
   3.564827589530429*^9}, {3.569132796515347*^9, 3.569132799625763*^9}, {
   3.5693288382643957`*^9, 3.569328840588331*^9}}],

Cell[BoxData["\<\"Possible gauges are: AnyGauge, ComovingGauge, FlatGauge, \
IsoDensityGauge, NewtonGauge and SynchronousGauge.\"\>"], "Output",
 CellChangeTimes->{3.5683127588084793`*^9, 3.568312869469571*^9, 
  3.568312916368314*^9, 3.569132392290345*^9, 3.569230310733594*^9, 
  3.569340252762981*^9, 3.5693405124292297`*^9, 3.569340731501895*^9, 
  3.56941899587836*^9, 3.569578893845613*^9}]
}, Open  ]],

Cell["\<\

Types of manifold:\
\>", "Text",
 CellChangeTimes->{{3.5625605904603252`*^9, 3.56256059496023*^9}, {
   3.564324718695812*^9, 3.564324721407361*^9}, 3.56433615205337*^9, 
   3.564729654070682*^9, {3.567239182789652*^9, 3.5672392244295073`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "TYPES"}], " ", "OF", " ", "MANIFOLD"}], " ", "***)"}],
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Anisotropic", "::", "usage"}], "=", 
     "\"\<General type of spatial hypersurfaces for an anisotropic manifold. \
The boolean function '$OpenConstantsOfStructure' is automatically set to \
'False'. For a four-dimensional manifold, the user can choose instead the \
particular types: BianchiB, BianchiA or BianchiI.\>\""}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"BianchiB", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of spatial hypersurfaces corresponding to a general Bianchi \
space-time. \n\nIf '$OpenConstantsOfStructure' is set to 'True', then the \
constants of structure \!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \
\(jk\)]\) are expressed in terms of \!\(\*SuperscriptBox[\(N\), \(ij\)]\) and \
\!\(\*SuperscriptBox[\(A\), \(i\)]\), according to: \
\!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \(\(jk\)\(\\\ \)\)]\)= \
\!\(\*SubscriptBox[\(\[Epsilon]\), \(jkl\)]\)\!\(\*SuperscriptBox[\(N\), \(li\
\)]\) + \!\(\*SubscriptBox[\(A\), \([j\)]\)\!\(\*SubscriptBox[SuperscriptBox[\
\(\[Delta]\), \(i\)], \(\(k\)\(]\)\)]\).\>\""}], ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"BianchiA", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of spatial hypersurfaces corresponding to a Bianchi type A \
space-time. \n\nIf '$OpenConstantsOfStructure' is set to 'True', then the \
constants of structure \!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \
\(jk\)]\) are expressed in terms of \!\(\*SuperscriptBox[\(N\), \(ij\)]\), \
according to: \!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \(\(jk\)\(\\\ \
\)\)]\)= \!\(\*SubscriptBox[\(\[Epsilon]\), \
\(jkl\)]\)\!\(\*SuperscriptBox[\(N\), \(li\)]\).\>\""}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"BianchiI", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of spatial hypersurfaces corresponding to a Bianchi type I \
space-time.\>\""}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"FLCurved", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of spatial hypersurfaces corresponding to a curved \
Friedmann-Lemaitre manifold (that is, with spatial curvature).\>\""}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"FLFlat", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of spatial hypersurfaces corresponding to a flat \
Friedmann-Lemaitre manifold (that is, without spatial curvature).\>\""}], ";",
     "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Minkowski", "::", "usage"}], " ", "=", " ", 
     "\"\<Type of spatial hypersurfaces corresponding to a Minkowski manifold \
(that is, a flat FL space-time without expansion).\>\""}], ";"}], 
   "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SpaceType", "::", "usage"}], " ", "=", " ", 
     "\"\<SpaceType[h], with 'h' being the induced metric on the \
hypersurfaces, displays the type of hypersurfaces chosen for the SetSlicing. \
It can be: Anisotropic, BianchiB, BianchiA, BianchiI, FLCurved, FLFlat or \
Minkowski.\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$ListOfSpaceTypes", "::", "usage"}], " ", "=", " ", 
    "\"\<Possible space types are: Anisotropic, BianchiB, BianchiA, BianchiI, \
FLCurved, FLFlat and Minkowski.\>\""}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562560597126005*^9, 3.562560733425946*^9}, {
   3.5625607788419943`*^9, 3.5625608643161783`*^9}, {3.5625619672013063`*^9, 
   3.562562022818565*^9}, {3.5625623005702*^9, 3.562562354739902*^9}, {
   3.5625624039399014`*^9, 3.5625624042994223`*^9}, {3.562655065536022*^9, 
   3.562655127928122*^9}, {3.5626559860957193`*^9, 3.5626559962416277`*^9}, {
   3.562658723481494*^9, 3.562658725160219*^9}, {3.562662326107951*^9, 
   3.562662378992852*^9}, {3.5630707275863256`*^9, 3.563070734656925*^9}, {
   3.563101545913994*^9, 3.563101554006518*^9}, {3.5632814181994963`*^9, 
   3.5632814628594112`*^9}, {3.563282767364212*^9, 3.563282768971799*^9}, 
   3.563511373019966*^9, {3.5635160652124987`*^9, 3.563516276520421*^9}, {
   3.5635229275847282`*^9, 3.563522928742249*^9}, {3.5635584731853*^9, 
   3.563558478047021*^9}, {3.56355930483639*^9, 3.563559305102947*^9}, {
   3.563605628998075*^9, 3.563605637704145*^9}, {3.563704302435445*^9, 
   3.563704324886928*^9}, {3.563740659739676*^9, 3.563740673775113*^9}, {
   3.5637408026096487`*^9, 3.5637408670135593`*^9}, {3.563782777256358*^9, 
   3.5637827800881567`*^9}, {3.563858613017461*^9, 3.563858627965798*^9}, {
   3.564324764273838*^9, 3.5643249084009457`*^9}, {3.5643250220079193`*^9, 
   3.564325028229498*^9}, 3.5643250588755302`*^9, {3.56432510361097*^9, 
   3.564325166956356*^9}, {3.564325204060103*^9, 3.564325320148139*^9}, {
   3.5643257398106403`*^9, 3.564325792698106*^9}, {3.564325865921425*^9, 
   3.5643260714505377`*^9}, {3.564326164925864*^9, 3.5643262723103743`*^9}, {
   3.5643263287715073`*^9, 3.5643263432944403`*^9}, {3.564326374881668*^9, 
   3.5643264217580023`*^9}, {3.564326863974008*^9, 3.5643271497478447`*^9}, {
   3.564327311244109*^9, 3.564327379025786*^9}, {3.564327476173297*^9, 
   3.5643274820928164`*^9}, {3.5643278736501493`*^9, 3.564327932887792*^9}, {
   3.564328231397122*^9, 3.5643283077774754`*^9}, 3.564328634049429*^9, {
   3.564330076450869*^9, 3.564330146982638*^9}, {3.56433017700914*^9, 
   3.5643301790256844`*^9}, {3.564330245560204*^9, 3.564330248500987*^9}, {
   3.564333875224955*^9, 3.5643339876907988`*^9}, {3.564334084126871*^9, 
   3.564334127454321*^9}, {3.564334168682107*^9, 3.564334223183258*^9}, {
   3.5643342931603317`*^9, 3.564334329760728*^9}, {3.5643344499690447`*^9, 
   3.564334484136183*^9}, {3.564334761968956*^9, 3.564334854293098*^9}, {
   3.564334906965859*^9, 3.5643349101307592`*^9}, {3.56433495228458*^9, 
   3.564334954180937*^9}, {3.564335351583192*^9, 3.564335785210106*^9}, {
   3.5643361860637703`*^9, 3.564336187970483*^9}, {3.564336468614668*^9, 
   3.564336479446048*^9}, {3.564413388406495*^9, 3.564413389974695*^9}, {
   3.564756563394763*^9, 3.564756599676015*^9}, {3.56475665055717*^9, 
   3.56475665226007*^9}, {3.564756756323522*^9, 3.564756761784142*^9}, {
   3.5648275953585997`*^9, 3.564827654214346*^9}, {3.565097674830287*^9, 
   3.565097682950604*^9}, {3.565249431141939*^9, 3.565249434789137*^9}, {
   3.565257972594274*^9, 3.565257973642137*^9}, {3.5672385247823343`*^9, 
   3.567238535421464*^9}, {3.56723856643296*^9, 3.5672385683676367`*^9}, {
   3.5672386067849293`*^9, 3.5672388701748133`*^9}, {3.567239068276133*^9, 
   3.5672390701608562`*^9}, {3.567239101963106*^9, 3.567239226844783*^9}, {
   3.5672393705352716`*^9, 3.567239449273827*^9}, {3.5674037553985033`*^9, 
   3.567403780960236*^9}, 3.569132360449349*^9, {3.5693289020680637`*^9, 
   3.569328906091084*^9}}],

Cell[BoxData["\<\"Possible space types are: Anisotropic, BianchiB, BianchiA, \
BianchiI, FLCurved, FLFlat and Minkowski.\"\>"], "Output",
 CellChangeTimes->{3.568312758955859*^9, 3.568312869503195*^9, 
  3.568312916402317*^9, 3.5691323923226967`*^9, 3.569230310772287*^9, 
  3.569340252800699*^9, 3.569340512480248*^9, 3.569340731542033*^9, 
  3.5694189959148083`*^9, 3.569578893881116*^9}]
}, Open  ]],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["1.6. Begin private", "Subsubsection",
 CellChangeTimes->{{3.563741698101275*^9, 3.5637416983961563`*^9}, {
  3.564737730313264*^9, 3.5647377313690777`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Begin", "[", "\"\<xAct`xPand`Private`\>\"", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5625534805512114`*^9, 3.562553481229899*^9}, {
  3.563773011796526*^9, 3.563773012776121*^9}, {3.568365194436617*^9, 
  3.568365195210232*^9}}],

Cell[BoxData["\<\"xAct`xPand`Private`\"\>"], "Output",
 CellChangeTimes->{
  3.5625534816561947`*^9, 3.562555500041892*^9, {3.562555834072101*^9, 
   3.562555886775097*^9}, 3.562556004967004*^9, {3.562556230354228*^9, 
   3.5625562429636793`*^9}, 3.562556398013133*^9, 3.562556493086812*^9, 
   3.562556566843802*^9, {3.562558882509075*^9, 3.562558929042034*^9}, 
   3.562561261243205*^9, 3.562561326129649*^9, 3.562561629745297*^9, 
   3.5625617332649107`*^9, 3.562561771119793*^9, 3.56256218644193*^9, 
   3.5625624632058764`*^9, 3.562562523365746*^9, 3.562562627483984*^9, 
   3.562562693269842*^9, {3.56256349914532*^9, 3.562563527139742*^9}, 
   3.56256387434459*^9, 3.562563904950653*^9, 3.562569792920557*^9, 
   3.56256986520304*^9, 3.562569940055172*^9, 3.562570069354033*^9, 
   3.562573720393043*^9, 3.562578605258504*^9, 3.562578678008391*^9, 
   3.562582470231386*^9, 3.562582720529517*^9, {3.5625840932384033`*^9, 
   3.562584108134748*^9}, 3.5625857078361273`*^9, 3.5625893642067633`*^9, 
   3.5625924449404917`*^9, 3.562593662226322*^9, 3.5625937442080936`*^9, 
   3.5625940231699877`*^9, 3.562594331256647*^9, 3.562606980430769*^9, 
   3.562647139393483*^9, 3.562647357477235*^9, 3.562649647046753*^9, 
   3.562650026057096*^9, 3.5626503817356243`*^9, 3.562650467870427*^9, 
   3.562650551574192*^9, 3.5626559555542593`*^9, 3.562717227113434*^9, 
   3.56319923247927*^9, 3.563461105527663*^9, 3.563772960028048*^9, 
   3.56377305895203*^9, 3.563773883286666*^9, 3.563773934679843*^9, 
   3.563773994788101*^9, 3.5683127589851418`*^9, 3.568312869535918*^9, 
   3.568312916435062*^9, 3.5691323923566837`*^9, 3.5692303108031597`*^9, 
   3.56934025283379*^9, 3.56934051257654*^9, 3.569340731573551*^9, 
   3.5694189959460773`*^9, 3.569578893952951*^9}]
}, Open  ]],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["1.7. Extensions of xTensor", "Subsubsection",
 CellChangeTimes->{{3.5626505250745687`*^9, 3.562650532342607*^9}, {
   3.563280999882614*^9, 3.5632810000723886`*^9}, {3.5637416866466827`*^9, 
   3.563741687532864*^9}, {3.5637739248018827`*^9, 3.5637739252256823`*^9}, {
   3.5647378725952044`*^9, 3.564737872970562*^9}, 3.565611395144515*^9, {
   3.5683560870066643`*^9, 3.568356093509886*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "*", " ", "Why", " ", "a", " ", "scalar", " ", "head", " ", "inside", " ", 
    "a", " ", "scalar", " ", 
    RowBox[{"function", "?"}]}], " ", "**)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "*", " ", "We", " ", "choose", " ", "that", " ", "the", " ", "Scalar", " ",
     "head", " ", "should", " ", "be", " ", "removed"}], "**)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Unprotect", "[", "xAct`xTensor`NoScalar", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"xAct`xTensor`NoScalar", "[", 
     RowBox[{
      RowBox[{"f_", "?", "ScalarFunctionQ"}], "[", "expr_", "]"}], "]"}], ":=", 
    RowBox[{"f", "[", 
     RowBox[{"NoScalar", "@", "expr"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Protect", "[", "xAct`xTensor`NoScalar", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "*", " ", "To", " ", "avoid", " ", "complaints", " ", "from", " ", 
     "MakeRule", " ", "when", " ", "the", " ", "rule", " ", "has", " ", 
     "already", " ", "been", " ", "defined", " ", "and", " ", "the", " ", 
     "lhs", " ", "is", " ", 
     RowBox[{"zero", "."}]}], " ", "**)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"xAct`xTensor`MakeRule", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"lhs_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Evaluate", "[", "#", "]"}], "===", "0"}], "&"}], 
           ")"}]}], ",", "rhs_", ",", "conditions___"}], "}"}], ",", 
       "options___"}], "]"}], ":=", 
     RowBox[{"{", "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562649959858017*^9, 3.5626499675206633`*^9}, {
   3.5626500601409883`*^9, 3.56265006206045*^9}, {3.562650447549335*^9, 
   3.56265045006211*^9}, {3.5626512472681713`*^9, 3.562651274610902*^9}, {
   3.562780057453079*^9, 3.5627800580014257`*^9}, {3.563103065067337*^9, 
   3.563103083487412*^9}, {3.563105078587597*^9, 3.563105093618329*^9}, {
   3.563105339678611*^9, 3.563105361664975*^9}, {3.563137617134811*^9, 
   3.563137619847885*^9}, {3.563138465984416*^9, 3.5631384679860353`*^9}, {
   3.563139354970381*^9, 3.5631393832049637`*^9}, {3.5631636594326982`*^9, 
   3.563163700270323*^9}, {3.563163887754581*^9, 3.563163906424601*^9}, {
   3.5631640144113607`*^9, 3.563164017853908*^9}, {3.56319041937845*^9, 
   3.563190421411005*^9}, 3.563190629302273*^9, {3.5632735763175287`*^9, 
   3.563273638541603*^9}, {3.56328081225706*^9, 3.563280991144342*^9}, {
   3.563425055858799*^9, 3.563425076678986*^9}, {3.563425577541067*^9, 
   3.5634256189308453`*^9}, {3.563425793113318*^9, 3.56342579571917*^9}, {
   3.5635150006816196`*^9, 3.563515004113714*^9}, {3.564471660487132*^9, 
   3.56447166094235*^9}, 3.564478644551565*^9, {3.564737778803647*^9, 
   3.564737862696217*^9}, {3.564751747768537*^9, 3.564751952109613*^9}, {
   3.564945550797289*^9, 3.564945551309742*^9}, {3.56631393278139*^9, 
   3.566313938622156*^9}, {3.568004978774014*^9, 3.568004984212612*^9}, {
   3.568100072280724*^9, 3.568100166020076*^9}, {3.568100268549596*^9, 
   3.5681002708460417`*^9}, {3.5681003232461576`*^9, 3.56810035222886*^9}, {
   3.568100485376153*^9, 3.568100491595495*^9}, {3.568101500381734*^9, 
   3.568101541483588*^9}, {3.568298144791143*^9, 3.568298147439986*^9}, {
   3.5682982397190523`*^9, 3.56829824314351*^9}, {3.568298407457621*^9, 
   3.56829843992699*^9}, {3.568314071804817*^9, 3.5683140942601337`*^9}, 
   3.568314131641488*^9, {3.5683560694264812`*^9, 3.568356107957871*^9}, 
   3.568458089719936*^9, 3.56845812404249*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Names", "[", "\"\<xAct`xPand`*\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.562553483669783*^9, 3.5625534850514927`*^9}, {
  3.563773014530553*^9, 3.56377301528048*^9}, {3.563774011403577*^9, 
  3.563774024411229*^9}, {3.568312901900853*^9, 3.568312902843878*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"a\"\>", ",", "\<\"av\"\>", 
   ",", "\<\"BackgroundFieldMethod\"\>", ",", "\<\"Bs\"\>", ",", "\<\"Bv\"\>",
    ",", "\<\"Conformal\"\>", ",", "\<\"ConformalWeight\"\>", 
   ",", "\<\"Connection\"\>", ",", "\<\"CS\"\>", 
   ",", "\<\"DefConformalMetric\"\>", ",", "\<\"DefMatterFields\"\>", 
   ",", "\<\"DefMetricFields\"\>", ",", "\<\"DefProjectedTensor\"\>", 
   ",", "\<\"DefProjectedTensorProperties\"\>", ",", "\<\"Disclaimer\"\>", 
   ",", "\<\"Es\"\>", ",", "\<\"Et\"\>", ",", "\<\"Ev\"\>", 
   ",", "\<\"ExtractComponents\"\>", ",", "\<\"ExtractOrder\"\>", 
   ",", "\<\"H\"\>", ",", "\<\"IndicesDown\"\>", ",", "\<\"IndicesUp\"\>", 
   ",", "\<\"Ls\"\>", ",", "\<\"Lv\"\>", ",", "\<\"nt\"\>", ",", "\<\"P\"\>", 
   ",", "\<\"RulesSplitCovDsOfTensor\"\>", 
   ",", "\<\"RulesVelocitySpatial\"\>", ",", "\<\"SetSlicing\"\>", 
   ",", "\<\"SpaceTimesOfDefinition\"\>", ",", "\<\"SpaceType\"\>", 
   ",", "\<\"SplitGaugeChange\"\>", ",", "\<\"SplitMatter\"\>", 
   ",", "\<\"SplitMetric\"\>", ",", "\<\"SplitMetricAndMatterGaugeChange\"\>",
    ",", "\<\"SplitPerturbations\"\>", ",", "\<\"T\"\>", 
   ",", "\<\"TensorProperties\"\>", ",", "\<\"ToBianchiType\"\>", 
   ",", "\<\"ToConstantsOfStructure\"\>", ",", "\<\"ToMetric\"\>", 
   ",", "\<\"ToxPand\"\>", ",", "\<\"ToxPandFromRules\"\>", ",", "\<\"V0\"\>",
    ",", "\<\"VisualizeTensor\"\>", ",", "\<\"Vs\"\>", ",", "\<\"Vspat\"\>", 
   ",", "\<\"Vv\"\>", ",", "\<\"xPand\"\>", ",", "\<\"\[ScriptK]\"\>", 
   ",", "\<\"\[Epsilon]\"\>", ",", "\<\"\[Xi]\"\>", ",", "\<\"\[Rho]\"\>", 
   ",", "\<\"\[Phi]\"\>", ",", "\<\"\[CurlyPhi]\"\>", ",", "\<\"\[Psi]\"\>", 
   ",", "\<\"$CacheRules\"\>", ",", "\<\"$CommutecdRules\"\>", 
   ",", "\<\"$ConformalTime\"\>", 
   ",", "\<\"$FirstOrderTensorPerturbations\"\>", 
   ",", "\<\"$FirstOrderVectorPerturbations\"\>", 
   ",", "\<\"$ListFieldsBackgroundAndPerturbed\"\>", 
   ",", "\<\"$ListFieldsBackgroundOnly\"\>", 
   ",", "\<\"$ListFieldsPerturbedOnly\"\>", ",", "\<\"$ListOfGauges\"\>", ",",
    "\<\"$ListOfSpaceTypes\"\>", ",", "\<\"$MyRules\"\>", 
   ",", "\<\"$OpenConstantsOfStructure\"\>", 
   ",", "\<\"$SortCovDAutomatic\"\>", ",", "\<\"$Version\"\>", 
   ",", "\<\"$xPertVersionExpected\"\>", 
   ",", "\<\"$xTensorVersionExpected\"\>"}], "}"}]], "Output",
 CellChangeTimes->{3.569418995999558*^9, 3.569578894014708*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["$ContextPath"], "Input"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"xAct`xPand`\"\>", ",", "\<\"xAct`xPert`\"\>", 
   ",", "\<\"xAct`xTensor`\"\>", ",", "\<\"xAct`xPerm`\"\>", 
   ",", "\<\"xAct`xCore`\"\>", ",", "\<\"xAct`ExpressionManipulation`\"\>", 
   ",", "\<\"System`\"\>"}], "}"}]], "Output",
 CellChangeTimes->{{3.5625534991782913`*^9, 3.562553511579418*^9}, 
   3.562556005034225*^9, {3.562556230430189*^9, 3.5625562431529007`*^9}, 
   3.5625563980900393`*^9, 3.562556493164074*^9, 3.562556566912746*^9, {
   3.562558882585108*^9, 3.562558929117688*^9}, 3.562561261312769*^9, 
   3.562561326203315*^9, 3.56256162981441*^9, 3.5625617333344584`*^9, 
   3.562561771274391*^9, 3.562562186557506*^9, 3.5625624632868137`*^9, 
   3.562562523435742*^9, 3.56256352721319*^9, 3.562563905019148*^9, 
   3.562569792989794*^9, 3.562569865288994*^9, 3.562569940238023*^9, 
   3.56257006942668*^9, 3.562573720467161*^9, 3.5625786053282757`*^9, 
   3.562578678079666*^9, 3.562582470300846*^9, 3.562582720615028*^9, 
   3.562584108239238*^9, 3.562585707905003*^9, 3.562589364279303*^9, 
   3.562592445009321*^9, 3.562593662313136*^9, 3.562593744281817*^9, 
   3.5625940232556067`*^9, 3.562594331340355*^9, 3.562606980533863*^9, 
   3.5626471394311047`*^9, 3.5626473575495787`*^9, 3.562649647114972*^9, 
   3.5626500261218843`*^9, 3.562650381808634*^9, 3.562650467970289*^9, 
   3.5626505516432962`*^9, 3.5626559558725653`*^9, 3.562717227215687*^9, 
   3.56319923256219*^9, 3.563461105601636*^9, 3.563772960129781*^9, 
   3.56377305905373*^9, 3.5637738834117327`*^9, 3.563773934879591*^9, 
   3.5637739949259443`*^9, 3.568312759083632*^9, 3.568312869705298*^9, 
   3.5683129165353107`*^9, 3.569132392439631*^9, 3.569230310901061*^9, 
   3.569340253050537*^9, 3.569340512660997*^9, 3.56934073167023*^9, 
   3.5694189960302258`*^9, 3.5695788940495367`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["$Context"], "Input"],

Cell[BoxData["\<\"xAct`xPand`Private`\"\>"], "Output",
 CellChangeTimes->{
  3.562553512312055*^9, 3.562556005072269*^9, {3.5625562304666224`*^9, 
   3.5625562432845383`*^9}, 3.562556398143414*^9, 3.562556493201912*^9, 
   3.562556566961092*^9, {3.562558882620899*^9, 3.562558929153141*^9}, 
   3.5625612613443613`*^9, 3.56256132624881*^9, 3.562561629846305*^9, 
   3.5625617333679132`*^9, 3.562561771557509*^9, 3.562562186624413*^9, 
   3.562562463319376*^9, 3.562562523466831*^9, 3.562563527242588*^9, 
   3.5625639050520067`*^9, 3.562569793023882*^9, 3.562569865343527*^9, 
   3.562569940283208*^9, 3.5625700694722433`*^9, 3.562573720511902*^9, 
   3.562578605361288*^9, 3.562578678109226*^9, 3.5625824703318996`*^9, 
   3.5625827206861563`*^9, 3.56258410826862*^9, 3.562585707941988*^9, 
   3.562589364307747*^9, 3.562592445064281*^9, 3.562593662345236*^9, 
   3.5625937443283453`*^9, 3.562594023306069*^9, 3.562594331375646*^9, 
   3.562606980585041*^9, 3.5626471394490433`*^9, 3.5626473575798187`*^9, 
   3.5626496471710167`*^9, 3.562650026158716*^9, 3.562650381837846*^9, 
   3.562650468007958*^9, 3.5626505516764717`*^9, 3.562655955974246*^9, 
   3.5627172272787743`*^9, 3.563199232617674*^9, 3.563461105630294*^9, 
   3.563772960183261*^9, 3.563773059102888*^9, 3.56377388347991*^9, 
   3.5637739349420424`*^9, 3.563773994972073*^9, 3.568312759121421*^9, 
   3.568312869737647*^9, 3.568312916573748*^9, 3.5691323924738197`*^9, 
   3.56923031093889*^9, 3.569340253082954*^9, 3.569340512691249*^9, 
   3.5693407317068443`*^9, 3.569418996064561*^9, 3.5695788940857563`*^9}]
}, Open  ]],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["1.8. Default options and protected names", "Subsubsection",
 CellChangeTimes->{{3.562559757086691*^9, 3.562559777749761*^9}, {
   3.5637417005726433`*^9, 3.563741700828908*^9}, {3.564737986190421*^9, 
   3.564737989580208*^9}, 3.565611398095446*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "DEFAULT"}], " ", "OPTIONS", " ", "AND", " ", 
    "PROTECTED", " ", "NAMES"}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"BackgroundFieldMethod", " ", "=", " ", "False"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$DebugInfoQ", "=", "False"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"$CacheRules", " ", "=", " ", "False"}], ";"}], " ", 
    RowBox[{"(*", " ", "obsolete", " ", "*)"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$CommutecdRules", " ", "=", " ", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$ConformalTime", " ", "=", " ", "True"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$FirstOrderVectorPerturbations", "=", "True"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$FirstOrderTensorPerturbations", "=", "True"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"$MyRules", "=", 
      RowBox[{"{", "}"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$OpenConstantsOfStructure", "=", "True"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$PrePrint", "=", "ScreenDollarIndices"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"$SortCovDAutomatic", "=", "True"}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Protect", "[", 
      RowBox[{
      "Anisotropic", ",", "BianchiB", ",", "BianchiA", ",", "BianchiI", ",", 
       "FLCurved", ",", "FLFlat"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", 
      RowBox[{"Background", ",", "Perturbed"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", 
      RowBox[{"SymmetricTensor", ",", "Traceless", ",", "Transverse"}], "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", 
      RowBox[{
      "AnyGauge", ",", "ComovingGauge", ",", "FlatGauge", ",", 
       "IsoDensityGauge", ",", "NewtonGauge", ",", "SynchronousGauge"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", 
      RowBox[{"Tilted", ",", " ", "NotTilted"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", "Time", "]"}], ";"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Off", "[", 
     StyleBox[
      RowBox[{"RuleDelayed", "::", "rhs"}], "MessageName"], 
     StyleBox["]", "MessageName"]}], 
    StyleBox[";", "MessageName"]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562559759851193*^9, 3.562559761249802*^9}, {
   3.562562069814568*^9, 3.562562102269669*^9}, {3.56256236509564*^9, 
   3.562562366813838*^9}, {3.562656004100676*^9, 3.5626560090260344`*^9}, {
   3.562662387120689*^9, 3.562662393486032*^9}, {3.562764640799706*^9, 
   3.562764643974275*^9}, {3.562765634088146*^9, 3.56276563526514*^9}, {
   3.5627657466858053`*^9, 3.562765753795895*^9}, {3.562769707355989*^9, 
   3.562769708457*^9}, {3.56286869947679*^9, 3.562868702563456*^9}, {
   3.562907234581778*^9, 3.562907237661024*^9}, {3.5629341085405693`*^9, 
   3.5629341163332*^9}, {3.562937624598484*^9, 3.562937626939456*^9}, {
   3.562958608494596*^9, 3.562958612484511*^9}, {3.56296737825025*^9, 
   3.562967380288393*^9}, {3.563099733963818*^9, 3.563099746270157*^9}, {
   3.5630998050318403`*^9, 3.5630998080336523`*^9}, {3.563101532612177*^9, 
   3.563101537604954*^9}, {3.5631080388463917`*^9, 3.5631080397345877`*^9}, {
   3.5631132671780033`*^9, 3.5631132741285477`*^9}, {3.5631718426756287`*^9, 
   3.563171847400419*^9}, {3.563197459173162*^9, 3.563197462547925*^9}, {
   3.563282330820362*^9, 3.563282334350708*^9}, {3.563527507642476*^9, 
   3.563527521117053*^9}, {3.563605643773634*^9, 3.563605654074357*^9}, {
   3.563615679594771*^9, 3.5636156984375277`*^9}, {3.563695784031949*^9, 
   3.5636957864655437`*^9}, {3.5647378975244093`*^9, 3.564738111307848*^9}, 
   3.564738154189324*^9, {3.564738201729841*^9, 3.5647382396715307`*^9}, {
   3.564751975751108*^9, 3.5647519790049953`*^9}, {3.564756662274791*^9, 
   3.5647566637685966`*^9}, 3.564756763885778*^9, {3.565951154840543*^9, 
   3.565951173370339*^9}, {3.5663139870989532`*^9, 3.566313987272159*^9}, {
   3.5668394640976477`*^9, 3.566839516352603*^9}, {3.56690181634978*^9, 
   3.566901816500333*^9}, {3.567225289169694*^9, 3.567225292336237*^9}, {
   3.5672385890028563`*^9, 3.567238589611244*^9}, {3.5693295823662024`*^9, 
   3.56932958592321*^9}, {3.569897866911418*^9, 3.569897873304144*^9}, 
   3.57051097482933*^9, 3.570511184334381*^9}],

Cell["\<\

InertHead used to replace the scalars. This is to avoid the application of \
the Leibniz rule inside the Scalar Head.\
\>", "Text",
 CellChangeTimes->{{3.564405303992445*^9, 3.564405322668154*^9}, {
  3.564738116943597*^9, 3.564738141014945*^9}, {3.564752014999996*^9, 
  3.56475201911031*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", "Print", "}"}], ",", 
    RowBox[{"DefInertHead", "[", 
     RowBox[{"ProtectMyScalar", ",", 
      RowBox[{"LinearQ", "\[Rule]", "True"}]}], "]"}]}], "]"}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.564752034778721*^9, 3.5650048536963787`*^9}],

Cell["\<\

\
\>", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
   3.564146893121169*^9, 3.564146894088922*^9}, 3.564738149319517*^9}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["2. Main functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{
  3.5081861140031013`*^9, {3.564140600125454*^9, 3.564140600263605*^9}, {
   3.564141496177951*^9, 3.564141537270952*^9}, 3.5641538330283947`*^9, {
   3.564752207227641*^9, 3.564752209425137*^9}, {3.565611388228051*^9, 
   3.565611389648827*^9}},
 FontColor->RGBColor[
  0.20389105058365758`, 0.38530556191348136`, 0.9685969329365988]],

Cell[CellGroupData[{

Cell["2.1. Useful tools", "Subsubsection",
 CellChangeTimes->{{3.5625603109856243`*^9, 3.562560317714089*^9}, {
  3.564752234156185*^9, 3.564752234761362*^9}}],

Cell["\<\
Contents: 
\tColoration of the perturbation orders
\tConvenient functions to build rules
\tHandling expressions
\tPrivate boolean functions\
\>", "Text",
 CellChangeTimes->{{3.564737589063151*^9, 3.564737715863504*^9}, 
   3.56474446663629*^9, {3.564750319139655*^9, 3.564750320359291*^9}, {
   3.565274585345623*^9, 3.5652745892657127`*^9}, {3.565606174392047*^9, 
   3.5656061812034073`*^9}, {3.565611346537211*^9, 3.565611346840087*^9}}],

Cell["\<\

Coloration of the perturbation orders:\
\>", "Text",
 CellChangeTimes->{{3.563736695507998*^9, 3.563736697779483*^9}, 
   3.565599922248754*^9, {3.565606125712685*^9, 3.565606201936356*^9}, 
   3.566040224103834*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "COLORATION"}], " ", "OF", " ", "THE", " ", 
    "PERTURBATION", " ", "ORDERS"}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"DerCharacter", ":=", 
     RowBox[{"If", "[", 
      RowBox[{"$ConformalTime", ",", "\"\<\[Prime]\>\"", ",", "\"\<.\>\""}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "The", " ", "output", " ", "format", " ", "of", " ", "the", " ", "Lie", 
      " ", "derivative", " ", "with", " ", "respect", " ", "to", " ", "the", 
      " ", "vector", " ", "normal", " ", "to", " ", "the", " ", 
      "hypersurfaces", " ", "is", " ", "a", " ", "prime", " ", "when", " ", 
      "one", " ", "considers", " ", "the", " ", "conformal", " ", "time"}], 
     ",", " ", 
     RowBox[{
     "and", " ", "a", " ", "dot", " ", "when", " ", "one", " ", "considers", 
      " ", "the", " ", "cosmic", " ", 
      RowBox[{"time", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"xTensorFormStop", "[", "Tensor", "]"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MakeBoxes", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Tens_", "?", "xTensorQ"}], "[", 
       RowBox[{
        RowBox[{"LI", "[", 
         RowBox[{"p_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
              RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], ")"}]}], 
         "]"}], ",", 
        RowBox[{"LI", "[", 
         RowBox[{"q_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
              RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], ")"}]}], 
         "]"}], ",", "inds___"}], "]"}], ",", "StandardForm"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"AnisotropyBool", "[", 
          RowBox[{"SpaceType", "@", 
           RowBox[{"InducedMetricOf", "[", "Tens", "]"}]}], "]"}], "||", 
         RowBox[{"BianchiBool", "[", 
          RowBox[{"SpaceType", "@", 
           RowBox[{"InducedMetricOf", "[", "Tens", "]"}]}], "]"}]}], ")"}], "&&", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"{", "inds", "}"}], ",", 
          RowBox[{"_", "?", "UpIndexQ"}]}], "]"}], "=!=", 
        RowBox[{"{", "}"}]}], "&&", 
       RowBox[{"q", "\[GreaterEqual]", "1"}]}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"xPand", "::", "makeboxes"}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"RowBox", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"OverscriptBox", "[", 
           RowBox[{"\"\<\\\"\\\"\>\"", ",", 
            RowBox[{"RowBox", "[", 
             RowBox[{"{", 
              RowBox[{"\"\<(\>\"", ",", 
               RowBox[{"ToString", "[", "p", "]"}], ",", "\"\<)\>\""}], "}"}],
              "]"}]}], "]"}], ",", "\"\<\[NegativeThinSpace]\>\"", ",", 
          RowBox[{"OverscriptBox", "[", 
           RowBox[{
            RowBox[{"MakeBoxes", "[", 
             RowBox[{
              RowBox[{"Tens", "[", "inds", "]"}], ",", "StandardForm"}], 
             "]"}], ",", 
            RowBox[{"ToString", "[", "q", "]"}]}], "]"}]}], "}"}], "]"}]}], 
      ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Switch", "[", 
       RowBox[{"p", ",", "\[IndentingNewLine]", "0", ",", 
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{"OverscriptBox", "[", 
           RowBox[{
            RowBox[{"MakeBoxes", "[", 
             RowBox[{
              RowBox[{"Tens", "[", "inds", "]"}], ",", "StandardForm"}], 
             "]"}], ",", 
            RowBox[{"StringJoin", "@", 
             RowBox[{"Table", "[", 
              RowBox[{"DerCharacter", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "q"}], "}"}]}], "]"}]}]}], "]"}], 
          "}"}], "]"}], ",", "\[IndentingNewLine]", "1", ",", 
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"OverscriptBox", "[", 
            RowBox[{"\"\<\\\"\\\"\>\"", ",", 
             RowBox[{"RowBox", "[", 
              RowBox[{"{", 
               RowBox[{"StyleBox", "[", 
                RowBox[{"\"\<(1)\>\"", ",", 
                 RowBox[{"FontColor", "\[Rule]", 
                  RowBox[{"RGBColor", "[", 
                   RowBox[{"0.85", ",", "0", ",", "0"}], "]"}]}]}], "]"}], 
               "}"}], "]"}]}], "]"}], ",", "\"\<\[NegativeThinSpace]\>\"", 
           ",", 
           RowBox[{"OverscriptBox", "[", 
            RowBox[{
             RowBox[{"MakeBoxes", "[", 
              RowBox[{
               RowBox[{"Tens", "[", "inds", "]"}], ",", "StandardForm"}], 
              "]"}], ",", 
             RowBox[{"StringJoin", "@", 
              RowBox[{"Table", "[", 
               RowBox[{"DerCharacter", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "q"}], "}"}]}], "]"}]}]}], 
            "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", "2", ",", 
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"OverscriptBox", "[", 
            RowBox[{"\"\<\\\"\\\"\>\"", ",", 
             RowBox[{"RowBox", "[", 
              RowBox[{"{", 
               RowBox[{"StyleBox", "[", 
                RowBox[{"\"\<(2)\>\"", ",", 
                 RowBox[{"FontColor", "\[Rule]", 
                  RowBox[{"RGBColor", "[", 
                   RowBox[{"0", ",", "0.6", ",", "0"}], "]"}]}]}], "]"}], 
               "}"}], "]"}]}], "]"}], ",", "\"\<\[NegativeThinSpace]\>\"", 
           ",", "\[IndentingNewLine]", 
           RowBox[{"OverscriptBox", "[", 
            RowBox[{
             RowBox[{"MakeBoxes", "[", 
              RowBox[{
               RowBox[{"Tens", "[", "inds", "]"}], ",", "StandardForm"}], 
              "]"}], ",", 
             RowBox[{"StringJoin", "@", 
              RowBox[{"Table", "[", 
               RowBox[{"DerCharacter", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "q"}], "}"}]}], "]"}]}]}], 
            "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", "3", ",", 
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"OverscriptBox", "[", 
            RowBox[{"\"\<\\\"\\\"\>\"", ",", 
             RowBox[{"RowBox", "[", 
              RowBox[{"{", 
               RowBox[{"StyleBox", "[", 
                RowBox[{"\"\<(3)\>\"", ",", 
                 RowBox[{"FontColor", "\[Rule]", 
                  RowBox[{"RGBColor", "[", 
                   RowBox[{"0", ",", "0", ",", "0.85"}], "]"}]}]}], "]"}], 
               "}"}], "]"}]}], "]"}], ",", "\"\<\[NegativeThinSpace]\>\"", 
           ",", 
           RowBox[{"OverscriptBox", "[", 
            RowBox[{
             RowBox[{"MakeBoxes", "[", 
              RowBox[{
               RowBox[{"Tens", "[", "inds", "]"}], ",", "StandardForm"}], 
              "]"}], ",", 
             RowBox[{"StringJoin", "@", 
              RowBox[{"Table", "[", 
               RowBox[{"DerCharacter", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "q"}], "}"}]}], "]"}]}]}], 
            "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", "4", ",", 
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"OverscriptBox", "[", 
            RowBox[{"\"\<\\\"\\\"\>\"", ",", 
             RowBox[{"RowBox", "[", 
              RowBox[{"{", 
               RowBox[{"StyleBox", "[", 
                RowBox[{"\"\<(4)\>\"", ",", 
                 RowBox[{"FontColor", "\[Rule]", 
                  RowBox[{"RGBColor", "[", 
                   RowBox[{"0.6", ",", "0.4", ",", "0.2"}], "]"}]}]}], "]"}], 
               "}"}], "]"}]}], "]"}], ",", "\"\<\[NegativeThinSpace]\>\"", 
           ",", 
           RowBox[{"OverscriptBox", "[", 
            RowBox[{
             RowBox[{"MakeBoxes", "[", 
              RowBox[{
               RowBox[{"Tens", "[", "inds", "]"}], ",", "StandardForm"}], 
              "]"}], ",", 
             RowBox[{"StringJoin", "@", 
              RowBox[{"Table", "[", 
               RowBox[{"DerCharacter", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "q"}], "}"}]}], "]"}]}]}], 
            "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", "5", ",", 
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"OverscriptBox", "[", 
            RowBox[{"\"\<\\\"\\\"\>\"", ",", 
             RowBox[{"RowBox", "[", 
              RowBox[{"{", 
               RowBox[{"StyleBox", "[", 
                RowBox[{"\"\<(5)\>\"", ",", 
                 RowBox[{"FontColor", "\[Rule]", 
                  RowBox[{"RGBColor", "[", 
                   RowBox[{"0.7", ",", "0", ",", "0.7"}], "]"}]}]}], "]"}], 
               "}"}], "]"}]}], "]"}], ",", "\"\<\[NegativeThinSpace]\>\"", 
           ",", 
           RowBox[{"OverscriptBox", "[", 
            RowBox[{
             RowBox[{"MakeBoxes", "[", 
              RowBox[{
               RowBox[{"Tens", "[", "inds", "]"}], ",", "StandardForm"}], 
              "]"}], ",", 
             RowBox[{"StringJoin", "@", 
              RowBox[{"Table", "[", 
               RowBox[{"DerCharacter", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "q"}], "}"}]}], "]"}]}]}], 
            "]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", "_", ",", 
        RowBox[{"RowBox", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"OverscriptBox", "[", 
            RowBox[{"\"\<\\\"\\\"\>\"", ",", 
             RowBox[{"RowBox", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"StyleBox", "[", 
                 RowBox[{"\"\<(\>\"", ",", 
                  RowBox[{"FontColor", "\[Rule]", 
                   RowBox[{"RGBColor", "[", 
                    RowBox[{"1", ",", "0.6", ",", "0"}], "]"}]}]}], "]"}], 
                ",", 
                RowBox[{"StyleBox", "[", 
                 RowBox[{
                  RowBox[{"ToString", "[", "p", "]"}], ",", 
                  RowBox[{"FontColor", "\[Rule]", 
                   RowBox[{"RGBColor", "[", 
                    RowBox[{"1", ",", "0.6", ",", "0"}], "]"}]}]}], "]"}], 
                ",", 
                RowBox[{"StyleBox", "[", 
                 RowBox[{"\"\<)\>\"", ",", 
                  RowBox[{"FontColor", "\[Rule]", 
                   RowBox[{"RGBColor", "[", 
                    RowBox[{"1", ",", "0.6", ",", "0"}], "]"}]}]}], "]"}]}], 
               "}"}], "]"}]}], "]"}], ",", "\"\<\[NegativeThinSpace]\>\"", 
           ",", 
           RowBox[{"OverscriptBox", "[", 
            RowBox[{
             RowBox[{"MakeBoxes", "[", 
              RowBox[{
               RowBox[{"Tens", "[", "inds", "]"}], ",", "StandardForm"}], 
              "]"}], ",", 
             RowBox[{"StringJoin", "@", 
              RowBox[{"Table", "[", 
               RowBox[{"DerCharacter", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "q"}], "}"}]}], "]"}]}]}], 
            "]"}]}], "}"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "\n", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"xTensorFormStart", "[", "Tensor", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5625933234016237`*^9, 3.5625934043926287`*^9}, {
   3.562593434924644*^9, 3.562593464575581*^9}, {3.5625935089310637`*^9, 
   3.562593526319685*^9}, {3.5625936869373817`*^9, 3.5625937201075583`*^9}, {
   3.562593814691472*^9, 3.5625938426627417`*^9}, {3.56259394828642*^9, 
   3.5625940044192057`*^9}, 3.562594155252771*^9, {3.562594186262424*^9, 
   3.562594195972742*^9}, {3.562594244228497*^9, 3.562594245339738*^9}, {
   3.5625943493088217`*^9, 3.562594442038971*^9}, {3.562594499852265*^9, 
   3.56259451751968*^9}, {3.562594666148861*^9, 3.5625947047010937`*^9}, {
   3.562594737008398*^9, 3.5625947449954777`*^9}, {3.562594790364253*^9, 
   3.56259484373137*^9}, {3.562594889723131*^9, 3.562594893687097*^9}, {
   3.5625949243449793`*^9, 3.562594960371579*^9}, {3.5625950017172213`*^9, 
   3.562595025463358*^9}, {3.562595127569173*^9, 3.5625951604827843`*^9}, {
   3.562595234291766*^9, 3.562595266720358*^9}, {3.562595311685704*^9, 
   3.56259532204834*^9}, {3.5625954231404457`*^9, 3.56259547207086*^9}, {
   3.5625955247524776`*^9, 3.5625955267543*^9}, {3.562595576987162*^9, 
   3.562595662731875*^9}, {3.5626069271081543`*^9, 3.562606963716811*^9}, {
   3.5626464651280813`*^9, 3.562646475865118*^9}, 3.5626465219872913`*^9, {
   3.562646705155902*^9, 3.562646709650979*^9}, {3.562651535129075*^9, 
   3.562651536742071*^9}, {3.562651633872854*^9, 3.5626516358449907`*^9}, {
   3.562656805031062*^9, 3.562656925823289*^9}, {3.5626569844089622`*^9, 
   3.562657034430972*^9}, {3.562657227611857*^9, 3.562657232650329*^9}, {
   3.562657386221434*^9, 3.5626573935480824`*^9}, {3.562657428212676*^9, 
   3.5626574632793617`*^9}, {3.562723003819562*^9, 3.5627230074878607`*^9}, {
   3.5627235870480337`*^9, 3.562723589646841*^9}, 3.562724405054818*^9, {
   3.563703426330496*^9, 3.5637034450269623`*^9}, {3.563736514091443*^9, 
   3.5637365346755342`*^9}, {3.56373662216387*^9, 3.5637366401130543`*^9}, {
   3.563736673464651*^9, 3.563736688352985*^9}, {3.565602644307456*^9, 
   3.56560264480189*^9}, {3.5656062045524397`*^9, 3.5656062053213882`*^9}, {
   3.5656066077815523`*^9, 3.565606633313128*^9}, {3.565606714969775*^9, 
   3.565606743502784*^9}, {3.565607272861617*^9, 3.565607279676262*^9}, {
   3.5656095410734367`*^9, 3.56560955833213*^9}, {3.565609643792431*^9, 
   3.565609652174674*^9}, {3.565609766334345*^9, 3.565609777874823*^9}, {
   3.5656098222143803`*^9, 3.565609879274815*^9}, {3.5656101323749743`*^9, 
   3.565610143650937*^9}, {3.5656101918519707`*^9, 3.565610230770206*^9}, {
   3.565610329820622*^9, 3.5656103742321787`*^9}, {3.565610509588439*^9, 
   3.56561051454558*^9}, {3.565611166109646*^9, 3.565611198374831*^9}, {
   3.565613803851553*^9, 3.5656138150774384`*^9}, {3.565881067364236*^9, 
   3.565881108899643*^9}, {3.5659410907951717`*^9, 3.565941138787434*^9}, {
   3.565941360083725*^9, 3.5659413692648077`*^9}, 3.565945403189856*^9, {
   3.565945448725526*^9, 3.565945459081592*^9}, {3.566112493542708*^9, 
   3.5661124987187366`*^9}, {3.566112732890327*^9, 3.566112736013379*^9}, {
   3.566114337079069*^9, 3.5661143554827223`*^9}, {3.566315779307901*^9, 
   3.566315784685814*^9}, {3.566317144548213*^9, 3.566317148413639*^9}, {
   3.566318470298293*^9, 3.56631848894636*^9}, {3.566318677367346*^9, 
   3.566318678562564*^9}, {3.56631877764778*^9, 3.566318823985784*^9}, {
   3.5663194991163*^9, 3.566319499906191*^9}, {3.566462906280212*^9, 
   3.566462907533633*^9}, {3.5681007264614887`*^9, 3.5681007375698547`*^9}, {
   3.568101297333973*^9, 3.568101313622014*^9}, {3.56810136579272*^9, 
   3.5681013682381372`*^9}, {3.568545831620187*^9, 3.5685458545732727`*^9}, {
   3.5685463868620253`*^9, 3.568546392512578*^9}, {3.568548018657514*^9, 
   3.568548067772698*^9}, {3.568548114414875*^9, 3.568548147608028*^9}, {
   3.568549288275539*^9, 3.5685493056594877`*^9}, 3.56854933927663*^9, {
   3.568549431804537*^9, 3.568549441216703*^9}, {3.568549888889254*^9, 
   3.568549899395431*^9}, {3.5685500525617456`*^9, 3.5685501576030703`*^9}, 
   3.568550224400756*^9, {3.568550364095131*^9, 3.568550405006708*^9}, {
   3.5685504891807117`*^9, 3.5685505218039*^9}, {3.568551165059423*^9, 
   3.568551177952649*^9}, {3.5685515114620447`*^9, 3.568551520079317*^9}, {
   3.56855174580328*^9, 3.568551750315065*^9}, 3.568552642870451*^9, {
   3.568603063322874*^9, 3.568603081264817*^9}}],

Cell["\<\

Convenient functions to build rules:\
\>", "Text",
 CellChangeTimes->{{3.563736800721842*^9, 3.563736807258157*^9}, 
   3.565611219383142*^9, {3.565611303197891*^9, 3.565611319426874*^9}, 
   3.566040230450684*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "CONVENIENT"}], " ", "FUNCTIONS", " ", "TO", " ", 
    "BUILD", " ", "RULES"}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"PatternLeft", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"left_", "\[RuleDelayed]", " ", "right_"}], ")"}], ",", 
      "PositiveIntegerList_List"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"left", "/.", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"#", "\[Rule]", 
            RowBox[{"Pattern", "[", 
             RowBox[{"#", ",", "_"}], "]"}]}], ")"}], "&"}], "/@", " ", 
         "PositiveIntegerList"}], ")"}]}], ")"}], "\[RuleDelayed]", 
     "right"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
       "The", " ", "function", " ", "PatternLeft", " ", "adds", " ", "a", " ",
         "Blank", " ", 
        RowBox[{"(", "_", ")"}], " ", "to", " ", "any", " ", "element", " ", 
        "of", " ", "the", " ", 
        RowBox[{"list", " ", "'"}], 
        RowBox[{"PositiveIntegerList", "'"}], " ", "present", " ", "in", " ", 
        "the", " ", "left"}], "-", 
       RowBox[{
       "hand", " ", "side", " ", "of", " ", "the", " ", "delayed", " ", 
        RowBox[{"rule", " ", "'"}], "left"}]}], " ", "\[RuleDelayed]", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"right", "'"}], ".", " ", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "It"}], " ", "is", " ", "used", " ", "for", 
        " ", "the", " ", "definition", " ", "of", " ", "general", " ", 
        "automatical", " ", 
        RowBox[{"rules", ".", " ", "The"}], " ", "elements", " ", 
        RowBox[{"of", " ", "'"}], 
        RowBox[{"PositiveIntegerList", "'"}], " ", "are", " ", "the", " ", 
        "arguments", " ", "of", " ", "the", " ", "label"}], "-", 
       RowBox[{
       "indices", " ", "for", " ", "the", " ", "perturbed", " ", 
        "tensors"}]}]}], ",", " ", 
     RowBox[{"they", " ", "must", " ", "be", " ", "positive", " ", 
      RowBox[{"integers", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", "following", " ",
      "command", " ", "aims", " ", "at", " ", "extending", " ", "the", " ", 
     "previous", " ", 
     RowBox[{"one", ".", " ", "It"}], " ", "does", " ", "not", " ", 
     RowBox[{"work", ".", " ", "What"}], " ", "is", " ", "the", " ", 
     "correct", " ", "way", " ", "to", " ", "add", " ", 
     RowBox[{"tests", "?"}]}], " ", "**********)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"PatternLeft", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"left_", "\[RuleDelayed]", " ", "right_"}], ")"}], ",", 
       "PositiveIntegerList_List"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"left", "/.", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"#", "\[Rule]", 
             RowBox[{"Pattern", "[", 
              RowBox[{"#", ",", "_Integer"}], "]"}]}], ")"}], "&"}], "/@", 
          " ", "PositiveIntegerList"}], ")"}]}], ")"}], "\[RuleDelayed]", 
      "right"}]}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PatternLeftGeneral", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"left_", "\[RuleDelayed]", " ", "right_"}], ")"}], ",", 
      "ReplaceLists_List"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"left", "/.", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", 
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "&"}], "/@", " ", 
         "ReplaceLists"}], ")"}]}], " ", ")"}], "\[RuleDelayed]", "right"}]}],
    "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "The", " ", "function", " ", "PatternLeftGeneral", " ", "replaces", " ", 
      "the", " ", "elements", " ", 
      RowBox[{"of", " ", "'"}], 
      RowBox[{"left", "'"}], " ", "matching", " ", "the", " ", "first", " ", 
      "element", " ", "of", " ", "one", " ", "of", " ", "the", " ", "lists", 
      " ", "given", " ", 
      RowBox[{"in", " ", "'"}], 
      RowBox[{"ReplaceLists", "'"}], " ", "by", " ", "the", " ", "second", 
      " ", "element", " ", "of", " ", "the", " ", "same", " ", 
      RowBox[{"list", ".", " ", "It"}], " ", "is", " ", "used", " ", "for", 
      " ", "the", " ", "definition", " ", "of", " ", "general", " ", 
      RowBox[{
      "AutomaticRules", ".", " ", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "PatternLeftGeneral"}], " ", "is", " ", "a", 
      " ", "generalization", " ", "of", " ", 
      RowBox[{
      "PatternLeft", ":", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"PatternLeftGeneral", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"left", " ", "\[RuleDelayed]", " ", "right"}], ")"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Element\[Degree]1", ",", 
             RowBox[{"Pattern", "[", 
              RowBox[{"Element\[Degree]1", ",", "_"}], "]"}]}], "}"}], ",", 
           " ", "...", " ", ",", " ", 
           RowBox[{"{", 
            RowBox[{"Element\[Degree]n", ",", 
             RowBox[{"Pattern", "[", 
              RowBox[{"Element\[Degree]n", ",", "_"}], "]"}]}], "}"}]}], " ", 
          "}"}]}], "]"}]}]}], "\[IndentingNewLine]", "=", " ", 
     RowBox[{"PatternLeft", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"left", " ", "\[RuleDelayed]", " ", "right"}], ")"}], ",", 
       RowBox[{"{", 
        RowBox[{
        "Element\[Degree]1", ",", " ", "...", " ", ",", " ", 
         "Element\[Degree]n"}], "}"}]}], "]"}]}], " ", "*)"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562646750013651*^9, 3.562646800781311*^9}, {
   3.562646844987351*^9, 3.562646861711505*^9}, {3.562647710858103*^9, 
   3.562647766987568*^9}, {3.562647839244627*^9, 3.562647845755522*^9}, {
   3.562647930951829*^9, 3.562647972382968*^9}, {3.562648021745718*^9, 
   3.562648050828744*^9}, {3.562648312890215*^9, 3.5626483288900003`*^9}, {
   3.562648433681319*^9, 3.562648455746562*^9}, {3.5626484877091913`*^9, 
   3.562648489812828*^9}, {3.562648571486703*^9, 3.562648574988126*^9}, {
   3.56265943320715*^9, 3.562659469305627*^9}, {3.562659518539547*^9, 
   3.5626595248155527`*^9}, {3.564718031278784*^9, 3.5647180322849197`*^9}, {
   3.565611321767017*^9, 3.565611321935008*^9}, {3.5656136431994867`*^9, 
   3.56561367967452*^9}, {3.565613820304508*^9, 3.565613834338964*^9}, {
   3.565775283758377*^9, 3.565775320461347*^9}, {3.565775418249639*^9, 
   3.565775449563208*^9}, {3.56577719303014*^9, 3.565777195171935*^9}, {
   3.5658811193908978`*^9, 3.5658812607901793`*^9}, {3.565881291456996*^9, 
   3.565881327187519*^9}, {3.56588138898221*^9, 3.5658814146291*^9}, {
   3.565881480240438*^9, 3.565881606723695*^9}, 3.5658959871192617`*^9, {
   3.5658960984386263`*^9, 3.56589619354852*^9}, {3.565896235786687*^9, 
   3.5658965088955803`*^9}, {3.5658966160032997`*^9, 
   3.5658969555785427`*^9}, {3.5658969973699827`*^9, 3.565897006798483*^9}, {
   3.565897060106305*^9, 3.565897062049468*^9}, {3.5658971332360973`*^9, 
   3.565897136217971*^9}, 3.565897176755061*^9, {3.565897697905755*^9, 
   3.565897799785087*^9}, {3.565940722039672*^9, 3.565940726992741*^9}, {
   3.566027000396693*^9, 3.566027001313727*^9}, {3.566027106681078*^9, 
   3.566027126699212*^9}, 3.5660297427476*^9, {3.566031731188902*^9, 
   3.566031767562209*^9}, {3.566031805555357*^9, 3.5660318433012037`*^9}, {
   3.566031880797319*^9, 3.5660320196611032`*^9}, {3.566032050191312*^9, 
   3.56603205356569*^9}, 3.5661121611174583`*^9, {3.566320191862068*^9, 
   3.566320210853487*^9}, {3.566320377734826*^9, 3.566320384737252*^9}, {
   3.566320428331761*^9, 3.566320436306518*^9}, {3.566320929208418*^9, 
   3.5663209314223433`*^9}, {3.566321166807685*^9, 3.566321183412776*^9}, {
   3.5663213166555157`*^9, 3.56632133243898*^9}, {3.56632146848438*^9, 
   3.566321494025803*^9}, {3.566321545837976*^9, 3.5663215560847282`*^9}, {
   3.56632160505886*^9, 3.5663216202717047`*^9}, {3.5663217012646503`*^9, 
   3.566321724323043*^9}, {3.566321828676774*^9, 3.566322022502509*^9}}],

Cell["\<\

Handling expressions:\
\>", "Text",
 CellChangeTimes->{{3.563736712824503*^9, 3.563736719822597*^9}, {
   3.5652553092433033`*^9, 3.565255326585868*^9}, {3.565273749643902*^9, 
   3.565273754107111*^9}, {3.565273927250073*^9, 3.565273938982561*^9}, 
   3.566040233709795*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "HANDLING"}], " ", "EXPRESSIONS"}], " ", "***)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"collect", "[", "expr_", "]"}], ":=", 
    RowBox[{"Collect", "[", 
     RowBox[{"expr", ",", "$PerturbationParameter", ",", "Identity"}], 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"org", "[", "expr_", "]"}], ":=", 
    RowBox[{"Collect", "[", 
     RowBox[{
      RowBox[{"ContractMetric", "[", "expr", "]"}], ",", 
      "$PerturbationParameter", ",", "ToCanonical"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TCnoCM", "[", "expr_", "]"}], ":=", 
    RowBox[{"ToCanonical", "[", 
     RowBox[{"expr", ",", 
      RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
     "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562560340159576*^9, 3.562560342820777*^9}, {
   3.563194591309537*^9, 3.563194619846067*^9}, {3.5636157127441483`*^9, 
   3.563615736203092*^9}, {3.563615771202962*^9, 3.5636157717297497`*^9}, {
   3.564726357207354*^9, 3.564726405094304*^9}, {3.564726881167119*^9, 
   3.564726910781046*^9}, {3.564726964773592*^9, 3.564727002179718*^9}, {
   3.564727136721032*^9, 3.5647271722443123`*^9}, {3.564752251221725*^9, 
   3.564752251698897*^9}, {3.564756666648232*^9, 3.5647566682997427`*^9}, 
   3.564756765322729*^9, {3.56508716021929*^9, 3.565087160634788*^9}, {
   3.565100722303797*^9, 3.56510072374551*^9}, {3.565255277758458*^9, 
   3.565255303238882*^9}, {3.565255495528433*^9, 3.565255529390852*^9}, {
   3.565256214558093*^9, 3.565256221308436*^9}, {3.565257061116297*^9, 
   3.5652572196347847`*^9}, {3.565257278647276*^9, 3.565257294428094*^9}, {
   3.56525732764468*^9, 3.565257367126314*^9}, {3.5652574366650753`*^9, 
   3.565257446953899*^9}, {3.5652574872945957`*^9, 3.565257617433436*^9}, {
   3.565257705664445*^9, 3.5652577468110123`*^9}, {3.565257793481442*^9, 
   3.565257905865428*^9}, {3.565257980974378*^9, 3.565258436279352*^9}, {
   3.565260293556981*^9, 3.565260335875909*^9}, {3.565273005463118*^9, 
   3.565273034244934*^9}, {3.5652730874302673`*^9, 3.565273173161075*^9}, {
   3.565273421969594*^9, 3.5652734263448257`*^9}, {3.565273633536174*^9, 
   3.56527367771704*^9}, {3.5652737317271223`*^9, 3.565273747333106*^9}, {
   3.5652739416427803`*^9, 3.565273967138383*^9}, {3.565613838031733*^9, 
   3.5656138408934393`*^9}, {3.5684372088235903`*^9, 3.568437210285256*^9}}],

Cell["\<\

Private boolean functions:\
\>", "Text",
 CellChangeTimes->{{3.563736712824503*^9, 3.563736719822597*^9}, {
   3.5652553092433033`*^9, 3.565255326585868*^9}, {3.565273972266572*^9, 
   3.565273982151067*^9}, 3.566040236057909*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "PRIVATE"}], " ", "BOOLEAN", " ", "FUNCTIONS"}], " ", 
   "***)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"*", " ", "Miscellaneous"}], " ", "**)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"$DefInfoQ", "=", "True"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"If", " ", "set", " ", 
      RowBox[{"to", " ", "'"}], 
      RowBox[{"False", "'"}]}], ",", " ", 
     RowBox[{
     "the", " ", "information", " ", "messages", " ", "are", " ", "not", " ", 
      
      RowBox[{"printed", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"*", " ", "Testing", " ", "expressions"}], " ", "**)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AnyIndicesListQ", "[", "inds_List", "]"}], ":=", 
    RowBox[{
     RowBox[{"Cases", "[", 
      RowBox[{"inds", ",", 
       RowBox[{"AnyIndices", "[", "_", "]"}]}], "]"}], "=!=", 
     RowBox[{"{", "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "If", " ", "the", " ", "list", " ", "of", " ", "indices", " ", 
      "contains", " ", "the", " ", 
      RowBox[{"head", " ", "'"}], 
      RowBox[{"AnyIndices", "'"}]}], ",", " ", 
     RowBox[{
      RowBox[{"then", " ", 
       RowBox[{"AnyIndicesListQ", "[", "inds", "]"}], " ", 
       RowBox[{"returns", " ", "'"}], 
       RowBox[{"True", "'"}]}], ";", " ", 
      RowBox[{"otherwise", " ", "it", " ", 
       RowBox[{"returns", " ", "'"}], 
       RowBox[{
        RowBox[{"False", "'"}], "."}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DefTensorQ", "[", "symb_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Cases", "[", 
      RowBox[{"$Tensors", ",", "symb"}], "]"}], "===", 
     RowBox[{"{", "symb", "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"If", " ", "'"}], 
      RowBox[{"symb", "'"}], " ", "has", " ", "been", " ", "defined", " ", 
      "as", " ", "a", " ", "tensor"}], ",", " ", 
     RowBox[{
      RowBox[{"then", " ", 
       RowBox[{"DefTensorQ", "[", "symb", "]"}], " ", 
       RowBox[{"returns", " ", "'"}], 
       RowBox[{"True", "'"}]}], ";", " ", 
      RowBox[{"otherwise", " ", "it", " ", 
       RowBox[{"returns", " ", "'"}], 
       RowBox[{
        RowBox[{"False", "'"}], "."}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GaugeQ", "[", "strg_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Cases", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\"\<AnyGauge\>\"", ",", "\"\<ComovingGauge\>\"", ",", 
         "\"\<FlatGauge\>\"", ",", "\"\<IsoDensityGauge\>\"", ",", 
         "\"\<NewtonGauge\>\"", ",", "\"\<SynchronousGauge\>\""}], "}"}], ",",
        "strg"}], "]"}], "===", 
     RowBox[{"{", "strg", "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"If", " ", "'"}], 
      RowBox[{"strg", "'"}], " ", "matches", " ", "one", " ", "of", " ", 
      "the", " ", "element", " ", "in", " ", "the", " ", "list"}], ",", " ", 
     RowBox[{
      RowBox[{"then", " ", 
       RowBox[{"GaugeQ", "[", "strg", "]"}], " ", 
       RowBox[{"returns", " ", "'"}], 
       RowBox[{"True", "'"}]}], ";", " ", 
      RowBox[{"otherwise", " ", "it", " ", 
       RowBox[{"returns", " ", "'"}], 
       RowBox[{
        RowBox[{"False", "'"}], "."}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"InducedMetricQ", "[", "symb_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MetricQ", "[", "symb", "]"}], ",", 
      RowBox[{
       RowBox[{"InducedFrom", "[", "symb", "]"}], "=!=", "Null"}], ",", 
      "False"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"If", " ", "'"}], 
      RowBox[{"symb", "'"}], " ", "is", " ", "not", " ", "defined", " ", "as",
       " ", "a", " ", "metric"}], ",", " ", 
     RowBox[{"then", " ", 
      RowBox[{"InducedMetricQ", "[", "symb", "]"}], " ", 
      RowBox[{"returns", " ", "'"}], 
      RowBox[{
       RowBox[{"False", "'"}], ".", " ", "Otherwise"}]}], ",", " ", 
     RowBox[{"it", " ", "checks", " ", 
      RowBox[{"whether", " ", "'"}], 
      RowBox[{"symb", "'"}], " ", "is", " ", "an", " ", "induced", " ", 
      RowBox[{"metric", ".", " ", "\[IndentingNewLine]", "If"}], " ", "this", 
      " ", "is", " ", "the", " ", "case"}], ",", " ", 
     RowBox[{
      RowBox[{"then", " ", 
       RowBox[{"InducedMetricQ", "[", "symb", "]"}], " ", 
       RowBox[{"gives", " ", "'"}], 
       RowBox[{"True", "'"}]}], ";", " ", 
      RowBox[{"otherwise", " ", "it", " ", 
       RowBox[{"gives", " ", "'"}], 
       RowBox[{
        RowBox[{"False", "'"}], "."}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SpaceTimeQ", "[", "strg_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Cases", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\"\<Anisotropic\>\"", ",", " ", "\"\<BianchiB\>\"", ",", 
         "\"\<BianchiA\>\"", ",", "\"\<BianchiI\>\"", ",", "\"\<FLCurved\>\"",
          ",", "\"\<FLFlat\>\"", ",", "\"\<Minkowski\>\""}], "}"}], ",", 
       "strg"}], "]"}], "===", 
     RowBox[{"{", "strg", "}"}]}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"If", " ", "'"}], 
      RowBox[{"strg", "'"}], " ", "matches", " ", "one", " ", "of", " ", 
      "the", " ", "element", " ", "of", " ", "the", " ", "list"}], ",", " ", 
     RowBox[{
      RowBox[{"then", " ", 
       RowBox[{"SpaceTimeQ", "[", "strg", "]"}], " ", 
       RowBox[{"returns", " ", "'"}], 
       RowBox[{"True", "'"}]}], ";", " ", 
      RowBox[{"otherwise", " ", "it", " ", 
       RowBox[{"returns", " ", "'"}], 
       RowBox[{
        RowBox[{"False", "'"}], "."}]}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TensorNullQ", "[", "tens_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Cases", "[", 
        RowBox[{
         RowBox[{"SlotsOfTensor", "[", "tens", "]"}], ",", "Labels"}], "]"}], 
       "=!=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<** Warning: the function TensorNullQ is only suited to test \
tensors defined without label-indices. \>\"", ",", "tens"}], "]"}], ",", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"inds", "=", 
          RowBox[{"DummyIn", "/@", 
           RowBox[{"SlotsOfTensor", "[", "tens", "]"}]}]}], "}"}], ",", 
        RowBox[{
         RowBox[{"tens", "@@", "inds"}], "===", "0"}]}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"TensorNullQ", "[", "tens", "]"}], " ", 
      RowBox[{"returns", " ", "'"}], 
      RowBox[{"True", "'"}], " ", 
      RowBox[{"if", " ", "'"}], 
      RowBox[{"tens", "'"}], " ", "is", " ", "a", " ", "null", " ", "tensor", 
      " ", 
      RowBox[{"and", " ", "'"}], 
      RowBox[{"False", "'"}], " ", 
      RowBox[{"otherwise", ".", " ", "This"}], " ", "function", " ", "is", 
      " ", "not", " ", "suited", " ", "to", " ", "test", " ", "tensors", " ", 
      "defined", " ", "with", " ", "label"}], "-", 
     RowBox[{"indices", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"*", " ", "Type", " ", "of", " ", "manifolds"}], " ", "**)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BianchiBool", "[", "Spacetype_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Spacetype", "===", "\"\<BianchiB\>\""}], "||", 
      RowBox[{"Spacetype", "===", "\"\<BianchiA\>\""}], "||", 
      RowBox[{"Spacetype", "===", "\"\<BianchiI\>\""}]}], ")"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FlatSpaceBool", "[", "Spacetype_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Spacetype", "===", "\"\<BianchiI\>\""}], "||", 
      RowBox[{"Spacetype", "===", "\"\<FLFlat\>\""}], "||", 
      RowBox[{"Spacetype", "===", "\"\<Minkowski\>\""}]}], ")"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"NoAnisotropyBool", "[", "Spacetype_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Spacetype", "===", "\"\<FLCurved\>\""}], "||", 
      RowBox[{"Spacetype", "===", "\"\<FLFlat\>\""}], "||", 
      RowBox[{"Spacetype", "===", "\"\<Minkowski\>\""}]}], ")"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AnisotropyBool", "[", "Spacetype_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{"Spacetype", "===", "\"\<Anisotropic\>\""}], ")"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"The", " ", 
     RowBox[{"name", " ", "'"}], 
     RowBox[{"AnisotropyBool", "'"}], " ", "should", " ", "be", " ", 
     RowBox[{"changed", "."}]}], " ", "*)"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562555561737547*^9, 3.5625555631220284`*^9}, {
   3.562561869109151*^9, 3.5625619038248367`*^9}, {3.56370887602913*^9, 
   3.563708881550889*^9}, {3.5637092673213043`*^9, 3.5637093128660107`*^9}, {
   3.564756670530485*^9, 3.5647566720565157`*^9}, 3.56475676676834*^9, 
   3.565255331279046*^9, {3.565273158864575*^9, 3.565273244611088*^9}, {
   3.5652733058693857`*^9, 3.5652734194840918`*^9}, {3.565273610652855*^9, 
   3.5652736274094057`*^9}, {3.565273800694317*^9, 3.565273815659333*^9}, {
   3.5652739054749813`*^9, 3.5652739079712057`*^9}, {3.5652739842518883`*^9, 
   3.56527451177932*^9}, {3.5652759651621733`*^9, 3.565275968159277*^9}, {
   3.565605510010808*^9, 3.565605550799232*^9}, {3.565605618534863*^9, 
   3.5656056952405863`*^9}, {3.565605757440118*^9, 3.565605797730657*^9}, {
   3.5656058662787123`*^9, 3.565606104410803*^9}, {3.5656877032616367`*^9, 
   3.5656879390075817`*^9}, {3.5656881806405983`*^9, 3.565688221990755*^9}, {
   3.5656890057303133`*^9, 3.5656890218542633`*^9}, {3.56568906484991*^9, 
   3.565689067207451*^9}, {3.5661072956244593`*^9, 3.566107309684143*^9}, {
   3.566382811854566*^9, 3.5663828603405037`*^9}, {3.566382926530171*^9, 
   3.566382992729003*^9}, {3.566383077723982*^9, 3.5663831357280817`*^9}, 
   3.566383393397664*^9, {3.566383471198786*^9, 3.566383507473835*^9}, {
   3.5672246603592253`*^9, 3.567224671693515*^9}, {3.567224775122447*^9, 
   3.567224791157254*^9}, {3.56722497665062*^9, 3.5672249965071793`*^9}, {
   3.567225048708446*^9, 3.567225069912915*^9}, {3.567238574448373*^9, 
   3.567238574880168*^9}, {3.567238985185261*^9, 3.5672389876800756`*^9}, {
   3.567403835216668*^9, 3.5674038407502127`*^9}, {3.567404029407612*^9, 
   3.567404033180499*^9}, {3.56740409002783*^9, 3.567404147218399*^9}, {
   3.567575418592759*^9, 3.567575433015986*^9}, {3.567927764792301*^9, 
   3.567927768191234*^9}, {3.569328929067424*^9, 3.5693290004569607`*^9}}],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["2.2. Building symbols", "Subsubsection",
 CellChangeTimes->{{3.5625603109856243`*^9, 3.562560317714089*^9}, {
  3.564752234156185*^9, 3.564752234761362*^9}, {3.567225358908021*^9, 
  3.5672253657861032`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "BUILDING"}], " ", 
    RowBox[{"SYMBOLS", ":", " ", 
     RowBox[{"Geometrical", " ", "quantities"}]}]}], " ", "***)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"a", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"a", ",", "symb"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"H", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"H", ",", "symb"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Connection", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Connection", ",", "symb"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"CS", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"CS", ",", "symb"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"nt", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"nt", ",", "symb"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"av", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"av", ",", "symb"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"K", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"K", ",", "symb"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[ScriptK]", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"\[ScriptK]", ",", "symb"}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.567225244736712*^9, {3.567225370915859*^9, 3.5672253792201347`*^9}, {
   3.5672254565464497`*^9, 3.567225489790799*^9}, {3.5672257682198067`*^9, 
   3.567226048411847*^9}, {3.567226089757833*^9, 3.567226149133443*^9}, {
   3.567226189845475*^9, 3.5672261969161987`*^9}, {3.567226474431675*^9, 
   3.56722657374319*^9}, 3.567226718049313*^9, {3.5672267506914454`*^9, 
   3.567226755888756*^9}, {3.567226869600388*^9, 3.56722690520444*^9}, {
   3.567227014238831*^9, 3.567227015551217*^9}, {3.567227240293311*^9, 
   3.567227366128791*^9}, {3.567227406064623*^9, 3.567227447552602*^9}, {
   3.567227922671014*^9, 3.567227933595551*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "BUILDING"}], " ", 
    RowBox[{"SYMBOLS", ":", " ", 
     RowBox[{"Fluid", " ", "quantities"}]}]}], " ", "***)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[Rho]", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"\[Rho]", ",", "symb"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"P", "[", "symb_", "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"P", ",", "symb"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"\[CapitalPi]", "[", "symb_", "]"}], ":=", 
      RowBox[{"SymbolJoin", "[", 
       RowBox[{"\[CapitalPi]", ",", "symb"}], "]"}]}], ";"}], " ", 
    "*)"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.567225244736712*^9, {3.567225370915859*^9, 3.5672253792201347`*^9}, {
   3.5672254565464497`*^9, 3.567225489790799*^9}, {3.5672257682198067`*^9, 
   3.567226048411847*^9}, {3.567226089757833*^9, 3.567226149133443*^9}, {
   3.567226189845475*^9, 3.5672261969161987`*^9}, {3.567226474431675*^9, 
   3.56722657374319*^9}, 3.567226718049313*^9, {3.5672267506914454`*^9, 
   3.567226755888756*^9}, {3.567226869600388*^9, 3.56722690520444*^9}, {
   3.567227014238831*^9, 3.567227015551217*^9}, {3.567227240293311*^9, 
   3.567227366128791*^9}, {3.567227406064623*^9, 3.567227447552602*^9}, {
   3.567227922671014*^9, 3.567227950926218*^9}, {3.56722968299811*^9, 
   3.567229688586371*^9}, {3.567232427516848*^9, 3.5672324326091547`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "BUILDING"}], " ", 
    RowBox[{"SYMBOLS", ":", " ", 
     RowBox[{
      RowBox[{"Perturbed", " ", "fluid", " ", "four"}], "-", "velocity"}]}]}],
    " ", "***)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"V0", "[", 
      RowBox[{
       RowBox[{"h_", "?", "InducedMetricQ"}], ",", "velocity_"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"V0", ",", "h", ",", "velocity"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Vspat", "[", 
      RowBox[{
       RowBox[{"h_", "?", "InducedMetricQ"}], ",", "velocity_"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Vspat", ",", "h", ",", "velocity"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Vs", "[", 
      RowBox[{
       RowBox[{"h_", "?", "InducedMetricQ"}], ",", "velocity_"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Vs", ",", "h", ",", "velocity"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Vv", "[", 
      RowBox[{
       RowBox[{"h_", "?", "InducedMetricQ"}], ",", "velocity_"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Vv", ",", "h", ",", "velocity"}], "]"}]}], ";"}]}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{
  3.567225244736712*^9, {3.567225370915859*^9, 3.5672253792201347`*^9}, {
   3.5672254565464497`*^9, 3.567225489790799*^9}, {3.5672257682198067`*^9, 
   3.567226048411847*^9}, {3.567226089757833*^9, 3.567226149133443*^9}, {
   3.567226189845475*^9, 3.5672261969161987`*^9}, {3.567226474431675*^9, 
   3.56722657374319*^9}, 3.567226718049313*^9, {3.5672267506914454`*^9, 
   3.567226755888756*^9}, {3.567226869600388*^9, 3.56722690520444*^9}, {
   3.567227014238831*^9, 3.567227015551217*^9}, {3.567227240293311*^9, 
   3.567227366128791*^9}, {3.567227406064623*^9, 3.567227447552602*^9}, {
   3.567227922671014*^9, 3.567227967248734*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "BUILDING"}], " ", 
    RowBox[{"SYMBOLS", ":", " ", 
     RowBox[{"Perturbation", " ", "of", " ", "the", " ", "metric"}]}]}], " ", 
   "***)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[Phi]", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"\[Phi]", ",", "h"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Bs", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Bs", ",", "h"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Bv", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Bv", ",", "h"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Psi]", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"\[Psi]", ",", "h"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Es", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Es", ",", "h"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ev", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Ev", ",", "h"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Et", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Et", ",", "h"}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.567225244736712*^9, {3.567225370915859*^9, 3.5672253792201347`*^9}, {
   3.5672254565464497`*^9, 3.567225489790799*^9}, {3.5672257682198067`*^9, 
   3.567226048411847*^9}, {3.567226089757833*^9, 3.567226149133443*^9}, {
   3.567226189845475*^9, 3.5672261969161987`*^9}, {3.567226474431675*^9, 
   3.56722657374319*^9}, 3.567226718049313*^9, {3.5672267506914454`*^9, 
   3.567226755888756*^9}, {3.567226869600388*^9, 3.56722690520444*^9}, {
   3.567227014238831*^9, 3.567227015551217*^9}, {3.567227240293311*^9, 
   3.567227366128791*^9}, {3.567227406064623*^9, 3.567227447552602*^9}, {
   3.567227922671014*^9, 3.56722798452652*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", " ", "BUILDING"}], " ", 
    RowBox[{"SYMBOLS", ":", " ", 
     RowBox[{"Gauge", " ", "vector", " ", "and", " ", "decomposition"}]}]}], 
   " ", "***)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"\[Xi]", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"\[Xi]", ",", "h"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"T", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"T", ",", "h"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Ls", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Ls", ",", "h"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Lv", "[", 
      RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
     RowBox[{"SymbolJoin", "[", 
      RowBox[{"Lv", ",", "h"}], "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.567225244736712*^9, {3.567225370915859*^9, 3.5672253792201347`*^9}, {
   3.5672254565464497`*^9, 3.567225489790799*^9}, {3.5672257682198067`*^9, 
   3.567226048411847*^9}, {3.567226089757833*^9, 3.567226149133443*^9}, {
   3.567226189845475*^9, 3.5672261969161987`*^9}, {3.567226474431675*^9, 
   3.56722657374319*^9}, 3.567226718049313*^9, {3.5672267506914454`*^9, 
   3.567226755888756*^9}, {3.567226869600388*^9, 3.56722690520444*^9}, {
   3.567227014238831*^9, 3.567227015551217*^9}, {3.567227240293311*^9, 
   3.567227366128791*^9}, {3.567227406064623*^9, 3.567227447552602*^9}, {
   3.567227922671014*^9, 3.5672280021186*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$ListFieldsBackgroundOnly", "[", 
     RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"a", "[", "h", "]"}], "[", "]"}], ",", "\"\<a\>\""}], "}"}], 
      ",", " ", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"H", "[", "h", "]"}], "[", "]"}], ",", 
        "\"\<\[ScriptCapitalH]\>\""}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"$ListFieldsPerturbedOnly", "[", 
     RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Phi]", "[", "h", "]"}], "[", "]"}], ",", 
        "\"\<\[Phi]\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Bs", "[", "h", "]"}], "[", "]"}], ",", "\"\<B\>\""}], "}"}],
       ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Bv", "[", "h", "]"}], "[", 
         RowBox[{"-", "\[Mu]"}], "]"}], ",", "\"\<B\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"\[Psi]", "[", "h", "]"}], "[", "]"}], ",", 
        "\"\<\[Psi]\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Es", "[", "h", "]"}], "[", "]"}], ",", "\"\<E\>\""}], "}"}],
       ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Ev", "[", "h", "]"}], "[", 
         RowBox[{"-", "\[Mu]"}], "]"}], ",", "\"\<E\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Et", "[", "h", "]"}], "[", 
         RowBox[{
          RowBox[{"-", "\[Mu]"}], ",", 
          RowBox[{"-", "\[Nu]"}]}], "]"}], ",", "\"\<E\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"T", "[", "h", "]"}], "[", "]"}], ",", "\"\<T\>\""}], "}"}], 
      ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Ls", "[", "h", "]"}], "[", "]"}], ",", "\"\<L\>\""}], "}"}],
       ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"Lv", "[", "h", "]"}], "[", 
         RowBox[{"-", "\[Mu]"}], "]"}], ",", "\"\<L\>\""}], "}"}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "former", " ", "implementation", " ", "failed", " ", "to", " ",
     "treat", " ", "separately", " ", "different", " ", 
    RowBox[{"fluids", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Obinna", " ", "proposed", " ", "the", " ", "replace", " ", "by", " ", 
    "the", " ", "version", " ", 
    RowBox[{"below", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "We", " ", "thank", " ", "Enrico", " ", "Pajer", " ", "for", " ", 
    "reporting", " ", "this", " ", 
    RowBox[{"bug", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"$ListFieldsBackgroundAndPerturbed", "[", 
      RowBox[{
       RowBox[{"h_", "?", "InducedMetricQ"}], ",", "velocity_"}], "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[CurlyPhi]", "[", "]"}], ",", "\"\<\[CurlyPhi]\>\""}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"\[Rho]", "[", "velocity", "]"}], "[", "]"}], ",", 
         "\"\<\[Rho]\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"P", "[", "velocity", "]"}], "[", "]"}], ",", "\"\<P\>\""}],
         "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Vspat", "[", 
           RowBox[{"h", ",", "velocity"}], "]"}], "[", 
          RowBox[{"-", "\[Mu]"}], "]"}], ",", "\"\<\[ScriptCapitalV]\>\""}], 
        "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"V0", "[", 
           RowBox[{"h", ",", "velocity"}], "]"}], "[", "]"}], ",", 
         "\"\<V0\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Vs", "[", 
           RowBox[{"h", ",", "velocity"}], "]"}], "[", "]"}], ",", 
         "\"\<V\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Vv", "[", 
           RowBox[{"h", ",", "velocity"}], "]"}], "[", 
          RowBox[{"-", "\[Mu]"}], "]"}], ",", "\"\<V\>\""}], "}"}]}], "}"}]}],
     ";"}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"$ListFieldsBackgroundAndPerturbed", "[", 
    RowBox[{
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", "velocity_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\[CurlyPhi]", "[", "]"}], ",", "\"\<\[CurlyPhi]\>\""}], "}"}],
      ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Rho]", "[", "velocity", "]"}], "[", "]"}], ",", 
       RowBox[{"ToString", "@", 
        RowBox[{"StringJoin", "[", 
         RowBox[{
          RowBox[{"{", "\"\<\[Rho]\>\"", "}"}], ",", 
          RowBox[{"ToString", "[", "velocity", "]"}]}], "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"P", "[", "velocity", "]"}], "[", "]"}], ",", 
       RowBox[{"ToString", "@", 
        RowBox[{"StringJoin", "[", 
         RowBox[{
          RowBox[{"{", "\"\<P\>\"", "}"}], ",", 
          RowBox[{"ToString", "[", "velocity", "]"}]}], "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Vspat", "[", 
         RowBox[{"h", ",", "velocity"}], "]"}], "[", 
        RowBox[{"-", "\[Mu]"}], "]"}], ",", 
       RowBox[{"ToString", "@", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"{", 
          RowBox[{"\"\<\[ScriptCapitalV]\>\"", ",", 
           RowBox[{"ToString", "[", "velocity", "]"}]}], "}"}], "]"}]}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"V0", "[", 
         RowBox[{"h", ",", "velocity"}], "]"}], "[", "]"}], ",", 
       RowBox[{"ToString", "@", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"{", 
          RowBox[{"\"\<V0\>\"", ",", 
           RowBox[{"ToString", "[", "velocity", "]"}]}], "}"}], "]"}]}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Vs", "[", 
         RowBox[{"h", ",", "velocity"}], "]"}], "[", "]"}], ",", 
       RowBox[{"ToString", "@", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"{", 
          RowBox[{"\"\<V\>\"", ",", 
           RowBox[{"ToString", "[", "velocity", "]"}]}], "}"}], "]"}]}]}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Vv", "[", 
         RowBox[{"h", ",", "velocity"}], "]"}], "[", 
        RowBox[{"-", "\[Mu]"}], "]"}], ",", 
       RowBox[{"ToString", "@", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"{", 
          RowBox[{"\"\<V\>\"", ",", 
           RowBox[{"ToString", "[", "velocity", "]"}]}], "}"}], "]"}]}]}], 
      "}"}]}], "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.567225244736712*^9, {3.567225370915859*^9, 3.5672253792201347`*^9}, {
   3.5672254565464497`*^9, 3.567225489790799*^9}, {3.5672257682198067`*^9, 
   3.567226048411847*^9}, {3.567226089757833*^9, 3.567226149133443*^9}, {
   3.567226189845475*^9, 3.5672261969161987`*^9}, {3.567226474431675*^9, 
   3.56722657374319*^9}, 3.567226718049313*^9, {3.5672267506914454`*^9, 
   3.567226755888756*^9}, {3.567226869600388*^9, 3.56722690520444*^9}, {
   3.567227014238831*^9, 3.567227015551217*^9}, {3.567227240293311*^9, 
   3.567227366128791*^9}, {3.567227406064623*^9, 3.567227447552602*^9}, {
   3.567227922671014*^9, 3.5672280183688583`*^9}, {3.567229701498549*^9, 
   3.56722973450867*^9}, {3.567229831800067*^9, 3.56722986076818*^9}, {
   3.567229909418612*^9, 3.56722992731207*^9}, {3.5672300745213346`*^9, 
   3.567230176568542*^9}, 3.567230220257822*^9, {3.567230729924765*^9, 
   3.5672308818009167`*^9}, {3.5672319117638483`*^9, 
   3.5672319710666037`*^9}, {3.567239637601754*^9, 3.567239679086746*^9}, {
   3.58737738361205*^9, 3.587377427066277*^9}, {3.587377623047833*^9, 
   3.587377630838283*^9}}],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
2.3. Definition of projected tensors, along with their properties\
\>", "Subsubsection",
 CellChangeTimes->{{3.5625603109856243`*^9, 3.562560317714089*^9}, {
  3.564752234156185*^9, 3.564752234761362*^9}, {3.566319785368972*^9, 
  3.5663198016149263`*^9}, {3.567225369146916*^9, 3.567225369458509*^9}}],

Cell["\<\
Contents:
\tDefault values
\tDefProjectedTensor
\tDefProjectedTensorProperties
\tDefProjectedTensorPropertiesAnyIndices\
\>", "Text",
 CellChangeTimes->{{3.563741766524354*^9, 3.563741790121416*^9}, 
   3.564719533068632*^9, 3.564723502418457*^9, {3.565613854862775*^9, 
   3.565613973112472*^9}, {3.56603960161989*^9, 3.566039609119771*^9}, {
   3.566039654921845*^9, 3.566039697322451*^9}, 3.566040004394486*^9, 
   3.566040302855218*^9, {3.566040363550664*^9, 3.566040364998371*^9}, {
   3.566839227292626*^9, 3.5668392274586153`*^9}}],

Cell["\<\

Default values:\
\>", "Text",
 CellChangeTimes->{{3.566040282546426*^9, 3.566040296792358*^9}, 
   3.566040361736294*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"**", " ", "DEFAULT"}], " ", 
      RowBox[{"VALUES", ":", " ", "DefProjectedTensor"}]}], " ", "&"}], " ", 
    "DefProjectedTensorProperties"}], " ", "***)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Options", "[", "DefProjectedTensor", "]"}], "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"PrintAs", "\[Rule]", "Identity"}], ",", 
       RowBox[{"TensorProperties", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
         "\"\<SymmetricTensor\>\"", ",", "\"\<Traceless\>\"", ",", 
          "\"\<Transverse\>\""}], "}"}]}], ",", 
       RowBox[{"SpaceTimesOfDefinition", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<Background\>\"", ",", "\"\<Perturbed\>\""}], "}"}]}]}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DefProjectedTensorQ", "[", 
      RowBox[{"Name_", ",", "h___"}], "]"}], ":=", "False"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PropertiesList", "[", "Name_", "]"}], ":=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"InducedMetricOf", "[", "Name_", "]"}], ":=", 
     RowBox[{"{", "}"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.566039615445053*^9, 3.566039665861207*^9}, {
   3.5660398636431007`*^9, 3.566039866142048*^9}, {3.566039969921027*^9, 
   3.56603998165521*^9}, {3.566040321359063*^9, 3.5660403456465683`*^9}, {
   3.566414165091927*^9, 3.566414165401517*^9}, {3.566418620106008*^9, 
   3.56641862042379*^9}, {3.566464077661887*^9, 3.5664640779868717`*^9}, {
   3.5664643640531883`*^9, 3.566464364378422*^9}, {3.566469160374525*^9, 
   3.566469160604287*^9}, {3.5664726751032*^9, 3.566472675270548*^9}, {
   3.566473929063327*^9, 3.5664739292849197`*^9}, {3.566535165687991*^9, 
   3.5665351659911003`*^9}, {3.566538290562181*^9, 3.566538290911684*^9}, {
   3.5666383274781933`*^9, 3.566638327953538*^9}, {3.566753865864933*^9, 
   3.5667538666234827`*^9}, {3.566839565214777*^9, 3.566839565470235*^9}, {
   3.5669018252799883`*^9, 3.566901825741143*^9}, {3.5672578719593287`*^9, 
   3.567257874541361*^9}, {3.567258801165317*^9, 3.567258801435481*^9}, {
   3.567260783968169*^9, 3.567260785301524*^9}, {3.567401668809072*^9, 
   3.56740166892057*^9}, {3.567407403510994*^9, 3.567407403670065*^9}, {
   3.567487513350011*^9, 3.567487513538886*^9}, 3.567488435854455*^9, {
   3.567488579034068*^9, 3.567488579239147*^9}, {3.568547650046686*^9, 
   3.5685476507915*^9}, {3.569329008182803*^9, 3.569329020864897*^9}, 
   3.570510975700431*^9, 3.570511184433443*^9}],

Cell["\<\

DefProjectedTensor:\
\>", "Text",
 CellChangeTimes->{{3.566040282546426*^9, 3.566040296792358*^9}, 
   3.566040361736294*^9, 3.5663200053324213`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"**", " ", 
    RowBox[{"MODULE", ":", " ", "DefProjectedTensor"}]}], " ", "***)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"DefProjectedTensor", "[", 
     RowBox[{
      RowBox[{"Name_", "[", "inds___", "]"}], ",", 
      RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
      RowBox[{"options___", "?", "OptionQ"}]}], "]"}], ":=", 
    RowBox[{"Catch", "@", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "IndsNoLI", ",", "p", ",", "q", ",", "PrAs", ",", "SpaTimeDef", ",", 
         "TensProp"}], "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"M", "=", 
           RowBox[{"ManifoldOfCovD", "@", 
            RowBox[{"CovDOfMetric", "[", 
             RowBox[{"First", "@", 
              RowBox[{"InducedFrom", "@", "h"}]}], "]"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"DefProjectedTensorQ", "[", 
             RowBox[{"Name", ",", "h"}], "]"}], ",", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"$DefInfoQ", ",", "\[IndentingNewLine]", 
               RowBox[{"Throw", "@", 
                RowBox[{"Print", "[", 
                 RowBox[{
                 "\"\<** DefProjectedTensor: The projection properties on the \
hypersurfaces associated with the induced metric \>\"", ",", " ", "h", ",", 
                  "\"\< have already been defined for the tensor \>\"", ",", 
                  " ", "Name", ",", "\"\<.\>\""}], "]"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"Throw", "[", "Null", "]"}]}], "\[IndentingNewLine]", 
              "]"}], ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"DefProjectedTensorQ", "[", "Name", "]"}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"$DefInfoQ", ",", "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<** DefProjectedTensor: Projection properties for the \
tensor \>\"", ",", " ", "Name", ",", 
                 "\"\< have been defined for another slicing. New projection \
properties on the hypersurfaces associated with the induced metric \>\"", ",",
                  " ", "h", ",", "\"\< are now added.\>\""}], "]"}]}], 
              "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
            "If", " ", "projection", " ", "properties", " ", "for", " ", 
             "the", " ", 
             RowBox[{"tensor", " ", "'"}], 
             RowBox[{"Name", "'"}], " ", "have", " ", "been", " ", "defined", 
             " ", "for", " ", "another", " ", "slicing"}], ",", " ", 
            RowBox[{"the", " ", 
             RowBox[{"command", " ", "'"}], 
             RowBox[{
              RowBox[{"Name", "[", "inds", "]"}], "'"}]}], ",", " ", 
            RowBox[{
             RowBox[{"with", " ", "'"}], 
             RowBox[{"inds", "'"}], " ", "being", " ", "abstract", " ", 
             "index"}], ",", " ", 
            RowBox[{"is", " ", "substituted", " ", 
             RowBox[{"by", " ", "'"}], 
             RowBox[{
              RowBox[{"Name", "[", 
               RowBox[{
                RowBox[{"LI", "[", "0", "]"}], ",", 
                RowBox[{"LI", "[", "0", "]"}], ",", "inds"}], "]"}], "'"}], 
             " ", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
               "refer", " ", "to", " ", "the", " ", "function", " ", 
                "DefProjectedTensorProperties", " ", "for", " ", "this", " ", 
                "rule"}], ")"}], ".", " ", "The"}], " ", "following", " ", 
             "command", " ", "then", " ", "serves", " ", "to", " ", "remove", 
             " ", "the", " ", "possible", " ", "label", " ", 
             RowBox[{"indices", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"IndsNoLI", "=", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"{", "inds", "}"}], ",", 
             RowBox[{
              RowBox[{"Not", "@", 
               RowBox[{"LIndexQ", "[", "#", "]"}]}], "&"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", "IndsNoLI", "]"}], "\[GreaterEqual]", 
               " ", "1"}], ")"}], "&&", 
             RowBox[{"(", 
              RowBox[{"Not", "@", 
               RowBox[{"AnyIndicesListQ", "[", "IndsNoLI", "]"}]}], ")"}], "&&", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Select", "[", 
                RowBox[{"IndsNoLI", ",", "UpIndexQ"}], "]"}], " ", "=!=", 
               RowBox[{"{", "}"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Throw", "[", 
             RowBox[{"Message", "[", 
              RowBox[{
               RowBox[{"DefProjectedTensor", "::", "notdownindices"}], ",", 
               "Name"}], "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"**", "**", "**", "**"}], "*", " ", "The", " ", 
            "following", " ", "Message", " ", "is", " ", "not", " ", "yet", 
            " ", 
            RowBox[{"defined", "."}]}], " ", "**********)"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", "IndsNoLI", "]"}], "\[GreaterEqual]", 
               " ", "2"}], ")"}], "&&", 
             RowBox[{"(", 
              RowBox[{"AnyIndicesListQ", "[", "IndsNoLI", "]"}], ")"}]}], ",",
             "\[IndentingNewLine]", 
            RowBox[{"Throw", "[", 
             RowBox[{"Message", "[", 
              RowBox[{
               RowBox[{"DefProjectedTensor", "::", "invalidanyindices"}], ",",
                "Name"}], "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"PrAs", "=", 
           RowBox[{
            RowBox[{"PrintAs", "/.", 
             RowBox[{"CheckOptions", "[", "options", "]"}]}], "/.", 
            RowBox[{"Options", "[", "DefProjectedTensor", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"SpaTimeDef", "=", 
           RowBox[{
            RowBox[{"SpaceTimesOfDefinition", "/.", 
             RowBox[{"CheckOptions", "[", "options", "]"}]}], "/.", 
            RowBox[{"Options", "[", "DefProjectedTensor", "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"TensProp", "=", 
           RowBox[{
            RowBox[{"TensorProperties", "/.", 
             RowBox[{"CheckOptions", "[", "options", "]"}]}], "/.", 
            RowBox[{"Options", "[", "DefProjectedTensor", "]"}]}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"If", " ", "the", " ", 
             RowBox[{"argument", " ", "'"}], 
             RowBox[{"options", "'"}], " ", "is", " ", "omitted"}], ",", " ", 
            
            RowBox[{
             RowBox[{"CheckOptions", "[", "options", "]"}], " ", "=", " ", 
             RowBox[{"{", "}"}]}], ",", " ", 
            RowBox[{
             RowBox[{"and", " ", "we", " ", "have", " ", "by", " ", 
              RowBox[{
              "default", ":", " ", "\[IndentingNewLine]", " ", "PrAs"}]}], 
             " ", "=", " ", 
             RowBox[{
              RowBox[{
              "Identity", " ", "\[IndentingNewLine]", " ", "SpaTimeDef"}], 
              " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Background", ",", "Perturbed"}], "}"}], " ", 
                "\[IndentingNewLine]", "TensProp"}], " ", "=", " ", 
               RowBox[{"{", 
                RowBox[{
                "SymmetricTensor", ",", "Traceless", ",", "Transverse"}], 
                "}"}]}]}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Not", "@", 
               RowBox[{"DefProjectedTensorQ", "[", "Name", "]"}]}], "&&", 
              RowBox[{"DefTensorQ", "[", "Name", "]"}]}], ","}]}], "*)"}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"DefProjectedTensorQ", "[", "Name", "]"}], "||", 
             RowBox[{"DefTensorQ", "[", "Name", "]"}]}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"$DefInfoQ", ",", "\[IndentingNewLine]", 
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<** DefProjectedTensor: The tensor \>\"", ",", " ", "Name",
                 ",", "\"\< already exists. The projection properties on the \
hypersurfaces associated with the induced metric \>\"", ",", " ", "h", ",", 
                "\"\< are now defined.\>\""}], "]"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DefTensor", "[", 
             RowBox[{
              RowBox[{"Name", "[", 
               RowBox[{
                RowBox[{"LI", "[", "p", "]"}], ",", 
                RowBox[{"LI", "[", "q", "]"}], ",", 
                RowBox[{"IndsNoLI", "/.", 
                 RowBox[{"List", "\[Rule]", "Sequence"}]}]}], "]"}], ",", "M",
               ",", 
              RowBox[{"Symmetric", "[", "IndsNoLI", "]"}], ",", 
              RowBox[{"PrintAs", "\[Rule]", "PrAs"}]}], "]"}]}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Definition", " ", "of", " ", "the", " ", "projection", " ", 
            "properties", " ", "for", " ", "the", " ", 
            RowBox[{"tensor", " ", "'"}], 
            RowBox[{
             RowBox[{"Name", "'"}], "."}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Not", "@", 
             RowBox[{"AnyIndicesListQ", "[", "IndsNoLI", "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DefProjectedTensorProperties", "[", 
             RowBox[{"Name", ",", 
              RowBox[{"IndsNoLI", "/.", 
               RowBox[{"List", "\[Rule]", "Sequence"}]}], ",", "h", ",", 
              "TensProp", ",", "SpaTimeDef"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DefProjectedTensorPropertiesAnyIndices", "[", 
             RowBox[{"Name", ",", "h", ",", "TensProp", ",", "SpaTimeDef"}], 
             "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"SetNumberOfArguments", "[", 
    RowBox[{"DefProjectedTensor", ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "Infinity"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Protect", "[", "DefProjectedTensor", "]"}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.566532400209086*^9, 3.5665324011748238`*^9}, {
   3.566532701081686*^9, 3.566532744415922*^9}, 3.566532996755151*^9, {
   3.566533273535058*^9, 3.566533274173046*^9}, {3.5665334252219257`*^9, 
   3.56653342573151*^9}, {3.5667538719269648`*^9, 3.5667538739833117`*^9}, {
   3.566754031145282*^9, 3.56675403139881*^9}, {3.566839917078992*^9, 
   3.5668399212695932`*^9}, {3.566921112207685*^9, 3.566921165134832*^9}, {
   3.5669214853290777`*^9, 3.566921501826391*^9}, {3.566921719563846*^9, 
   3.5669217283375874`*^9}, 3.566988743134243*^9, {3.56715687628412*^9, 
   3.567156908754628*^9}, {3.5671569517593*^9, 3.567156988856604*^9}, {
   3.567157058485881*^9, 3.567157077009905*^9}, {3.56725788237228*^9, 
   3.56725788296399*^9}, {3.567258804453051*^9, 3.5672588046372337`*^9}, {
   3.567259920319956*^9, 3.567259923668805*^9}, {3.567401638268774*^9, 
   3.567401706866534*^9}, {3.5674018277487917`*^9, 3.5674018395638113`*^9}, {
   3.567401908895275*^9, 3.567401937985804*^9}, {3.567404200549028*^9, 
   3.567404204895507*^9}, {3.567404256835082*^9, 3.567404282865798*^9}, {
   3.5674068222256804`*^9, 3.567406833576133*^9}, {3.567407085152463*^9, 
   3.567407086804994*^9}, {3.56740713729716*^9, 3.567407156860292*^9}, {
   3.567407254137395*^9, 3.567407258821165*^9}, {3.567407289945524*^9, 
   3.567407296178712*^9}, {3.567407360484158*^9, 3.567407576393166*^9}, {
   3.56740762656549*^9, 3.567407674282559*^9}, {3.567407717621868*^9, 
   3.5674078662760468`*^9}, {3.567486257869482*^9, 3.567486507256322*^9}, {
   3.5674865443525543`*^9, 3.567486570198493*^9}, {3.56748660827171*^9, 
   3.567487158126843*^9}, {3.56748722276479*^9, 3.567487503239909*^9}, {
   3.56748759692638*^9, 3.567487598534565*^9}, {3.567487971442595*^9, 
   3.5674880218321447`*^9}, {3.567488053001568*^9, 3.567488073426536*^9}, {
   3.567488136500404*^9, 3.567488136817068*^9}, {3.567488228280545*^9, 
   3.567488267660192*^9}, 3.56748841890205*^9, {3.567488970507998*^9, 
   3.5674891638616467`*^9}, 3.5674892522250853`*^9, {3.567497708908671*^9, 
   3.567497727320838*^9}, {3.567498206195364*^9, 3.567498207287689*^9}, {
   3.567498421282777*^9, 3.567498431265932*^9}, {3.5674988326037073`*^9, 
   3.567498842545467*^9}, 3.5674990102914257`*^9, {3.567500299891827*^9, 
   3.567500342117481*^9}, {3.567500984298983*^9, 3.5675009847826643`*^9}, {
   3.567575521669482*^9, 3.567575524092523*^9}, {3.567928646015622*^9, 
   3.56792869002987*^9}, 3.568458072573448*^9, 3.570510976662635*^9, 
   3.570511184549685*^9}],

Cell["\<\

DefProjectedTensorProperties:\
\>", "Text",
 CellChangeTimes->{{3.566040282546426*^9, 3.566040296792358*^9}, 
   3.566040361736294*^9, 3.5663200053324213`*^9, {3.566462776983321*^9, 
   3.56646277812514*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"**", " ", 
    RowBox[{"MODULE", ":", " ", "DefProjectedTensorProperties"}]}], " ", 
   "***)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DefProjectedTensorProperties", "[", 
    RowBox[{"Name_", ",", 
     RowBox[{"inds___", "?", "DownIndexQ"}], ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", "Properties_List", ",", 
     "Spacetimes_List"}], "]"}], ":=", 
   RowBox[{"Catch", "@", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "prot", "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"g", "=", 
           RowBox[{"First", "@", 
            RowBox[{"InducedFrom", "@", "h"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"n", "=", 
           RowBox[{"Last", "@", 
            RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"cd", "=", 
             RowBox[{"CovDOfMetric", "[", "h", "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"M", "=", 
             RowBox[{"ManifoldOfCovD", "[", 
              RowBox[{"CovDOfMetric", "[", "g", "]"}], "]"}]}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"SymmetricBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Properties", ",", "\"\<SymmetricTensor\>\""}], "]"}],
                "===", 
               RowBox[{"{", "\"\<SymmetricTensor\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"TracelessBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Properties", ",", "\"\<Traceless\>\""}], "]"}], "===", 
               RowBox[{"{", "\"\<Traceless\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"TransverseBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Properties", ",", "\"\<Transverse\>\""}], "]"}], "===", 
               RowBox[{"{", "\"\<Transverse\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"BackgroundBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Spacetimes", ",", "\"\<Background\>\""}], "]"}], "===", 
               RowBox[{"{", "\"\<Background\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PerturbedBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Spacetimes", ",", "\"\<Perturbed\>\""}], "]"}], "===", 
               RowBox[{"{", "\"\<Perturbed\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"ToCan", "=", 
             RowBox[{
              RowBox[{"ToCanonical", "[", 
               RowBox[{"#", ",", 
                RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], "]"}], 
              "&"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Not", "[", "SymmetricBool", "]"}], "&&", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"{", "inds", "}"}], "]"}], "\[GreaterEqual]", "2"}], 
               ")"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"Throw", "@", 
              RowBox[{"Message", "[", 
               RowBox[{
               "DefProjectedTensorProperties", "::", "symmetrictensors"}], 
               "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"DefProjectedTensorQ", "[", 
             RowBox[{"Name", ",", "h"}], "]"}], "^=", "True"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"InducedMetricOf", "[", "Name", "]"}], "^=", "h"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"DefProjectedTensorQ", "[", "Name", "]"}], "===", 
              "False"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"PropertiesList", "[", "Name", "]"}], "^=", 
               RowBox[{"Join", "[", 
                RowBox[{"Properties", ",", 
                 RowBox[{"Which", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}], "===", "0"}], ",", 
                   RowBox[{"{", "\"\<Scalar\>\"", "}"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}], "===", "1"}], ",", 
                   RowBox[{"{", "\"\<Vector\>\"", "}"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}], "\[GreaterEqual]", 
                    "2"}], ",", 
                   RowBox[{"{", "\"\<Tensor\>\"", "}"}]}], "]"}]}], "]"}]}], 
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Name", "[", 
                RowBox[{"indices___", "?", "AIndexQ"}], "]"}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "0", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices"}], "]"}], 
                "\[IndentingNewLine]", "/;", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "indices", "}"}], "]"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", 
                  RowBox[{"p_", "?", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                    ")"}]}], "]"}], ",", 
                 RowBox[{"indices___", "?", "AIndexQ"}]}], "]"}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices"}], "]"}], 
                "\[IndentingNewLine]", "/;", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "indices", "}"}], "]"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "For", " ", "tensors", " ", "of", " ", "rank", " ", "larger", 
                 " ", "than", " ", "or", " ", "equal", " ", "to", " ", "2"}], 
                ",", " ", 
                RowBox[{
                "the", " ", "following", " ", "rules", " ", "provide", " ", 
                 "the", " ", "traceless", " ", 
                 RowBox[{"property", "."}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}], "\[GreaterEqual]", 
                   "2"}], ")"}], "&&", "TracelessBool"}], ",", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Name", "/:", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    "Dum_", ",", "indices2___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices3___"}], "]"}], ":=", 
                  
                  RowBox[{"0", " ", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices2___", ",", "Dum_", 
                    ",", "indices3___"}], "]"}], ":=", 
                  RowBox[{"0", " ", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum_", 
                    ",", "indices2___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices3___"}], "]"}], ":=", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "}"}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Dummy1", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Dummy2", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{"ToCan", "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    "Dum", ",", "indices2", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices3"}], "]"}], "]"}], 
                    "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", "+", 
                    
                    RowBox[{"2", "*", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dummy1"}], ",", "indices2", ",", 
                    RowBox[{"-", "Dummy2"}], ",", "indices3"}], "]"}], 
                    RowBox[{
                    RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "]"}]}]}], ")"}]}]}]}],
                     "\[IndentingNewLine]", " ", "\[IndentingNewLine]", "]"}],
                    "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices2___", ",", "Dum_", 
                    ",", "indices3___"}], "]"}], ":=", "\[IndentingNewLine]", 
                  
                  RowBox[{
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "}"}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Dummy1", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Dummy2", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{"ToCan", "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    "Dum", ",", "indices2", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices3"}], "]"}], "]"}], 
                    "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", "+", 
                    
                    RowBox[{"2", " ", "*", " ", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dummy1"}], ",", "indices2", ",", 
                    RowBox[{"-", "Dummy2"}], ",", "indices3"}], "]"}], 
                    RowBox[{
                    RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "]"}]}]}], ")"}]}]}]}],
                     "\[IndentingNewLine]", " ", "\[IndentingNewLine]", "]"}],
                    "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";"}]}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
                    ",", "indices2___", ",", "Dum2_", ",", "indices3___"}], 
                    "]"}], 
                   RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "Dum1_"}], ",", 
                    RowBox[{"-", "Dum2_"}]}], "]"}]}], ":=", 
                  RowBox[{"0", " ", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
                    ",", "indices2___", ",", "Dum2_", ",", "indices3___"}], 
                    "]"}], 
                   RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "Dum2_"}], ",", 
                    RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
                  RowBox[{"0", " ", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___", ",", 
                    RowBox[{"-", "Dum2_"}], ",", "indices3___"}], "]"}], 
                   RowBox[{"g", "[", 
                    RowBox[{"Dum1_", ",", "Dum2_"}], "]"}]}], ":=", 
                  RowBox[{"0", " ", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___", ",", 
                    RowBox[{"-", "Dum2_"}], ",", "indices3___"}], "]"}], 
                   RowBox[{"g", "[", 
                    RowBox[{"Dum2_", ",", "Dum1_"}], "]"}]}], ":=", 
                  RowBox[{"0", " ", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";"}], 
                "\[IndentingNewLine]", "\[IndentingNewLine]", "*)"}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"PerturbationOrder", "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "0", "]"}], ",", 
                  RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], "]"}], 
                "]"}], "^:=", 
               RowBox[{"Catch", "@", 
                RowBox[{"Module", "[", 
                 RowBox[{
                  RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "indices", "}"}], "]"}], "=!=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The number of indices for the tensor \
\>\"", ",", " ", "Name", ",", "\"\< is incorrect.\>\""}], "]"}], "]"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                   
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"AIndexQ", "/@", 
                    RowBox[{"{", "indices", "}"}]}], ",", "False"}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The indices of the tensor \>\"", ",", 
                    " ", "Name", ",", 
                    "\"\< have to be abstract indices.\>\""}], "]"}], "]"}]}],
                     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ")"}], ",", 
                    "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The second label-index has to be a \
positive integer.\>\"", "]"}], "]"}], "]"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"NumericQ", "[", "q", "]"}], ",", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The second label-index has to be a \
positive integer.\>\"", "]"}], "]"}]}], "]"}]}], "]"}]}]}], 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]}], ";",
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"TO", " ", 
                RowBox[{"DO", ":", " ", 
                 RowBox[{
                 "We", " ", "here", " ", "have", " ", "to", " ", "comment", 
                  " ", "on", " ", "the", " ", "commutation", " ", "between", 
                  " ", "perturbing", " ", "and", " ", "Lie", " ", 
                  RowBox[{"deriving", ".", " ", "This"}], " ", "commutation", 
                  " ", "stems", " ", "from", " ", "the", " ", "fact", " ", 
                  "that", " ", "the", " ", "Lie", " ", "derivative", " ", 
                  "is", " ", "a", " ", "background", " ", "Lie", " ", 
                  RowBox[{"derivative", "."}]}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
               "PerturbedBool", ",", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                  RowBox[{
                  "For", " ", "any", " ", "perturbed", " ", "tensors"}], ",", 
                  " ", 
                  RowBox[{"we", " ", 
                   RowBox[{"have", ":"}]}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"PerturbationOrder", "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p_", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                    "]"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "indices", "}"}], "]"}], "=!=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The number of indices for the tensor \
\>\"", ",", " ", "Name", ",", "\"\< is incorrect.\>\""}], "]"}], "]"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"AIndexQ", "/@", 
                    RowBox[{"{", "indices", "}"}]}], ",", "False"}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The indices of the tensor \>\"", ",", 
                    " ", "Name", ",", 
                    "\"\< have to be abstract indices.\>\""}], "]"}], "]"}]}],
                     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "p", "]"}], "&&", 
                    RowBox[{"p", "\[GreaterEqual]", "1"}]}], ")"}], "&&", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ")"}]}], ",", 
                    "\[IndentingNewLine]", "p", ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The label-indices have to be positive \
integers.\>\"", "]"}], "]"}], "]"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"NumericQ", "[", "p", "]"}], "&&", 
                    RowBox[{"NumericQ", "[", "q", "]"}]}], ",", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The label-indices have to be positive \
integers.\>\"", "]"}], "]"}]}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"the", " ", "rule", " ", 
                    RowBox[{"for", " ", "'"}], "p"}], " ", "=", " ", 
                    RowBox[{
                    RowBox[{"0", "'"}], " ", "is", " ", "defined", " ", 
                    "above"}]}], ")"}], " ", "*)"}], "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                   RowBox[{
                   "and", " ", "for", " ", "perturbed", " ", "scalar", " ", 
                    "quantities"}], ",", " ", 
                   RowBox[{"we", " ", 
                    RowBox[{"have", ":"}]}]}], " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Perturbation", "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p_", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}]}], "]"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "p", "]"}], "&&", 
                    RowBox[{"p", "\[GreaterEqual]", "0"}]}], ")"}], "&&", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ")"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p", "+", "1"}], "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The label-indices have to be positive \
integers.\>\"", "]"}], "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Perturbation", "[", 
                   RowBox[{
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p_", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}]}], "]"}], ",", 
                    "PertOrder_"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "[", 
                    RowBox[{"IntegerQ", "[", "PertOrder", "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The order of the perturbation has to be \
an integer.\>\"", "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "p", "]"}], "&&", 
                    RowBox[{"p", "\[GreaterEqual]", "0"}]}], ")"}], "&&", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ")"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p", "+", "PertOrder"}], "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The label-indices have to be positive \
integers.\>\"", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}], ";"}]}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "For", " ", "tensors", " ", "living", " ", "on", " ", "the", 
                 " ", "background", " ", "only"}], ",", " ", 
                RowBox[{"we", " ", 
                 RowBox[{"have", ":"}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"BackgroundBool", "&&", 
                 RowBox[{"Not", "[", "PerturbedBool", "]"}]}], ",", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Perturbation", "[", 
                   RowBox[{
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                    "]"}], ",", "PertOrder_"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "indices", "}"}], "]"}], "=!=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The number of indices for the tensor \
\>\"", ",", " ", "Name", ",", "\"\< is incorrect.\>\""}], "]"}], "]"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"AIndexQ", "/@", 
                    RowBox[{"{", "indices", "}"}]}], ",", "False"}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The indices of the tensor \>\"", ",", 
                    " ", "Name", ",", 
                    "\"\< have to be abstract indices.\>\""}], "]"}], "]"}]}],
                     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "[", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The second label-index has to be a \
positive integer.\>\"", "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"PertOrder", "===", "0"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices"}], "]"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "PertOrder", "]"}], "&&", 
                    RowBox[{"PertOrder", "\[GreaterEqual]", "1"}]}], ")"}], 
                    ",", "\[IndentingNewLine]", "0", ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The order of the perturbation has to be \
a positive integer.\>\"", "]"}], "]"}]}], "]"}]}], "]"}]}]}], 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]}], 
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Perturbation", "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                    "]"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "indices", "}"}], "]"}], "=!=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The number of indices for the tensor \
\>\"", ",", " ", "Name", ",", "\"\< is incorrect.\>\""}], "]"}], "]"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"AIndexQ", "/@", 
                    RowBox[{"{", "indices", "}"}]}], ",", "False"}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The indices of the tensor \>\"", ",", 
                    " ", "Name", ",", 
                    "\"\< have to be abstract indices.\>\""}], "]"}], "]"}]}],
                     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ",", 
                    "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The second label-index has to be a \
positive integer.\>\"", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}], ";"}]}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"For", " ", "pure", " ", "perturbations", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"i", ".", "e", ".", " ", "for"}], " ", "tensors", 
                   " ", "without", " ", "background", " ", "values"}], 
                  ")"}]}], ",", " ", 
                RowBox[{"we", " ", 
                 RowBox[{"have", ":"}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Not", "[", "BackgroundBool", "]"}], "&&", 
                 "PerturbedBool"}], ",", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Name", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "0", "]"}], ",", 
                   RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                    ")"}]}], "]"}], ",", 
                   RowBox[{"indices___", "?", "AIndexQ"}]}], "]"}], ":=", 
                 RowBox[{"0", "\[IndentingNewLine]", "/;", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "indices", "}"}], "]"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}]}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"DefProjectedTensorQ", "[", "Name", "]"}], "^=", 
               "True"}], ";"}]}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"PropertiesList", "[", "Name", "]"}], "^=", 
            "\[IndentingNewLine]", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"PropertiesList", "[", "Name", "]"}], ",", 
              RowBox[{"Which", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}], "===", "1"}], "&&", 
                 "TransverseBool"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                 "\"\<SVT-Vector associated with the induced metric \>\"", 
                  " ", "h", " ", "\"\<\>\""}], "}"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}], "\[GreaterEqual]", 
                  "2"}], "&&", "SymmetricBool", "&&", "TracelessBool", "&&", 
                 "TransverseBool"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                 "\"\<SVT-Tensor associated with the induced metric \>\"", 
                  " ", "h", " ", "\"\<\>\""}], "}"}], ",", 
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"{", "inds", "}"}], "]"}], "\[GreaterEqual]", "0"}],
                 ",", 
                RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"'", "SVT"}], "-", 
             RowBox[{
              RowBox[{"Vector", "'"}], " ", "is", " ", "a", " ", "vector", 
              " ", "satisfying", " ", "the", " ", "SVT"}], "-", 
             RowBox[{"decomposition", " ", "properties", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"hence", " ", "it", " ", "is", " ", "transverse"}], 
                ")"}], ".", " ", "\[IndentingNewLine]", "'"}], "SVT"}], "-", 
             RowBox[{
              RowBox[{"Tensor", "'"}], " ", "is", " ", "a", " ", "tensor", 
              " ", "satisfying", " ", "the", " ", "SVT"}], "-", 
             RowBox[{"decomposition", " ", "properties", " ", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"hence", " ", "it", " ", "is", " ", "symmetric"}], 
                 ",", " ", 
                 RowBox[{"traceless", " ", "and", " ", "transverse"}]}], 
                ")"}], "."}]}]}], "*)"}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "The", " ", "Lie", " ", "derivative", " ", "for", " ", "tensors",
               " ", "with", " ", "indices", " ", 
              StyleBox["down",
               FontVariations->{"Underline"->True}], " ", "is", " ", 
              "represented", " ", "by", " ", "the", " ", "second", " ", 
              "label"}], "-", 
             RowBox[{"index", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"LieD", "[", 
              RowBox[{"n", "[", "Dum_", "]"}], "]"}], "[", 
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"indices___", "?", "DownIndexQ"}]}], "]"}], "]"}], ":=",
             " ", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{"$ConformalTime", ",", "1", ",", 
                RowBox[{
                 RowBox[{"a", "[", "h", "]"}], "[", "]"}]}], "]"}], "*", 
              RowBox[{"Name", "[", 
               RowBox[{
                RowBox[{"LI", "[", "p", "]"}], ",", 
                RowBox[{"LI", "[", 
                 RowBox[{"q", "+", "1"}], "]"}], ",", "indices"}], "]"}]}], 
             "\[IndentingNewLine]", "/;", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"{", "indices", "}"}], "]"}], "===", 
               RowBox[{"Length", "[", 
                RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "For", " ", "tensors", " ", "of", " ", "rank", " ", "larger", 
              " ", "than", " ", "or", " ", "equal", " ", "to", " ", "1"}], 
             ","}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"{", "inds", "}"}], "]"}], "\[GreaterEqual]", "1"}], 
             ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"we", " ", "bypass", " ", 
               RowBox[{"OrthogonalToVectorQ", ":"}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"OrthogonalToVectorQ", "[", "n", "]"}], "[", "Name", 
                "]"}], "=", "True"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"Projection", " ", "conditions"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "The", " ", "contraction", " ", "with", " ", "the", " ", 
                 "vector", " ", "normal", " ", "to", " ", "the", " ", 
                 "hypersurfaces", " ", "gives", " ", "0", " ", 
                 RowBox[{"(", 
                  RowBox[{
                  "since", " ", "the", " ", "tensor", " ", "is", " ", 
                   "projected"}], ")"}]}], ":"}], " ", "*)"}], 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum_", 
                  ",", "indices2___"}], "]"}], 
                RowBox[{"n", "[", 
                 RowBox[{"-", "Dum_"}], "]"}]}], ":=", 
               RowBox[{"0", " ", "/;", 
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum_"}], ",", "indices2___"}], "]"}], 
                RowBox[{"n", "[", "Dum_", "]"}]}], ":=", 
               RowBox[{"0", " ", "/;", 
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "and", " ", "the", " ", "action", " ", "of", " ", "the", " ", 
                "projector", " ", "onto", " ", "the", " ", "hypersurfaces", 
                " ", "is", " ", "an", " ", "invariant", " ", 
                RowBox[{"operation", ":"}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "On", " ", "background", " ", "quantities", " ", "we", " ", 
                "contract", " ", "automatically"}], " ", "*)"}], 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"Old", " ", "Implementation"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"Name", "/:", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    "Dum1_", ",", "indices2___"}], "]"}], 
                  RowBox[{"h", "[", 
                   RowBox[{
                    RowBox[{"-", "Dum1_"}], ",", "Dum2_"}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"Name", "/:", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    "Dum1_", ",", "indices2___"}], "]"}], 
                  RowBox[{"h", "[", 
                   RowBox[{"Dum2_", ",", 
                    RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"Name", "/:", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                  RowBox[{"h", "[", 
                   RowBox[{"Dum1_", ",", "Dum2_"}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"Name", "/:", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                  RowBox[{"h", "[", 
                   RowBox[{"Dum2_", ",", "Dum1_"}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";"}], 
               "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"$Rulecdh", "[", "h", "]"}], "=", 
               RowBox[{"Append", "[", 
                RowBox[{
                 RowBox[{"$Rulecdh", "[", "h", "]"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    "Dum1_", ",", "indices2___"}], "]"}], 
                   RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "Dum1_"}], ",", 
                    RowBox[{"-", "Dum2_"}]}], "]"}]}], ":>", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}], " ", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}]}], "]"}]}],
               ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"$Rulecdh", "[", "h", "]"}], "=", 
               RowBox[{"Append", "[", 
                RowBox[{
                 RowBox[{"$Rulecdh", "[", "h", "]"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                   RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"Dum1_", "?", "UpIndexQ"}], ",", 
                    RowBox[{"Dum2_", "?", "UpIndexQ"}]}], "]"}]}], ":>", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}], " ", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}]}], "]"}]}],
               ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"Name", "/:", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    "Dum1_", ",", "indices2___"}], "]"}], 
                  RowBox[{"h", "[", 
                   RowBox[{"Dum2_", ",", 
                    RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"Name", "/:", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                  RowBox[{"h", "[", 
                   RowBox[{"Dum1_", ",", "Dum2_"}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"Name", "/:", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                  RowBox[{"h", "[", 
                   RowBox[{"Dum2_", ",", "Dum1_"}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";"}], 
               "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                  "Dum1_", ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{
                  RowBox[{"-", "Dum1_"}], ",", 
                  RowBox[{"Dum2_", "?", "UpIndexQ"}]}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", "Dum2",
                   ",", "indices2"}], "]"}], " ", "/;", 
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                  "Dum1_", ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{
                  RowBox[{"Dum2_", "?", "UpIndexQ"}], ",", 
                  RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", "Dum2",
                   ",", "indices2"}], "]"}], " ", "/;", 
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{"Dum1_", ",", 
                  RowBox[{"-", "Dum2_"}]}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                  RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}], " ", "/;", 
                
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{
                  RowBox[{"-", "Dum2_"}], ",", "Dum1_"}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                  RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}], " ", "/;", 
                
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"prot", "=", 
                 RowBox[{"Unprotect", "[", "cd", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"cd", "/:", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cd", "[", "a_", "]"}], "@", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    "Dum1_", ",", "indices2___"}], "]"}]}], 
                  RowBox[{"h", "[", 
                   RowBox[{
                    RowBox[{"-", "Dum1_"}], ",", "Dum2_"}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cd", "[", "a", "]"}], "@", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}]}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"cd", "/:", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cd", "[", "a_", "]"}], "@", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    "Dum1_", ",", "indices2___"}], "]"}]}], 
                  RowBox[{"h", "[", 
                   RowBox[{"Dum2_", ",", 
                    RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cd", "[", "a", "]"}], "@", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}]}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"cd", "/:", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cd", "[", "a_", "]"}], "@", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}]}], 
                  RowBox[{"h", "[", 
                   RowBox[{"Dum1_", ",", "Dum2_"}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cd", "[", "a", "]"}], "@", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}]}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"cd", "/:", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cd", "[", "a_", "]"}], "@", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}]}], 
                  RowBox[{"h", "[", 
                   RowBox[{"Dum2_", ",", "Dum1_"}], "]"}]}], ":=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"cd", "[", "a", "]"}], "@", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                    "Dum2", ",", "indices2"}], "]"}]}], " ", "/;", 
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Protect", "[", "prot", "]"}], ";"}], 
               "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "When", " ", "there", " ", "are", " ", "Lie", " ", 
                 "derivatives"}], ",", " ", 
                RowBox[{
                "h", " ", "contracted", " ", "automatically", " ", "only", 
                 " ", "when", " ", "the", " ", "free", " ", "index", " ", 
                 "is", " ", 
                 RowBox[{"down", ".", " ", "Otherwise"}], " ", "it", " ", 
                 "requires", " ", "ContractMetric", " ", "to", " ", "perform",
                  " ", "contraction"}]}], " ", "*)"}], "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
                  ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{
                  RowBox[{"-", "Dum1_"}], ",", 
                  RowBox[{"-", "Dum2_"}]}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p", "]"}], ",", 
                  RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                  RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}], " ", "/;", 
                
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
                  ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{
                  RowBox[{"-", "Dum2_"}], ",", 
                  RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p", "]"}], ",", 
                  RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                  RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}], " ", "/;", 
                
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{"Dum1_", ",", 
                  RowBox[{"-", "Dum2_"}]}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p", "]"}], ",", 
                  RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                  RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}], " ", "/;", 
                
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{
                  RowBox[{"-", "Dum2_"}], ",", "Dum1_"}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p", "]"}], ",", 
                  RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                  RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}], " ", "/;", 
                
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "g", " ", "to", " ", "h", " ", "is", " ", "automatic"}], " ", 
               "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
                  ",", "indices2___"}], "]"}], 
                RowBox[{"g", "[", 
                 RowBox[{
                  RowBox[{"-", "Dum1_"}], ",", "Dum2_"}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Name", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "p", "]"}], ",", 
                   RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                   "Dum1", ",", "indices2"}], "]"}], 
                 RowBox[{"h", "[", 
                  RowBox[{
                   RowBox[{"-", "Dum1"}], ",", "Dum2"}], "]"}]}], " ", "/;", 
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
                  ",", "indices2___"}], "]"}], 
                RowBox[{"g", "[", 
                 RowBox[{"Dum2_", ",", 
                  RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Name", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "p", "]"}], ",", 
                   RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                   "Dum1", ",", "indices2"}], "]"}], " ", 
                 RowBox[{"h", "[", 
                  RowBox[{"Dum2", ",", 
                   RowBox[{"-", "Dum1"}]}], "]"}]}], " ", "/;", 
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                RowBox[{"g", "[", 
                 RowBox[{"Dum1_", ",", "Dum2_"}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Name", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "p", "]"}], ",", 
                   RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                   RowBox[{"-", "Dum1"}], ",", "indices2"}], "]"}], " ", 
                 RowBox[{"h", "[", 
                  RowBox[{"Dum1", ",", "Dum2"}], "]"}]}], " ", "/;", 
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                RowBox[{"g", "[", 
                 RowBox[{"Dum2_", ",", "Dum1_"}], "]"}]}], ":=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Name", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "p", "]"}], ",", 
                   RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                   RowBox[{"-", "Dum1"}], ",", "indices2"}], "]"}], " ", 
                 RowBox[{"h", "[", 
                  RowBox[{"Dum2", ",", "Dum1"}], "]"}]}], " ", "/;", 
                RowBox[{"(", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                   "1"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "If", " ", "the", " ", "tensor", " ", "belongs", " ", 
                 RowBox[{"(", 
                  RowBox[{"at", " ", "least"}], ")"}], " ", "to", " ", "the", 
                 " ", "perturbed", " ", "manifold"}], ",", " ", 
                RowBox[{
                "and", " ", "if", " ", "it", " ", "is", " ", "tranverse"}], 
                ","}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"PerturbedBool", " ", "&&", " ", "TransverseBool"}], 
                ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"(", 
                  RowBox[{"transverse", " ", "property"}], ")"}], " ", "*)"}],
                 "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"cd", "[", "Dum_", "]"}], "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices2___"}], "]"}], "]"}],
                   ":=", "\[IndentingNewLine]", 
                  RowBox[{"0", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"cd", "[", 
                    RowBox[{"-", "Dum_"}], "]"}], "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    "Dum_", ",", "indices2___"}], "]"}], "]"}], ":=", 
                  "\[IndentingNewLine]", 
                  RowBox[{"0", "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                   RowBox[{"then", " ", "the", " ", "first", " ", 
                    RowBox[{"rule", ":", " ", 
                    RowBox[{
                    SuperscriptBox["D", "a"], 
                    SubscriptBox["\[ScriptCapitalL]", "n"], 
                    SubscriptBox["T", 
                    RowBox[{
                    RowBox[{"a", "..."}], " "}]]}]}]}], "=", " ", 
                   RowBox[{
                    RowBox[{
                    SubscriptBox["\[ScriptCapitalL]", "n"], 
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox["D", "a"], 
                    SubscriptBox["T", 
                    RowBox[{"a", "..."}]]}], ")"}]}], " ", "-", " ", 
                    RowBox[{
                    SubscriptBox["\[ScriptCapitalL]", "n"], 
                    RowBox[{"(", 
                    SuperscriptBox["g", "ab"], ")"}], 
                    SubscriptBox["D", "b"], 
                    SubscriptBox[
                    SubscriptBox["T", "a"], "..."]}], " ", "+", " ", 
                    RowBox[{
                    RowBox[{
                    SuperscriptBox["g", "ab"], "[", 
                    RowBox[{
                    SubscriptBox["D", "b"], ",", 
                    SubscriptBox["\[ScriptCapitalL]", "n"]}], "]"}], 
                    SubscriptBox["T", 
                    RowBox[{"a", "..."}]]}]}]}], " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"cd", "[", "Dum_", "]"}], "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"indices1___", "?", "DownIndexQ"}], ",", 
                    RowBox[{"-", "Dum_"}], ",", 
                    RowBox[{"indices2___", "?", "DownIndexQ"}]}], "]"}], 
                   "]"}], ":=", 
                  RowBox[{
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "}"}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Dummy1", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Dummy2", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"ToCan", "@", 
                    RowBox[{
                    "ContractMetric", "[", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "Dum", "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    "-", " ", 
                    RowBox[{"ToCan", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"Dum", ",", "Dummy2"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], " ", "&"}]}], "]"}], 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", "+", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"Dum", ",", "Dummy2"}], "]"}], 
                    RowBox[{"ToCan", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "-", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]",
                     "]"}], "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                   RowBox[{"and", " ", "the", " ", "second", " ", 
                    RowBox[{"rule", ":", " ", 
                    RowBox[{
                    SubscriptBox["D", "a"], 
                    SubscriptBox["\[ScriptCapitalL]", "n"], 
                    SubscriptBox[
                    SuperscriptBox["T", "a"], 
                    RowBox[{"...", " "}]]}]}]}], "=", " ", 
                   RowBox[{
                    RowBox[{
                    SubscriptBox["\[ScriptCapitalL]", "n"], 
                    RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox["D", "a"], 
                    SubscriptBox["T", 
                    RowBox[{"a", "..."}]]}], ")"}]}], " ", "-", " ", 
                    RowBox[{
                    SubscriptBox["\[ScriptCapitalL]", "n"], 
                    RowBox[{"(", 
                    SuperscriptBox["g", "ab"], ")"}], 
                    SubscriptBox["D", "b"], 
                    SubscriptBox[
                    SubscriptBox["T", "a"], "..."]}], " ", "+", " ", 
                    RowBox[{
                    RowBox[{
                    SuperscriptBox["g", "ab"], "[", 
                    RowBox[{
                    SubscriptBox["D", "b"], ",", 
                    SubscriptBox["\[ScriptCapitalL]", "n"]}], "]"}], 
                    SubscriptBox["T", 
                    RowBox[{"a", "..."}]]}]}]}], " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"cd", "[", 
                    RowBox[{"-", "Dum_"}], "]"}], "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"indices1___", "?", "DownIndexQ"}], ",", "Dum_", 
                    ",", 
                    RowBox[{"indices2___", "?", "DownIndexQ"}]}], "]"}], 
                   "]"}], ":=", 
                  RowBox[{
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "}"}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Dummy1", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Dummy2", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"ToCan", "@", 
                    RowBox[{
                    "ContractMetric", "[", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "Dum", "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    "-", " ", 
                    RowBox[{"ToCan", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"Dum", ",", "Dummy2"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], " ", "&"}]}], "]"}], 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", "+", " ", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"Dum", ",", "Dummy2"}], "]"}], 
                    RowBox[{"ToCan", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "-", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]",
                     "\[IndentingNewLine]", "]"}], "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", 
                    "1"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                   RowBox[{"apply", ".", " ", "We"}], " ", "have", " ", 
                   "denoted", " ", 
                   RowBox[{"by", " ", "'"}], 
                   RowBox[{"n", "'"}], " ", "the", " ", "vector", " ", 
                   "normal", " ", "to", " ", "the", " ", 
                   RowBox[{"hypersurfaces", ".", " ", "The"}], " ", 
                   RowBox[{"commutator", " ", "[", 
                    RowBox[{".", 
                    RowBox[{",", "."}]}], "]"}], " ", "is", " ", "handle", 
                   " ", "automatically", " ", "by", " ", "another", " ", 
                   "automatic", " ", 
                   RowBox[{"rule", "."}]}], " ", "*)"}], 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                   RowBox[{
                   "If", " ", "the", " ", "indices", " ", "are", " ", "not", 
                    " ", "down"}], ",", " ", 
                   RowBox[{
                    RowBox[{"we", " ", "separate", " ", 
                    RowBox[{"them", ".", " ", "In"}], " ", "practice", " ", 
                    "this", " ", "happens", " ", "almost", " ", "never"}], 
                    "..."}]}], " ", "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"cd", "[", "Dum_", "]"}], "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                    RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices3___", 
                    ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices2___"}], "]"}], "]"}],
                   ":=", 
                  RowBox[{
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "Dummy", "}"}], ",", 
                    RowBox[{
                    RowBox[{"Dummy", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "Dummy"}], "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "Dum", "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dummy"}], ",", "indices3", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], 
                    "]"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]",
                     "]"}], "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"cd", "[", "Dum_", "]"}], "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices3___", ",", 
                    RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices2___"}],
                     "]"}], "]"}], ":=", 
                  RowBox[{
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "Dummy", "}"}], ",", 
                    RowBox[{
                    RowBox[{"Dummy", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "Dummy"}], "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "Dum", "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices3", ",", 
                    RowBox[{"-", "Dummy"}], ",", "indices2"}], "]"}], 
                    "]"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]",
                     "]"}], "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"cd", "[", 
                    RowBox[{"-", "Dum_"}], "]"}], "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                    RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices3___", 
                    ",", "Dum_", ",", "indices2___"}], "]"}], "]"}], ":=", 
                  RowBox[{
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "Dummy", "}"}], ",", 
                    RowBox[{
                    RowBox[{"Dummy", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "Dummy"}], "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dum"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dummy"}], ",", "indices3", ",", "Dum", ",", 
                    "indices2"}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}], "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"cd", "[", 
                    RowBox[{"-", "Dum_"}], "]"}], "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum_", 
                    ",", "indices3___", ",", 
                    RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices2___"}],
                     "]"}], "]"}], ":=", 
                  RowBox[{
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "Dummy", "}"}], ",", 
                    RowBox[{
                    RowBox[{"Dummy", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "Dummy"}], "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dum"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    "Dum", ",", "indices3", ",", 
                    RowBox[{"-", "Dummy"}], ",", "indices2"}], "]"}], 
                    "]"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]",
                     "]"}], "/;", 
                   RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", "indices1", "}"}], ",", 
                    RowBox[{"{", "indices2", "}"}], ",", 
                    RowBox[{"{", "indices3", "}"}]}], "]"}], "]"}], "+", 
                    "2"}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";"}]}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
              "The", " ", "following", " ", "rule", " ", "serves", " ", "to", 
               " ", "express", " ", "the", " ", "three"}], "-", 
              RowBox[{"covariant", " ", "derivative", " ", "of", " ", 
               RowBox[{"(", "homogeneous", ")"}], " ", "background", " ", 
               "quantities", " ", "in", " ", "terms", " ", "of", " ", "the", 
               " ", "connection", " ", 
               RowBox[{"components", ".", " ", "For"}], " ", "instance"}]}], 
             ",", " ", 
             RowBox[{"'", 
              SubscriptBox["D", "i"], 
              RowBox[{
               SubscriptBox["\[Omega]", "j"], "'"}], " ", "is", " ", 
              "replaced", " ", 
              RowBox[{"by", ":", " ", 
               RowBox[{"'", "-", " ", 
                RowBox[{
                 SubscriptBox[
                  SuperscriptBox["\[CapitalGamma]", "a"], "ij"], 
                 RowBox[{
                  RowBox[{
                   SubscriptBox["\[Omega]", "a"], "'"}], "."}]}]}]}]}]}], " ",
             "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
            "BackgroundBool", ",", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", "Dummy2_", "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "0", "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                    ")"}]}], "]"}], ",", "indices___"}], "]"}], "]"}], ":=", 
               RowBox[{
                RowBox[{"Module", "[", 
                 RowBox[{
                  RowBox[{"{", "Dummy1", "}"}], ",", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Dummy1", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", "\[IndentingNewLine]", 
                   RowBox[{"ToCan", "[", 
                    RowBox[{"Plus", "@@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"Dummy1", ",", "Dummy2", ",", "#"}], "]"}]}], 
                    RowBox[{"ReplaceIndex", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices"}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{"-", "Dummy1"}]}]}], "]"}]}], ")"}], "&"}], "/@", 
                    " ", 
                    RowBox[{"{", "indices", "}"}]}], ")"}]}], "]"}]}]}], 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], "/;", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "indices", "}"}], "]"}], "===", 
                  RowBox[{"Length", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Confer", " ", "the", " ", "function", " ", "SetSlicing", " ", 
             "for", " ", "the", " ", "definition", " ", 
             RowBox[{"of", " ", "'"}], 
             RowBox[{"Connection", "'"}], " ", "and", " ", "its", " ", 
             RowBox[{"properties", "."}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "Is", " ", "the", " ", "above", " ", "relation", " ", "correct", 
              " ", "for", " ", "space"}], "-", 
             RowBox[{"time", " ", 
              RowBox[{"indices", "?", " ", "To"}], " ", 
              RowBox[{"check", "!"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{"(*", " ", 
            RowBox[{"What", " ", "is", " ", "the", " ", "need", " ", 
             RowBox[{"for", " ", "'"}], 
             RowBox[{
              RowBox[{"Evaluate", "'"}], "?"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"In", " ", "principle"}], ",", " ", 
             RowBox[{
             "the", " ", "following", " ", "rule", " ", "needs", " ", "not", 
              " ", "to", " ", "be", " ", 
              RowBox[{"used", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"LieD", "[", 
              RowBox[{"n", "[", "Dummy1_", "]"}], "]"}], "[", 
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                  ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                  ")"}]}], "]"}], ",", 
               RowBox[{"indices1___", "?", "AIndexQ"}], ",", 
               RowBox[{"IndexUp_", "?", "UpIndexQ"}], ",", 
               RowBox[{"indices2___", "?", "AIndexQ"}]}], "]"}], "]"}], ":=", 
            
            RowBox[{
             RowBox[{"Module", "[", 
              RowBox[{
               RowBox[{"{", "Dum", "}"}], ",", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Dum", "=", 
                 RowBox[{"DummyIn", "[", 
                  RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"g", "[", 
                   RowBox[{"IndexUp", ",", "Dum"}], "]"}], 
                  RowBox[{
                   RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}]}], 
                 "+", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                   RowBox[{"g", "[", 
                    RowBox[{"IndexUp", ",", "Dum"}], "]"}], "]"}], " ", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}]}]}]}]}], 
              "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], "/;", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"Join", "[", 
                  RowBox[{
                   RowBox[{"{", "indices1", "}"}], ",", 
                   RowBox[{"{", "indices2", "}"}]}], "]"}], "]"}], "+", "1"}],
                "===", 
               RowBox[{"Length", "[", 
                RowBox[{"{", "inds", "}"}], "]"}]}], ")"}]}]}], ";"}]}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562658053935182*^9, 3.562658093020544*^9}, {
   3.562658124338984*^9, 3.562658156598362*^9}, {3.562658282131606*^9, 
   3.562658283321499*^9}, {3.5626591896751413`*^9, 3.5626591941050158`*^9}, {
   3.562659226860417*^9, 3.562659335862483*^9}, {3.562659503276092*^9, 
   3.5626595858169394`*^9}, {3.5626597322180862`*^9, 3.562659782605674*^9}, {
   3.562659915410139*^9, 3.562659915768111*^9}, {3.5626599685138407`*^9, 
   3.562659996200436*^9}, {3.5626602087694063`*^9, 3.562660210496201*^9}, {
   3.5626603195572987`*^9, 3.5626603225916967`*^9}, {3.562661364196891*^9, 
   3.562661370132008*^9}, {3.562662223957425*^9, 3.562662317540872*^9}, {
   3.562662403787108*^9, 3.562662531704566*^9}, 3.562662575988043*^9, {
   3.562662752278059*^9, 3.562662838015995*^9}, {3.5626628875173073`*^9, 
   3.562662981735955*^9}, {3.562664290976099*^9, 3.562664387091413*^9}, {
   3.562664422718424*^9, 3.562664438912901*^9}, {3.5626646625107107`*^9, 
   3.5626646945450153`*^9}, {3.562669928674458*^9, 3.5626700331160297`*^9}, {
   3.562670085498435*^9, 3.562670088383222*^9}, {3.562670127756197*^9, 
   3.562670134054471*^9}, {3.562670167241691*^9, 3.5626701707622433`*^9}, {
   3.562670240538591*^9, 3.562670252189842*^9}, {3.5626775364915752`*^9, 
   3.562677544393833*^9}, {3.562677749553858*^9, 3.562677839192113*^9}, {
   3.562677895546361*^9, 3.562677898829648*^9}, {3.562677937767404*^9, 
   3.562678061192514*^9}, {3.562678190360547*^9, 3.562678213061885*^9}, {
   3.5626782460920277`*^9, 3.562678251455166*^9}, {3.56267842859741*^9, 
   3.5626784507451677`*^9}, {3.562678719000239*^9, 3.562678719902689*^9}, {
   3.562678863356927*^9, 3.5626788840146303`*^9}, {3.562679149373746*^9, 
   3.5626791749897118`*^9}, {3.5626793243547087`*^9, 
   3.5626793279702673`*^9}, {3.562679373988097*^9, 3.562679382730596*^9}, {
   3.5627167408111753`*^9, 3.562716789701312*^9}, {3.562717019670932*^9, 
   3.562717159302092*^9}, {3.562717259784704*^9, 3.562717274699841*^9}, {
   3.56271792336033*^9, 3.562717927244261*^9}, {3.562718109780755*^9, 
   3.562718113264658*^9}, {3.562718145276389*^9, 3.5627181606368933`*^9}, {
   3.562718539882098*^9, 3.562718555145371*^9}, {3.562718726887712*^9, 
   3.562718729012415*^9}, {3.562718763726109*^9, 3.5627187817414494`*^9}, {
   3.562719013340929*^9, 3.562719017370162*^9}, {3.562719617369377*^9, 
   3.562719621501144*^9}, {3.5627197303016777`*^9, 3.562719731875773*^9}, {
   3.562719764468473*^9, 3.562719769769781*^9}, {3.562720566691141*^9, 
   3.562720570832011*^9}, {3.5627211473407307`*^9, 3.562721149962323*^9}, {
   3.5627214907602377`*^9, 3.562721496234454*^9}, {3.562721648820215*^9, 
   3.562721650284357*^9}, {3.562721725614482*^9, 3.562721799147355*^9}, {
   3.562721841133831*^9, 3.5627219233090267`*^9}, {3.5627220084109697`*^9, 
   3.5627220374426737`*^9}, {3.562722332244747*^9, 3.562722399249247*^9}, {
   3.562722560981908*^9, 3.562722571511696*^9}, {3.5627231709551277`*^9, 
   3.562723174149959*^9}, {3.56272344642087*^9, 3.5627235489643917`*^9}, {
   3.562723748341072*^9, 3.562723750308546*^9}, {3.5627238120432167`*^9, 
   3.562723863191524*^9}, {3.562723937436236*^9, 3.562723942230547*^9}, {
   3.562724096808774*^9, 3.562724108008751*^9}, {3.5627242470744667`*^9, 
   3.562724251126667*^9}, {3.562724462446533*^9, 3.56272447459702*^9}, {
   3.562724551828374*^9, 3.562724555951391*^9}, {3.562743312798285*^9, 
   3.562743314472831*^9}, {3.56274351330412*^9, 3.5627435161825323`*^9}, {
   3.56275197370514*^9, 3.562751981414851*^9}, {3.562754123015819*^9, 
   3.562754143698225*^9}, {3.562754639067143*^9, 3.562754641037011*^9}, {
   3.5627548893709393`*^9, 3.562754918806196*^9}, {3.562755034488648*^9, 
   3.562755045956657*^9}, {3.5627550976712627`*^9, 3.562755109359417*^9}, {
   3.562759153173294*^9, 3.5627591616653223`*^9}, {3.562787717870493*^9, 
   3.562787765861047*^9}, {3.562787900636407*^9, 3.562787917224205*^9}, {
   3.562924361208345*^9, 3.562924370691825*^9}, {3.562924555885997*^9, 
   3.56292456114419*^9}, {3.562924925167982*^9, 3.562924939085814*^9}, {
   3.562925472278266*^9, 3.5629254849219847`*^9}, {3.56292973982189*^9, 
   3.562929832142902*^9}, {3.5629298711568747`*^9, 3.5629299033433332`*^9}, {
   3.5629299688824387`*^9, 3.5629299998406363`*^9}, {3.562930098802923*^9, 
   3.562930139365468*^9}, {3.562930189657695*^9, 3.562930249839354*^9}, {
   3.562930350985261*^9, 3.562930351099258*^9}, {3.562930385651639*^9, 
   3.562930513200095*^9}, {3.562930564347033*^9, 3.562930814085639*^9}, {
   3.5629309975454617`*^9, 3.562930997700026*^9}, 3.5629313048795567`*^9, {
   3.5629313648168983`*^9, 3.562931468412827*^9}, {3.562932078136093*^9, 
   3.562932093100065*^9}, {3.5629321949221582`*^9, 3.562932392086041*^9}, {
   3.5629598338352823`*^9, 3.562959911998975*^9}, {3.5629610984485903`*^9, 
   3.5629611113128767`*^9}, {3.562961157129302*^9, 3.562961211830522*^9}, {
   3.562961251995676*^9, 3.562961280787471*^9}, {3.562966547091543*^9, 
   3.5629665560253267`*^9}, {3.563075053533147*^9, 3.5630750778980722`*^9}, {
   3.563099756783924*^9, 3.56309978546741*^9}, {3.563104783715753*^9, 
   3.563104784992124*^9}, {3.563106230326301*^9, 3.563106302250153*^9}, {
   3.56310634013666*^9, 3.563106371754697*^9}, {3.563107815287449*^9, 
   3.563107824005142*^9}, {3.563107902573161*^9, 3.5631080144397783`*^9}, {
   3.563112980113538*^9, 3.563113010193359*^9}, {3.5631254105293703`*^9, 
   3.563125413527244*^9}, {3.5631258877827053`*^9, 3.563125888250585*^9}, {
   3.563128412001521*^9, 3.5631284124554663`*^9}, {3.563128605406744*^9, 
   3.56312860573884*^9}, {3.563128672624258*^9, 3.563128673241379*^9}, {
   3.563128716622645*^9, 3.563128717282423*^9}, {3.563128788894424*^9, 
   3.563128809110568*^9}, {3.563128868358789*^9, 3.5631289030148153`*^9}, {
   3.563132165187447*^9, 3.563132178264461*^9}, {3.563133200976618*^9, 
   3.563133214330936*^9}, {3.563133999553082*^9, 3.563134010103807*^9}, 
   3.563134675324318*^9, {3.563135296367051*^9, 3.56313534370252*^9}, {
   3.5631356313755217`*^9, 3.5631356669813833`*^9}, {3.5631362250543137`*^9, 
   3.563136245962693*^9}, {3.563137758396996*^9, 3.563137769933936*^9}, {
   3.563137915966798*^9, 3.5631379293752527`*^9}, {3.5631381744414387`*^9, 
   3.563138188048421*^9}, {3.5631383392336407`*^9, 3.563138363462296*^9}, {
   3.563138493730894*^9, 3.563138496093891*^9}, {3.563166081926073*^9, 
   3.563166109054715*^9}, {3.5631944916910753`*^9, 3.5631944926956*^9}, {
   3.563275141709092*^9, 3.5632751529150057`*^9}, {3.563275213563279*^9, 
   3.563275222414638*^9}, {3.563275295947709*^9, 3.563275298905879*^9}, {
   3.563275924751256*^9, 3.5632759987972918`*^9}, {3.563276039993684*^9, 
   3.563276220991413*^9}, {3.563276297564912*^9, 3.563276299904755*^9}, {
   3.563276387690424*^9, 3.563276427404932*^9}, {3.563276572221343*^9, 
   3.563276585449617*^9}, {3.5632767096753263`*^9, 3.563276724496718*^9}, {
   3.5632768740031137`*^9, 3.563276876679364*^9}, {3.563277222192691*^9, 
   3.563277224472011*^9}, {3.5632776947416773`*^9, 3.563277711997283*^9}, {
   3.563278799935533*^9, 3.563278803903049*^9}, {3.5632792833154*^9, 
   3.563279288546487*^9}, {3.563280299153226*^9, 3.5632802998713913`*^9}, {
   3.5632834970820627`*^9, 3.5632834989828253`*^9}, {3.5632835946678677`*^9, 
   3.5632835964395943`*^9}, {3.5632837906833773`*^9, 
   3.5632837933587637`*^9}, {3.563286076544973*^9, 3.563286078712057*^9}, {
   3.563300628282281*^9, 3.56330063077656*^9}, {3.563363873858404*^9, 
   3.563363875658601*^9}, {3.563364143459044*^9, 3.5633642296063557`*^9}, {
   3.563364337977612*^9, 3.5633643481957283`*^9}, {3.563364481679668*^9, 
   3.563364483670712*^9}, {3.563422653256981*^9, 3.563422684933928*^9}, {
   3.56342277165441*^9, 3.563422783282336*^9}, {3.563428875964278*^9, 
   3.563428878037383*^9}, {3.56342893619569*^9, 3.563428952241592*^9}, {
   3.563429207654276*^9, 3.563429209300907*^9}, {3.563529364663702*^9, 
   3.563529367004324*^9}, {3.5636113229328938`*^9, 3.563611323721348*^9}, {
   3.563611406319326*^9, 3.563611408570961*^9}, {3.563611557920388*^9, 
   3.5636115753435287`*^9}, {3.563611691845193*^9, 3.5636117090284557`*^9}, {
   3.563611754413916*^9, 3.5636117557466927`*^9}, {3.5636958229668627`*^9, 
   3.563695847391666*^9}, {3.563703745020031*^9, 3.5637038124683447`*^9}, {
   3.5637038877924347`*^9, 3.5637038930070257`*^9}, {3.563735810134663*^9, 
   3.563735817022429*^9}, {3.56373585543041*^9, 3.563735869967783*^9}, 
   3.5637368424270678`*^9, {3.563779124215477*^9, 3.563779128481639*^9}, {
   3.563779372641891*^9, 3.563779372774618*^9}, {3.563779420817038*^9, 
   3.5637794381600723`*^9}, {3.5637794698856916`*^9, 3.563779473742277*^9}, {
   3.563779518501584*^9, 3.563779527265594*^9}, {3.563782535395916*^9, 
   3.56378257172476*^9}, {3.563864525760388*^9, 3.563864528459379*^9}, {
   3.563864576828908*^9, 3.563864622688816*^9}, {3.564473911002468*^9, 
   3.564473949595871*^9}, {3.5644739817380257`*^9, 3.564474001735437*^9}, {
   3.5646739635495777`*^9, 3.564674013431754*^9}, {3.5647162270702553`*^9, 
   3.564716232019672*^9}, {3.5647180502545023`*^9, 3.5647181508097353`*^9}, {
   3.564723512364748*^9, 3.564723519685564*^9}, 3.5647264324897547`*^9, {
   3.564741603872278*^9, 3.5647416782152348`*^9}, {3.564742739145115*^9, 
   3.5647427408510313`*^9}, {3.565757407824024*^9, 3.565757436064479*^9}, {
   3.5657575433625*^9, 3.5657575675018177`*^9}, {3.565775736390414*^9, 
   3.565775747484123*^9}, {3.565775854378147*^9, 3.5657758702573357`*^9}, {
   3.56577605850508*^9, 3.565776066291005*^9}, {3.566195105012026*^9, 
   3.56619510746598*^9}, {3.566316769636467*^9, 3.566316771081727*^9}, {
   3.566319986887335*^9, 3.566319987742495*^9}, {3.566462400110733*^9, 
   3.56646240351893*^9}, {3.566462783386338*^9, 3.566462788635701*^9}, 
   3.566553713460786*^9, {3.566554399374387*^9, 3.566554399699376*^9}, 
   3.5668391181609173`*^9, {3.5668391765175447`*^9, 3.566839181169099*^9}, 
   3.56683924865758*^9, {3.566839533645709*^9, 3.5668395345625343`*^9}, {
   3.5668396216629553`*^9, 3.566839623871632*^9}, {3.566888743922052*^9, 
   3.5668887689097033`*^9}, {3.56688977429265*^9, 3.566889788062509*^9}, {
   3.566895717228693*^9, 3.5668958047142763`*^9}, {3.566895848605493*^9, 
   3.56689587616502*^9}, {3.566895907988832*^9, 3.566895948797351*^9}, {
   3.5668960183395767`*^9, 3.566896019521368*^9}, {3.5668970434663877`*^9, 
   3.5668970828077393`*^9}, 3.566897933528007*^9, {3.566901089452368*^9, 
   3.566901194362213*^9}, {3.566921837228917*^9, 3.566921840901888*^9}, {
   3.566921901381669*^9, 3.566921980346198*^9}, {3.566922015359027*^9, 
   3.56692221625863*^9}, {3.566922749345256*^9, 3.5669228428527737`*^9}, {
   3.566923031557349*^9, 3.56692303690552*^9}, {3.56692314231777*^9, 
   3.566923146318228*^9}, {3.56692321949275*^9, 3.566923230926359*^9}, {
   3.566923324392996*^9, 3.5669233550814667`*^9}, {3.566923575012064*^9, 
   3.566923580748774*^9}, 3.5669238096101513`*^9, 3.5669238987566223`*^9, {
   3.566923937396764*^9, 3.566923955097643*^9}, {3.567257901219534*^9, 
   3.567257901483754*^9}, {3.567258807055728*^9, 3.567258807216021*^9}, {
   3.567260762047367*^9, 3.567260764786293*^9}, {3.567262239291872*^9, 
   3.567262271651061*^9}, {3.567407885746648*^9, 3.5674078882409353`*^9}, {
   3.5674079200060053`*^9, 3.5674080383079853`*^9}, {3.5674080839941177`*^9, 
   3.5674080893613253`*^9}, {3.567488422040442*^9, 3.567488424916319*^9}, {
   3.567489526654704*^9, 3.567489533340694*^9}, {3.56749121919407*^9, 
   3.5674914222406*^9}, {3.56749150399662*^9, 3.5674916357932987`*^9}, {
   3.5674917144372873`*^9, 3.567491714989545*^9}, {3.567491758932519*^9, 
   3.5674918395607567`*^9}, {3.567491887055853*^9, 3.567491890245984*^9}, {
   3.567491990247847*^9, 3.5674919946184797`*^9}, {3.56749205753582*^9, 
   3.567492135264955*^9}, {3.567492191368354*^9, 3.56749221859832*^9}, {
   3.567492273498151*^9, 3.567492367717598*^9}, {3.567492408193284*^9, 
   3.5674924766858797`*^9}, {3.567493824962648*^9, 3.567494004306593*^9}, {
   3.567494272566247*^9, 3.567494283986788*^9}, {3.567494315004974*^9, 
   3.567494354863758*^9}, {3.567494472604836*^9, 3.567494499045637*^9}, 
   3.567496390440151*^9, {3.567497730562791*^9, 3.567497860249433*^9}, {
   3.5674984352990227`*^9, 3.567498455585763*^9}, 3.567498490915112*^9, {
   3.5674988502683764`*^9, 3.567498909932547*^9}, {3.567499018965275*^9, 
   3.567499032004717*^9}, {3.567575584626779*^9, 3.5675755884938393`*^9}, {
   3.5675759643165827`*^9, 3.5675760013229637`*^9}, {3.567576162969933*^9, 
   3.567576165178754*^9}, {3.5676734343879232`*^9, 3.567673440283094*^9}, {
   3.56782577497579*^9, 3.567825839745961*^9}, {3.567826072268448*^9, 
   3.567826081954917*^9}, {3.567826126645679*^9, 3.5678261288039103`*^9}, {
   3.567826319421505*^9, 3.5678263458669147`*^9}, {3.567826419742731*^9, 
   3.56782642014573*^9}, {3.567826773178334*^9, 3.5678267792981253`*^9}, {
   3.567826881544755*^9, 3.567826894300404*^9}, {3.5679164995276957`*^9, 
   3.567916501907238*^9}, {3.567916533864748*^9, 3.5679166512585907`*^9}, {
   3.567916699134181*^9, 3.567916703869693*^9}, {3.567929246592457*^9, 
   3.5679292646730337`*^9}, {3.568298413772201*^9, 3.568298415011176*^9}, {
   3.5682984802588043`*^9, 3.5682984842557907`*^9}, {3.5683660061125402`*^9, 
   3.568366009674983*^9}, {3.568435006571795*^9, 3.568435149227395*^9}, {
   3.568435721172571*^9, 3.568435728716362*^9}, {3.568436477627718*^9, 
   3.568436489561583*^9}, {3.5684406970711937`*^9, 3.568440732726288*^9}, {
   3.568440776498047*^9, 3.568440856384028*^9}, {3.568440961104965*^9, 
   3.568440964542666*^9}, {3.56854577456466*^9, 3.5685457750613813`*^9}, 
   3.5691323644970827`*^9, {3.569329068105564*^9, 3.569329101295788*^9}, {
   3.569329131853119*^9, 3.569329139081223*^9}, {3.569666627488803*^9, 
   3.5696666545754137`*^9}, {3.5696667076180763`*^9, 3.56966672127325*^9}, {
   3.569668281093363*^9, 3.569668281191781*^9}, {3.5696683208340483`*^9, 
   3.569668395485609*^9}, {3.569668433305608*^9, 3.569668455262323*^9}, {
   3.569668703298005*^9, 3.569668745227189*^9}, {3.569669108847966*^9, 
   3.5696691492963953`*^9}, {3.569833655343791*^9, 3.5698336987332897`*^9}, {
   3.569833754950142*^9, 3.569833756987421*^9}, 3.5698981355077744`*^9, 
   3.569898240803005*^9, {3.569898604625613*^9, 3.5698986161920033`*^9}, {
   3.569926722466926*^9, 3.569926725696066*^9}, {3.5699284020853863`*^9, 
   3.569928402772249*^9}, {3.570510977714938*^9, 3.570510978599663*^9}, {
   3.570511184750434*^9, 3.570511184900507*^9}, {3.573278849023085*^9, 
   3.573278970811399*^9}, {3.573279030565385*^9, 3.573279159472487*^9}}],

Cell["\<\

DefProjectedTensorPropertiesAnyIndices:\
\>", "Text",
 CellChangeTimes->{{3.566040282546426*^9, 3.566040296792358*^9}, 
   3.566040361736294*^9, 3.5663200053324213`*^9, {3.566462776983321*^9, 
   3.56646277812514*^9}, {3.566839214516988*^9, 3.566839216458256*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"**", " ", 
    RowBox[{"MODULE", ":", " ", "DefProjectedTensorPropertiesAnyIndices"}]}], 
   " ", "***)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DefProjectedTensorPropertiesAnyIndices", "[", 
    RowBox[{"Name_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", "Properties_List", ",", 
     "Spacetimes_List"}], "]"}], ":=", 
   RowBox[{"Catch", "@", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"g", "=", 
           RowBox[{"First", "@", 
            RowBox[{"InducedFrom", "@", "h"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"n", "=", 
           RowBox[{"Last", "@", 
            RowBox[{"InducedFrom", "@", "h"}]}]}], ",", "\[IndentingNewLine]",
           "\[IndentingNewLine]", 
          RowBox[{"cd", "=", 
           RowBox[{"CovDOfMetric", "[", "h", "]"}]}]}], "}"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"M", "=", 
             RowBox[{"ManifoldOfCovD", "[", 
              RowBox[{"CovDOfMetric", "[", "g", "]"}], "]"}]}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"SymmetricBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Properties", ",", "\"\<SymmetricTensor\>\""}], "]"}],
                "===", 
               RowBox[{"{", "\"\<SymmetricTensor\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"TracelessBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Properties", ",", "\"\<Traceless\>\""}], "]"}], "===", 
               RowBox[{"{", "\"\<Traceless\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"TransverseBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Properties", ",", "\"\<Transverse\>\""}], "]"}], "===", 
               RowBox[{"{", "\"\<Transverse\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"BackgroundBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Spacetimes", ",", "\"\<Background\>\""}], "]"}], "===", 
               RowBox[{"{", "\"\<Background\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PerturbedBool", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Cases", "[", 
                RowBox[{"Spacetimes", ",", "\"\<Perturbed\>\""}], "]"}], "===", 
               RowBox[{"{", "\"\<Perturbed\>\"", "}"}]}], ")"}]}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"ToCan", "=", 
             RowBox[{
              RowBox[{"ToCanonical", "[", 
               RowBox[{"#", ",", 
                RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], "]"}], 
              "&"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"DefProjectedTensorQ", "[", 
             RowBox[{"Name", ",", "h"}], "]"}], "^=", "True"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"InducedMetricOf", "[", "Name", "]"}], "^=", "h"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"DefProjectedTensorQ", "[", "Name", "]"}], "===", 
              "False"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"PropertiesList", "[", "Name", "]"}], "^=", 
               "\[IndentingNewLine]", 
               RowBox[{"Join", "[", 
                RowBox[{"Properties", ",", 
                 RowBox[{"{", 
                  RowBox[{
                  "\"\<Scalar\>\"", ",", "\"\<Vector\>\"", ",", 
                   "\"\<Tensor\>\""}], "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Name", "[", 
                RowBox[{"indices___", "?", "AIndexQ"}], "]"}], ":=", 
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", "0", "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "indices"}], "]"}]}], 
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", 
                  RowBox[{"p_", "?", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                    ")"}]}], "]"}], ",", 
                 RowBox[{"indices___", "?", "AIndexQ"}]}], "]"}], ":=", 
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", "p", "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "indices"}], "]"}]}], 
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "The", " ", "following", " ", "rule", " ", "provides", " ", 
                "the", " ", "symmetry", " ", 
                RowBox[{"property", "."}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{"SymmetricBool", ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"SymmetryGroupOfTensor", "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p_", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices__"}], "]"}],
                    "]"}], "^:=", 
                  RowBox[{"Symmetric", "[", 
                   RowBox[{
                    RowBox[{"2", "+", 
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "@", 
                    RowBox[{"{", "indices", "}"}]}]}]}], ",", "Cycles"}], 
                   "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "The", " ", "following", " ", "rules", " ", "provide", " ", 
                "the", " ", "traceless", " ", 
                RowBox[{"property", "."}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
               "TracelessBool", ",", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Name", "/:", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    "Dum_", ",", "indices2___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices3___"}], "]"}], ":=", 
                  "0"}], " ", ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices2___", ",", "Dum_", 
                    ",", "indices3___"}], "]"}], ":=", "0"}], " ", ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum_", 
                    ",", "indices2___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices3___"}], "]"}], ":=", 
                  "\[IndentingNewLine]", 
                  RowBox[{"Module", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "}"}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Dummy1", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Dummy2", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{"ToCan", "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    "Dum", ",", "indices2", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices3"}], "]"}], "]"}], 
                    "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", "+", 
                    
                    RowBox[{"2", " ", "*", " ", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dummy1"}], ",", "indices2", ",", 
                    RowBox[{"-", "Dummy2"}], ",", "indices3"}], "]"}], 
                    RowBox[{
                    RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "]"}]}]}], ")"}]}]}]}],
                    "\[IndentingNewLine]", " ", "\[IndentingNewLine]", 
                   "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum_"}], ",", "indices2___", ",", "Dum_", 
                    ",", "indices3___"}], "]"}], ":=", "\[IndentingNewLine]", 
                  
                  RowBox[{"Module", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "}"}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Dummy1", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Dummy2", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{"ToCan", "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    "Dum", ",", "indices2", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices3"}], "]"}], "]"}], 
                    "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", "+", 
                    
                    RowBox[{"2", " ", "*", " ", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dummy1"}], ",", "indices2", ",", 
                    RowBox[{"-", "Dummy2"}], ",", "indices3"}], "]"}], 
                    RowBox[{
                    RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
                    RowBox[{"Dummy1", ",", "Dummy2"}], "]"}]}]}], ")"}]}]}]}],
                    "\[IndentingNewLine]", " ", "\[IndentingNewLine]", 
                   "]"}]}], ";"}]}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
                    ",", "indices2___", ",", "Dum2_", ",", "indices3___"}], 
                    "]"}], 
                   RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "Dum1_"}], ",", 
                    RowBox[{"-", "Dum2_"}]}], "]"}]}], ":=", "0"}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
                    ",", "indices2___", ",", "Dum2_", ",", "indices3___"}], 
                    "]"}], 
                   RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "Dum2_"}], ",", 
                    RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", "0"}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___", ",", 
                    RowBox[{"-", "Dum2_"}], ",", "indices3___"}], "]"}], 
                   RowBox[{"g", "[", 
                    RowBox[{"Dum1_", ",", "Dum2_"}], "]"}]}], ":=", "0"}], 
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                    RowBox[{"-", "Dum1_"}], ",", "indices2___", ",", 
                    RowBox[{"-", "Dum2_"}], ",", "indices3___"}], "]"}], 
                   RowBox[{"g", "[", 
                    RowBox[{"Dum2_", ",", "Dum1_"}], "]"}]}], ":=", "0"}], 
                 ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", "*)"}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"PerturbationOrder", "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "0", "]"}], ",", 
                  RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], "]"}], 
                "]"}], "^:=", 
               RowBox[{"Catch", "@", 
                RowBox[{"Module", "[", 
                 RowBox[{
                  RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"AIndexQ", "/@", 
                    RowBox[{"{", "indices", "}"}]}], ",", "False"}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The indices of the tensor \>\"", ",", 
                    " ", "Name", ",", 
                    "\"\< have to be abstract indices.\>\""}], "]"}], "]"}]}],
                     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ")"}], ",", 
                    "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The second label-index has to be a \
positive integer.\>\"", "]"}], "]"}], "]"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"NumericQ", "[", "q", "]"}], ",", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The second label-index has to be a \
positive integer.\>\"", "]"}], "]"}]}], "]"}]}], "]"}]}]}], 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]}], ";",
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"TO", " ", 
                RowBox[{"DO", ":", " ", 
                 RowBox[{
                 "We", " ", "here", " ", "have", " ", "to", " ", "comment", 
                  " ", "on", " ", "the", " ", "commutation", " ", "between", 
                  " ", "perturbing", " ", "and", " ", "Lie", " ", 
                  RowBox[{"deriving", ".", " ", "This"}], " ", "commutation", 
                  " ", "stems", " ", "from", " ", "the", " ", "fact", " ", 
                  "that", " ", "the", " ", "Lie", " ", "derivative", " ", 
                  "is", " ", "a", " ", "background", " ", "Lie", " ", 
                  RowBox[{"derivative", "."}]}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
               "PerturbedBool", ",", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                  RowBox[{
                  "For", " ", "any", " ", "perturbed", " ", "tensors"}], ",", 
                  " ", 
                  RowBox[{"we", " ", 
                   RowBox[{"have", ":"}]}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"PerturbationOrder", "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p_", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                    "]"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"AIndexQ", "/@", 
                    RowBox[{"{", "indices", "}"}]}], ",", "False"}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The indices of the tensor \>\"", ",", 
                    " ", "Name", ",", 
                    "\"\< have to be abstract indices.\>\""}], "]"}], "]"}]}],
                     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "p", "]"}], "&&", 
                    RowBox[{"p", "\[GreaterEqual]", "1"}]}], ")"}], "&&", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ")"}]}], ",", 
                    "\[IndentingNewLine]", "p", ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The label-indices have to be positive \
integers.\>\"", "]"}], "]"}], "]"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"NumericQ", "[", "p", "]"}], "&&", 
                    RowBox[{"NumericQ", "[", "q", "]"}]}], ",", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The label-indices have to be positive \
integers.\>\"", "]"}], "]"}]}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                   RowBox[{"The", " ", "rule", " ", 
                    RowBox[{"for", " ", "'"}], "p"}], " ", "=", " ", 
                   RowBox[{
                    RowBox[{"0", "'"}], " ", "is", " ", "defined", " ", "at", 
                    " ", "the", " ", "beginning", " ", "of", " ", "the", " ", 
                    
                    RowBox[{"module", "."}]}]}], " ", "*)"}], 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                   RowBox[{
                   "and", " ", "for", " ", "perturbed", " ", "scalar", " ", 
                    "quantities"}], ",", " ", 
                   RowBox[{"we", " ", 
                    RowBox[{"have", ":"}]}]}], " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Perturbation", "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p_", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}]}], "]"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "p", "]"}], "&&", 
                    RowBox[{"p", "\[GreaterEqual]", "0"}]}], ")"}], "&&", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ")"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p", "+", "1"}], "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The label-indices have to be positive \
integers.\>\"", "]"}], "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Perturbation", "[", 
                   RowBox[{
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p_", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}]}], "]"}], ",", 
                    "PertOrder_"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "[", 
                    RowBox[{"IntegerQ", "[", "PertOrder", "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The order of the perturbation has to be \
an integer.\>\"", "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "p", "]"}], "&&", 
                    RowBox[{"p", "\[GreaterEqual]", "0"}]}], ")"}], "&&", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ")"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p", "+", "PertOrder"}], "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The label-indices have to be positive \
integers.\>\"", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}], ";"}]}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "For", " ", "tensors", " ", "living", " ", "on", " ", "the", 
                 " ", "background", " ", "only"}], ",", " ", 
                RowBox[{"we", " ", 
                 RowBox[{"have", ":"}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"BackgroundBool", "&&", 
                 RowBox[{"Not", "[", "PerturbedBool", "]"}]}], ",", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Perturbation", "[", 
                   RowBox[{
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                    "]"}], ",", "PertOrder_"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"AIndexQ", "/@", 
                    RowBox[{"{", "indices", "}"}]}], ",", "False"}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The indices of the tensor \>\"", ",", 
                    " ", "Name", ",", 
                    "\"\< have to be abstract indices.\>\""}], "]"}], "]"}]}],
                     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"Not", "[", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The second label-index has to be a \
positive integer.\>\"", "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"PertOrder", "===", "0"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices"}], "]"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "PertOrder", "]"}], "&&", 
                    RowBox[{"PertOrder", "\[GreaterEqual]", "1"}]}], ")"}], 
                    ",", "\[IndentingNewLine]", "0", ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The order of the perturbation has to be \
a positive integer.\>\"", "]"}], "]"}]}], "]"}]}], "]"}]}]}], 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]}], 
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Perturbation", "[", 
                   RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                    "]"}], "]"}], "^:=", 
                  RowBox[{"Catch", "@", 
                   RowBox[{"Module", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"AIndexQ", "/@", 
                    RowBox[{"{", "indices", "}"}]}], ",", "False"}], "]"}], "=!=", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<** Warning: The indices of the tensor \>\"", ",", 
                    " ", "Name", ",", 
                    "\"\< have to be abstract indices.\>\""}], "]"}], "]"}]}],
                     "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "q", "]"}], "&&", 
                    RowBox[{"q", "\[GreaterEqual]", "0"}]}], ",", 
                    "\[IndentingNewLine]", "0", ",", "\[IndentingNewLine]", 
                    RowBox[{"Throw", "[", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: The second label-index has to be a \
positive integer.\>\"", "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}], ";", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"Name", "/:", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], "&"}], 
                    ")"}]}], "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                   "]"}], ":=", "0"}]}]}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"For", " ", "perturbations", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"i", ".", "e", ".", " ", "for"}], " ", "tensors", 
                   " ", "without", " ", "background", " ", "values"}], 
                  ")"}]}], ",", " ", 
                RowBox[{"we", " ", 
                 RowBox[{"have", ":"}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Not", "[", "BackgroundBool", "]"}], "&&", 
                 "PerturbedBool"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Name", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "0", "]"}], ",", 
                   RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                    ")"}]}], "]"}], ",", 
                   RowBox[{"indices___", "?", "AIndexQ"}]}], "]"}], ":=", 
                 "0"}]}], "]"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"DefProjectedTensorQ", "[", "Name", "]"}], "^=", 
               "True"}], ";"}]}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"PropertiesList", "[", "Name", "]"}], "^=", 
            "\[IndentingNewLine]", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"PropertiesList", "[", "Name", "]"}], ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                "SymmetricBool", "&&", "TracelessBool", "&&", 
                 "TransverseBool"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                  "\"\<SVT-Vector associated with the induced metric \>\"", 
                   "h", "\"\<\>\""}], ",", 
                  RowBox[{
                  "\"\<SVT-Tensor associated with the induced metric \>\"", 
                   "h", "\"\<\>\""}]}], "}"}], ",", 
                RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "The", " ", "Lie", " ", "derivative", " ", "for", " ", "tensors",
               " ", "with", " ", "indices", " ", 
              StyleBox["down",
               FontVariations->{"Underline"->True}], " ", "is", " ", 
              "represented", " ", "by", " ", "the", " ", "second", " ", 
              "label"}], "-", 
             RowBox[{"index", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"LieD", "[", 
              RowBox[{"n", "[", "Dum_", "]"}], "]"}], "[", 
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"indices___", "?", "DownIndexQ"}]}], "]"}], "]"}], ":=", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"$ConformalTime", ",", "1", ",", 
               RowBox[{
                RowBox[{"a", "[", "h", "]"}], "[", "]"}]}], "]"}], "*", 
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", "p", "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q", "+", "1"}], "]"}], ",", "indices"}], "]"}]}]}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"We", " ", "bypass", " ", "OrthogonalToVectorQ"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"OrthogonalToVectorQ", "[", "n", "]"}], "[", "Name", 
             "]"}], "=", "True"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "The", " ", "contraction", " ", "with", " ", "the", " ", 
              "vector", " ", "normal", " ", "to", " ", "the", " ", 
              "hypersurfaces", " ", "gives", " ", "0", " ", 
              RowBox[{"(", 
               RowBox[{
               "since", " ", "the", " ", "tensor", " ", "is", " ", 
                "projected"}], ")"}]}], ":"}], " ", "*)"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum_", 
               ",", "indices2___"}], "]"}], 
             RowBox[{"n", "[", 
              RowBox[{"-", "Dum_"}], "]"}]}], ":=", "0"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
               RowBox[{"-", "Dum_"}], ",", "indices2___"}], "]"}], 
             RowBox[{"n", "[", "Dum_", "]"}]}], ":=", "0"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "and", " ", "the", " ", "action", " ", "of", " ", "the", " ", 
             "projector", " ", "onto", " ", "the", " ", "hypersurfaces", " ", 
             "is", " ", "an", " ", "invariant", " ", 
             RowBox[{"operation", ":"}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"Old", " ", "implementation"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Name", "/:", 
              RowBox[{
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", 
                  RowBox[{"p_", "?", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                 "Dum1_", ",", "indices2___"}], "]"}], 
               RowBox[{"h", "[", 
                RowBox[{
                 RowBox[{"-", "Dum1_"}], ",", "Dum2_"}], "]"}]}], ":=", 
              RowBox[{"Name", "[", 
               RowBox[{
                RowBox[{"LI", "[", "p", "]"}], ",", 
                RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", "Dum2", 
                ",", "indices2"}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"Name", "/:", 
              RowBox[{
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", 
                  RowBox[{"p_", "?", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                 "Dum1_", ",", "indices2___"}], "]"}], 
               RowBox[{"h", "[", 
                RowBox[{"Dum2_", ",", 
                 RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
              RowBox[{"Name", "[", 
               RowBox[{
                RowBox[{"LI", "[", "p", "]"}], ",", 
                RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", "Dum2", 
                ",", "indices2"}], "]"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"Name", "/:", 
              RowBox[{
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", 
                  RowBox[{"p_", "?", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                 RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
               RowBox[{"h", "[", 
                RowBox[{"Dum1_", ",", "Dum2_"}], "]"}]}], ":=", 
              RowBox[{"Name", "[", 
               RowBox[{
                RowBox[{"LI", "[", "p", "]"}], ",", 
                RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", "Dum2", 
                ",", "indices2"}], "]"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"Name", "/:", 
              RowBox[{
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", 
                  RowBox[{"p_", "?", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                 RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
               RowBox[{"h", "[", 
                RowBox[{"Dum2_", ",", "Dum1_"}], "]"}]}], ":=", 
              RowBox[{"Name", "[", 
               RowBox[{
                RowBox[{"LI", "[", "p", "]"}], ",", 
                RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", "Dum2", 
                ",", "indices2"}], "]"}]}], ";"}], "*)"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$Rulecdh", "[", "h", "]"}], "=", 
            RowBox[{"Append", "[", 
             RowBox[{
              RowBox[{"$Rulecdh", "[", "h", "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                  "Dum1_", ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{
                  RowBox[{"-", "Dum1_"}], ",", 
                  RowBox[{"-", "Dum2_"}]}], "]"}]}], ":>", 
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", "p", "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
                 RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}]}]}], " ", 
             "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"$Rulecdh", "[", "h", "]"}], "=", 
            RowBox[{"Append", "[", 
             RowBox[{
              RowBox[{"$Rulecdh", "[", "h", "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
                RowBox[{"h", "[", 
                 RowBox[{
                  RowBox[{"Dum1_", "?", "UpIndexQ"}], ",", 
                  RowBox[{"Dum2_", "?", "UpIndexQ"}]}], "]"}]}], ":>", 
               RowBox[{"Name", "[", 
                RowBox[{
                 RowBox[{"LI", "[", "p", "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", "Dum2", 
                 ",", "indices2"}], "]"}]}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
               "Dum1_", ",", "indices2___"}], "]"}], 
             RowBox[{"h", "[", 
              RowBox[{
               RowBox[{"-", "Dum1_"}], ",", 
               RowBox[{"Dum2_", "?", "UpIndexQ"}]}], "]"}]}], ":=", 
            RowBox[{"Name", "[", 
             RowBox[{
              RowBox[{"LI", "[", "p", "]"}], ",", 
              RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", "Dum2", 
              ",", "indices2"}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
               "Dum1_", ",", "indices2___"}], "]"}], 
             RowBox[{"h", "[", 
              RowBox[{
               RowBox[{"Dum2_", "?", "UpIndexQ"}], ",", 
               RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
            RowBox[{"Name", "[", 
             RowBox[{
              RowBox[{"LI", "[", "p", "]"}], ",", 
              RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", "Dum2", 
              ",", "indices2"}], "]"}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
               RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
             RowBox[{"h", "[", 
              RowBox[{"Dum1_", ",", 
               RowBox[{"-", "Dum2_"}]}], "]"}]}], ":=", 
            RowBox[{"Name", "[", 
             RowBox[{
              RowBox[{"LI", "[", "p", "]"}], ",", 
              RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
              RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
               RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
             RowBox[{"h", "[", 
              RowBox[{
               RowBox[{"-", "Dum2_"}], ",", "Dum1_"}], "]"}]}], ":=", 
            RowBox[{"Name", "[", 
             RowBox[{
              RowBox[{"LI", "[", "p", "]"}], ",", 
              RowBox[{"LI", "[", "0", "]"}], ",", "indices1", ",", 
              RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "When", " ", "there", " ", "are", " ", "Lie", " ", 
              "derivatives"}], ",", " ", 
             RowBox[{
             "h", " ", "contracted", " ", "automatically", " ", "only", " ", 
              "when", " ", "the", " ", "free", " ", "index", " ", "is", " ", 
              RowBox[{"down", ".", " ", "Otherwise"}], " ", "it", " ", 
              "requires", " ", "ContractMetric", " ", "to", " ", "perform", 
              " ", "contraction"}]}], " ", "*)"}], "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
               ",", "indices2___"}], "]"}], 
             RowBox[{"h", "[", 
              RowBox[{
               RowBox[{"-", "Dum1_"}], ",", 
               RowBox[{"-", "Dum2_"}]}], "]"}]}], ":=", 
            RowBox[{"Name", "[", 
             RowBox[{
              RowBox[{"LI", "[", "p", "]"}], ",", 
              RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
              RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
               ",", "indices2___"}], "]"}], 
             RowBox[{"h", "[", 
              RowBox[{
               RowBox[{"-", "Dum2_"}], ",", 
               RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
            RowBox[{"Name", "[", 
             RowBox[{
              RowBox[{"LI", "[", "p", "]"}], ",", 
              RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
              RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
               RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
             RowBox[{"h", "[", 
              RowBox[{"Dum1_", ",", 
               RowBox[{"-", "Dum2_"}]}], "]"}]}], ":=", 
            RowBox[{"Name", "[", 
             RowBox[{
              RowBox[{"LI", "[", "p", "]"}], ",", 
              RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
              RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
               RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
             RowBox[{"h", "[", 
              RowBox[{
               RowBox[{"-", "Dum2_"}], ",", "Dum1_"}], "]"}]}], ":=", 
            RowBox[{"Name", "[", 
             RowBox[{
              RowBox[{"LI", "[", "p", "]"}], ",", 
              RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
              RowBox[{"-", "Dum2"}], ",", "indices2"}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"g", " ", "to", " ", "h", "  ", "is", " ", "automatic"}], 
            " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
               ",", "indices2___"}], "]"}], 
             RowBox[{"g", "[", 
              RowBox[{
               RowBox[{"-", "Dum1_"}], ",", "Dum2_"}], "]"}]}], ":=", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", "p", "]"}], ",", 
               RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", "Dum1", 
               ",", "indices2"}], "]"}], 
             RowBox[{"h", "[", 
              RowBox[{
               RowBox[{"-", "Dum1"}], ",", "Dum2"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum1_", 
               ",", "indices2___"}], "]"}], 
             RowBox[{"g", "[", 
              RowBox[{"Dum2_", ",", 
               RowBox[{"-", "Dum1_"}]}], "]"}]}], ":=", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", "p", "]"}], ",", 
               RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", "Dum1", 
               ",", "indices2"}], "]"}], " ", 
             RowBox[{"h", "[", 
              RowBox[{"Dum2", ",", 
               RowBox[{"-", "Dum1"}]}], "]"}]}]}], ";", "\[IndentingNewLine]",
            "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
               RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
             RowBox[{"g", "[", 
              RowBox[{"Dum1_", ",", "Dum2_"}], "]"}]}], ":=", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", "p", "]"}], ",", 
               RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
               RowBox[{"-", "Dum1"}], ",", "indices2"}], "]"}], " ", 
             RowBox[{"h", "[", 
              RowBox[{"Dum1", ",", "Dum2"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], " ", 
                   "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
               RowBox[{"-", "Dum1_"}], ",", "indices2___"}], "]"}], 
             RowBox[{"g", "[", 
              RowBox[{"Dum2_", ",", "Dum1_"}], "]"}]}], ":=", 
            RowBox[{
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", "p", "]"}], ",", 
               RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
               RowBox[{"-", "Dum1"}], ",", "indices2"}], "]"}], " ", 
             RowBox[{"h", "[", 
              RowBox[{"Dum2", ",", "Dum1"}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"If", " ", "the", " ", "tensor", " ", "belongs", " ", 
              RowBox[{"(", 
               RowBox[{"at", " ", "least"}], ")"}], " ", "to", " ", "the", 
              " ", "perturbed", " ", "manifold"}], ",", " ", 
             RowBox[{
             "and", " ", "if", " ", "it", " ", "is", " ", "transverse"}], 
             ","}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"PerturbedBool", "&&", " ", "TransverseBool"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"(", 
               RowBox[{"transverse", " ", "property"}], ")"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", "Dum_", "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum_"}], ",", "indices2___"}], "]"}], "]"}], ":=",
                "0"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", 
                 RowBox[{"-", "Dum_"}], "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}], ",", "indices1___", ",", 
                  "Dum_", ",", "indices2___"}], "]"}], "]"}], ":=", "0"}], 
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"then", " ", "the", " ", "first", " ", 
                 RowBox[{"rule", ":", " ", 
                  RowBox[{
                   SuperscriptBox["D", "a"], 
                   SubscriptBox["\[ScriptCapitalL]", "n"], 
                   SubscriptBox["T", 
                    RowBox[{
                    RowBox[{"a", "..."}], " "}]]}]}]}], "=", " ", 
                RowBox[{
                 RowBox[{
                  SubscriptBox["\[ScriptCapitalL]", "n"], 
                  RowBox[{"(", 
                   RowBox[{
                    SuperscriptBox["D", "a"], 
                    SubscriptBox["T", 
                    RowBox[{"a", "..."}]]}], ")"}]}], " ", "-", " ", 
                 RowBox[{
                  SubscriptBox["\[ScriptCapitalL]", "n"], 
                  RowBox[{"(", 
                   SuperscriptBox["g", "ab"], ")"}], 
                  SubscriptBox["D", "b"], 
                  SubscriptBox[
                   SubscriptBox["T", "a"], "..."]}], " ", "+", " ", 
                 RowBox[{
                  RowBox[{
                   SuperscriptBox["g", "ab"], "[", 
                   RowBox[{
                    SubscriptBox["D", "b"], ",", 
                    SubscriptBox["\[ScriptCapitalL]", "n"]}], "]"}], 
                  SubscriptBox["T", 
                   RowBox[{"a", "..."}]]}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", "Dum_", "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"indices1___", "?", "DownIndexQ"}], ",", 
                  RowBox[{"-", "Dum_"}], ",", 
                  RowBox[{"indices2___", "?", "DownIndexQ"}]}], "]"}], "]"}], 
               ":=", 
               RowBox[{"Module", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"Dummy1", ",", "Dummy2"}], "}"}], ",", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Dummy1", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"Dummy2", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"ToCan", "@", 
                   RowBox[{
                   "ContractMetric", "[", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "Dum", "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    "-", " ", 
                    RowBox[{"ToCan", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"Dum", ",", "Dummy2"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], " ", "&"}]}], "]"}], 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", "+", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"Dum", ",", "Dummy2"}], "]"}], 
                    RowBox[{"ToCan", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "-", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]",
                 "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"and", " ", "the", " ", "second", " ", 
                 RowBox[{"rule", ":", " ", 
                  RowBox[{
                   SubscriptBox["D", "a"], 
                   SubscriptBox["\[ScriptCapitalL]", "n"], 
                   SubscriptBox[
                    SuperscriptBox["T", "a"], 
                    RowBox[{"...", " "}]]}]}]}], "=", " ", 
                RowBox[{
                 RowBox[{
                  SubscriptBox["\[ScriptCapitalL]", "n"], 
                  RowBox[{"(", 
                   RowBox[{
                    SuperscriptBox["D", "a"], 
                    SubscriptBox["T", 
                    RowBox[{"a", "..."}]]}], ")"}]}], " ", "-", " ", 
                 RowBox[{
                  SubscriptBox["\[ScriptCapitalL]", "n"], 
                  RowBox[{"(", 
                   SuperscriptBox["g", "ab"], ")"}], 
                  SubscriptBox["D", "b"], 
                  SubscriptBox[
                   SubscriptBox["T", "a"], "..."]}], " ", "+", " ", 
                 RowBox[{
                  RowBox[{
                   SuperscriptBox["g", "ab"], "[", 
                   RowBox[{
                    SubscriptBox["D", "b"], ",", 
                    SubscriptBox["\[ScriptCapitalL]", "n"]}], "]"}], 
                  SubscriptBox["T", 
                   RowBox[{"a", "..."}]]}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", 
                 RowBox[{"-", "Dum_"}], "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"indices1___", "?", "DownIndexQ"}], ",", "Dum_", 
                  ",", 
                  RowBox[{"indices2___", "?", "DownIndexQ"}]}], "]"}], "]"}], 
               ":=", 
               RowBox[{"Module", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"Dummy1", ",", "Dummy2"}], "}"}], ",", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Dummy1", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"Dummy2", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"ToCan", "@", 
                   RowBox[{
                   "ContractMetric", "[", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "Dum", "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    "-", " ", 
                    RowBox[{"ToCan", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"Dum", ",", "Dummy2"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], " ", "&"}]}], "]"}], 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", "+", " ", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"Dum", ",", "Dummy2"}], "]"}], 
                    RowBox[{"ToCan", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "-", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}], "*", 
                    
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dummy2"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q", "-", "1"}], "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], "]"}], 
                    "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]",
                 "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "If", " ", "the", " ", "indices", " ", "are", " ", "not", " ",
                  "down"}], ",", " ", 
                RowBox[{
                 RowBox[{"we", " ", "separate", " ", 
                  RowBox[{"them", ".", " ", "In"}], " ", "practice", " ", 
                  "this", " ", "happens", " ", "almost", " ", "never"}], 
                 "..."}]}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", "Dum_", "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                  RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices3___", 
                  ",", 
                  RowBox[{"-", "Dum_"}], ",", "indices2___"}], "]"}], "]"}], ":=", 
               RowBox[{"Module", "[", 
                RowBox[{
                 RowBox[{"{", "Dummy", "}"}], ",", 
                 RowBox[{
                  RowBox[{"Dummy", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "Dummy"}], "]"}], 
                   RowBox[{
                    RowBox[{"cd", "[", "Dum", "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dummy"}], ",", "indices3", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices2"}], "]"}], 
                    "]"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]",
                 "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", "Dum_", "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                  RowBox[{"-", "Dum_"}], ",", "indices3___", ",", 
                  RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices2___"}], 
                 "]"}], "]"}], ":=", 
               RowBox[{"Module", "[", 
                RowBox[{
                 RowBox[{"{", "Dummy", "}"}], ",", 
                 RowBox[{
                  RowBox[{"Dummy", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "Dummy"}], "]"}], 
                   RowBox[{
                    RowBox[{"cd", "[", "Dum", "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "indices3", ",", 
                    RowBox[{"-", "Dummy"}], ",", "indices2"}], "]"}], 
                    "]"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]",
                 "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", 
                 RowBox[{"-", "Dum_"}], "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", 
                  RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices3___", 
                  ",", "Dum_", ",", "indices2___"}], "]"}], "]"}], ":=", 
               RowBox[{"Module", "[", 
                RowBox[{
                 RowBox[{"{", "Dummy", "}"}], ",", 
                 RowBox[{
                  RowBox[{"Dummy", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "Dummy"}], "]"}], 
                   RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dum"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "Dummy"}], ",", "indices3", ",", "Dum", ",", 
                    "indices2"}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
                "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", 
                 RowBox[{"-", "Dum_"}], "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", 
                   RowBox[{"p_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], " ", "&&", " ", 
                    RowBox[{"#", "\[GreaterEqual]", "1"}]}], ")"}], " ", 
                    "&"}], ")"}]}], "]"}], ",", "indices1___", ",", "Dum_", 
                  ",", "indices3___", ",", 
                  RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices2___"}], 
                 "]"}], "]"}], ":=", 
               RowBox[{"Module", "[", 
                RowBox[{
                 RowBox[{"{", "Dummy", "}"}], ",", 
                 RowBox[{
                  RowBox[{"Dummy", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "Dummy"}], "]"}], 
                   RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "Dum"}], "]"}], "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    "Dum", ",", "indices3", ",", 
                    RowBox[{"-", "Dummy"}], ",", "indices2"}], "]"}], 
                    "]"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]",
                 "]"}]}], ";"}]}], "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"apply", ".", " ", "We"}], " ", "have", " ", "denoted", 
              " ", 
              RowBox[{"by", " ", "'"}], 
              RowBox[{"n", "'"}], " ", "the", " ", "vector", " ", "normal", 
              " ", "to", " ", "the", " ", 
              RowBox[{"hypersurfaces", ".", " ", "The"}], " ", 
              RowBox[{"commutator", " ", "[", 
               RowBox[{".", 
                RowBox[{",", "."}]}], "]"}], " ", "is", " ", "handle", " ", 
              "automatically", " ", "by", " ", "another", " ", "automatic", 
              " ", 
              RowBox[{"rule", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
              "The", " ", "following", " ", "rule", " ", "serves", " ", "to", 
               " ", "express", " ", "the", " ", "three"}], "-", 
              RowBox[{"covariant", " ", "derivative", " ", "of", " ", 
               RowBox[{"(", "homogeneous", ")"}], " ", "background", " ", 
               "quantities", " ", "in", " ", "terms", " ", "of", " ", "the", 
               " ", "connection", " ", 
               RowBox[{"components", ".", " ", "For"}], " ", "instance"}]}], 
             ",", " ", 
             RowBox[{"'", 
              SubscriptBox["D", "i"], 
              RowBox[{
               SubscriptBox["\[Omega]", "j"], "'"}], " ", "is", " ", 
              "replaced", " ", 
              RowBox[{"by", ":", " ", 
               RowBox[{"'", "-", " ", 
                RowBox[{
                 SubscriptBox[
                  SuperscriptBox["\[CapitalGamma]", "a"], "ij"], 
                 RowBox[{
                  RowBox[{
                   SubscriptBox["\[Omega]", "a"], "'"}], "."}]}]}]}]}]}], " ",
             "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
            "BackgroundBool", ",", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Name", "/:", 
               RowBox[{
                RowBox[{"cd", "[", "Dummy2_", "]"}], "[", 
                RowBox[{"Name", "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "0", "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                    ")"}]}], "]"}], ",", "indices___"}], "]"}], "]"}], ":=", 
               RowBox[{"Module", "[", 
                RowBox[{
                 RowBox[{"{", "Dummy1", "}"}], ",", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Dummy1", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"ToCan", "[", 
                   RowBox[{"Plus", "@@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"Dummy1", ",", "Dummy2", ",", "#"}], "]"}]}], 
                    RowBox[{"ReplaceIndex", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Name", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices"}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{"-", "Dummy1"}]}]}], "]"}]}], ")"}], "&"}], "/@", 
                    " ", 
                    RowBox[{"{", "indices", "}"}]}], ")"}]}], "]"}]}]}], 
                "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
              ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "Confer", " ", "the", " ", "function", " ", "SetSlicing", " ", 
             "for", " ", "the", " ", "definition", " ", 
             RowBox[{"of", " ", "'"}], 
             RowBox[{"Connection", "'"}], " ", "and", " ", "its", " ", 
             RowBox[{"properties", "."}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
             "Is", " ", "the", " ", "above", " ", "relation", " ", "correct", 
              " ", "for", " ", "space"}], "-", 
             RowBox[{"time", " ", 
              RowBox[{"indices", "?", " ", "To"}], " ", 
              RowBox[{"check", "!"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{"(*", " ", 
            RowBox[{"What", " ", "is", " ", "the", " ", "need", " ", 
             RowBox[{"for", " ", "'"}], 
             RowBox[{
              RowBox[{"Evaluate", "'"}], "?"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"In", " ", "principle"}], ",", " ", 
             RowBox[{
             "the", " ", "following", " ", "rule", " ", "needs", " ", "not", 
              " ", "to", " ", "be", " ", 
              RowBox[{"used", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Name", "/:", 
            RowBox[{
             RowBox[{"LieD", "[", 
              RowBox[{"n", "[", "Dummy1_", "]"}], "]"}], "[", 
             RowBox[{"Name", "[", 
              RowBox[{
               RowBox[{"LI", "[", 
                RowBox[{"p_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                  ")"}]}], "]"}], ",", 
               RowBox[{"LI", "[", 
                RowBox[{"q_", "?", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "0"}]}], ")"}], "&"}], 
                  ")"}]}], "]"}], ",", 
               RowBox[{"Indices1___", "?", "AIndexQ"}], ",", 
               RowBox[{"IndexUp_", "?", "UpIndexQ"}], ",", 
               RowBox[{"Indices2___", "?", "AIndexQ"}]}], "]"}], "]"}], ":=", 
            
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "Dum", "}"}], ",", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Dum", "=", 
                RowBox[{"DummyIn", "[", 
                 RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"g", "[", 
                  RowBox[{"IndexUp", ",", "Dum"}], "]"}], 
                 RowBox[{
                  RowBox[{"LieD", "[", 
                   RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                  RowBox[{"Name", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "Indices1", ",", 
                    RowBox[{"-", "Dum"}], ",", "Indices2"}], "]"}], "]"}]}], 
                "+", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"LieD", "[", 
                   RowBox[{"n", "[", "Dummy1", "]"}], "]"}], "[", 
                  RowBox[{"g", "[", 
                   RowBox[{"IndexUp", ",", "Dum"}], "]"}], "]"}], " ", 
                 RowBox[{"Name", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "p", "]"}], ",", 
                   RowBox[{"LI", "[", "q", "]"}], ",", "Indices1", ",", 
                   RowBox[{"-", "Dum"}], ",", "Indices2"}], "]"}]}]}]}]}], 
             "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.565671664010859*^9, 3.565671669158836*^9}, {
   3.565671754939118*^9, 3.5656718044796057`*^9}, {3.565671840855328*^9, 
   3.565671855327052*^9}, {3.565671896370674*^9, 3.565671960373829*^9}, {
   3.565673032855186*^9, 3.565673034528221*^9}, {3.565673163641577*^9, 
   3.565673173857786*^9}, {3.565673211082901*^9, 3.565673286427412*^9}, {
   3.565673323930553*^9, 3.565673746407466*^9}, {3.5656737886396103`*^9, 
   3.565673788852964*^9}, {3.565673857302664*^9, 3.565673859362425*^9}, {
   3.565673889432329*^9, 3.565673943022275*^9}, {3.5656740030540323`*^9, 
   3.565674003190529*^9}, {3.5656740424002743`*^9, 3.5656740446136837`*^9}, {
   3.565674137075171*^9, 3.565674159332285*^9}, {3.5656742046974277`*^9, 
   3.5656742265093946`*^9}, {3.5656743009374437`*^9, 3.56567431752841*^9}, {
   3.565674397840225*^9, 3.5656745065904007`*^9}, {3.5656754047120047`*^9, 
   3.5656754137642517`*^9}, {3.5656754843957863`*^9, 
   3.5656755171575193`*^9}, {3.5656755568001127`*^9, 3.565675591652499*^9}, {
   3.565677767052661*^9, 3.565677779917342*^9}, {3.565678165271062*^9, 
   3.565678178645184*^9}, {3.565678293992723*^9, 3.5656783419875402`*^9}, {
   3.5656783884507017`*^9, 3.56567840284308*^9}, {3.5656784384465523`*^9, 
   3.565678439147387*^9}, {3.5657575983010693`*^9, 3.5657576562774553`*^9}, {
   3.5657722000382442`*^9, 3.5657722116470203`*^9}, {3.565772357379745*^9, 
   3.565772367272676*^9}, {3.565772422884568*^9, 3.565772435770645*^9}, {
   3.5657740371619043`*^9, 3.565774068437495*^9}, {3.565775902864243*^9, 
   3.565775920590469*^9}, {3.5657760832359*^9, 3.5657762005196753`*^9}, {
   3.5661148150207357`*^9, 3.566114830520954*^9}, {3.5661950111817207`*^9, 
   3.5661950345990887`*^9}, {3.56646245543884*^9, 3.566462458367873*^9}, {
   3.5668392604977913`*^9, 3.5668392661641903`*^9}, {3.5668972234768143`*^9, 
   3.566897230485395*^9}, {3.566988144578044*^9, 3.566988156569263*^9}, {
   3.5672579073876038`*^9, 3.567257908523415*^9}, {3.567258810446865*^9, 
   3.567258810614983*^9}, {3.5672607712273073`*^9, 3.5672607739135523`*^9}, {
   3.56748842673608*^9, 3.5674884304799137`*^9}, {3.56749583512082*^9, 
   3.567495835788269*^9}, {3.567495867344246*^9, 3.567496028522582*^9}, {
   3.5674960710692663`*^9, 3.567496163318297*^9}, {3.567496205469983*^9, 
   3.567496303315851*^9}, {3.56749642224305*^9, 3.567496427045697*^9}, {
   3.5675761476858587`*^9, 3.567576150048071*^9}, {3.567576183499514*^9, 
   3.567576233908469*^9}, {3.567673450219624*^9, 3.567673457856845*^9}, {
   3.567826151158784*^9, 3.56782617273454*^9}, {3.5678262856293087`*^9, 
   3.567826294688092*^9}, {3.5678266520699883`*^9, 3.567826658709654*^9}, {
   3.567826757759583*^9, 3.567826761818695*^9}, {3.567826912834031*^9, 
   3.567826939342081*^9}, {3.567916756515285*^9, 3.5679167719842653`*^9}, {
   3.567916825820774*^9, 3.5679168372828903`*^9}, {3.5679292798330584`*^9, 
   3.567929302378005*^9}, {3.568298416789706*^9, 3.568298418451754*^9}, {
   3.568298492116839*^9, 3.56829849295883*^9}, {3.568366096960331*^9, 
   3.568366100001481*^9}, {3.568434511661578*^9, 3.568434553650033*^9}, {
   3.568434793653851*^9, 3.568434875251028*^9}, {3.568434960187436*^9, 
   3.5684349906645803`*^9}, {3.568435572262933*^9, 3.568435704079893*^9}, {
   3.5685457826832237`*^9, 3.5685457830211563`*^9}, {3.5686931879540377`*^9, 
   3.5686931908460827`*^9}, 3.569132368192972*^9, {3.569227893820312*^9, 
   3.569227930801277*^9}, {3.569230126821176*^9, 3.569230130998847*^9}, {
   3.569329186793704*^9, 3.569329237338112*^9}, {3.569666555939406*^9, 
   3.569666596521212*^9}, {3.56966957624631*^9, 3.569669609488007*^9}, {
   3.569898647145159*^9, 3.569898667002552*^9}, {3.5705109793136387`*^9, 
   3.570510979811471*^9}, {3.570511185085332*^9, 3.5705111852132998`*^9}, {
   3.5732791921672773`*^9, 3.573279233186647*^9}}],

Cell["", "Text",
 CellChangeTimes->{{3.564141560322721*^9, 3.564141585440034*^9}, {
  3.564146893121169*^9, 3.564146894088922*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["2.4. SetSlicing", "Subsubsection",
 CellChangeTimes->{{3.5625603109856243`*^9, 3.562560317714089*^9}, {
  3.564752234156185*^9, 3.564752234761362*^9}, {3.566319785368972*^9, 
  3.5663198016149263`*^9}, {3.566988220334113*^9, 3.566988224971903*^9}, {
  3.567225421175012*^9, 3.5672254213553743`*^9}, {3.569230422280949*^9, 
  3.569230425256576*^9}}],

Cell["\<\

Definition of the ambient metric g, the normal vector u to the hypersurfaces \
and the metric h induces on the hypersurface. All functions which require the \
explicit details of the slicing will refer to
the slicing by using the induced metric (since the normal vector and the \
ambient metric can always be found from the induced metric by invoking \
InducedFrom[h].)\
\>", "Text",
 CellChangeTimes->{{3.562554021684702*^9, 3.562554096503006*^9}, {
  3.563948144784011*^9, 3.563948174080607*^9}, {3.566988348626814*^9, 
  3.566988349216893*^9}, {3.568458030561493*^9, 3.5684580414482*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TensorHasAnyIndicesQ", "[", "tens_", "]"}], ":=", 
  RowBox[{"AnyIndicesListQ", "[", 
   RowBox[{"SlotsOfTensor", "[", "tens", "]"}], "]"}], 
  RowBox[{"(*", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Length", "@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"SlotsOfTensor", "[", "tens", "]"}], ",", 
        RowBox[{"AnyIndices", "[", "_", "]"}]}], "]"}]}], ">", "0"}], ")"}], 
   "*)"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.566382905770481*^9, 3.566382906663927*^9}, {
  3.566989491015967*^9, 3.566989491256181*^9}, {3.5669904932989483`*^9, 
  3.566990493817748*^9}, {3.567063044779768*^9, 3.567063045388463*^9}, {
  3.567063565937666*^9, 3.567063566120479*^9}, {3.567233635431469*^9, 
  3.567233635589837*^9}, {3.567239785880596*^9, 3.567239786111651*^9}, {
  3.567496516632215*^9, 3.567496517017036*^9}, {3.567501006089492*^9, 
  3.567501006368161*^9}, {3.5675762563483543`*^9, 3.5675762565908003`*^9}, {
  3.567673465373547*^9, 3.5676734656445932`*^9}, {3.567827009838482*^9, 
  3.5678270101094227`*^9}, {3.5678298144949827`*^9, 3.567829814715238*^9}, {
  3.567837920937739*^9, 3.567837921141941*^9}, {3.567843086023789*^9, 
  3.567843086254518*^9}, {3.567917092225335*^9, 3.5679170924723473`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Note", " ", "that", " ", "only", " ", "down", " ", "indices", " ", "can", 
    " ", "be", " ", "passed", " ", "to", " ", "this", " ", "function"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"IsElementInList", "[", 
      RowBox[{"el_", ",", "list_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"Length", "@", 
       RowBox[{"Cases", "[", 
        RowBox[{"list", ",", "el"}], "]"}]}], "\[GreaterEqual]", "1"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"TranverseTensorQ", "[", "tens_", "]"}], ":=", 
      RowBox[{
       RowBox[{"xTensorQ", "[", "tens", "]"}], "&&", 
       RowBox[{"IsElementInList", "[", 
        RowBox[{"Transverse", ",", 
         RowBox[{"PropertiesList", "[", "tens", "]"}]}], "]"}]}]}], ";"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ScalarTensorQ", "[", "tens_", "]"}], ":=", 
     RowBox[{
      RowBox[{"xTensorQ", "[", "tens", "]"}], "&&", 
      RowBox[{"IsElementInList", "[", 
       RowBox[{"\"\<Scalar\>\"", ",", 
        RowBox[{"PropertiesList", "[", "tens", "]"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"VectorTensorQ", "[", "tens_", "]"}], ":=", 
     RowBox[{
      RowBox[{"xTensorQ", "[", "tens", "]"}], "&&", 
      RowBox[{"IsElementInList", "[", 
       RowBox[{"\"\<Vector\>\"", ",", 
        RowBox[{"PropertiesList", "[", "tens", "]"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"TensorTensorQ", "[", "tens_", "]"}], ":=", 
     RowBox[{
      RowBox[{"xTensorQ", "[", "tens", "]"}], "&&", 
      RowBox[{"IsElementInList", "[", 
       RowBox[{"\"\<Tensor\>\"", ",", 
        RowBox[{"PropertiesList", "[", "tens", "]"}]}], "]"}]}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.569329248335709*^9, 3.56932925410424*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Rules", " ", "used", " ", "to", " ", "build", " ", 
     RowBox[{"Automaticrules", ".", " ", "We"}], " ", "first", " ", "use", 
     " ", "MakeRule"}], ",", " ", 
    RowBox[{
    "and", " ", "then", " ", "we", " ", "use", " ", "these", " ", "rule", " ",
      "to", " ", "put", " ", "patterns", " ", "on", " ", "the", " ", "Lable", 
     " ", "indices", " ", "of", " ", "the", " ", "left", " ", "hand", " ", 
     RowBox[{"side", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"PatternTensorLeftScalar", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"lhs_", "\[RuleDelayed]", "rhs_"}], ")"}], ",", 
      RowBox[{
       RowBox[{"TensDummy_", "?", "ScalarTensorQ"}], "[", "inds___", "]"}]}], 
     "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "TScal", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"lhs", "/.", 
           RowBox[{"(", 
            RowBox[{"TensDummy", "\[Rule]", 
             RowBox[{"PatternTest", "[", 
              RowBox[{
               RowBox[{"Pattern", "[", 
                RowBox[{"TensDummy", ",", "_"}], "]"}], ",", 
               "ScalarTensorQ"}], "]"}]}], ")"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{"(", "rhs", ")"}]}], ")"}], "/.", 
       RowBox[{"(", 
        RowBox[{"TensDummy", "->", "TScal"}], ")"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PatternTensorLeftVector", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"lhs_", "\[RuleDelayed]", "rhs_"}], ")"}], ",", 
      RowBox[{
       RowBox[{"TensDummy_", "?", "VectorTensorQ"}], "[", "inds___", "]"}]}], 
     "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "TVect", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"lhs", "/.", 
           RowBox[{"(", 
            RowBox[{"TensDummy", "->", 
             RowBox[{"PatternTest", "[", 
              RowBox[{
               RowBox[{"Pattern", "[", 
                RowBox[{"TensDummy", ",", "_"}], "]"}], ",", 
               "VectorTensorQ"}], "]"}]}], ")"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{"(", "rhs", ")"}]}], ")"}], "/.", 
       RowBox[{"(", 
        RowBox[{"TensDummy", "->", "TVect"}], ")"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PatternTensorLeftTensor", "[", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"lhs_", "\[RuleDelayed]", "rhs_"}], ")"}], ",", 
      RowBox[{
       RowBox[{"TensDummy_", "?", "TensorTensorQ"}], "[", "inds___", "]"}]}], 
     "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", "TTens", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Evaluate", "[", 
          RowBox[{"lhs", "/.", 
           RowBox[{"(", 
            RowBox[{"TensDummy", "->", 
             RowBox[{"PatternTest", "[", 
              RowBox[{
               RowBox[{"Pattern", "[", 
                RowBox[{"TensDummy", ",", "_"}], "]"}], ",", 
               "TensorTensorQ"}], "]"}]}], ")"}]}], "]"}], "\[RuleDelayed]", 
         RowBox[{"(", "rhs", ")"}]}], ")"}], "/.", 
       RowBox[{"(", 
        RowBox[{"TensDummy", "->", "TTens"}], ")"}]}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5631077859355783`*^9, 3.5631078074199333`*^9}, {
   3.563108059017219*^9, 3.563108092918779*^9}, {3.563108135307707*^9, 
   3.563108165967517*^9}, {3.563108907124978*^9, 3.563108923813754*^9}, {
   3.563113019713608*^9, 3.563113033716627*^9}, {3.563125480437722*^9, 
   3.563125482067342*^9}, {3.563174864582333*^9, 3.563174947618636*^9}, 
   3.563175064123884*^9, {3.5631753662040987`*^9, 3.5631753799328814`*^9}, {
   3.563175484333248*^9, 3.563175496648237*^9}, {3.563175647175919*^9, 
   3.563175690703207*^9}, {3.5631758011299677`*^9, 3.563175835208481*^9}, {
   3.563175935051304*^9, 3.563175974417997*^9}, {3.563176094854372*^9, 
   3.563176102049571*^9}, {3.5631761601953697`*^9, 3.563176176038684*^9}, {
   3.563176340640293*^9, 3.563176343630575*^9}, {3.563176466322342*^9, 
   3.563176492957979*^9}, {3.5631765608685217`*^9, 3.5631765932391977`*^9}, {
   3.563176840118518*^9, 3.563176846365226*^9}, {3.5631770806104183`*^9, 
   3.563177086128941*^9}, {3.563177445182907*^9, 3.563177494312796*^9}, {
   3.563177598991802*^9, 3.563177616093717*^9}, {3.563177687707234*^9, 
   3.563177697009665*^9}, {3.5631777688951883`*^9, 3.563177788061294*^9}, {
   3.563177827227603*^9, 3.563177843610108*^9}, {3.563178056486368*^9, 
   3.563178109986779*^9}, {3.5644170178252497`*^9, 3.564417029772283*^9}, {
   3.564417435238501*^9, 3.564417458640457*^9}, {3.564420085355851*^9, 
   3.564420093966546*^9}, {3.564420216282877*^9, 3.564420268522193*^9}, {
   3.564718157007455*^9, 3.564718190916409*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SetSlicing", "[", 
    RowBox[{
     RowBox[{"g_", "?", "MetricQ"}], ",", "u_", ",", 
     RowBox[{"normu_:", "-", "1"}], ",", "h_", ",", "cd_", ",", 
     RowBox[{"{", 
      RowBox[{"cdpost_String", ",", "cdpre_String"}], "}"}], ",", 
     RowBox[{"SpaceTimeType_", "?", "SpaceTimeQ"}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", "p", ",", "q", ",", "DummyS", ",", "DummyV", ",", "DummyT", 
       ",", "ui", ",", "indsdimminustwo", ",", "indsdim", ",", "dim", ",", 
       "prot"}], "}"}], ",", 
     RowBox[{"Catch", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"MetricQ", "[", "g", "]"}]}], ",", 
         RowBox[{"Throw", "[", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SetSlicing", "::", "noambientmetric"}], ",", "g"}], 
           "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"SignDetOfMetric", "@", "g"}], "=!=", 
          RowBox[{"-", "1"}]}], ",", 
         RowBox[{"Throw", "[", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SetSlicing", "::", "signature"}], ",", "g"}], "]"}], 
          "]"}]}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Manifold", "=", 
            RowBox[{"ManifoldOfCovD", "@", 
             RowBox[{"CovDOfMetric", "[", "g", "]"}]}]}], ",", 
           RowBox[{"CD", "=", 
            RowBox[{"CovDOfMetric", "[", "g", "]"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"dim", "=", 
           RowBox[{"DimOfManifold", "[", "Manifold", "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"NumericQ", "[", "dim", "]"}], "&&", 
             RowBox[{"dim", "<", "2"}]}], ",", 
            RowBox[{"Throw", "[", 
             RowBox[{"Message", "[", 
              RowBox[{
               RowBox[{"SetSlicing", "::", "dimension"}], ",", "dim"}], "]"}],
              "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"BianchiBool", "[", "SpaceTimeType", "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Not", "@", 
                RowBox[{"NumericQ", "[", "dim", "]"}]}], "||", 
               RowBox[{"dim", "=!=", "4"}]}], ",", 
              RowBox[{
               RowBox[{
               "Print", "[", 
                "\"\<** Warning: You define a Bianchi spacetime for a \
dimension which is not 4. The Ellis&MacCallum-1969 parameterization of the \
constants of structure as \!\(\*SubscriptBox[SuperscriptBox[\(C\), \(i\)], \
\(jk\)]\)=\!\(\*SubscriptBox[\(\[Epsilon]\), \
\(jkl\)]\)\!\(\*SuperscriptBox[\(n\), \(li\)]\) + \
\!\(\*SubscriptBox[SuperscriptBox[\(\[Delta]\), \(i\)], \([j\)]\) \
\!\(\*SubscriptBox[\(a\), \(\(k\)\(]\)\)]\) is not possible. The option \
$OpenConstantsOfStructure is set to False. **\>\"", "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"$OpenConstantsOfStructure", "=", "False"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ind1", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"ind2", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"ind3", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"ind4", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"ind5", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"ind6", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"ind7", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"i1", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"i2", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"i3", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"i4", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"i5", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"dummy", "=", 
               RowBox[{"DummyIn", "[", 
                RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}]}], "}"}], 
            ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Not", "@", 
                RowBox[{"DefTensorQ", "[", "u", "]"}]}], ",", 
               RowBox[{
                RowBox[{"DefTensor", "[", 
                 RowBox[{
                  RowBox[{"u", "[", "ind1", "]"}], ",", 
                  RowBox[{"{", "Manifold", "}"}], ",", 
                  RowBox[{"PrintAs", "\[Rule]", 
                   RowBox[{"\"\<\\!\\(\>\"", "<>", 
                    RowBox[{"ToString", "[", "u", "]"}], "<>", 
                    "\"\<\\&-\\)\>\""}]}]}], "]"}], ";"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"SlotsOfTensor", "[", "u", "]"}], "]"}], "=!=", 
                    "1"}], "||", 
                   RowBox[{
                    RowBox[{"VBundleOfIndex", "@", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"First", "@", 
                    RowBox[{"SlotsOfTensor", "@", "u"}]}], "]"}]}], "=!=", 
                    RowBox[{"Tangent", "[", "Manifold", "]"}]}]}], ",", 
                  RowBox[{"Throw", "[", 
                   RowBox[{"Message", "[", 
                    RowBox[{
                    RowBox[{"SetSlicing", "::", "invalidnormalvector"}], ",", 
                    "u"}], "]"}], "]"}]}], "]"}], ";"}]}], 
              "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Off", "[", 
              StyleBox[
               RowBox[{"DefMetric", "::", "old"}], "MessageName"], "]"}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"Annoying", " ", "message", " ", "turned", " ", "off"}],
               "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"contribution", " ", "of", " ", "Obinna"}], " ", "*)"}],
              "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"DefMetric", "[", 
                RowBox[{"1", ",", 
                 RowBox[{"h", "[", 
                  RowBox[{
                   RowBox[{"-", "ind1"}], ",", 
                   RowBox[{"-", "ind2"}]}], "]"}], ",", "cd", ",", 
                 RowBox[{"{", 
                  RowBox[{"cdpost", ",", "cdpre"}], "}"}], ",", 
                 RowBox[{"InducedFrom", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"g", ",", "u"}], "}"}]}], ",", 
                 RowBox[{"If", "[", 
                  RowBox[{"$ConformalTime", ",", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"FlatSpaceBool", "[", "SpaceTimeType", "]"}], ",", 
                    RowBox[{"PrintAs", "\[Rule]", "\"\<\[Delta]\>\""}], ",", 
                    RowBox[{"PrintAs", "\[Rule]", 
                    RowBox[{"\"\<\\!\\(\>\"", "<>", 
                    RowBox[{"ToString", "[", "h", "]"}], "<>", 
                    "\"\<\\&-\\)\>\""}]}]}], "]"}], ",", 
                   RowBox[{"PrintAs", "\[Rule]", 
                    RowBox[{"\"\<\\!\\(\>\"", "<>", 
                    RowBox[{"ToString", "[", "h", "]"}], "<>", 
                    "\"\<\\&-\\)\>\""}]}]}], "]"}]}], "]"}], ";"}], "*)"}], 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"DefMetric", "[", 
              RowBox[{"1", ",", 
               RowBox[{"h", "[", 
                RowBox[{
                 RowBox[{"-", "ind1"}], ",", 
                 RowBox[{"-", "ind2"}]}], "]"}], ",", "cd", ",", 
               RowBox[{"{", 
                RowBox[{"cdpost", ",", "cdpre"}], "}"}], ",", 
               RowBox[{"InducedFrom", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{"g", ",", "u"}], "}"}]}], ",", 
               RowBox[{"PrintAs", "\[Rule]", 
                RowBox[{"\"\<\\!\\(\>\"", "<>", 
                 RowBox[{"ToString", "[", "h", "]"}], "<>", 
                 "\"\<\\&-\\)\>\""}]}]}], "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"Maybe", " ", "not", " ", "so", " ", "useful"}], 
               "..."}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"AutomaticRules", "[", 
              RowBox[{"h", ",", 
               RowBox[{"MakeRule", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"g", "[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}], 
                   RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", 
                    RowBox[{"-", "ind3"}]}], "]"}]}], ",", 
                  RowBox[{"h", "[", 
                   RowBox[{"ind1", ",", 
                    RowBox[{"-", "ind3"}]}], "]"}]}], "}"}], "]"}]}], "]"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"AutomaticRules", "[", 
              RowBox[{"h", ",", 
               RowBox[{"MakeRule", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], 
                   RowBox[{"h", "[", 
                    RowBox[{"ind2", ",", "ind3"}], "]"}]}], ",", 
                  RowBox[{"h", "[", 
                   RowBox[{
                    RowBox[{"-", "ind1"}], ",", "ind3"}], "]"}]}], "}"}], 
                "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"On", "[", 
              StyleBox[
               RowBox[{"DefMetric", "::", "old"}], "MessageName"], "]"}], ";",
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "We", " ", "remove", " ", "automatic", " ", "Leibniz", " ", 
               "rule", " ", "when", " ", "there", " ", "is", " ", "a", " ", 
               "Scalar", " ", 
               RowBox[{"Head", ".", " ", "This"}], " ", "is", " ", "to", " ", 
               "ensure", " ", "that", " ", "the", " ", "induced", " ", 
               "derivative", " ", "does", " ", "not", " ", "spoil", " ", 
               RowBox[{"an", " ", "'"}], 
               RowBox[{"InducedDecomposition", "'"}]}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"prot", "=", 
              RowBox[{"Unprotect", "[", "cd", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"cd", "[", "a_", "]"}], "[", 
               RowBox[{"Scalar", "[", "expr_", "]"}], "]"}], "=."}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Protect", "[", "prot", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"$Rulecdh", "[", "h1_", "]"}], ":=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"h1", "[", 
                   RowBox[{
                    RowBox[{"-", "a_"}], ",", "b_"}], "]"}], 
                  RowBox[{
                   RowBox[{"cd", "[", "a_", "]"}], "[", "expr1_", "]"}]}], ":>", 
                 RowBox[{
                  RowBox[{"cd", "[", "b", "]"}], "[", "expr1", "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"h1", "[", 
                   RowBox[{"a_", ",", "b_"}], "]"}], 
                  RowBox[{
                   RowBox[{"cd", "[", 
                    RowBox[{"-", "a_"}], "]"}], "[", "expr1_", "]"}]}], ":>", 
                 
                 RowBox[{
                  RowBox[{"cd", "[", "b", "]"}], "[", "expr1", "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"h1", "[", 
                   RowBox[{"b_", ",", 
                    RowBox[{"-", "a_"}]}], "]"}], 
                  RowBox[{
                   RowBox[{"cd", "[", "a_", "]"}], "[", "expr1_", "]"}]}], ":>", 
                 RowBox[{
                  RowBox[{"cd", "[", "b", "]"}], "[", "expr1", "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"h1", "[", 
                   RowBox[{"b_", ",", "a_"}], "]"}], 
                  RowBox[{
                   RowBox[{"cd", "[", 
                    RowBox[{"-", "a_"}], "]"}], "[", "expr1_", "]"}]}], ":>", 
                 
                 RowBox[{
                  RowBox[{"cd", "[", "b", "]"}], "[", "expr1", "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"h1", "[", 
                   RowBox[{
                    RowBox[{"-", "a_"}], ",", "b_"}], "]"}], 
                  RowBox[{
                   RowBox[{"cd", "[", "c_", "]"}], "@", 
                   RowBox[{
                    RowBox[{"cd", "[", "a_", "]"}], "[", "expr1_", "]"}]}]}], 
                 "\[RuleDelayed]", 
                 RowBox[{
                  RowBox[{"cd", "[", "c", "]"}], "@", 
                  RowBox[{
                   RowBox[{"cd", "[", "b", "]"}], "[", "expr1", "]"}]}]}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"h1", "[", 
                   RowBox[{"a_", ",", "b_"}], "]"}], 
                  RowBox[{
                   RowBox[{"cd", "[", "c_", "]"}], "@", 
                   RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "a_"}], "]"}], "[", "expr1_", "]"}]}]}], 
                 "\[RuleDelayed]", 
                 RowBox[{
                  RowBox[{"cd", "[", "c", "]"}], "@", 
                  RowBox[{
                   RowBox[{"cd", "[", "b", "]"}], "[", "expr1", "]"}]}]}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"h1", "[", 
                   RowBox[{"b_", ",", 
                    RowBox[{"-", "a_"}]}], "]"}], 
                  RowBox[{
                   RowBox[{"cd", "[", "c_", "]"}], "@", 
                   RowBox[{
                    RowBox[{"cd", "[", "a_", "]"}], "[", "expr1_", "]"}]}]}], 
                 "\[RuleDelayed]", 
                 RowBox[{
                  RowBox[{"cd", "[", "c", "]"}], "@", 
                  RowBox[{
                   RowBox[{"cd", "[", "b", "]"}], "[", "expr1", "]"}]}]}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"h1", "[", 
                   RowBox[{"b_", ",", "a_"}], "]"}], 
                  RowBox[{
                   RowBox[{"cd", "[", "c_", "]"}], "@", 
                   RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "a_"}], "]"}], "[", "expr1_", "]"}]}]}], 
                 "\[RuleDelayed]", 
                 RowBox[{
                  RowBox[{"cd", "[", "c", "]"}], "@", 
                  RowBox[{
                   RowBox[{"cd", "[", "b", "]"}], "[", "expr1", "]"}]}]}]}], 
               "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "*", " ", "All", " ", "of", " ", "this", " ", "is", " ", "now", 
               " ", "included", " ", "in", " ", "xAct", " ", "1.0", ".5", " ",
                "so", " ", "we", " ", "comment", " ", "these", " ", "lines"}],
               " ", "**)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"cd", "[", "i1_", "]"}], "[", 
                 RowBox[{"x_", " ", "y_"}], "]"}], "=."}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"cd", "[", 
                  RowBox[{"_", "?", "GIndexQ"}], "]"}], "[", "expr_", "]"}], 
                "=."}], ";"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"and", " ", "we", " ", "redefine", " ", "them"}], " ", 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"cd", "[", "i1_", "]"}], "[", 
                 RowBox[{"x_", "  ", 
                  RowBox[{"g", "[", 
                   RowBox[{"ind1_", ",", "ind2_"}], "]"}]}], "]"}], ":=", 
                RowBox[{
                 RowBox[{"h", "[", 
                  RowBox[{"ind1", ",", "ind2"}], "]"}], " ", 
                 RowBox[{
                  RowBox[{"cd", "[", "i1", "]"}], "[", "x", "]"}]}]}], 
               RowBox[{"(*", 
                RowBox[{"/;", 
                 RowBox[{
                  RowBox[{"OrthogonalToVectorQ", "[", "u", "]"}], "[", "x", 
                  "]"}]}], "*)"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"cd", "[", "i1_", "]"}], "[", 
                 RowBox[{"x_", "  ", 
                  RowBox[{"delta", "[", 
                   RowBox[{"ind1_", ",", "ind2_"}], "]"}]}], "]"}], ":=", 
                RowBox[{
                 RowBox[{"h", "[", 
                  RowBox[{"ind1", ",", "ind2"}], "]"}], " ", 
                 RowBox[{
                  RowBox[{"cd", "[", "i1", "]"}], "[", "x", "]"}]}]}], 
               RowBox[{"(*", 
                RowBox[{"/;", 
                 RowBox[{
                  RowBox[{"OrthogonalToVectorQ", "[", "u", "]"}], "[", "x", 
                  "]"}]}], "*)"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"cd", "[", "i1_", "]"}], "[", 
                 RowBox[{"g", "[", 
                  RowBox[{"ind1_", ",", "ind2_"}], "]"}], "]"}], ":=", "0"}], 
               ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"cd", "[", "i1_", "]"}], "[", 
                 RowBox[{"x_", "  ", "y_"}], "]"}], ":=", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "[", "x", "]"}], "y"}], 
                  "+", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "[", "y", "]"}], "x"}]}], 
                 "/;", 
                 RowBox[{"And", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"OrthogonalToVectorQ", "[", "u", "]"}], "[", "x", 
                    "]"}], ",", 
                   RowBox[{
                    RowBox[{"OrthogonalToVectorQ", "[", "u", "]"}], "[", "y", 
                    "]"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"cd", "[", 
                  RowBox[{"_", "?", "GIndexQ"}], "]"}], "[", "expr_", "]"}], ":=", 
                RowBox[{
                 RowBox[{"Throw", "@", 
                  RowBox[{"Message", "[", 
                   RowBox[{
                    RowBox[{"Validate", "::", "error"}], ",", 
                    "\"\<Induced derivative acting on non-projected \
expression.\>\""}], "]"}]}], "/;", 
                 RowBox[{"Not", "@", 
                  RowBox[{
                   RowBox[{"OrthogonalToVectorQ", "[", "u", "]"}], "[", 
                   "expr", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"cd", "[", "i1_", "]"}], "[", 
                 RowBox[{"x_", "  ", "y_"}], "]"}], ":=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"cd", "[", "i1", "]"}], "[", 
                  RowBox[{"Expand", "@", 
                   RowBox[{"GradNormalToExtrinsicK", "@", 
                    RowBox[{"Expand", "[", 
                    RowBox[{
                    RowBox[{"InducedDecomposition", "[", 
                    RowBox[{"x", ",", 
                    RowBox[{"{", 
                    RowBox[{"h", ",", "u"}], "}"}]}], "]"}], 
                    RowBox[{"InducedDecomposition", "[", 
                    RowBox[{"y", ",", 
                    RowBox[{"{", 
                    RowBox[{"h", ",", "u"}], "}"}]}], "]"}]}], "]"}]}]}], 
                  "]"}], "/;", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "@", "x"}], "=!=", "g"}], "&&", 
                  RowBox[{
                   RowBox[{"Head", "@", "y"}], "=!=", "g"}], "&&", 
                  RowBox[{
                   RowBox[{"OrthogonalToVectorQ", "[", "u", "]"}], "[", 
                   RowBox[{"x", " ", "y"}], "]"}]}]}]}], ";"}], "*)"}], 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", "**", "*****)"}], "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"**", "**", "**"}], "*", " ", "End", " ", "of", " ", 
               "Patch"}], " ", "*)"}], "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"SpaceType", "[", "h", "]"}], "^=", "SpaceTimeType"}], 
             ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "The", " ", "default", " ", "positionof", " ", "indices", " ", 
               "for", " ", "the", " ", "extrinsic", " ", "curvature", " ", 
               "and", " ", "the", " ", "acceleration", " ", "is", " ", 
               "down"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"SlotsOfTensor", "[", "#", "]"}], "^:=", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", 
                    RowBox[{"Tangent", "[", "Manifold", "]"}]}], ",", 
                   RowBox[{"-", 
                    RowBox[{"Tangent", "[", "Manifold", "]"}]}]}], "}"}]}], 
                ")"}], "&"}], "/@", 
              RowBox[{"{", 
               RowBox[{"ExtrinsicK", "[", "h", "]"}], "}"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"SlotsOfTensor", "[", "#", "]"}], "^:=", 
                 RowBox[{"{", 
                  RowBox[{"-", 
                   RowBox[{"Tangent", "[", "Manifold", "]"}]}], "}"}]}], 
                ")"}], "&"}], "/@", 
              RowBox[{"{", 
               RowBox[{"Acceleration", "[", "u", "]"}], "}"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "The", " ", "acceleration", " ", "should", " ", "vanish", " ", 
               "for", " ", "homogeneous", " ", 
               RowBox[{"spacetimes", "."}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Acceleration", "[", "u", "]"}], "[", "ind1_", "]"}], 
              "\[InvisibleSpace]", "=", " ", "0"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AutomaticRules", "[", 
              RowBox[{"u", ",", 
               RowBox[{"MakeRule", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"u", "[", "ind1", "]"}], 
                   RowBox[{"u", "[", 
                    RowBox[{"-", "ind1"}], "]"}]}], ",", "normu"}], "}"}], 
                "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"AutomaticRules", "[", 
              RowBox[{"u", ",", 
               RowBox[{"MakeRule", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"u", "[", 
                    RowBox[{"-", "ind1"}], "]"}], 
                   RowBox[{"g", "[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}]}], ",", 
                  RowBox[{"u", "[", "ind2", "]"}]}], "}"}], "]"}]}], "]"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"AutomaticRules", "[", 
              RowBox[{"u", ",", 
               RowBox[{"MakeRule", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"g", "[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}], 
                   RowBox[{"u", "[", 
                    RowBox[{"-", "ind2"}], "]"}], 
                   RowBox[{"u", "[", 
                    RowBox[{"-", "ind1"}], "]"}]}], ",", "normu"}], "}"}], 
                "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"IntegerQ", "@", "dim"}], "&&", 
                RowBox[{"dim", "\[GreaterEqual]", "2"}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"indsdim", "=", 
                 RowBox[{"GetIndicesOfVBundle", "[", 
                  RowBox[{
                   RowBox[{"Tangent", "@", "Manifold"}], ",", "dim", ",", 
                   RowBox[{"{", "ind5", "}"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"epsilon", "[", "g", "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"epsilon", "[", "g", "]"}], "@@", "indsdim"}], 
                    " ", 
                    RowBox[{"u", "[", 
                    RowBox[{"-", 
                    RowBox[{"indsdim", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], 
                    RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"indsdim", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "ind5"}], "]"}]}], 
                    ",", 
                    RowBox[{
                    RowBox[{"ReplaceIndex", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{
                    RowBox[{"epsilon", "[", "g", "]"}], "@@", "indsdim"}], 
                    "]"}], ",", 
                    RowBox[{
                    RowBox[{"indsdim", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Rule]", " ", 
                    "ind5"}]}], "]"}], " ", 
                    RowBox[{"u", "[", 
                    RowBox[{"-", 
                    RowBox[{"indsdim", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], "}"}], "]"}],
                    "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
             ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"We", " ", "define", " ", 
                RowBox[{"a", "[", "h", "]"}], " ", "the", " ", "scale", " ", 
                "factor", " ", "associated", " ", "to", " ", "h"}], ",", " ", 
               
               RowBox[{"and", " ", "the", " ", "Hubble", " ", "factor", " ", 
                RowBox[{"related", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"DefProjectedTensor", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "h", ",", 
                  RowBox[{"SpaceTimesOfDefinition", "->", 
                   RowBox[{"{", "\"\<Background\>\"", "}"}]}], ",", 
                  RowBox[{"TensorProperties", "->", 
                   RowBox[{"{", 
                    RowBox[{
                    "\"\<Traceless\>\"", ",", "\"\<Transverse\>\"", ",", 
                    "\"\<SymmetricTensor\>\""}], "}"}]}], ",", 
                  RowBox[{"PrintAs", "->", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ")"}], "&"}], "/@", 
              RowBox[{"$ListFieldsBackgroundOnly", "[", "h", "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Evaluate", "[", 
                RowBox[{"a", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
              RowBox[{"a", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Evaluate", "[", 
                RowBox[{"H", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
              RowBox[{"H", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "Patch", " ", "to", " ", "have", " ", "a", " ", "nice", " ", 
               "output", " ", "for", " ", "the", " ", "Hubble", " ", 
               "factor"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"H", "[", "h", "]"}], "]"}], "/:", 
              RowBox[{
               RowBox[{"PrintAs", "[", 
                RowBox[{"H", "[", "h", "]"}], "]"}], "=."}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"PrintAs", "[", 
               RowBox[{"H", "[", "h", "]"}], "]"}], "^:=", 
              RowBox[{"If", "[", 
               RowBox[{
               "$ConformalTime", ",", "\"\<\[ScriptCapitalH]\>\"", ",", 
                "\"\<H\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"Unprotect", "[", "NoScalar", "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
               "We", " ", "know", " ", "it", " ", "is", " ", "safe", " ", 
                "to", " ", "remove", " ", "the", " ", "scalar", " ", "heads", 
                " ", "on", " ", "scale", " ", "factors", " ", "and", " ", 
                "Hubble", " ", "factors"}], ",", " ", 
               RowBox[{
                RowBox[{
                "because", " ", "we", " ", "shall", " ", "never", " ", 
                 "replace", " ", "a", " ", "Hubble", " ", "factor", " ", 
                 "nor", " ", "a", " ", "scale", " ", "factor", " ", "by", " ",
                  "something", " ", "else", " ", "which", " ", "is", " ", 
                 "not", " ", "a", " ", "pure", " ", "scalar", " ", "field"}], 
                "..."}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"NoScalar", "[", 
               RowBox[{"Power", "[", 
                RowBox[{
                 RowBox[{"Scalar", "[", 
                  RowBox[{
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"H", "[", "h", "]"}], "]"}], "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], "]"}], ",", 
                 "n_Integer"}], "]"}], "]"}], ":=", 
              RowBox[{"Power", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"H", "[", "h", "]"}], "]"}], "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "0", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}]}], "]"}], ",", "n"}], "]"}]}],
              ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"NoScalar", "[", 
               RowBox[{"Power", "[", 
                RowBox[{
                 RowBox[{"Scalar", "[", 
                  RowBox[{
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"a", "[", "h", "]"}], "]"}], "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], "]"}], ",", 
                 "n_Integer"}], "]"}], "]"}], ":=", 
              RowBox[{"Power", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"a", "[", "h", "]"}], "]"}], "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "0", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}]}], "]"}], ",", "n"}], "]"}]}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"Protect", "[", "NoScalar", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"SpaceTimeType", "===", "\"\<Minkowski\>\""}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"a", "[", "h", "]"}], "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "0", "]"}], ",", 
                   RowBox[{"LI", "[", "0", "]"}]}], "]"}], "=", "1"}], ";", 
                RowBox[{
                 RowBox[{
                  RowBox[{"H", "[", "h", "]"}], "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "0", "]"}], ",", 
                   RowBox[{"LI", "[", "0", "]"}]}], "]"}], "=", "0"}], ";"}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"a", "[", "h", "]"}], "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "0", "]"}], ",", 
                   RowBox[{"LI", "[", "1", "]"}]}], "]"}], ":=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"H", "[", "h", "]"}], "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                  RowBox[{
                   RowBox[{"a", "[", "h", "]"}], "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"a", "[", "h", "]"}], "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "0", "]"}], ",", 
                   RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"IntegerQ", "[", "#", "]"}], "&&", 
                    RowBox[{"#", "\[GreaterEqual]", "2"}]}], ")"}], "&"}], 
                    ")"}]}], "]"}]}], "]"}], ":=", 
                 RowBox[{"NoScalar", "@", 
                  RowBox[{"org", "@", 
                   RowBox[{"Nest", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", "#", "]"}], 
                    "&"}], ",", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], ",", "q"}], 
                    "]"}]}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"DefConformalMetric", "[", 
                 RowBox[{"g", ",", 
                  RowBox[{"a", "[", "h", "]"}]}], "]"}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"Obvious", ".", " ", "SHould"}], " ", "be", " ", 
               "automatic", " ", "in", " ", "xPert"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"cd", "[", "_", "]"}], "[", "$PerturbationParameter", 
               "]"}], "=", "0"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "The", " ", "vector", " ", "used", " ", "for", " ", "the", " ", 
               "background", " ", "slicing", " ", "is", " ", "indeed", " ", 
               "backgorund", " ", "so", " ", "should", " ", "not", " ", "be", 
               " ", "perturbed"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Perturbation", "[", 
               RowBox[{
                RowBox[{"u", "[", "ind1_", "]"}], ",", "n_"}], "]"}], "^:=", 
              RowBox[{"0", "/;", 
               RowBox[{"n", "\[GreaterEqual]", "1"}]}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "Lie", " ", "Derivatives", " ", "of", " ", "metric", " ", 
               "with", " ", "up", " ", "indices", " ", "should", " ", "be", 
               " ", "automatic"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"AutomaticRules", "[", 
              RowBox[{"g", ",", 
               RowBox[{"MakeRule", "[", 
                RowBox[{
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}]}], "}"}], "]"}], 
                 ",", 
                 RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"AutomaticRules", "[", 
              RowBox[{"g", ",", 
               RowBox[{"MakeRule", "[", 
                RowBox[{
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], "]"}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}]}], "}"}], "]"}], 
                 ",", 
                 RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}], 
             ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"DefTensor", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Connection", "[", "h", "]"}], "[", 
                RowBox[{
                 RowBox[{"-", "ind1"}], ",", 
                 RowBox[{"-", "ind2"}], ",", 
                 RowBox[{"-", "ind3"}]}], "]"}], ",", 
               RowBox[{"{", "Manifold", "}"}], ",", 
               RowBox[{"Antisymmetric", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "ind1"}], ",", 
                  RowBox[{"-", "ind3"}]}], "}"}], "]"}], ",", 
               RowBox[{"OrthogonalTo", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"u", "[", "ind1", "]"}], ",", 
                  RowBox[{"u", "[", "ind2", "]"}], ",", 
                  RowBox[{"u", "[", "ind3", "]"}]}], "}"}]}], ",", 
               RowBox[{"ProjectedWith", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"h", "[", 
                   RowBox[{"ind1", ",", 
                    RowBox[{"-", "ind4"}]}], "]"}], ",", 
                  RowBox[{"h", "[", 
                   RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind5"}]}], "]"}], ",", 
                  RowBox[{"h", "[", 
                   RowBox[{"ind3", ",", 
                    RowBox[{"-", "ind6"}]}], "]"}]}], "}"}]}], ",", 
               RowBox[{"PrintAs", "\[Rule]", 
                RowBox[{"StringJoin", "[", 
                 RowBox[{"\"\<\[CapitalGamma]\>\"", ",", 
                  RowBox[{"ToString", "[", "h", "]"}]}], "]"}]}]}], "]"}], 
             " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"DefTensor", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"CS", "[", "h", "]"}], "[", 
                RowBox[{
                 RowBox[{"-", "ind1"}], ",", 
                 RowBox[{"-", "ind2"}], ",", 
                 RowBox[{"-", "ind3"}]}], "]"}], ",", 
               RowBox[{"{", "Manifold", "}"}], ",", 
               RowBox[{"Antisymmetric", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "ind2"}], ",", 
                  RowBox[{"-", "ind3"}]}], "}"}], "]"}], ",", 
               RowBox[{"OrthogonalTo", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"u", "[", "ind1", "]"}], ",", 
                  RowBox[{"u", "[", "ind2", "]"}], ",", 
                  RowBox[{"u", "[", "ind3", "]"}]}], "}"}]}], ",", 
               RowBox[{"ProjectedWith", "\[Rule]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"h", "[", 
                   RowBox[{"ind1", ",", 
                    RowBox[{"-", "ind4"}]}], "]"}], ",", 
                  RowBox[{"h", "[", 
                   RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind5"}]}], "]"}], ",", 
                  RowBox[{"h", "[", 
                   RowBox[{"ind3", ",", 
                    RowBox[{"-", "ind6"}]}], "]"}]}], "}"}]}], ",", 
               RowBox[{"PrintAs", "\[Rule]", 
                RowBox[{"StringJoin", "[", "\"\<C\>\"", 
                 RowBox[{"(*", 
                  RowBox[{",", 
                   RowBox[{"ToString", "[", "h", "]"}]}], "*)"}], "]"}]}]}], 
              "]"}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Not", "[", 
                RowBox[{
                 RowBox[{"FlatSpaceBool", "[", "SpaceTimeType", "]"}], "&&", 
                 RowBox[{"dim", "===", "4"}], "&&", 
                 RowBox[{"BianchiBool", "[", "SpaceTimeType", "]"}]}], "]"}], 
               ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"DefTensor", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"nt", "[", "h", "]"}], "[", 
                   RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], ",", 
                  RowBox[{"{", "Manifold", "}"}], ",", 
                  RowBox[{"Symmetric", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "}"}], "]"}], ",", 
                  RowBox[{"OrthogonalTo", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"u", "[", "ind1", "]"}], ",", 
                    RowBox[{"u", "[", "ind2", "]"}]}], "}"}]}], ",", 
                  RowBox[{"ProjectedWith", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"ind1", ",", 
                    RowBox[{"-", "ind4"}]}], "]"}], ",", 
                    RowBox[{"h", "[", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind5"}]}], "]"}]}], "}"}]}], ",", 
                  RowBox[{"PrintAs", "\[Rule]", 
                   RowBox[{"StringJoin", "[", "\"\<N\>\"", 
                    RowBox[{"(*", 
                    RowBox[{",", 
                    RowBox[{"ToString", "[", "h", "]"}]}], "*)"}], "]"}]}]}], 
                 "]"}], " ", ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"DefTensor", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"av", "[", "h", "]"}], "[", 
                   RowBox[{"-", "ind1"}], "]"}], ",", 
                  RowBox[{"{", "Manifold", "}"}], ",", 
                  RowBox[{"OrthogonalTo", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{"u", "[", "ind1", "]"}], "}"}]}], ",", 
                  RowBox[{"ProjectedWith", "\[Rule]", 
                   RowBox[{"{", 
                    RowBox[{"h", "[", 
                    RowBox[{"ind1", ",", 
                    RowBox[{"-", "ind4"}]}], "]"}], "}"}]}], ",", 
                  RowBox[{"PrintAs", "\[Rule]", 
                   RowBox[{"StringJoin", "[", "\"\<A\>\"", 
                    RowBox[{"(*", 
                    RowBox[{",", 
                    RowBox[{"ToString", "[", "h", "]"}]}], "*)"}], "]"}]}]}], 
                 "]"}], " ", ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"SpaceTimeType", "===", "\"\<BianchiA\>\""}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"av", "[", "h", "]"}], "[", "ind1_", "]"}], "=", 
                    "0"}], ";"}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"AutomaticRules", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"av", "[", "h", "]"}], "]"}], ",", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"av", "[", "h", "]"}], "[", "ind1", "]"}], 
                    RowBox[{
                    RowBox[{"nt", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}]}], ",", "0"}], "}"}], 
                    "]"}], "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
                 "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
               "Properties", " ", "of", " ", "constancy", " ", "of", " ", 
                "these", " ", "constants"}], "..."}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "So", " ", "far", " ", "the", " ", "only", " ", "way", " ", 
               "we", " ", "found", " ", "is", " ", "to", " ", "be", " ", 
               "exhaustive"}], " ", "*)"}], "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "We", " ", "first", " ", "distinguish", " ", "the", " ", "case",
                " ", "of", " ", "Flat", " ", "Friedmann", " ", "and", " ", 
               "Curved", " ", "Friedmann", " ", "where", " ", "the", " ", 
               "connections", " ", "have", " ", "a", " ", "simple", " ", 
               "expression"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"Which", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"FlatSpaceBool", "[", "SpaceTimeType", "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"CS", "[", "h", "]"}], "[", 
                  RowBox[{"ind1_", ",", "ind2_", ",", "ind3_"}], "]"}], "=", 
                 "0"}], ";", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                  RowBox[{"i1_", ",", "i2_", ",", "i3_", ",", "i4_"}], "]"}], 
                 "=", "0"}], ";", " ", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                  RowBox[{"i1_", ",", "i2_"}], "]"}], "=", "0"}], ";", " ", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"RicciScalar", "[", "cd", "]"}], "[", "]"}], "=", 
                 "0"}], ";"}], ",", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"SpaceTimeType", "===", "\"\<FLCurved\>\""}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"DefTensor", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"\[ScriptK]", "[", "h", "]"}], "[", "]"}], ",", 
                  RowBox[{"{", "Manifold", "}"}], ",", 
                  RowBox[{"PrintAs", "->", 
                   RowBox[{"StringJoin", "[", "\"\<\[ScriptK]\>\"", 
                    RowBox[{"(*", 
                    RowBox[{",", 
                    RowBox[{"ToString", "[", "h", "]"}]}], "*)"}], "]"}]}]}], 
                 "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"CD", "[", "ind1_", "]"}], "[", 
                  RowBox[{
                   RowBox[{"\[ScriptK]", "[", "h", "]"}], "[", "]"}], "]"}], 
                 "=", 
                 RowBox[{
                  RowBox[{"-", "1"}], "*", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"-", "2"}], "/", "3"}], ")"}], "*", 
                  RowBox[{"u", "[", "ind1", "]"}], 
                  RowBox[{
                   RowBox[{"\[ScriptK]", "[", "h", "]"}], "[", "]"}], 
                  RowBox[{
                   RowBox[{"CD", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                   RowBox[{"u", "[", "ind2", "]"}], "]"}]}]}], ";", " ", 
                RowBox[{"(*", " ", 
                 RowBox[{
                  RowBox[{"This", " ", "is", " ", "because", " ", 
                   SubscriptBox["\[ScriptCapitalL]", "u"], 
                   RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox["\[ScriptK]", 
                    RowBox[{"1", "/", "2"}]], 
                    SubscriptBox[
                    SuperscriptBox["\[Epsilon]", "\[Mu]"], "\[Nu]\[Sigma]"]}],
                     ")"}], " ", "must", " ", "be", " ", "zero", " ", "since",
                    " ", 
                   SubscriptBox["\[ScriptCapitalL]", "u"], 
                   RowBox[{"(", 
                    SubscriptBox[
                    SuperscriptBox["C", "\[Mu]"], "\[Nu]\[Sigma]"], ")"}]}], 
                  "=", "0"}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                  RowBox[{
                  "Given", " ", "that", " ", "we", " ", "first", " ", "work", 
                   " ", "on", " ", "the", " ", "conformal", " ", "metric", 
                   " ", "where", " ", "the", " ", "trace", " ", "of", " ", 
                   "the", " ", "extrinsic", " ", "curvature", " ", "is", " ", 
                   "0"}], ",", " ", 
                  RowBox[{
                  "then", " ", "this", " ", "point", " ", "does", " ", "not", 
                   " ", "matter", " ", "at", " ", "all", " ", "for", " ", 
                   RowBox[{"us", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"cd", "[", "ind1_", "]"}], "[", 
                  RowBox[{
                   RowBox[{"\[ScriptK]", "[", "h", "]"}], "[", "]"}], "]"}], 
                 "=", "0"}], ";", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"dim", "===", "4"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind1_", ",", "ind2_", ",", "ind3_"}], "]"}], "=", 
                   RowBox[{"2", 
                    RowBox[{"Sqrt", "[", 
                    RowBox[{
                    RowBox[{"\[ScriptK]", "[", "h", "]"}], "[", "]"}], "]"}], 
                    
                    RowBox[{
                    RowBox[{"epsilon", "[", "h", "]"}], "[", 
                    RowBox[{"ind1", ",", "ind2", ",", "ind3"}], "]"}]}]}]}], 
                 "]"}], ";"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"BianchiBool", "@", "SpaceTimeType"}], ")"}], "&&", 
                RowBox[{"(", 
                 RowBox[{"Not", "@", 
                  RowBox[{"FlatSpaceBool", "@", "SpaceTimeType"}]}], ")"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "Lie", " ", "derivatives", " ", "of", " ", "the", " ", 
                 "constants", " ", "of", " ", "structure", " ", "in", " ", 
                 "general", " ", "Bianchi", " ", "cases", " ", "It", " ", 
                 "is", " ", "0", " ", "when", " ", "indices", " ", "are", " ",
                  "in", " ", "position", " ", 
                 RowBox[{
                  SubscriptBox[
                   SuperscriptBox["C", "i"], "jk"], " ", "."}]}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"We", " ", "are", " ", 
                 RowBox[{"exhaustive", ".", " ", "Maybe"}], " ", "there", " ",
                  "is", "  ", "simpler", " ", "way", " ", "to", " ", "write", 
                 " ", 
                 RowBox[{"it", "."}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind3"}], ",", 
                    RowBox[{"-", "ind4"}]}], "]"}], "]"}], ",", "0"}], "}"}], 
                    "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", 
                    RowBox[{"-", "ind3"}], ",", 
                    RowBox[{"-", "ind4"}]}], "]"}], "]"}], ",", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", 
                    RowBox[{"-", "ind5"}]}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind5", ",", 
                    RowBox[{"-", "ind3"}], ",", 
                    RowBox[{"-", "ind4"}]}], "]"}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], "]"}]}]}], "}"}],
                     "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind3"}], ",", "ind4"}], "]"}], "]"}], ",", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind4", ",", "ind6"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind3"}], ",", 
                    RowBox[{"-", "ind6"}]}], "]"}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], "]"}]}]}], "}"}],
                     "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", 
                    RowBox[{"-", "ind4"}]}], "]"}], "]"}], ",", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind5"}], ",", 
                    RowBox[{"-", "ind4"}]}], "]"}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], "]"}]}]}], "}"}],
                     "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", "ind3", ",", 
                    RowBox[{"-", "ind4"}]}], "]"}], "]"}], ",", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], "]"}], 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind6"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind6", ",", 
                    RowBox[{"-", "ind5"}], ",", 
                    RowBox[{"-", "ind4"}]}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind6"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind6", ",", 
                    RowBox[{"-", "ind5"}], ",", 
                    RowBox[{"-", "ind4"}]}], "]"}]}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], "]"}]}]}], "}"}],
                     "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", 
                    RowBox[{"-", "ind4"}], ",", "ind3"}], "]"}], "]"}], ",", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], "]"}], 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind6"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind6", ",", 
                    RowBox[{"-", "ind4"}], ",", 
                    RowBox[{"-", "ind5"}]}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind6"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind6", ",", 
                    RowBox[{"-", "ind4"}], ",", 
                    RowBox[{"-", "ind5"}]}], "]"}]}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], "]"}]}]}], "}"}],
                     "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", "ind3", ",", "ind4"}], "]"}], 
                    "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], "]"}], 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind6"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], 
                    RowBox[{"g", "[", 
                    RowBox[{"ind4", ",", "ind7"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind6", ",", 
                    RowBox[{"-", "ind5"}], ",", 
                    RowBox[{"-", "ind7"}]}], "]"}]}], "\[IndentingNewLine]", 
                    "+", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind6"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], "]"}], 
                    RowBox[{"g", "[", 
                    RowBox[{"ind4", ",", "ind7"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind6", ",", 
                    RowBox[{"-", "ind5"}], ",", 
                    RowBox[{"-", "ind7"}]}], "]"}]}], "\[IndentingNewLine]", 
                    "+", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], 
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "ind6"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind4", ",", "ind7"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind6", ",", 
                    RowBox[{"-", "ind5"}], ",", 
                    RowBox[{"-", "ind7"}]}], "]"}]}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], "]"}]}]}], "}"}],
                     "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4"}], "]"}], "]"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], "]"}], 
                    RowBox[{"g", "[", 
                    RowBox[{"ind4", ",", "ind6"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind5"}], ",", 
                    RowBox[{"-", "ind6"}]}], "]"}]}], "\[IndentingNewLine]", 
                    "+", 
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"ind3", ",", "ind5"}], "]"}], 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"ind4", ",", "ind6"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind5"}], ",", 
                    RowBox[{"-", "ind6"}]}], "]"}]}]}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], "]"}]}]}], "}"}],
                     "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", "--"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
             
             RowBox[{"(*", " ", 
              RowBox[{
              "We", " ", "now", " ", "define", " ", "the", " ", "connection", 
               " ", "and", " ", "the", " ", "Riemann", " ", "tensor", " ", 
               "of", " ", "the", " ", "induced", " ", 
               RowBox[{"metric", ".", " ", "See"}], " ", "draft"}], " ", 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"IndexSet", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Connection", "[", "h", "]"}], "[", 
                RowBox[{"i1_", ",", "i2_", ",", "i3_"}], "]"}], ",", 
               RowBox[{
                RowBox[{"1", "/", "2"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"CS", "[", "h", "]"}], "[", 
                   RowBox[{"i2", ",", "i1", ",", "i3"}], "]"}], "-", 
                  RowBox[{
                   RowBox[{"CS", "[", "h", "]"}], "[", 
                   RowBox[{"i1", ",", "i3", ",", "i2"}], "]"}], "+", 
                  RowBox[{
                   RowBox[{"CS", "[", "h", "]"}], "[", 
                   RowBox[{"i3", ",", "i1", ",", "i2"}], "]"}]}], ")"}]}]}], 
              "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"SpaceTimeType", "===", "\"\<FLCurved\>\""}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"IndexSet", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                   RowBox[{"i1_", ",", "i2_", ",", "i3_", ",", "i4_"}], "]"}],
                   ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"\[ScriptK]", "[", "h", "]"}], "[", "]"}], 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i3"}], "]"}], 
                    RowBox[{"h", "[", 
                    RowBox[{"i2", ",", "i4"}], "]"}]}], "-", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i4"}], "]"}], 
                    RowBox[{"h", "[", 
                    RowBox[{"i2", ",", "i3"}], "]"}]}]}], ")"}]}]}], "]"}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"IndexSet", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                   RowBox[{"i1_", ",", "i2_"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"\[ScriptK]", "[", "h", "]"}], "[", "]"}], 
                   RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i3", ",", 
                    RowBox[{"-", "i3"}]}], "]"}], "-", "1"}], ")"}]}]}], 
                 "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"IndexSet", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"RicciScalar", "[", "cd", "]"}], "[", "]"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"\[ScriptK]", "[", "h", "]"}], "[", "]"}], 
                   RowBox[{"h", "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"-", "i1"}]}], "]"}], 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i3", ",", 
                    RowBox[{"-", "i3"}]}], "]"}], "-", "1"}], ")"}]}]}], 
                 "]"}], ";"}], ",", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "Rieman", " ", "Ricci", " ", "and", " ", "RicciScalar", " ", 
                 "tensors"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"IndexSet", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                    RowBox[{"i1_", ",", "i2_", ",", "i3_", ",", "i4_"}], 
                    "]"}], ",", " ", 
                   RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i2"}], "]"}]}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i4", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i4", ",", "i2"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i3", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "-", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i4"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"-", "i5"}], ",", "i2"}], "]"}]}]}], "]"}]}]}], 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"IndexSet", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                    RowBox[{"i1_", ",", "i3_"}], "]"}], ",", " ", 
                   RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "i2"}], ",", 
                    RowBox[{"-", "i4"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i2"}], "]"}]}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i4", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i4", ",", "i2"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i3", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "-", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i4"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"-", "i5"}], ",", "i2"}], "]"}]}]}], ")"}]}], 
                    "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"IndexSet", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"RicciScalar", "[", "cd", "]"}], "[", "]"}], ",", 
                   " ", 
                   RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "i2"}], ",", 
                    RowBox[{"-", "i4"}]}], "]"}], 
                    RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "i1"}], ",", 
                    RowBox[{"-", "i3"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i2"}], "]"}]}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i4", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i4", ",", "i2"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i3", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "-", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i4"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"-", "i5"}], ",", "i2"}], "]"}]}]}], ")"}]}], 
                    "]"}]}]}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"ConstantsOfStructureRules", "[", "h", "]"}], "=", 
                 RowBox[{"Flatten", "@", 
                  RowBox[{"Join", "[", 
                   RowBox[{
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                    RowBox[{"i1", ",", "i2", ",", "i3", ",", "i4"}], "]"}], 
                    ",", " ", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i2"}], "]"}]}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i4", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i4", ",", "i2"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i3", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "-", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i4"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"-", "i5"}], ",", "i2"}], "]"}]}]}], ")"}], 
                    RowBox[{"(*", 
                    RowBox[{"/.", 
                    RowBox[{"ConstantsDecompositionRules", "[", "h", "]"}]}], 
                    "*)"}], "]"}]}]}], "}"}], "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                    RowBox[{"i1", ",", "i3"}], "]"}], ",", " ", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "i2"}], ",", 
                    RowBox[{"-", "i4"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i2"}], "]"}]}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i4", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i4", ",", "i2"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i3", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "-", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i4"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"-", "i5"}], ",", "i2"}], "]"}]}]}], ")"}]}], 
                    ")"}], 
                    RowBox[{"(*", 
                    RowBox[{"/.", 
                    RowBox[{"ConstantsDecompositionRules", "[", "h", "]"}]}], 
                    "*)"}], "]"}]}]}], "}"}], "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RicciScalar", "[", "cd", "]"}], "[", "]"}], ",", 
                    " ", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "i2"}], ",", 
                    RowBox[{"-", "i4"}]}], "]"}], 
                    RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "i1"}], ",", 
                    RowBox[{"-", "i3"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i2"}], "]"}]}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i4", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i4", ",", "i2"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", "i3", ",", 
                    RowBox[{"-", "i5"}]}], "]"}]}], "-", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"i5", ",", "i3", ",", "i4"}], "]"}], 
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"-", "i5"}], ",", "i2"}], "]"}]}]}], ")"}]}], 
                    ")"}], 
                    RowBox[{"(*", 
                    RowBox[{"/.", 
                    RowBox[{"ConstantsDecompositionRules", "[", "h", "]"}]}], 
                    "*)"}], "]"}]}]}], "}"}], "]"}], "]"}]}], 
                   "\[IndentingNewLine]", "]"}]}]}], ";"}]}], 
              "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "We", " ", "replace", " ", "the", " ", "extrinsic", " ", 
               "curvature", " ", "with", " ", "an", " ", "adhoc", " ", 
               "tensor", " ", "which", " ", "can", " ", "have", " ", 
               "derivatives", " ", "label", " ", "indices"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"DefProjectedTensor", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"K", "[", "h", "]"}], "[", 
                RowBox[{
                 RowBox[{"-", "ind1"}], ",", 
                 RowBox[{"-", "ind2"}]}], "]"}], ",", "h", ",", 
               RowBox[{"TensorProperties", "->", 
                RowBox[{"{", 
                 RowBox[{
                 "\"\<SymmetricTensor\>\"", ",", "\"\<Traceless\>\""}], 
                 "}"}]}], ",", 
               RowBox[{"SpaceTimesOfDefinition", "->", 
                RowBox[{"{", "\"\<Background\>\"", "}"}]}], ",", 
               RowBox[{"PrintAs", "\[Rule]", "\"\<K\>\""}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
               RowBox[{"i1_", ",", "i2_"}], "]"}], ":=", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{"$ConformalTime", ",", "1", ",", 
                 RowBox[{
                  RowBox[{"a", "[", "h", "]"}], "[", "]"}]}], "]"}], "*", 
               RowBox[{
                RowBox[{"K", "[", "h", "]"}], "[", 
                RowBox[{
                 RowBox[{"LI", "[", "0", "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                "]"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "0", "]"}], ",", 
                  RowBox[{"LI", "[", "q_", "]"}], ",", "i1_", ",", "i2_"}], 
                 "]"}], ":=", 
                RowBox[{
                 RowBox[{"K", "[", "h", "]"}], "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "0", "]"}], ",", 
                  RowBox[{"LI", "[", "q", "]"}], ",", "i1", ",", "i2"}], 
                 "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
                RowBox[{"PrintAs", "[", "Kh", "]"}], "^=", 
                "printextrinsicK"}], ";"}], "*)"}], "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"NoAnisotropyBool", "[", "SpaceTimeType", "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
                  RowBox[{"i1_", ",", "i2_"}], "]"}], "=", "0"}], ";", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"K", "[", "h", "]"}], "]"}], "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "0", "]"}], ",", 
                   RowBox[{"LI", "[", "0", "]"}], ",", "i1_", ",", "i2_"}], 
                  "]"}], "=", "0"}], ";"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
               "Commutation", " ", "of", " ", "Lie", " ", "and", " ", 
                "Partial", " ", 
                RowBox[{"derivatives", ".", " ", "Very"}], " ", "important", 
                " ", 
                RowBox[{"here", ".", " ", "See"}], " ", "draft", " ", "for", 
                " ", "the", " ", "formula", " ", "which", " ", "is", " ", 
                "implemented"}], "..."}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"Unprotect", "[", "LieD", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"A", " ", "revoir"}], "..."}], " ", "This", " ", "is",
                " ", "to", " ", "commute", " ", "Lie", " ", "and", " ", 
               "induced", " ", "derivative", " ", "when", " ", "the", " ", 
               "indices", " ", "are", " ", 
               RowBox[{"up", ".", " ", "Basically"}], " ", "it", " ", "just", 
               " ", "ensure", " ", "that", " ", "indices", " ", "should", " ",
                "be", " ", "put", " ", 
               RowBox[{"down", "."}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"LieD", "[", 
                RowBox[{"u", "[", "ind1_", "]"}], "]"}], "[", 
               RowBox[{
                RowBox[{"cd", "[", "ind2_", "]"}], "[", "expr1_", "]"}], 
               "]"}], ":=", 
              RowBox[{
               RowBox[{
                RowBox[{"LieD", "[", 
                 RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                RowBox[{"IndicesDown", "[", 
                 RowBox[{
                  RowBox[{"cd", "[", "ind2", "]"}], "[", "expr1", "]"}], " ", 
                 "]"}], " ", "]"}], "/;", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"IndicesOf", "[", 
                    RowBox[{"Free", ",", "Up"}], "]"}], "[", 
                   RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", "expr1", "]"}], 
                   "]"}], "]"}], "=!=", "0"}], "&&", 
                RowBox[{
                 RowBox[{"OrthogonalToVectorQ", "[", "u", "]"}], "[", "expr1",
                  "]"}], "&&", 
                RowBox[{
                 RowBox[{"Abs", "[", 
                  RowBox[{
                   RowBox[{"u", "[", "ind1", "]"}], 
                   RowBox[{"u", "[", 
                    RowBox[{"-", "ind1"}], "]"}]}], "]"}], "===", "1"}]}]}]}],
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"LieD", "[", 
                RowBox[{"u", "[", "ind1_", "]"}], "]"}], "[", 
               RowBox[{
                RowBox[{"cd", "[", 
                 RowBox[{"ind2_", "?", "DownIndexQ"}], "]"}], "[", "expr1_", 
                "]"}], "]"}], ":=", 
              RowBox[{
               RowBox[{"Module", "[", 
                RowBox[{
                 RowBox[{"{", "dum", "}"}], ",", 
                 RowBox[{
                  RowBox[{"dum", "=", 
                   RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"With", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"frees", "=", 
                    RowBox[{"FindFreeIndices", "[", "expr1", "]"}]}], "}"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"ToCanonical", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", "expr1", 
                    "]"}], "]"}], "\[IndentingNewLine]", "+", 
                    RowBox[{"$ExtrinsicKSign", " ", "*", 
                    RowBox[{"Plus", "@@", 
                    RowBox[{"(", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"cd", "[", "#", "]"}], "[", 
                    RowBox[{
                    RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", "dum"}], "]"}], "]"}]}], 
                    RowBox[{"ReplaceIndex", "[", 
                    RowBox[{"expr1", ",", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{"-", "dum"}]}]}], "]"}]}], "\[IndentingNewLine]", 
                    "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "dum", "]"}], "[", 
                    RowBox[{
                    RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
                    RowBox[{"#", ",", "ind2"}], "]"}], "]"}], 
                    RowBox[{"ReplaceIndex", "[", 
                    RowBox[{"expr1", ",", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{"-", "dum"}]}]}], "]"}]}], "\[IndentingNewLine]", 
                    "-", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"ExtrinsicK", "[", "h", "]"}], "[", 
                    RowBox[{"dum", ",", "#"}], "]"}], "]"}], 
                    RowBox[{"ReplaceIndex", "[", 
                    RowBox[{"expr1", ",", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{"-", "dum"}]}]}], "]"}]}]}], ")"}], "&"}], "/@", 
                    "frees"}], ")"}]}]}]}], ")"}], "\[IndentingNewLine]", ",", 
                    RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
                    "]"}]}], "]"}]}]}], "]"}], "/;", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"IndicesOf", "[", 
                    RowBox[{"Free", ",", "Up"}], "]"}], "[", "expr1", "]"}], 
                  "]"}], "===", "0"}], "&&", 
                RowBox[{
                 RowBox[{"OrthogonalToVectorQ", "[", "u", "]"}], "[", "expr1",
                  "]"}], "&&", 
                RowBox[{
                 RowBox[{"Abs", "[", 
                  RowBox[{
                   RowBox[{"u", "[", "ind1", "]"}], 
                   RowBox[{"u", "[", 
                    RowBox[{"-", "ind1"}], "]"}]}], "]"}], "===", "1"}]}]}]}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"Protect", "[", "LieD", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"OLD", " ", "STuff"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "The", " ", "only", " ", "CovD", " ", "that", " ", "I", " ", 
               "think", " ", "should", " ", "be", " ", 
               RowBox[{"automatic", ".", " ", "It"}], " ", "is", " ", "the", 
               " ", "CovD", " ", "on", " ", "extrinsic", " ", 
               RowBox[{"curvature", "."}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"However", ",", " ", 
               RowBox[{
               "it", " ", "clearly", " ", "creates", " ", "problems", " ", 
                "so", " ", "I", " ", "remove", " ", "the", " ", 
                "automaticity"}]}], " ", "*)"}], "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"AnisotropyBool", "@", "SpaceTimeType"}], "||", 
                  RowBox[{"BianchiBool", "@", "SpaceTimeType"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"AutomaticRules", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"K", "[", "h", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", "q", "}"}]}], "]"}], "&"}], "/@", 
                    "\[IndentingNewLine]", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2", ",", "ind3"}],
                     "]"}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"ToCanonical", "[", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"ToInducedDerivative", "[", 
                    RowBox[{
                    RowBox[{"IndicesDown", "[", 
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2", ",", "ind3"}],
                     "]"}], "]"}], "]"}], ",", "CD", ",", "cd"}], "]"}], "//",
                     "GradNormalToExtrinsicK"}], "]"}], "]"}]}], "}"}], "]"}],
                     "]"}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
               ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"**", "*"}], " ", "*)"}], "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"BianchiBool", "@", "SpaceTimeType"}], ")"}], "&&", 
                RowBox[{"(", 
                 RowBox[{"Not", "@", 
                  RowBox[{"FlatSpaceBool", "@", "SpaceTimeType"}]}], ")"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "Automatic", " ", "rules", " ", "for", " ", "the", " ", 
                   "gradients", " ", "of", " ", "the", " ", "constants", " ", 
                   "of", " ", 
                   RowBox[{"structure", ".", " ", "I"}], " ", "should", " ", 
                   "define", " ", "one", " ", "function", " ", "only", " ", 
                   "to", " ", "define", " ", "these", " ", "rules", " ", 
                   "since", " ", "it", " ", "is", " ", "also", " ", "called", 
                   " ", "in", " ", "the", " ", "DefSTFTensor"}], "..."}], " ",
                  "Here", " ", "I", " ", "keep", " ", "the", " ", "way", " ", 
                 "it", " ", "was", " ", "implemented", " ", "in", " ", "the", 
                 " ", "first", " ", "version"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4"}], "]"}], "]"}], 
                    ",", 
                    RowBox[{"ToCanonical", "[", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    "Minus", " ", "the", " ", "connection", " ", "for", " ", 
                    "down", " ", "indices"}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"-", 
                    RowBox[{"Plus", "@@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"dummy", ",", "ind1", ",", "#"}], "]"}], " ", 
                    RowBox[{"ReplaceIndex", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4"}], "]"}], "]"}], 
                    ",", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{"-", "dummy"}]}]}], "]"}]}], ")"}], "&"}], "/@", 
                    RowBox[{"{", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4"}], "}"}]}], 
                    ")"}]}]}], "]"}]}], "\[IndentingNewLine]", "}"}], "]"}], 
                   "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                  RowBox[{"From", " ", "this"}], ",", " ", 
                  RowBox[{
                   RowBox[{"the", " ", "n"}], "+", 
                   RowBox[{
                   "1", " ", "splitting", " ", "of", " ", "Covariant", " ", 
                    "derivatives", " ", "is", " ", 
                    RowBox[{"obvious", "."}]}]}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"CS", "[", "h", "]"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4"}], "]"}], "]"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"ToCanonical", "[", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"ToInducedDerivative", "[", 
                    RowBox[{
                    RowBox[{"IndicesDown", "[", 
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"CS", "[", "h", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4"}], "]"}], "]"}], 
                    "]"}], ",", "CD", ",", "cd"}], "]"}], "//", 
                    "GradNormalToExtrinsicK"}], "]"}], "]"}]}], "}"}], "]"}], 
                   "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                 "TODO", " ", "Finish", " ", "correctly", " ", "this", " ", 
                  "part"}], " ", "*)"}], "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                  RowBox[{
                  "Incomplete", " ", "here", " ", "for", " ", "the", " ", 
                   "Rieman", " ", 
                   RowBox[{"induced", ".", " ", "One"}], " ", "should", " ", 
                   "enforce", " ", "the", " ", "splitting", " ", "and", " ", 
                   "also", " ", "the", " ", "treatment", " ", "of", " ", 
                   "Lie", " ", "derivative"}], "..."}], "*)"}], 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"The", " ", "most", " ", "important", " ", 
                  RowBox[{"part", ":", " ", 
                   RowBox[{
                   "induced", " ", "derivatives", " ", "on", " ", "Riemann", 
                    " ", "and", " ", 
                    RowBox[{"Ricci", "."}]}]}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"Riemann", "[", "cd", "]"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4", ",", "ind5"}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"ToCanonical", "[", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    "Minus", " ", "the", " ", "connection", " ", "for", " ", 
                    "down", " ", "indices"}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"-", 
                    RowBox[{"Plus", "@@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"dummy", ",", "ind1", ",", "#"}], "]"}], " ", 
                    RowBox[{"ReplaceIndex", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{
                    RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4", ",", "ind5"}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{"-", "dummy"}]}]}], "]"}]}], ")"}], "&"}], "/@", 
                    RowBox[{"{", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4", ",", "ind5"}], 
                    "}"}]}], ")"}]}]}], "]"}]}], "\[IndentingNewLine]", "}"}],
                     "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"Ricci", "[", "cd", "]"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3"}], "]"}], "]"}], ",", 
                    RowBox[{"ToCanonical", "[", "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    "Minus", " ", "the", " ", "connection", " ", "for", " ", 
                    "down", " ", "indices"}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"-", 
                    RowBox[{"Plus", "@@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Connection", "[", "h", "]"}], "[", 
                    RowBox[{"dummy", ",", "ind1", ",", "#"}], "]"}], " ", 
                    RowBox[{"ReplaceIndex", "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{
                    RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3"}], "]"}], "]"}], ",", 
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{"-", "dummy"}]}]}], "]"}]}], ")"}], "&"}], "/@", 
                    RowBox[{"{", 
                    RowBox[{"ind2", ",", "ind3"}], "}"}]}], ")"}]}]}], 
                    "]"}]}], "\[IndentingNewLine]", "}"}], "]"}], "]"}]}], 
                 "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"RicciScalar", "[", "cd", "]"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"RicciScalar", "[", "cd", "]"}], "[", "]"}], 
                    "]"}], ",", "0"}], "}"}], "]"}], "]"}]}], "]"}], ";", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"3", "+", 
                  RowBox[{
                  "1", " ", "splitting", " ", "of", " ", "CD", " ", "on", " ",
                    "Riemann", " ", "and", " ", 
                   RowBox[{"Ricci", ".", " ", "Should"}], " ", "never", " ", 
                   "be", " ", "used", " ", "in", " ", "general", " ", 
                   "unless", " ", "the", " ", "user", " ", "wants", " ", "to",
                    " ", "split", " ", 
                   RowBox[{
                    RowBox[{"CD", "[", "Riemann", "]"}], ".", " ", "Very"}], 
                   " ", 
                   RowBox[{"unlikely", "."}]}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                 "I", " ", "comment", " ", "out", " ", "for", " ", "the", " ",
                   "moment", " ", "but", " ", "it", " ", "should", " ", "be", 
                  " ", "all", " ", "right"}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"Riemann", "[", "cd", "]"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4", ",", "ind5"}], 
                    "]"}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"ToCanonical", "[", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"ToInducedDerivative", "[", 
                    RowBox[{
                    RowBox[{"IndicesDown", "[", 
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3", ",", "ind4", ",", "ind5"}], 
                    "]"}], "]"}], "]"}], ",", "CD", ",", "cd"}], "]"}], "//", 
                    "GradNormalToExtrinsicK"}], "]"}], "]"}]}], "}"}], "]"}], 
                   "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"Ricci", "[", "cd", "]"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3"}], "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"ToCanonical", "[", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"ToInducedDerivative", "[", 
                    RowBox[{
                    RowBox[{"IndicesDown", "[", 
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                    RowBox[{"ind2", ",", "ind3"}], "]"}], "]"}], "]"}], ",", 
                    "CD", ",", "cd"}], "]"}], "//", 
                    "GradNormalToExtrinsicK"}], "]"}], "]"}]}], "}"}], "]"}], 
                   "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"RicciScalar", "[", "cd", "]"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"RicciScalar", "[", "cd", "]"}], "[", "]"}], 
                    "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"ToCanonical", "[", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"ToInducedDerivative", "[", 
                    RowBox[{
                    RowBox[{"IndicesDown", "[", 
                    RowBox[{
                    RowBox[{"CD", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"RicciScalar", "[", "cd", "]"}], "[", "]"}], 
                    "]"}], "]"}], ",", "CD", ",", "cd"}], "]"}], "//", 
                    "GradNormalToExtrinsicK"}], "]"}], "]"}]}], "}"}], "]"}], 
                   "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                  RowBox[{
                  "In", " ", "that", " ", "case", " ", "we", " ", "also", " ",
                    "need", " ", "to", " ", "treat", " ", "the", " ", "Lie", 
                   " ", "Derivative", " ", "which", " ", "comes", " ", "from",
                    " ", "thsi", " ", "3"}], "+", 
                  RowBox[{"1", " ", "splitting"}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                 "Lie", " ", "D", " ", "with", " ", "down", " ", "indices"}], 
                 " ", "*)"}], "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"Riemann", "[", "cd", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", 
                    RowBox[{"-", "ind3"}], ",", 
                    RowBox[{"-", "ind4"}], ",", 
                    RowBox[{"-", "ind5"}]}], "]"}], "]"}], ",", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Riemann", "[", "cd", "]"}], "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", 
                    RowBox[{"-", "ind3"}], ",", 
                    RowBox[{"-", "ind4"}], ",", 
                    RowBox[{"-", "ind5"}]}], "]"}], "/.", 
                    RowBox[{"ConstantsOfStructureRules", "[", "h", "]"}]}], 
                    "]"}], "]"}]}]}], " ", "}"}], "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"Ricci", "[", "cd", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", 
                    RowBox[{"-", "ind3"}]}], "]"}], "]"}], ",", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Ricci", "[", "cd", "]"}], "[", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", 
                    RowBox[{"-", "ind3"}]}], "]"}], "/.", 
                    RowBox[{"ConstantsOfStructureRules", "[", "h", "]"}]}], 
                    "]"}], "]"}]}]}], " ", "}"}], "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"AutomaticRules", "[", 
                 RowBox[{
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"RicciScalar", "[", "cd", "]"}], "]"}], ",", 
                  RowBox[{"MakeRule", "[", 
                   RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"RicciScalar", "[", "cd", "]"}], "[", "]"}], 
                    "]"}], ",", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "ind1", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RicciScalar", "[", "cd", "]"}], "[", "]"}], "/.", 
                    RowBox[{"ConstantsOfStructureRules", "[", "h", "]"}]}], 
                    "]"}], "]"}]}]}], " ", "}"}], "]"}], ",", 
                    RowBox[{"MetricOn", "\[Rule]", "None"}]}], "]"}]}], "]"}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                 "Extension", " ", "to", " ", "any", " ", "position", " ", 
                  "of", " ", "indices"}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"Riemann", "[", "cd", "]"}], "]"}], "/:", 
                 RowBox[{
                  RowBox[{"LieD", "[", 
                   RowBox[{"u", "[", "dummy_", "]"}], "]"}], "[", 
                  RowBox[{
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"Riemann", "[", "cd", "]"}], "]"}], "[", 
                   RowBox[{"indices1___", ",", 
                    RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices2___"}],
                    "]"}], "]"}], ":=", "\[IndentingNewLine]", 
                 RowBox[{"Module", "[", 
                  RowBox[{
                   RowBox[{"{", "dum", "}"}], ",", 
                   RowBox[{
                    RowBox[{"dum", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ";", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: a Lie derivative with up indices has \
been converted (safely) to a Lie derivative with down indices **\>\"", "]"}], 
                    ";"}], "*)"}], 
                    RowBox[{
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "dum"}], "]"}], 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Riemann", "[", "cd", "]"}], "]"}], "[", 
                    RowBox[{"indices1", ",", 
                    RowBox[{"-", "dum"}], ",", "indices2"}], "]"}], "]"}]}], 
                    "+", 
                    RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "dum"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Riemann", "[", "cd", "]"}], "]"}], "[", 
                    RowBox[{"indices1", ",", 
                    RowBox[{"-", "dum"}], ",", "indices2"}], "]"}]}], 
                    "]"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"Ricci", "[", "cd", "]"}], "]"}], "/:", 
                 RowBox[{
                  RowBox[{"LieD", "[", 
                   RowBox[{"u", "[", "dummy_", "]"}], "]"}], "[", 
                  RowBox[{
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"Ricci", "[", "cd", "]"}], "]"}], "[", 
                   RowBox[{"indices1___", ",", 
                    RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices2___"}],
                    "]"}], "]"}], ":=", "\[IndentingNewLine]", 
                 RowBox[{"Module", "[", 
                  RowBox[{
                   RowBox[{"{", "dum", "}"}], ",", 
                   RowBox[{
                    RowBox[{"dum", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ";", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: a Lie derivative with up indices has \
been converted (safely) to a Lie derivative with down indices **\>\"", "]"}], 
                    ";"}], "*)"}], 
                    RowBox[{
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "dum"}], "]"}], 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Ricci", "[", "cd", "]"}], "]"}], "[", 
                    RowBox[{"indices1", ",", 
                    RowBox[{"-", "dum"}], ",", "indices2"}], "]"}], "]"}]}], 
                    "+", 
                    RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "dum"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"Ricci", "[", "cd", "]"}], "]"}], "[", 
                    RowBox[{"indices1", ",", 
                    RowBox[{"-", "dum"}], ",", "indices2"}], "]"}]}], 
                    "]"}]}]}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "We", " ", "gather", " ", "many", " ", "many", " ", "rules", 
               " ", "for", " ", "the", " ", "commutation", " ", "of", " ", 
               "induced", " ", 
               RowBox[{"derivatives", ".", " ", "These"}], " ", "are", " ", 
               "in", " ", "general", " ", "made", " ", "to", " ", "make", " ",
                "sure", " ", "that", " ", "the", " ", "transverse", " ", 
               "conditions", " ", "of", " ", "vectors", " ", "and", " ", 
               "tensors", " ", "are", " ", 
               RowBox[{"used", ".", " ", "It"}], " ", "is", " ", "also", " ", 
               "made", " ", "to", " ", "gather", " ", 
               RowBox[{"Laplacians", "."}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"DummyS", "[", "Sym_", "]"}], ":=", 
              RowBox[{"SymbolJoin", "[", 
               RowBox[{"DS", ",", "Sym"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"DummyV", "[", "Sym_", "]"}], ":=", 
              RowBox[{"SymbolJoin", "[", 
               RowBox[{"DV", ",", "Sym"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"DummyT", "[", "Sym_", "]"}], ":=", 
              RowBox[{"SymbolJoin", "[", 
               RowBox[{"DT", ",", "Sym"}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Block", "[", 
              RowBox[{
               RowBox[{"{", "Print", "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"DefProjectedTensor", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", "]"}], ",",
                   "h", ",", 
                  RowBox[{"SpaceTimesOfDefinition", "->", 
                   RowBox[{"{", "\"\<Perturbed\>\"", "}"}]}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"DefProjectedTensor", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                   RowBox[{"-", "ind1"}], "]"}], ",", "h", ",", 
                  RowBox[{"SpaceTimesOfDefinition", "->", 
                   RowBox[{"{", "\"\<Perturbed\>\"", "}"}]}], ",", 
                  RowBox[{"TensorProperties", "->", 
                   RowBox[{"{", "\"\<Transverse\>\"", "}"}]}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"DefProjectedTensor", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyT", "[", "h", "]"}], "]"}], "[", 
                   RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}], ",", "h", ",", 
                  RowBox[{"TensorProperties", "->", 
                   RowBox[{"{", 
                    RowBox[{
                    "\"\<SymmetricTensor\>\"", ",", "\"\<Transverse\>\"", 
                    ",", "\"\<Traceless\>\""}], "}"}]}], ",", 
                  RowBox[{"SpaceTimesOfDefinition", "->", 
                   RowBox[{"{", "\"\<Perturbed\>\"", "}"}]}]}], "]"}], 
                ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"$CommutecdRules", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"$CommutecdRules", ",", 
                RowBox[{"Flatten", "@", 
                 RowBox[{"Join", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftScalar", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind3", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind3", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind1"}]}], "}"}]}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind3", ",", 
                    RowBox[{"-", "ind1"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftScalar", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind3", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind3", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind3", ",", 
                    RowBox[{"-", "ind1"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftScalar", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind3", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind3", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind3", ",", "ind1"}], "}"}]}], "]"}], ",", "cd", 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"ind3", ",", 
                    RowBox[{"-", "ind1"}]}], "}"}]}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind2", ",", "ind1"}], "}"}]}], "]"}], ",", "cd", 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind1"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftScalar", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftScalar", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyS", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}]}], "]"}], "]"}], "]"}], 
                    "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", "ind2"}], "}"}]}], "]"}], ",",
                     "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftVector", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2"}], "]"}]}], 
                    "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "}"}]}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind1", ",", 
                    RowBox[{"-", "ind2"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftVector", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2"}], "]"}]}], 
                    "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "}"}]}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind1", ",", 
                    RowBox[{"-", "ind2"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftVector", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind3"}], "]"}]}], 
                    "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind3"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind3"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind3"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind3"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind1", ",", 
                    RowBox[{"-", "ind3"}]}], "}"}]}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind3"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftVector", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind3"}], "]"}]}], 
                    "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind3"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind3"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind3"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind2", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind3"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind2", ",", 
                    RowBox[{"-", "ind3"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftVector", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2"}], "]"}]}], 
                    "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind3"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind3", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind3"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind3", "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2"}], "]"}], 
                    "]"}], "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{"ind3", ",", 
                    RowBox[{"-", "ind1"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftVector", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind1"}], "]"}]}], 
                    "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind1"}], "]"}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyV", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind1"}], "]"}], 
                    "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "ind2"}], ",", 
                    RowBox[{"-", "ind1"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"PatternLeft", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "q"}], "}"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PatternTensorLeftTensor", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyT", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2", ",", "ind3"}],
                     "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"MakeRule", "[", 
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyT", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2", ",", "ind3"}],
                     "]"}], "]"}], "]"}], ",", 
                    RowBox[{"org", "[", 
                    RowBox[{"CommuteCovDs", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind2"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"cd", "[", 
                    RowBox[{"-", "ind1"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"DummyT", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "ind2", ",", "ind3"}],
                     "]"}], "]"}], "]"}], ",", "cd", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "ind1"}], ",", 
                    RowBox[{"-", "ind2"}]}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "]"}], "]"}]}], ")"}]}]}], "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", "]"}]}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Block", "[", 
              RowBox[{
               RowBox[{"{", "Print", "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"UndefTensor", "[", 
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"DummyS", "[", "h", "]"}], "]"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"UndefTensor", "[", 
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"DummyV", "[", "h", "]"}], "]"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"UndefTensor", "[", 
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"DummyT", "[", "h", "]"}], "]"}], "]"}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
               "If", " ", "there", " ", "is", " ", "a", " ", "up", " ", 
                "index", " ", "on", " ", "the", " ", "Lie", " ", "derivative",
                 " ", "of", " ", "extrinsic", " ", "curvature"}], ",", " ", 
               RowBox[{"it", " ", "is", " ", "converted", " ", 
                RowBox[{"automatically", ".", "\[IndentingNewLine]", "That"}],
                 " ", "way"}], ",", " ", 
               RowBox[{
                RowBox[{"the", " ", "n"}], "+", 
                RowBox[{
                "1", " ", "splitting", " ", "of", " ", "Cov", " ", "Ds", " ", 
                 "on", " ", "extrinsic", " ", "curvatrue", " ", "is", " ", 
                 "completely", " ", 
                 RowBox[{"automatic", ".", " ", "It"}], " ", "is", " ", "the",
                  " ", "only", " ", "tensor", " ", "for", " ", "which", " ", 
                 "it", " ", "is", " ", "completely", " ", "automatic"}]}]}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"Not", "@", 
                RowBox[{"NoAnisotropyBool", "[", "SpaceTimeType", "]"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"Evaluate", "[", 
                  RowBox[{"K", "[", "h", "]"}], "]"}], "/:", 
                 RowBox[{
                  RowBox[{"LieD", "[", 
                   RowBox[{"u", "[", "dummy_", "]"}], "]"}], "[", 
                  RowBox[{
                   RowBox[{"Evaluate", "[", 
                    RowBox[{"K", "[", "h", "]"}], "]"}], "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "n_", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices1___", ",", 
                    RowBox[{"indup_", "?", "UpIndexQ"}], ",", "indices2___"}],
                    "]"}], "]"}], ":=", "\[IndentingNewLine]", 
                 RowBox[{"Module", "[", 
                  RowBox[{
                   RowBox[{"{", "dum", "}"}], ",", 
                   RowBox[{
                    RowBox[{"dum", "=", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"Tangent", "[", "Manifold", "]"}], "]"}]}], ";", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<** Warning: a Lie derivative with up indices has \
been converted (safely) to a Lie derivative with down indices **\>\"", "]"}], 
                    ";"}], "*)"}], 
                    RowBox[{
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "dum"}], "]"}], 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"K", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "dum"}], ",", "indices2"}], "]"}], "]"}]}], 
                    "+", 
                    RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"u", "[", "dummy", "]"}], "]"}], "[", 
                    RowBox[{"g", "[", 
                    RowBox[{"indup", ",", "dum"}], "]"}], "]"}], 
                    RowBox[{
                    RowBox[{"Evaluate", "[", 
                    RowBox[{"K", "[", "h", "]"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "q", "]"}], ",", "indices1", ",", 
                    RowBox[{"-", "dum"}], ",", "indices2"}], "]"}]}], 
                    "]"}]}]}]}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
              "]"}], ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
      "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"SetSlicing", ",", "6"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", "SetSlicing", "]"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Default", " ", 
    RowBox[{"value", ".", " ", "It"}], " ", "is", " ", "overwritten", " ", 
    "if", " ", "there", " ", "is", " ", "curvature"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConstantsOfStructureRules", "[", "_", "]"}], ":=", 
    RowBox[{"{", "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ToConstantsOfStructure", "[", 
    RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
   RowBox[{"Function", "[", 
    RowBox[{"expr", ",", 
     RowBox[{"expr", "/.", 
      RowBox[{"ConstantsOfStructureRules", "[", "h", "]"}]}]}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562554099687901*^9, 3.562554337929538*^9}, {
   3.5625544041287193`*^9, 3.562554439630183*^9}, {3.562554481719222*^9, 
   3.562554492874317*^9}, {3.562554880767206*^9, 3.562554910176565*^9}, {
   3.562555569563814*^9, 3.562555571691061*^9}, {3.56255561667791*^9, 
   3.5625556329874353`*^9}, {3.562555668920652*^9, 3.56255579825629*^9}, {
   3.562555969075055*^9, 3.5625559715220337`*^9}, {3.5625562053016*^9, 
   3.562556232976832*^9}, {3.562556369696848*^9, 3.5625564127661867`*^9}, {
   3.5625564450986967`*^9, 3.56255648257791*^9}, {3.5625565181906223`*^9, 
   3.562556558174244*^9}, {3.5625587308015413`*^9, 3.562558801868422*^9}, {
   3.562558875084219*^9, 3.5625588765556383`*^9}, {3.5625590688969507`*^9, 
   3.562559098380336*^9}, {3.562559153625614*^9, 3.562559153921217*^9}, {
   3.5625598733441257`*^9, 3.562560007913719*^9}, {3.562560073608678*^9, 
   3.562560214074239*^9}, {3.5625602485961447`*^9, 3.562560265465034*^9}, {
   3.5625604443349743`*^9, 3.562560489063086*^9}, {3.562560527154604*^9, 
   3.562560532439725*^9}, {3.562560573385611*^9, 3.562560579192648*^9}, {
   3.5625607470754747`*^9, 3.562560753939637*^9}, {3.5625608726900597`*^9, 
   3.5625609401234417`*^9}, {3.5625609938224*^9, 3.562561068534689*^9}, {
   3.562561141852759*^9, 3.5625611661990213`*^9}, {3.562561231596307*^9, 
   3.562561270659546*^9}, 3.5625613905136433`*^9, {3.562561577886376*^9, 
   3.562561605234942*^9}, {3.562561669527358*^9, 3.562561724737091*^9}, {
   3.562561828621792*^9, 3.5625618634632483`*^9}, {3.5625619200879087`*^9, 
   3.5625619600326138`*^9}, 3.562562113373547*^9, {3.5625622396825933`*^9, 
   3.562562277726513*^9}, {3.5625623787765913`*^9, 3.562562447141911*^9}, {
   3.562562498704878*^9, 3.562562510935645*^9}, {3.562562549870932*^9, 
   3.562562550181665*^9}, {3.562562590247369*^9, 3.562562614451276*^9}, {
   3.5625626661114063`*^9, 3.56256267060577*^9}, {3.562562726088254*^9, 
   3.5625627674468517`*^9}, {3.562570059318995*^9, 3.562570059466641*^9}, {
   3.562657879176167*^9, 3.5626579341564207`*^9}, {3.5626582249671*^9, 
   3.5626582294433002`*^9}, {3.562658292907963*^9, 3.562658336078396*^9}, {
   3.562658371671092*^9, 3.56265838119707*^9}, {3.5626604231404467`*^9, 
   3.562660431061995*^9}, {3.562661429801517*^9, 3.562661490914093*^9}, {
   3.562661530533696*^9, 3.562661558128161*^9}, {3.562663027632512*^9, 
   3.562663132885597*^9}, {3.562663172078166*^9, 3.5626632261482353`*^9}, {
   3.562663257293324*^9, 3.5626632877581244`*^9}, {3.5626633457325363`*^9, 
   3.562663424043745*^9}, {3.5626635823578873`*^9, 3.562663640445128*^9}, {
   3.56266375409225*^9, 3.562663770133378*^9}, {3.5626638084584427`*^9, 
   3.5626641157344837`*^9}, {3.562664164748667*^9, 3.562664210968185*^9}, {
   3.562664574950933*^9, 3.5626646071950617`*^9}, 3.562664711887932*^9, 
   3.5626687323618183`*^9, 3.562668840436857*^9, {3.562668887810659*^9, 
   3.5626688920461187`*^9}, {3.562668963135516*^9, 3.5626689696583977`*^9}, {
   3.5626693606733637`*^9, 3.5626693991672*^9}, {3.562669459549596*^9, 
   3.5626694743947287`*^9}, {3.5626704286510267`*^9, 3.562670485420918*^9}, {
   3.562676017338791*^9, 3.562676041349855*^9}, {3.562676133533245*^9, 
   3.562676153346833*^9}, {3.5626762953514833`*^9, 3.562676302946533*^9}, {
   3.562676510918375*^9, 3.5626765705520144`*^9}, {3.562676643296913*^9, 
   3.562676656589546*^9}, {3.562676705422038*^9, 3.562676717058545*^9}, {
   3.5626768010854597`*^9, 3.562676804965764*^9}, {3.562676983185051*^9, 
   3.562676987724848*^9}, {3.5626770569679823`*^9, 3.562677090425305*^9}, {
   3.562677293831341*^9, 3.562677343535178*^9}, {3.562677518732888*^9, 
   3.56267752067489*^9}, {3.562678200369479*^9, 3.562678202687902*^9}, {
   3.562678627342997*^9, 3.562678629261054*^9}, {3.5627184274824667`*^9, 
   3.5627184636865463`*^9}, {3.56272332055261*^9, 3.562723323999445*^9}, {
   3.562723398060461*^9, 3.562723429216906*^9}, {3.562724063100341*^9, 
   3.562724066097248*^9}, {3.562724135384471*^9, 3.562724140866692*^9}, {
   3.562724215865217*^9, 3.562724221809273*^9}, {3.562724256813077*^9, 
   3.562724261596835*^9}, {3.562724302209132*^9, 3.562724314337325*^9}, {
   3.562724355987142*^9, 3.562724371887843*^9}, {3.5627430299726887`*^9, 
   3.56274311924475*^9}, {3.562743423631628*^9, 3.56274342590491*^9}, {
   3.562743501383808*^9, 3.562743545114867*^9}, {3.562743589115406*^9, 
   3.562743591894536*^9}, {3.562750048532773*^9, 3.562750056471179*^9}, {
   3.5627503603754177`*^9, 3.5627503615049257`*^9}, {3.5627505348811483`*^9, 
   3.5627506266011744`*^9}, {3.562750705066592*^9, 3.562750716475123*^9}, {
   3.562750980637055*^9, 3.562751000316571*^9}, {3.562751087548868*^9, 
   3.562751096079338*^9}, {3.562751162447123*^9, 3.56275118055962*^9}, {
   3.562751653274393*^9, 3.562751666293191*^9}, {3.562751713262644*^9, 
   3.562751715440613*^9}, {3.562751749124852*^9, 3.5627517530603733`*^9}, {
   3.5627528674830513`*^9, 3.5627529220474033`*^9}, {3.562752967780301*^9, 
   3.562753137705419*^9}, {3.562753229881488*^9, 3.5627532317598658`*^9}, {
   3.56275327205836*^9, 3.562753342607635*^9}, {3.5627535478739567`*^9, 
   3.562753555525659*^9}, {3.562753619742343*^9, 3.562753620959956*^9}, {
   3.5627536850808887`*^9, 3.562753686405724*^9}, {3.5627538934413433`*^9, 
   3.56275391710643*^9}, {3.562755302982242*^9, 3.562755324549539*^9}, {
   3.5627553598710213`*^9, 3.5627555121807413`*^9}, {3.562755543384183*^9, 
   3.562755850037837*^9}, {3.56275588794571*^9, 3.562756062838583*^9}, {
   3.562756099405871*^9, 3.5627562559609003`*^9}, {3.562756373233745*^9, 
   3.562756379812193*^9}, {3.56275646501868*^9, 3.562756484802383*^9}, {
   3.562757002979363*^9, 3.56275700915843*^9}, 3.562757142069405*^9, {
   3.56275743611327*^9, 3.562757455397026*^9}, {3.562757623858066*^9, 
   3.5627577097392597`*^9}, {3.562758059540358*^9, 3.5627580695509644`*^9}, {
   3.562758573375716*^9, 3.5627586190512867`*^9}, {3.562758710122986*^9, 
   3.562758785859652*^9}, {3.562758849209441*^9, 3.56275889238774*^9}, {
   3.56275903795779*^9, 3.562759069855598*^9}, {3.562759392268537*^9, 
   3.562759414143805*^9}, {3.562759509141323*^9, 3.562759525040243*^9}, {
   3.5627596123401613`*^9, 3.562759619291686*^9}, {3.562759713428376*^9, 
   3.562759719815063*^9}, {3.562783310623163*^9, 3.5627833243607893`*^9}, {
   3.562783607563407*^9, 3.562783691375984*^9}, {3.562787669221757*^9, 
   3.562787695416986*^9}, {3.5627879234063253`*^9, 3.562787943815814*^9}, {
   3.5627879811994267`*^9, 3.562788040874395*^9}, {3.562788107359674*^9, 
   3.562788113176834*^9}, {3.5627886173968563`*^9, 3.562788647819853*^9}, {
   3.562788722287528*^9, 3.5627887304018*^9}, {3.5627888426593523`*^9, 
   3.5627890111646957`*^9}, {3.562789086814929*^9, 3.5627890883582687`*^9}, {
   3.562789140272986*^9, 3.562789160593915*^9}, {3.5627894047712803`*^9, 
   3.562789412621166*^9}, {3.5627894662145557`*^9, 3.562789493681076*^9}, {
   3.5627895636561127`*^9, 3.562789575059506*^9}, 3.5629303229540663`*^9, {
   3.562932950458737*^9, 3.562933057130106*^9}, {3.562933630026973*^9, 
   3.562933638228264*^9}, {3.562933765741046*^9, 3.562933773455224*^9}, {
   3.5629338136521*^9, 3.562933814843533*^9}, {3.562937636704176*^9, 
   3.562937738861969*^9}, {3.562937769748477*^9, 3.5629378088395967`*^9}, {
   3.562960927317308*^9, 3.5629609623877363`*^9}, {3.562961732767303*^9, 
   3.562961735397051*^9}, {3.5629629187896843`*^9, 3.562962924905449*^9}, {
   3.562963432081415*^9, 3.562963435955028*^9}, {3.563014961776762*^9, 
   3.563015060230218*^9}, {3.563015092682345*^9, 3.5630150929851*^9}, {
   3.5630705508677073`*^9, 3.5630706036875772`*^9}, {3.5630708624268637`*^9, 
   3.5630710015637283`*^9}, {3.563071087105122*^9, 3.5630711856555767`*^9}, {
   3.563071223218494*^9, 3.563071226838985*^9}, {3.5630714402200317`*^9, 
   3.563071524063312*^9}, {3.563074095261799*^9, 3.5630740957541103`*^9}, {
   3.5630750298190737`*^9, 3.563075035743606*^9}, {3.56307645955077*^9, 
   3.563076482706633*^9}, {3.563076534618429*^9, 3.563076594020973*^9}, 
   3.563094052110215*^9, {3.563095994519698*^9, 3.563096023819709*^9}, {
   3.56309607695122*^9, 3.563096322583015*^9}, {3.563096679994935*^9, 
   3.563096710092564*^9}, {3.563097639355913*^9, 3.5630977400726557`*^9}, {
   3.5630977750242357`*^9, 3.5630977840999737`*^9}, {3.563098279142598*^9, 
   3.563098286878181*^9}, {3.56309836831714*^9, 3.563098369724478*^9}, {
   3.5630984132634087`*^9, 3.563098442307127*^9}, {3.563098580648262*^9, 
   3.563098588139729*^9}, {3.563099163567074*^9, 3.563099164451949*^9}, {
   3.563099824224815*^9, 3.563099863089242*^9}, {3.5631060624420223`*^9, 
   3.563106089316078*^9}, {3.5631061642365437`*^9, 3.563106191591826*^9}, {
   3.5631064063489656`*^9, 3.5631065455420437`*^9}, {3.56310662613907*^9, 
   3.563106633438568*^9}, {3.563107175185994*^9, 3.56310717840102*^9}, {
   3.5631076430600986`*^9, 3.563107726106317*^9}, {3.5631081817992163`*^9, 
   3.5631082219789743`*^9}, {3.563108268238206*^9, 3.563108313464855*^9}, {
   3.5631083438243637`*^9, 3.563108682732535*^9}, {3.5631087395038967`*^9, 
   3.5631088990181093`*^9}, {3.563108959458769*^9, 3.563108991465568*^9}, {
   3.5631090808710938`*^9, 3.563109269845454*^9}, {3.5631128930712013`*^9, 
   3.563112949911772*^9}, {3.563113046326557*^9, 3.5631130817174063`*^9}, {
   3.56311311189203*^9, 3.563113198189496*^9}, {3.563113343576085*^9, 
   3.563113355930996*^9}, {3.563124685951983*^9, 3.563124715956726*^9}, {
   3.563124966028743*^9, 3.5631249747356453`*^9}, 3.5631250519925203`*^9, 
   3.5631251229914093`*^9, {3.5631259748313217`*^9, 3.563125998068913*^9}, {
   3.563128981547434*^9, 3.563128999188654*^9}, {3.563164194710561*^9, 
   3.563164215551743*^9}, {3.563164334724429*^9, 3.563164339012795*^9}, {
   3.563164407879076*^9, 3.5631644102778893`*^9}, {3.5631644879475527`*^9, 
   3.5631644919766273`*^9}, {3.563164534983006*^9, 3.56316453856323*^9}, {
   3.56316470739545*^9, 3.56316471259505*^9}, {3.5631660838661757`*^9, 
   3.563166092503573*^9}, {3.563166981336349*^9, 3.5631670258809357`*^9}, {
   3.563167440729952*^9, 3.563167474833272*^9}, {3.563170131827063*^9, 
   3.5631703028471127`*^9}, {3.563170410004311*^9, 3.563170439020586*^9}, {
   3.563170474749205*^9, 3.5631705609518833`*^9}, {3.563170684553944*^9, 
   3.5631708232363*^9}, {3.5631709965493097`*^9, 3.563171002339514*^9}, 
   3.5631710601576033`*^9, {3.563171225136757*^9, 3.563171255318623*^9}, {
   3.563171587540707*^9, 3.563171625261364*^9}, {3.563171657742627*^9, 
   3.5631716587281017`*^9}, {3.5631718117462606`*^9, 3.5631718195373*^9}, {
   3.563172282586808*^9, 3.5631723000942097`*^9}, {3.563173326147685*^9, 
   3.5631733607195168`*^9}, {3.56317366072295*^9, 3.563173663005875*^9}, {
   3.563173785727953*^9, 3.563173797843606*^9}, {3.563173872835133*^9, 
   3.563173898438702*^9}, {3.5631740018233347`*^9, 3.563174049419599*^9}, {
   3.5631741023173656`*^9, 3.5631741152926903`*^9}, {3.563174206314239*^9, 
   3.563174208655345*^9}, {3.563174339570529*^9, 3.563174393076194*^9}, {
   3.563174424740944*^9, 3.563174495168827*^9}, {3.563174603560553*^9, 
   3.5631746108794394`*^9}, {3.563174675163644*^9, 3.563174693748399*^9}, {
   3.56317473966187*^9, 3.563174744164743*^9}, {3.563174807519582*^9, 
   3.563174809672703*^9}, {3.5631749574513903`*^9, 3.563174959703775*^9}, {
   3.563175559212652*^9, 3.563175563347536*^9}, {3.563176632121375*^9, 
   3.5631766344995937`*^9}, {3.563176782849687*^9, 3.5631768027159243`*^9}, {
   3.5631768597692738`*^9, 3.5631768619323606`*^9}, {3.563176933154949*^9, 
   3.5631769473304358`*^9}, {3.5631783051049213`*^9, 3.5631783075224*^9}, {
   3.563178440970675*^9, 3.5631784695305567`*^9}, {3.563188024476716*^9, 
   3.5631880375325613`*^9}, {3.563188159714683*^9, 3.5631881647893543`*^9}, 
   3.563188205309908*^9, {3.563191361848958*^9, 3.563191390711734*^9}, {
   3.563191681993907*^9, 3.563191725046537*^9}, {3.563191805787681*^9, 
   3.563191818371257*^9}, {3.563191945297683*^9, 3.563191992619357*^9}, 
   3.56319210662494*^9, {3.56319310053589*^9, 3.563193108204953*^9}, {
   3.5631935691729383`*^9, 3.5631935712818813`*^9}, {3.5631940051664*^9, 
   3.5631940068929443`*^9}, {3.5631943079622602`*^9, 
   3.5631943193395557`*^9}, {3.563195924300486*^9, 3.563195942017146*^9}, {
   3.563252320500565*^9, 3.563252324481291*^9}, {3.563275511827417*^9, 
   3.563275533032815*^9}, {3.563275592582638*^9, 3.563275646885784*^9}, {
   3.5632769939731197`*^9, 3.563277154803113*^9}, {3.563277799881835*^9, 
   3.5632778332401257`*^9}, {3.563279312970586*^9, 3.563279344189139*^9}, {
   3.563279582131743*^9, 3.5632796144304256`*^9}, {3.563279713438753*^9, 
   3.563279714291181*^9}, {3.5632798162909393`*^9, 3.5632798189895983`*^9}, {
   3.5634261368538923`*^9, 3.5634261459285917`*^9}, {3.563522536466032*^9, 
   3.5635225490780783`*^9}, {3.563522580666254*^9, 3.56352275294074*^9}, {
   3.5635228206702213`*^9, 3.563522831789071*^9}, {3.563522863978861*^9, 
   3.563522916776538*^9}, {3.563523009574297*^9, 3.563523027167889*^9}, {
   3.563523079967793*^9, 3.563523082850052*^9}, 3.5635231537965517`*^9, {
   3.563703994817486*^9, 3.563703995990438*^9}, {3.56370403122711*^9, 
   3.563704188066091*^9}, {3.563704269523041*^9, 3.56370428430396*^9}, {
   3.5637091106071043`*^9, 3.563709162249601*^9}, {3.563709347134412*^9, 
   3.5637094904228907`*^9}, {3.563709525504613*^9, 3.563709558194273*^9}, {
   3.563709991329685*^9, 3.563709997678507*^9}, {3.563710063380782*^9, 
   3.563710064616912*^9}, {3.563710110187983*^9, 3.563710123359397*^9}, {
   3.563711185802744*^9, 3.5637112702269897`*^9}, {3.5637113268330803`*^9, 
   3.563711337269147*^9}, {3.5637113850718412`*^9, 3.563711444393825*^9}, {
   3.563711685656529*^9, 3.563711797428294*^9}, {3.563711834112288*^9, 
   3.563711875211985*^9}, {3.5637126788423367`*^9, 3.563712716157117*^9}, {
   3.563712844038583*^9, 3.563712888885335*^9}, {3.5637129663675537`*^9, 
   3.563712968667316*^9}, {3.563713100830206*^9, 3.5637131405716248`*^9}, {
   3.563713171605551*^9, 3.5637131720694027`*^9}, 3.563713206632168*^9, {
   3.563731969335867*^9, 3.5637320640602093`*^9}, {3.563732105457644*^9, 
   3.563732219313487*^9}, {3.563732287296589*^9, 3.5637323234090767`*^9}, {
   3.5637323659909687`*^9, 3.5637324188485403`*^9}, {3.5637325464524317`*^9, 
   3.5637326678728647`*^9}, {3.563732817830668*^9, 3.5637328354386873`*^9}, {
   3.5637329814182463`*^9, 3.5637329867512627`*^9}, {3.563733053491332*^9, 
   3.5637330544748363`*^9}, {3.56373318082581*^9, 3.563733186354137*^9}, 
   3.56373325673897*^9, {3.563733421885158*^9, 3.563733448299018*^9}, {
   3.563733483231351*^9, 3.5637335285563717`*^9}, {3.563733585783079*^9, 
   3.563733607360684*^9}, {3.563733657631267*^9, 3.5637338185339413`*^9}, 
   3.563733912846882*^9, {3.563734200104547*^9, 3.563734301168639*^9}, {
   3.563734464508408*^9, 3.563734477701331*^9}, {3.563734623299449*^9, 
   3.563734636625051*^9}, {3.563734741834043*^9, 3.563734820713163*^9}, {
   3.563734871628998*^9, 3.56373488164027*^9}, {3.563734971484001*^9, 
   3.563734976573326*^9}, {3.5637350612899857`*^9, 3.563735065471436*^9}, 
   3.563736395182963*^9, {3.563736865632568*^9, 3.5637368704683933`*^9}, {
   3.563773248032012*^9, 3.563773250257856*^9}, {3.56377836396305*^9, 
   3.563778448169849*^9}, {3.5637785016924257`*^9, 3.563778501799505*^9}, {
   3.5637785415231647`*^9, 3.5637785829376*^9}, {3.5637787529294777`*^9, 
   3.563778754870501*^9}, {3.5637788164399023`*^9, 3.563778819787312*^9}, {
   3.563779100800733*^9, 3.563779135622796*^9}, {3.563788015813127*^9, 
   3.56378801778232*^9}, {3.5637881051807613`*^9, 3.563788107087994*^9}, {
   3.5637921598181353`*^9, 3.563792165461129*^9}, {3.563864657189734*^9, 
   3.563864691201374*^9}, 3.563866992106786*^9, {3.563879020702168*^9, 
   3.56387908509726*^9}, {3.563947338537991*^9, 3.563947395000949*^9}, {
   3.563947494057081*^9, 3.563947526451152*^9}, {3.563947683587275*^9, 
   3.563947687262321*^9}, {3.5639481919125967`*^9, 3.563948192060443*^9}, {
   3.564002161353957*^9, 3.564002179925063*^9}, {3.56421544738211*^9, 
   3.564215455895912*^9}, {3.5642238353953457`*^9, 3.56422386464557*^9}, {
   3.564382887007412*^9, 3.564382895988708*^9}, {3.564384667047524*^9, 
   3.564384670439559*^9}, {3.564402456985273*^9, 3.564402459027451*^9}, {
   3.564415626165601*^9, 3.564415657170836*^9}, {3.564416773455419*^9, 
   3.564416782315258*^9}, {3.5644168202795486`*^9, 3.564416838714665*^9}, {
   3.5644175196256227`*^9, 3.5644175227138844`*^9}, {3.564474500333688*^9, 
   3.5644745088751917`*^9}, {3.564474755395547*^9, 3.564474757063212*^9}, {
   3.5645747874591627`*^9, 3.564574822911553*^9}, {3.564574996078628*^9, 
   3.564574998460002*^9}, {3.5645855416432734`*^9, 3.5645855440469007`*^9}, {
   3.564585580126604*^9, 3.5645855895339527`*^9}, {3.5645856806484327`*^9, 
   3.564585683137889*^9}, {3.564630322237874*^9, 3.564630382395343*^9}, {
   3.564631065256143*^9, 3.564631067678335*^9}, {3.5646333313853703`*^9, 
   3.564633470110271*^9}, {3.564633526280549*^9, 3.564633555853546*^9}, {
   3.564633916224002*^9, 3.564633963723527*^9}, {3.5647182030948267`*^9, 
   3.5647187281483297`*^9}, {3.564723521312611*^9, 3.56472352547831*^9}, {
   3.5647254655612793`*^9, 3.564725465953128*^9}, {3.5647256349548798`*^9, 
   3.564725636496983*^9}, {3.564725685660986*^9, 3.564725689374558*^9}, {
   3.5647259283861732`*^9, 3.564725929702465*^9}, {3.5647264420073757`*^9, 
   3.564726470928052*^9}, 3.564727201011744*^9, 3.564738068085862*^9, {
   3.564745319653407*^9, 3.564745345081277*^9}, {3.564755776141778*^9, 
   3.5647558270415697`*^9}, {3.564755888952881*^9, 3.564755890208579*^9}, {
   3.564755966069466*^9, 3.564755980236412*^9}, {3.564756768733459*^9, 
   3.564756770268983*^9}, {3.564979185835086*^9, 3.564979223009461*^9}, {
   3.5652243736536083`*^9, 3.56522438289723*^9}, {3.565499439728346*^9, 
   3.565499454085939*^9}, {3.565500135587669*^9, 3.565500137810093*^9}, {
   3.565512473652853*^9, 3.5655125594185953`*^9}, {3.565520060192939*^9, 
   3.565520164040852*^9}, {3.565520351360544*^9, 3.5655203738494263`*^9}, {
   3.565520507793076*^9, 3.565520600939954*^9}, {3.56552074694344*^9, 
   3.56552074705761*^9}, {3.5655209070882893`*^9, 3.565520978424038*^9}, {
   3.565521115896331*^9, 3.565521187433196*^9}, {3.565521235694626*^9, 
   3.5655212514981813`*^9}, {3.5655212960235853`*^9, 3.565521300181674*^9}, {
   3.565521352856279*^9, 3.565521404779871*^9}, {3.565521483583446*^9, 
   3.565521521539143*^9}, {3.565521553822955*^9, 3.56552156153629*^9}, {
   3.5655216056394367`*^9, 3.565521954123131*^9}, {3.56552202093834*^9, 
   3.5655220404522448`*^9}, {3.565528148124546*^9, 3.565528222727799*^9}, {
   3.565528826086092*^9, 3.565528849094078*^9}, {3.565531064049696*^9, 
   3.56553106934055*^9}, {3.56553886063861*^9, 3.565538911801268*^9}, {
   3.565775667341045*^9, 3.565775685282362*^9}, {3.566196025569501*^9, 
   3.566196053793839*^9}, {3.566196691229411*^9, 3.5661967086074467`*^9}, {
   3.566196750230279*^9, 3.566196757173381*^9}, 3.566197080878137*^9, {
   3.566316806234847*^9, 3.5663168071675787`*^9}, 3.5663168377430077`*^9, {
   3.567225453002288*^9, 3.5672254661889563`*^9}, {3.567225552425857*^9, 
   3.5672255534359713`*^9}, 3.567229883163865*^9, 3.567229932011203*^9, {
   3.567232158646648*^9, 3.567232187532812*^9}, 3.567239641573379*^9, 
   3.567826969118211*^9, {3.567927864651053*^9, 3.567927882469542*^9}, {
   3.568008421743904*^9, 3.568008429385724*^9}, {3.568011413616076*^9, 
   3.568011415980783*^9}, {3.568011449352393*^9, 3.5680115093216476`*^9}, {
   3.568011539715701*^9, 3.5680115974903708`*^9}, {3.568075881136724*^9, 
   3.568075883506938*^9}, {3.5680776007632093`*^9, 3.568077604580258*^9}, {
   3.568077870671302*^9, 3.568077873284197*^9}, {3.568077966904483*^9, 
   3.568077969885777*^9}, {3.568078031611786*^9, 3.5680780459721737`*^9}, {
   3.568078086757818*^9, 3.5680781198617687`*^9}, {3.568078186507169*^9, 
   3.568078198978878*^9}, {3.568078298253757*^9, 3.568078300810308*^9}, {
   3.5680785983636227`*^9, 3.568078606548029*^9}, {3.568078712978662*^9, 
   3.568078715439934*^9}, {3.5680788047733383`*^9, 3.568078809179798*^9}, {
   3.568102090771819*^9, 3.568102092509046*^9}, {3.568102243148362*^9, 
   3.5681022458289347`*^9}, {3.568102292877142*^9, 3.568102294350008*^9}, {
   3.5681024595932207`*^9, 3.568102462548031*^9}, {3.568102694191825*^9, 
   3.568102718423684*^9}, {3.5681111834194736`*^9, 3.568111185022092*^9}, {
   3.56818757358741*^9, 3.568187591337451*^9}, {3.568298421660248*^9, 
   3.568298429539969*^9}, {3.568367476140102*^9, 3.568367485102611*^9}, {
   3.56836752287035*^9, 3.568367544377223*^9}, {3.568367747635779*^9, 
   3.568367758697036*^9}, {3.568368095299405*^9, 3.568368191654252*^9}, {
   3.5684358988830233`*^9, 3.568435910877213*^9}, {3.56843772099297*^9, 
   3.568437776435643*^9}, {3.568437876206008*^9, 3.5684378783851957`*^9}, {
   3.568438039012267*^9, 3.568438058991411*^9}, {3.568438409740316*^9, 
   3.568438483443184*^9}, {3.568438717280851*^9, 3.568438741010991*^9}, 
   3.568458012675363*^9, {3.569132369798417*^9, 3.56913237568544*^9}, 
   3.56923027551355*^9, {3.569329274024218*^9, 3.5693292767269993`*^9}, {
   3.569329375630289*^9, 3.569329398356501*^9}, {3.569329792469756*^9, 
   3.569329820305307*^9}, {3.569330016081956*^9, 3.56933003708779*^9}, {
   3.569340481196208*^9, 3.569340483807036*^9}, {3.56934070801618*^9, 
   3.569340709558907*^9}, {3.569413606533258*^9, 3.5694136072815523`*^9}, {
   3.569418949284731*^9, 3.569418954289583*^9}, {3.569577879990046*^9, 
   3.5695778822311573`*^9}, 3.569578025449256*^9, {3.569578269078277*^9, 
   3.5695782694363213`*^9}, {3.569578418871479*^9, 3.569578531913073*^9}, {
   3.569578799973612*^9, 3.569578828783203*^9}, 3.569580500046524*^9, {
   3.569663629263324*^9, 3.5696637065923557`*^9}, {3.569663947051795*^9, 
   3.569663951499517*^9}, {3.569667208098385*^9, 3.569667210375083*^9}, {
   3.5696673973698683`*^9, 3.5696673994160557`*^9}, {3.569667747756778*^9, 
   3.569667763892972*^9}, {3.569667805978286*^9, 3.569667831013608*^9}, 
   3.569669144308528*^9, {3.569735337491502*^9, 3.569735362377392*^9}, {
   3.569754033738632*^9, 3.5697540375237427`*^9}, {3.5697541586177063`*^9, 
   3.569754161237103*^9}, {3.569898414020873*^9, 3.569898416944435*^9}, {
   3.569898538657745*^9, 3.56989854103869*^9}, {3.569898789140862*^9, 
   3.56989882681129*^9}, {3.569899264592985*^9, 3.5698993055357037`*^9}, 
   3.569899343292416*^9, {3.569899394727528*^9, 3.569899424865465*^9}, {
   3.5698996479956617`*^9, 3.5698996729921722`*^9}, {3.569899735504348*^9, 
   3.5698997404828253`*^9}, {3.569899917667897*^9, 3.569899928460717*^9}, {
   3.569900004847219*^9, 3.5699000269831753`*^9}, {3.569900061514372*^9, 
   3.569900064456768*^9}, {3.569901924506134*^9, 3.569901926220447*^9}, {
   3.56990207205127*^9, 3.56990214872232*^9}, {3.569902632482395*^9, 
   3.56990264548316*^9}, {3.569902980408317*^9, 3.569903020656198*^9}, {
   3.569903300332412*^9, 3.5699033387412663`*^9}, {3.569904005030066*^9, 
   3.569904008140658*^9}, 3.569904140945323*^9, {3.5699041753108587`*^9, 
   3.56990420257996*^9}, {3.5699042799617577`*^9, 3.569904295783391*^9}, {
   3.569904368500592*^9, 3.569904377192335*^9}, 3.56990445501832*^9, {
   3.5699045002945957`*^9, 3.569904509188352*^9}, {3.569904568021768*^9, 
   3.569904583591502*^9}, {3.5699047076024837`*^9, 3.569904710705467*^9}, {
   3.5699048862667294`*^9, 3.569904893891128*^9}, {3.5699058263713617`*^9, 
   3.569905838796948*^9}, {3.569905872739893*^9, 3.5699058899359007`*^9}, {
   3.5699061875982113`*^9, 3.569906190173869*^9}, {3.569906505145349*^9, 
   3.569906561775395*^9}, {3.56990662245684*^9, 3.5699066326542387`*^9}, {
   3.569906884624185*^9, 3.5699068901676903`*^9}, 3.5699069241079597`*^9, {
   3.569906994872952*^9, 3.569906997086753*^9}, {3.5699071858978786`*^9, 
   3.569907248604697*^9}, {3.570007953647937*^9, 3.57000798383278*^9}, {
   3.5700080168055058`*^9, 3.570008074811302*^9}, {3.570008179213468*^9, 
   3.570008179503474*^9}, {3.5700083162203083`*^9, 3.570008316521266*^9}, {
   3.570008416287711*^9, 3.570008417678834*^9}, {3.5705109808278437`*^9, 
   3.57051098164248*^9}, {3.570511185443677*^9, 3.570511185813686*^9}, {
   3.579003673560151*^9, 3.5790037574497013`*^9}, {3.579003867426477*^9, 
   3.5790038680325327`*^9}, {3.579003975186496*^9, 3.5790040823975573`*^9}, {
   3.579004311305648*^9, 3.579004313411882*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
2.5 Defining automatically all the tensors needed to split the most common \
perturbations of metric and matter\
\>", "Subsubsection",
 CellChangeTimes->{{3.563741807001367*^9, 3.5637418290953493`*^9}, 
   3.56471962398985*^9, {3.577160779282322*^9, 3.577160780014965*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"DefinedPerturbationParameter", "[", "x_", "]"}], ":=", "False"}],
    ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DefMetricFields", "[", 
    RowBox[{
     RowBox[{"g_", "?", "MetricQ"}], ",", "dg_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
     RowBox[{"PerturbParameter_:", "\[Epsilon]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "n", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"M", "=", 
          RowBox[{"ManifoldOfCovD", "@", 
           RowBox[{"CovDOfMetric", "@", "g"}]}]}], ",", 
         RowBox[{"cd", "=", 
          RowBox[{"CovDOfMetric", "@", "h"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], ",", "\[IndentingNewLine]", 
         
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "=", 
           RowBox[{"GetIndicesOfVBundle", "[", 
            RowBox[{
             RowBox[{"Tangent", "@", "M"}], ",", "2"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Not", "[", 
             RowBox[{"DefTensorQ", "[", "dg", "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"DefMetricPerturbation", "[", 
              RowBox[{"g", ",", " ", "dg", ",", " ", 
               RowBox[{"Evaluate", "[", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                  "DefinedPerturbationParameter", "[", 
                   "$PerturbationParameter", "]"}], ",", 
                  "$PerturbationParameter", ",", "PerturbParameter"}], "]"}], 
                "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
              "DefinedPerturbationParameter", "[", "$PerturbationParameter", 
               "]"}], "=", "True"}], ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"PrintAs", "[", "dg", "]"}], " ", "^=", 
              RowBox[{"\"\<\[Delta]\>\"", "<>", 
               RowBox[{"ToString", "[", "g", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"dg", "[", 
               RowBox[{
                RowBox[{"LI", "[", "n_", "]"}], ",", "\[Mu]_", ",", 
                "\[Nu]_"}], "]"}], ":=", 
              RowBox[{"0", "/;", 
               RowBox[{
                RowBox[{"n", ">", "1"}], "&&", "BackgroundFieldMethod"}]}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"dg", "[", 
               RowBox[{
                RowBox[{"\[Mu]_", "?", "AIndexQ"}], ",", 
                RowBox[{"\[Nu]_", "?", "AIndexQ"}]}], "]"}], ":=", 
              RowBox[{"dg", "[", 
               RowBox[{
                RowBox[{"LI", "[", "0", "]"}], ",", "\[Mu]", ",", "\[Nu]"}], 
               "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"$DefInfoQ", ",", 
               RowBox[{
                RowBox[{
                "Print", "[", 
                 "\"\<** Warning: Metric perturbation already defined. This \
cannot be redefined without undefining it. **\>\"", "]"}], ";"}]}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Defining", " ", "some", " ", "tensors", " ", "we", " ", "shall", 
            " ", "need", " ", "anyway"}], " ", "*)"}], "\[IndentingNewLine]", 
          
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"DefProjectedTensor", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", "h", ",", 
               RowBox[{"TensorProperties", "->", 
                RowBox[{"{", 
                 RowBox[{
                 "\"\<Traceless\>\"", ",", "\"\<Transverse\>\"", ",", 
                  "\"\<SymmetricTensor\>\""}], "}"}]}], ",", 
               RowBox[{"SpaceTimesOfDefinition", "->", 
                RowBox[{"{", "\"\<Perturbed\>\"", "}"}]}], ",", 
               RowBox[{"PrintAs", "->", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ")"}], "&"}], "/@", 
           RowBox[{"$ListFieldsPerturbedOnly", "[", "h", "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"\[Phi]", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"\[Phi]", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Bs", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"Bs", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Bv", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"Bv", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"\[Psi]", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"\[Psi]", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Es", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"Es", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Ev", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"Ev", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Et", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"Et", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"T", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"T", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Ls", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"Ls", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Evaluate", "[", 
             RowBox[{"Lv", "[", "h", "]"}], "]"}], "::", "usage"}], "=", 
           RowBox[{"Lv", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
            "If", " ", "we", " ", "want", " ", "a", " ", "nice", " ", 
             "output", " ", "for", " ", "the", " ", "perturbation", " ", 
             "parameter"}], ",", ","}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"MakeBoxes", "[", 
            RowBox[{"PerturbParameter", ",", "StandardForm"}], "]"}], ":=", 
           "\[IndentingNewLine]", 
           RowBox[{"StyleBox", "[", 
            RowBox[{
             RowBox[{"ToString", "[", "$PerturbationParameter", "]"}], ",", 
             RowBox[{"FontColor", "\[Rule]", 
              RowBox[{"RGBColor", "[", 
               RowBox[{"0.3", ",", " ", "0.8", ",", " ", "0.8"}], "]"}]}]}], 
            "]"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "]"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetNumberOfArguments", "[", 
   RowBox[{"DefMetricFields", ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "4"}], "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "DefMetricFields", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.56317114681139*^9, 3.563171188352113*^9}, {
   3.563171267963704*^9, 3.5631712802937117`*^9}, {3.563171321522897*^9, 
   3.56317150905917*^9}, {3.563171543044077*^9, 3.563171562444775*^9}, {
   3.563171615939846*^9, 3.563171617192868*^9}, {3.5631716644355993`*^9, 
   3.563171664798362*^9}, 3.563171892586688*^9, {3.56317205418995*^9, 
   3.563172069664174*^9}, {3.563172108549272*^9, 3.5631721269663887`*^9}, {
   3.563172302797963*^9, 3.563172384799107*^9}, 3.5631726765642567`*^9, {
   3.5635164991766567`*^9, 3.563516511783718*^9}, {3.563523030220759*^9, 
   3.563523073827778*^9}, {3.5635231156683197`*^9, 3.5635231178577003`*^9}, {
   3.563523156327523*^9, 3.563523183550119*^9}, {3.563523237698312*^9, 
   3.563523531174543*^9}, {3.563526701473909*^9, 3.563526738039105*^9}, {
   3.56352693115096*^9, 3.5635269386281643`*^9}, {3.563527072519359*^9, 
   3.563527075904895*^9}, {3.563527153561977*^9, 3.56352721398936*^9}, {
   3.563527251022581*^9, 3.56352726124854*^9}, {3.56352729633389*^9, 
   3.563527296971281*^9}, {3.5635273444676523`*^9, 3.5635273816739483`*^9}, {
   3.563527413070524*^9, 3.563527416081312*^9}, {3.563527740941979*^9, 
   3.5635277648421793`*^9}, {3.563528057968913*^9, 3.5635280717692537`*^9}, {
   3.563528125759111*^9, 3.5635281337599573`*^9}, {3.563528205573206*^9, 
   3.563528206909216*^9}, {3.5635282393605223`*^9, 3.563528243600994*^9}, {
   3.563528294298996*^9, 3.563528296390708*^9}, {3.563528334220224*^9, 
   3.563528433032701*^9}, {3.563528472951118*^9, 3.563528479567369*^9}, {
   3.563528581534788*^9, 3.5635285841356792`*^9}, 3.563528846400682*^9, {
   3.563529468515033*^9, 3.5635294821174603`*^9}, {3.563529843259736*^9, 
   3.563529855779654*^9}, {3.56352994645608*^9, 3.563529951546617*^9}, {
   3.563530389399809*^9, 3.5635304107473917`*^9}, {3.5635305702052097`*^9, 
   3.563530643644665*^9}, 3.5635569286832867`*^9, {3.56355727234581*^9, 
   3.563557278031885*^9}, {3.563557313161675*^9, 3.563557315214278*^9}, {
   3.5635575488907213`*^9, 3.5635575673051577`*^9}, {3.563557687035466*^9, 
   3.563557708949829*^9}, {3.56355775823029*^9, 3.563557795062192*^9}, {
   3.563558047876055*^9, 3.563558163152547*^9}, {3.563558206058062*^9, 
   3.563558206634207*^9}, {3.563558429309125*^9, 3.563558434139985*^9}, {
   3.5635593138424892`*^9, 3.563559391273459*^9}, {3.563560455071357*^9, 
   3.563560459190487*^9}, 3.563560493053351*^9, {3.563605816962963*^9, 
   3.563605913134109*^9}, {3.563606677832374*^9, 3.563606696671483*^9}, 
   3.563703975520109*^9, 3.563737435552383*^9, {3.563773142870925*^9, 
   3.56377319623293*^9}, {3.563859240925569*^9, 3.563859249642165*^9}, {
   3.5638593975486803`*^9, 3.563859400663015*^9}, {3.5638639166063538`*^9, 
   3.563863953836117*^9}, {3.563864727011548*^9, 3.5638647548191433`*^9}, {
   3.5638647969899673`*^9, 3.563864798923744*^9}, {3.563881898099144*^9, 
   3.5638819117334957`*^9}, {3.563881982566975*^9, 3.563881984880843*^9}, 
   3.563882041207198*^9, {3.563882094399909*^9, 3.563882107672093*^9}, 
   3.5638822388514137`*^9, {3.5639475366248713`*^9, 3.563947551101284*^9}, {
   3.564472869602927*^9, 3.56447290088908*^9}, {3.564473536132115*^9, 
   3.564473549662407*^9}, {3.564474474346368*^9, 3.564474480567666*^9}, {
   3.56447483145362*^9, 3.564474832744166*^9}, {3.564718738365137*^9, 
   3.564718766402937*^9}, 3.564723526828765*^9, {3.564725938220604*^9, 
   3.564725949760727*^9}, 3.564726499486106*^9, 3.564726569162053*^9, {
   3.56474767736932*^9, 3.56474773400808*^9}, {3.564824910609294*^9, 
   3.564824921638365*^9}, {3.5648250673700247`*^9, 3.564825165893627*^9}, {
   3.564825245392188*^9, 3.564825246871388*^9}, 3.5648253910771637`*^9, {
   3.56482548112461*^9, 3.564825482771834*^9}, {3.564825784189023*^9, 
   3.564825786314827*^9}, {3.564826026266594*^9, 3.564826052497212*^9}, {
   3.5650836382424927`*^9, 3.5650836913839483`*^9}, {3.565083737276758*^9, 
   3.565083737411461*^9}, {3.565083814145705*^9, 3.5650838416874638`*^9}, {
   3.565086393916169*^9, 3.56508639779009*^9}, {3.565093509433248*^9, 
   3.565093511334344*^9}, 3.566316839217942*^9, {3.567230198253248*^9, 
   3.567230226672098*^9}, {3.567232008909975*^9, 3.567232143645508*^9}, 
   3.567239663811555*^9, {3.5684580024282103`*^9, 3.5684580040820293`*^9}, {
   3.569330065241475*^9, 3.569330078011344*^9}, 3.570511185928611*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DefMatterFields", "[", 
    RowBox[{"uf_", ",", "duf_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", " ", 
     RowBox[{"PerturbParameter_:", "\[Epsilon]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", "ord"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"g", "=", 
          RowBox[{"First", "@", 
           RowBox[{"InducedFrom", "@", "h"}]}]}], ",", 
         RowBox[{"u", "=", 
          RowBox[{"Last", "@", 
           RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"M", "=", 
            RowBox[{"ManifoldOfCovD", "@", 
             RowBox[{"CovDOfMetric", "@", "g"}]}]}], ",", 
           RowBox[{"cd", "=", 
            RowBox[{"CovDOfMetric", "@", "h"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\[Mu]", ",", "\[Nu]"}], "}"}], "=", 
             RowBox[{"GetIndicesOfVBundle", "[", 
              RowBox[{
               RowBox[{"Tangent", "@", "M"}], ",", "2"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"DefProjectedTensor", "[", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", "h", ",", 
                 RowBox[{"TensorProperties", "->", 
                  RowBox[{"{", 
                   RowBox[{
                   "\"\<Traceless\>\"", ",", "\"\<Transverse\>\"", ",", 
                    "\"\<SymmetricTensor\>\""}], "}"}]}], ",", 
                 RowBox[{"SpaceTimesOfDefinition", "->", 
                  RowBox[{"{", 
                   RowBox[{"\"\<Background\>\"", ",", "\"\<Perturbed\>\""}], 
                   "}"}]}], ",", 
                 RowBox[{"PrintAs", "->", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ")"}], "&"}], "/@", 
             RowBox[{"$ListFieldsBackgroundAndPerturbed", "[", 
              RowBox[{"h", ",", "uf"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"\[Rho]", "[", "uf", "]"}], "]"}], "::", "usage"}], 
             "=", 
             RowBox[{"\[Rho]", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
            
            RowBox[{
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"P", "[", "uf", "]"}], "]"}], "::", "usage"}], "=", 
             RowBox[{"P", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"Vspat", "[", 
                RowBox[{"h", ",", "uf"}], "]"}], "]"}], "::", "usage"}], "=", 
             
             RowBox[{"Vspat", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"V0", "[", 
                RowBox[{"h", ",", "uf"}], "]"}], "]"}], "::", "usage"}], "=", 
             
             RowBox[{"V0", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"Vs", "[", 
                RowBox[{"h", ",", "uf"}], "]"}], "]"}], "::", "usage"}], "=", 
             
             RowBox[{"Vs", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Evaluate", "[", 
               RowBox[{"Vv", "[", 
                RowBox[{"h", ",", "uf"}], "]"}], "]"}], "::", "usage"}], "=", 
             
             RowBox[{"Vv", "::", "usage"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Not", "[", 
               RowBox[{"DefTensorQ", "[", "uf", "]"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"DefTensor", "[", 
                RowBox[{
                 RowBox[{"uf", "[", "\[Mu]", "]"}], ",", "M"}], "]"}], ";"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{"$DefInfoQ", ",", 
                 RowBox[{
                  RowBox[{"Print", "[", 
                   RowBox[{
                   "\"\<** Warning: Tensor \>\"", ",", "uf", " ", ",", " ", 
                    "\"\<is already defined. It cannot be redefined without \
undefining it. **\>\""}], "]"}], ";"}]}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Not", "[", 
               RowBox[{"DefTensorQ", "[", "duf", "]"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"DefTensorPerturbation", "[", 
                RowBox[{
                 RowBox[{"duf", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "ord", "]"}], ",", "\[Mu]"}], "]"}], 
                 ",", 
                 RowBox[{"uf", "[", "\[Mu]", "]"}], ",", "M", ",", 
                 RowBox[{"PrintAs", "\[Rule]", 
                  RowBox[{"\"\<\[Delta]\>\"", "<>", 
                   RowBox[{"PrintAs", "[", "uf", "]"}]}]}]}], "]"}], ";"}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{"$DefInfoQ", ",", 
                 RowBox[{
                  RowBox[{"Print", "[", 
                   RowBox[{
                   "\"\<** Warning: Tensor \>\"", ",", "duf", " ", ",", " ", 
                    "\"\<is already defined. It cannot be redefined without \
undefining it. **\>\""}], "]"}], ";"}]}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Not", "@", 
               RowBox[{
               "DefinedPerturbationParameter", "[", "$PerturbationParameter", 
                "]"}]}], ",", 
              RowBox[{
               RowBox[{"$PerturbationParameter", "=", "PerturbParameter"}], 
               ";", 
               RowBox[{
                RowBox[{
                "DefinedPerturbationParameter", "[", "$PerturbationParameter",
                  "]"}], "=", "True"}]}]}], "]"}], ";", "\[IndentingNewLine]",
             "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"duf", "[", 
              RowBox[{"\[Mu]_", "?", "AIndexQ"}], "]"}], ":=", 
             RowBox[{"duf", "[", 
              RowBox[{
               RowBox[{"LI", "[", "0", "]"}], ",", "\[Mu]"}], "]"}]}], 
            ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"DefMatterFields", ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "4"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "DefMatterFields", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.56317114681139*^9, 3.563171188352113*^9}, {
   3.563171267963704*^9, 3.5631712802937117`*^9}, {3.563171321522897*^9, 
   3.56317150905917*^9}, {3.563171543044077*^9, 3.563171562444775*^9}, {
   3.563171615939846*^9, 3.563171617192868*^9}, {3.5631716644355993`*^9, 
   3.563171664798362*^9}, 3.563171892586688*^9, {3.56317205418995*^9, 
   3.563172069664174*^9}, {3.563172108549272*^9, 3.5631721269663887`*^9}, {
   3.563172302797963*^9, 3.563172384799107*^9}, 3.5631726765642567`*^9, {
   3.5635164991766567`*^9, 3.563516511783718*^9}, {3.563523030220759*^9, 
   3.563523073827778*^9}, {3.5635231156683197`*^9, 3.5635231178577003`*^9}, {
   3.563523156327523*^9, 3.563523183550119*^9}, {3.563523237698312*^9, 
   3.563523531174543*^9}, {3.563526701473909*^9, 3.563526738039105*^9}, {
   3.56352693115096*^9, 3.5635269386281643`*^9}, {3.563527072519359*^9, 
   3.563527075904895*^9}, {3.563527153561977*^9, 3.56352721398936*^9}, {
   3.563527251022581*^9, 3.56352726124854*^9}, {3.56352729633389*^9, 
   3.563527296971281*^9}, {3.5635273444676523`*^9, 3.5635273816739483`*^9}, {
   3.563527413070524*^9, 3.563527416081312*^9}, {3.563527740941979*^9, 
   3.5635277648421793`*^9}, {3.563528057968913*^9, 3.5635280717692537`*^9}, {
   3.563528125759111*^9, 3.5635281337599573`*^9}, {3.563528205573206*^9, 
   3.563528206909216*^9}, {3.5635282393605223`*^9, 3.563528243600994*^9}, {
   3.563528294298996*^9, 3.563528296390708*^9}, {3.563528334220224*^9, 
   3.563528433032701*^9}, {3.563528472951118*^9, 3.563528479567369*^9}, {
   3.563528581534788*^9, 3.5635285841356792`*^9}, 3.563528846400682*^9, {
   3.563529468515033*^9, 3.5635294821174603`*^9}, {3.563529843259736*^9, 
   3.563529855779654*^9}, {3.56352994645608*^9, 3.563529951546617*^9}, {
   3.563530389399809*^9, 3.5635304107473917`*^9}, {3.5635305702052097`*^9, 
   3.563530643644665*^9}, 3.5635569286832867`*^9, {3.56355727234581*^9, 
   3.563557278031885*^9}, {3.563557313161675*^9, 3.563557315214278*^9}, {
   3.5635575488907213`*^9, 3.5635575673051577`*^9}, {3.563557687035466*^9, 
   3.563557708949829*^9}, {3.56355775823029*^9, 3.563557795062192*^9}, {
   3.563558047876055*^9, 3.563558163152547*^9}, {3.563558206058062*^9, 
   3.563558206634207*^9}, {3.563558429309125*^9, 3.563558434139985*^9}, {
   3.5635593138424892`*^9, 3.563559391273459*^9}, {3.563560455071357*^9, 
   3.563560459190487*^9}, 3.563560493053351*^9, {3.563605816962963*^9, 
   3.563605913134109*^9}, {3.563606677832374*^9, 3.563606696671483*^9}, 
   3.563703975520109*^9, 3.563737435552383*^9, {3.563773164219481*^9, 
   3.563773221368382*^9}, {3.5638651115679417`*^9, 3.563865117966502*^9}, {
   3.5638651506808023`*^9, 3.563865153770453*^9}, 3.5638666450308723`*^9, {
   3.563947559609688*^9, 3.5639475731292*^9}, {3.564474574639969*^9, 
   3.564474616000813*^9}, {3.564474723831129*^9, 3.564474725755332*^9}, {
   3.564548478884446*^9, 3.564548492208564*^9}, {3.564548932383116*^9, 
   3.564548935907359*^9}, {3.5645494010382547`*^9, 3.564549404600213*^9}, {
   3.564673913281493*^9, 3.564673919576532*^9}, {3.564679092269916*^9, 
   3.564679102334466*^9}, {3.564680114246365*^9, 3.564680122251844*^9}, {
   3.5647137243956957`*^9, 3.564713724833095*^9}, {3.564716841740665*^9, 
   3.564716842951276*^9}, 3.564718803097954*^9, 3.5647235280816708`*^9, {
   3.5647259549243383`*^9, 3.564725962192545*^9}, 3.5647265022136993`*^9, {
   3.5647475850400667`*^9, 3.56474764308311*^9}, {3.564747690926134*^9, 
   3.5647476910836287`*^9}, {3.56474774342325*^9, 3.564747744636364*^9}, {
   3.564824606426025*^9, 3.564824633587373*^9}, {3.564824866037903*^9, 
   3.564824878003367*^9}, {3.564825180693675*^9, 3.5648252009398937`*^9}, {
   3.564825537588196*^9, 3.5648255687553787`*^9}, 3.564825688456904*^9, 
   3.5648257890003977`*^9, 3.5648258683482323`*^9, 3.564826068071747*^9, {
   3.565083609641844*^9, 3.5650836330583477`*^9}, {3.565083701544549*^9, 
   3.5650838097751417`*^9}, {3.5650838468718433`*^9, 3.565083859291523*^9}, {
   3.565086402219881*^9, 3.565086414685667*^9}, {3.5650935402701178`*^9, 
   3.5650935415748262`*^9}, {3.566316840431986*^9, 3.566316841140723*^9}, {
   3.567226982307659*^9, 3.567227002859342*^9}, {3.567227071076037*^9, 
   3.5672270856841*^9}, {3.5672271791570807`*^9, 3.567227183048718*^9}, {
   3.567227230882669*^9, 3.567227231296143*^9}, 3.567230869905868*^9, {
   3.5672314183286448`*^9, 3.567231550884404*^9}, 3.5672396817071*^9, 
   3.568457999112604*^9, {3.569330084300034*^9, 3.569330100482115*^9}, 
   3.570510982694236*^9, 3.570511183873827*^9}],

Cell[BoxData[
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"DefMatterFields", ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "4"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.569132393308937*^9, 3.569230311717065*^9, 
  3.569340254224917*^9, 3.569340514156746*^9, 3.569340732502451*^9, 
  3.569418996879401*^9, 3.569578894898777*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BV1", ":=", 
   RowBox[{"Boole", "@", "$FirstOrderVectorPerturbations"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BT1", ":=", 
    RowBox[{"Boole", "@", "$FirstOrderTensorPerturbations"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SplitMetric", "[", 
    RowBox[{
     RowBox[{"g_", "?", "MetricQ"}], ",", "dg_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
     RowBox[{"gauge_", "?", "GaugeQ"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "n", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"u", "=", 
         RowBox[{"Last", "@", 
          RowBox[{"InducedFrom", "@", "h"}]}]}], "}"}], ",", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"M", "=", 
            RowBox[{"ManifoldOfCovD", "@", 
             RowBox[{"CovDOfMetric", "@", "g"}]}]}], ",", 
           RowBox[{"cd", "=", 
            RowBox[{"CovDOfMetric", "@", "h"}]}], ",", 
           RowBox[{"ShBool", "=", 
            RowBox[{"Evaluate", "@", 
             RowBox[{"BianchiBool", "[", 
              RowBox[{"SpaceType", "[", "h", "]"}], "]"}]}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Block", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"i1", ",", "i2"}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}], "=", 
             RowBox[{"GetIndicesOfVBundle", "[", 
              RowBox[{
               RowBox[{"Tangent", "@", "M"}], ",", "2"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Not", "[", 
                RowBox[{"DefTensorQ", "[", 
                 RowBox[{"Et", "[", "h", "]"}], "]"}], "]"}], "||", 
               RowBox[{"Not", "[", 
                RowBox[{"DefTensorQ", "[", "dg", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{
               "Print", "[", 
                "\"\<** Warning: The perturbed metric, or the fields required \
to parameterize its splitting were not previously defined **\>\"", "]"}], ";",
                "\[IndentingNewLine]", 
               RowBox[{
               "Print", "[", 
                "\"\<** DefMetricFields is called to build the perturbation \
of the metric and the fields needed for future splitting **\>\"", "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"DefMetricFields", "[", 
                RowBox[{"g", ",", " ", "dg", ",", "h"}], "]"}]}]}], "]"}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "First", " ", "the", " ", "rules", " ", "at", " ", "first", " ", 
              
              RowBox[{"order", ".", " ", "We"}], " ", "separate", " ", "them",
               " ", "from", " ", "higher", " ", "order", " ", "rules", " ", 
              "because", " ", "the", " ", "user", " ", "can", " ", "choose", 
              " ", "not", " ", "to", " ", "use", " ", "vectors", " ", "and", 
              " ", "tensor", " ", "at", " ", "first", " ", 
              RowBox[{"order", "."}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Switch", "[", 
                RowBox[{
                "gauge", " ", ",", "\"\<NewtonGauge\>\"", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", "i1_", ",", "i2_"}], 
                    "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "-", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"BT1", " ", "2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"BV1", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}]}]}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<ComovingGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", "i1_", ",", "i2_"}], 
                    "]"}], "\[Rule]", 
                   RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "-", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"BT1", " ", "2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"BV1", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}], "+", 
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], ")"}]}], 
                    "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<SynchronousGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", "i1_", ",", "i2_"}], 
                    "]"}], "->", 
                   RowBox[{"Identity", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", "2"}], 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"BT1", " ", "2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Es", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], 
                    "\[IndentingNewLine]", "+", 
                    RowBox[{"BV1", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Ev", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Ev", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}]}]}], "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<FlatGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", "i1_", ",", "i2_"}], 
                    "]"}], "->", 
                   RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "+", 
                    RowBox[{"BT1", " ", "2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"BV1", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}], "+", 
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], ")"}]}], 
                    "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<AnyGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", "i1_", ",", "i2_"}], 
                    "]"}], "->", 
                   RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "-", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"BT1", " ", "2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Es", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], 
                    "\[IndentingNewLine]", "+", 
                    RowBox[{"BV1", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Ev", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Ev", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"BV1", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}], "+", 
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], ")"}]}], 
                    "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<IsoDensityGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", "i1_", ",", "i2_"}], 
                    "]"}], "->", 
                   RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "-", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"BT1", " ", "2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"BV1", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}], "+", 
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], ")"}]}], 
                    "]"}]}], ")"}]}], "]"}], "}"}], ",", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "And", " ", "then", " ", "the", " ", "rules", " ", "at", " ", 
                "order", " ", "larger", " ", "that", " ", "1"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"Switch", "[", 
                RowBox[{
                "gauge", " ", ",", "\"\<NewtonGauge\>\"", ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"n_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[GreaterEqual]", "2"}], "&"}], ")"}]}], 
                    "]"}], ",", "i1_", ",", "i2_"}], "]"}], "->", 
                   RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "-", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}]}], "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<ComovingGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"n_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[GreaterEqual]", "2"}], "&"}], ")"}]}], 
                    "]"}], ",", "i1_", ",", "i2_"}], "]"}], "->", 
                   RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "-", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}], "+", 
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], ")"}]}], 
                    "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<SynchronousGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"n_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[GreaterEqual]", "2"}], "&"}], ")"}]}], 
                    "]"}], ",", "i1_", ",", "i2_"}], "]"}], "->", 
                   RowBox[{"Identity", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", "2"}], 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Es", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], 
                    "\[IndentingNewLine]", "+", 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Ev", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Ev", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<FlatGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"n_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[GreaterEqual]", "2"}], "&"}], ")"}]}], 
                    "]"}], ",", "i1_", ",", "i2_"}], "]"}], "->", 
                   RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}], "+", 
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], ")"}]}], 
                    "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<AnyGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"n_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[GreaterEqual]", "2"}], "&"}], ")"}]}], 
                    "]"}], ",", "i1_", ",", "i2_"}], "]"}], "->", 
                   RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "-", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Es", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], 
                    "\[IndentingNewLine]", "+", 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Ev", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Ev", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}], 
                    "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}], "+", 
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], ")"}]}], 
                    "]"}]}], ")"}], ",", "\[IndentingNewLine]", 
                 "\"\<IsoDensityGauge\>\"", ",", "\[IndentingNewLine]", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"dg", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"n_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[GreaterEqual]", "2"}], "&"}], ")"}]}], 
                    "]"}], ",", "i1_", ",", "i2_"}], "]"}], "->", 
                   RowBox[{"Identity", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u", "[", "i1", "]"}]}], 
                    RowBox[{"u", "[", "i2", "]"}], "2", 
                    RowBox[{
                    RowBox[{"\[Phi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], 
                    "\[IndentingNewLine]", "-", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"\[Psi]", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"h", "[", 
                    RowBox[{"i1", ",", "i2"}], "]"}], "+", 
                    RowBox[{"If", "[", 
                    RowBox[{"ShBool", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}], "/", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "0"}], 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", "+", 
                    RowBox[{"2", 
                    RowBox[{
                    RowBox[{"Et", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i2"}], "]"}]}], "+", 
                    
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"Bv", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1"}], "]"}]}]}], 
                    ")"}], "\[IndentingNewLine]", "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"u", "[", "i1", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i2", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}], "+", 
                    RowBox[{
                    RowBox[{"u", "[", "i2", "]"}], 
                    RowBox[{
                    RowBox[{"cd", "[", "i1", "]"}], "@", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}]}]}], ")"}]}], 
                    "]"}]}], ")"}]}], "]"}], "}"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"SplitMetric", ",", "4"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "SplitMetric", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.563530654168147*^9, 3.56353065982548*^9}, {
   3.563530706497075*^9, 3.56353073982579*^9}, {3.563556699767825*^9, 
   3.563556707384211*^9}, {3.563558300101953*^9, 3.563558312323783*^9}, {
   3.563605733401085*^9, 3.563605797880916*^9}, {3.563607095644959*^9, 
   3.5636071934283953`*^9}, {3.563607235035565*^9, 3.563607314474931*^9}, {
   3.563609106904379*^9, 3.5636091639554367`*^9}, {3.563609200431322*^9, 
   3.563609207061123*^9}, {3.563615804744828*^9, 3.563616107445413*^9}, {
   3.563616187140903*^9, 3.56361621078202*^9}, {3.563616921623789*^9, 
   3.563616926287407*^9}, {3.563708747905919*^9, 3.563708803498434*^9}, {
   3.563708862261312*^9, 3.563708865127019*^9}, {3.5637089828707*^9, 
   3.563709042790449*^9}, {3.563773296771387*^9, 3.5637733112049723`*^9}, {
   3.563865169192494*^9, 3.563865202200487*^9}, {3.563865293147482*^9, 
   3.563865296701386*^9}, {3.56386730854488*^9, 3.5638673115351887`*^9}, {
   3.564719829704015*^9, 3.56471987117992*^9}, {3.564725971398593*^9, 
   3.564726012302435*^9}, 3.5647265034228888`*^9, 3.5647265738200808`*^9, 
   3.564727014249566*^9, {3.5647560836479483`*^9, 3.5647560936869087`*^9}, {
   3.56475612558928*^9, 3.564756136359211*^9}, {3.565093512794119*^9, 
   3.565093513747876*^9}, {3.5663168416583767`*^9, 3.566316842175971*^9}, 
   3.568457989654422*^9, {3.56913280320436*^9, 3.569132804792285*^9}, {
   3.5693301109894247`*^9, 3.569330223386067*^9}, {3.569898748178316*^9, 
   3.5698987578911753`*^9}, {3.569898842821609*^9, 3.569898894193369*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["2.6 Conformal Transformation", "Subsubsection",
 CellChangeTimes->{{3.562906975160152*^9, 3.562906983540073*^9}, {
  3.5771607812139397`*^9, 3.5771607819586353`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"IndicesDown", "[", "expr_", "]"}], ":=", " ", 
    RowBox[{"Fold", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"SeparateMetric", "[", 
         RowBox[{"First", "@", "$Metrics"}], "]"}], "[", 
        RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", 
      RowBox[{"xAct`xTensor`Private`ReplaceIsolated", "[", "expr", "]"}], ",", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"IndicesOf", "[", "Up", "]"}], "[", "expr", "]"}], ",", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"LIndexQ", "[", "#", "]"}]}], "&"}]}], "]"}]}], "]"}]}], 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"IndicesDown", " ", "and", " ", "IndicesUp"}], ",", " ", 
    RowBox[{
    "separate", " ", "the", " ", "indices", " ", "so", " ", "as", " ", "to", 
     " ", "have", " ", "only", " ", "indices", " ", "down", " ", 
     RowBox[{"(", 
      RowBox[{"or", " ", "up"}], ")"}], " ", "with", " ", "inverse", " ", 
     "metrics", " ", 
     RowBox[{"(", 
      RowBox[{"or", " ", "with", " ", "metrics"}], ")"}]}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Linearity", ",", " ", 
    RowBox[{"handle", " ", "products"}], ",", " ", "list", ",", " ", 
    RowBox[{"etc", "..."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"IndicesDown", "[", "expr_Times", "]"}], ":=", 
     RowBox[{"IndicesDown", "/@", "expr"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"IndicesDown", "[", "expr_List", "]"}], ":=", 
     RowBox[{"IndicesDown", "/@", "expr"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"IndicesDown", "[", "expr_Plus", "]"}], ":=", 
     RowBox[{"IndicesDown", "/@", "expr"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"IndicesDown", "[", 
      RowBox[{"Num_", "?", "NumericQ"}], "]"}], ":=", "Num"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"IndicesDown", "[", 
      RowBox[{"param_Symbol", "?", "ParameterQ"}], "]"}], ":=", "param"}], 
    ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"IndicesDown", "[", 
      RowBox[{"Power", "[", 
       RowBox[{"expr_", ",", "n_Integer"}], "]"}], "]"}], ":=", 
     RowBox[{"Power", "[", 
      RowBox[{
       RowBox[{"IndicesDown", "[", "expr", "]"}], ",", "n"}], "]"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
     "We", " ", "decide", " ", "to", " ", "go", " ", "through", " ", "scalar",
       " ", 
      RowBox[{"heads", ".", " ", "This"}], " ", "has", " ", "been", " ", 
      "added", " ", "after", " ", "the", " ", "comments", " ", "of", " ", 
      "Leo", " ", "Stein", " ", "and", " ", "Jolyon", " ", "Bloomfield"}], 
     " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{"Actually", " ", 
      RowBox[{"that", "'"}], "s", " ", "a", " ", "bad", " ", "idea", " ", 
      "according", " ", "to", " ", 
      RowBox[{"Jose", ".", " ", "We"}], " ", "d", " ", "better", " ", "make", 
      " ", "sure", " ", "that", " ", "IndicesDown", " ", "is", " ", "applied",
       " ", "inside", " ", "the", " ", "Scalar", " ", "heads", " ", "and", 
      " ", "scalar", " ", "functions", " ", 
      RowBox[{"(", 
       RowBox[{
       "see", " ", "the", " ", "implementation", " ", "of", " ", 
        "Conformal"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"IndicesDown", "[", 
      RowBox[{"Scalar", "[", "expr_", "]"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"Scalar", "@", 
        RowBox[{"IndicesDown", "[", "expr", "]"}]}], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "We", " ", "decide", " ", "to", " ", "go", " ", "through", " ", 
          "scalar", " ", 
          RowBox[{"functions", ".", " ", "I"}], " ", "do", " ", "not", " ", 
          "know", " ", "if", " ", "this", " ", "is", " ", "safe"}], "..."}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"IndicesDown", "[", 
        RowBox[{
         RowBox[{"sf_", "?", "ScalarFunctionQ"}], "[", "args___", "]"}], 
        "]"}]}], ":=", 
      RowBox[{"sf", "@@", 
       RowBox[{"IndicesDown", "/@", 
        RowBox[{"{", "args", "}"}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "actual", " ", "function", " ", "based", " ", "on", " ", 
    "IndicesOf"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"IndicesDown", "[", "expr_", "]"}], ":=", " ", 
    RowBox[{"Fold", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"SeparateMetric", "[", 
         RowBox[{"First", "@", "$Metrics"}], "]"}], "[", 
        RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", "expr", ",", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"IndicesOf", "[", "Up", "]"}], "[", "expr", "]"}], ",", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"LIndexQ", "[", "#", "]"}]}], "&"}]}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "IndicesUp", " ", "is", " ", "implemented", " ", "in", " ", "a", " ", 
     "similar", " ", "way"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"IndicesUp", "[", "expr_Times", "]"}], ":=", 
      RowBox[{"IndicesUp", "/@", "expr"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"IndicesUp", "[", "expr_List", "]"}], ":=", 
      RowBox[{"IndicesUp", "/@", "expr"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"IndicesUp", "[", "expr_Plus", "]"}], ":=", 
      RowBox[{"IndicesUp", "/@", "expr"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"IndicesUp", "[", 
       RowBox[{"Num_", "?", "NumericQ"}], "]"}], ":=", "Num"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"IndicesUp", "[", 
       RowBox[{"param_Symbol", "?", "ParameterQ"}], "]"}], ":=", "param"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"IndicesUp", "[", 
       RowBox[{"Power", "[", 
        RowBox[{"expr_", ",", "n_Integer"}], "]"}], "]"}], ":=", 
      RowBox[{"Power", "[", 
       RowBox[{
        RowBox[{"IndicesUp", "[", "expr", "]"}], ",", "n"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"IndicesUp", "[", 
       RowBox[{"Scalar", "[", "expr_", "]"}], "]"}], ":=", 
      RowBox[{
       RowBox[{
        RowBox[{"Scalar", "@", 
         RowBox[{"IndicesUp", "[", "expr", "]"}]}], "\[IndentingNewLine]", 
        RowBox[{"IndicesUp", "[", 
         RowBox[{
          RowBox[{"sf_", "?", "ScalarFunctionQ"}], "[", "args___", "]"}], 
         "]"}]}], ":=", 
       RowBox[{"sf", "@@", 
        RowBox[{"IndicesUp", "/@", 
         RowBox[{"{", "args", "}"}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"IndicesUp", "[", "expr_", "]"}], ":=", " ", 
    RowBox[{"Fold", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"SeparateMetric", "[", 
         RowBox[{"First", "@", "$Metrics"}], "]"}], "[", 
        RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", "expr", ",", 
      RowBox[{"Select", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"IndicesOf", "[", "Down", "]"}], "[", "expr", "]"}], ",", 
        RowBox[{
         RowBox[{"Not", "@", 
          RowBox[{"LIndexQ", "[", "#", "]"}]}], "&"}]}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IndicesDown", "[", "0", "]"}], ":=", "0"}], " ", ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"This", " ", "is", " ", "to", " ", "avoid", " ", "bugs"}], 
     "..."}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IndicesUp", "[", "0", "]"}], ":=", "0"}], " ", 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562658737994227*^9, 3.5626587381958933`*^9}, {
   3.562658907543044*^9, 3.562658932076045*^9}, {3.562661640336493*^9, 
   3.5626616455309753`*^9}, {3.562661782856827*^9, 3.5626617885114317`*^9}, {
   3.562965083882963*^9, 3.562965110210911*^9}, {3.563416409999311*^9, 
   3.563416412421764*^9}, {3.563418408555957*^9, 3.563418413030305*^9}, {
   3.563418508299778*^9, 3.563418532349093*^9}, 3.5634274139408607`*^9, 
   3.563559156790902*^9, {3.56471987892964*^9, 3.564719883350964*^9}, {
   3.5647399944397907`*^9, 3.56473999804729*^9}, {3.564755892717783*^9, 
   3.564755894189546*^9}, {3.564755928229684*^9, 3.564755929116465*^9}, {
   3.5684338262409477`*^9, 3.5684338399253693`*^9}, {3.573471818522057*^9, 
   3.5734718521527042`*^9}, {3.5734718856479607`*^9, 3.573472187818919*^9}, {
   3.573472303911893*^9, 3.573472315133892*^9}, {3.5734735763016872`*^9, 
   3.573473612710658*^9}, {3.5734747062781477`*^9, 3.573474741860552*^9}, {
   3.573474818869727*^9, 3.57347482544602*^9}, {3.573475340653612*^9, 
   3.573475358973754*^9}, {3.573475719772934*^9, 3.5734757432960873`*^9}, {
   3.5735689269144*^9, 3.573568942108478*^9}, {3.573569324335801*^9, 
   3.573569364197378*^9}, {3.5738798997721567`*^9, 3.573879911261414*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ConformalMetricName", "[", 
    RowBox[{
     RowBox[{"g_", "?", "MetricQ"}], ",", "1"}], "]"}], ":=", "g"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConformalMetricName", "[", 
    RowBox[{
     RowBox[{"g_", "?", "MetricQ"}], ",", "conffactor_"}], "]"}], ":=", 
   RowBox[{"SymbolJoin", "[", 
    RowBox[{"g", ",", "conffactor", ",", "2"}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJwl0X0sFHAYB3CHEVNqQqy15LUQCyk5dSWkvCymOZeXk/J+TRSrrDAqHOrW
OTvkrRflNUVXkaIyi+O8XFK7cbW66IXe1oZ+319/PPv88X2ePc/2mHF5B2PU
1dTUvEnBmVXC34n5Klb/jk6DJCI7yHUvXO5yIBgyBh9EwmXHzKNhu+KU4wli
ae43V8jVqK+Cbc+v1kETu76mNOLwRjnVSxG2dJLYkcBinMKcSW4I/MlcHgo1
TlemQac1j6mXh5bG4Zqcp2+h9EeAEuZMub6HW14kzEFBlt88rGi5uC6dOFku
+G+RpxiWLByphsmKmXrITp9ohJLqF63wy1F2G7xe90UKM/V2DMGbwwZvoNio
bBJy7uTHZBBbzqioXlFZ6QPEsKFC6orAuj2GBSpW2UWRFxTxeY5mRKtn2k7w
81z7L/ghdoTKZWdlmhPzWpXnoTGjzM+C+PDrrQBo/aqyCl6fda2B7p36g3BG
KhqFMgM3bUvilitz1OKm2nC489u+KNjVOx1sjX3ObqFQt0I7Csp+HedBG2GE
+1Yi574OEw6bjPR6ELXYcmrqZFl3E/HI9lnqXLf8Jdzw1bSvid4jkkPG4fy3
MGVqeprmA79VtH9XxzzctHc9o5nYLOqwgQ2G52yhVFLuA+OTpP/lLNbCxESX
BrjYeKMF7r5wVgIXOi1zWgrwr5V5cHGpuAQ6+GcJYSv/aSUsZdrXQD+PcI1W
5MIBqmeVRAfe49XoQX+XH0aw9FOeFfy0Vp8JfZ3Vd8Jk2UQILH5vewhuXoy9
AnuqgwTQKLBbDD1O+JTDfF3LLsgqutQNO7M5U3DstpYShmYUpt4ljjb3U6fE
HwugXppxIXxSeiDpHVEpf86DgpL4OCUxUKeEOsbkrtMsJP0cewvIF6c7w7+D
w9tgm3+SB4zj91H3m2l7wsHXmt5wg+cqP1iRkR0IjeJ9gmFspDIEDlhwImBw
SlA0/O7dK9MlXjO2lkMLrzQbPaKNXcFGWC/8bOBG/KOvWA1Pzo9HuRNNa7y5
8BFL18GX2CNwoEZGV1vZF6lYtlpS6j83t04o
  "]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DefConformalMetric", "[", 
    RowBox[{
     RowBox[{"g_", "?", "MetricQ"}], ",", "conffactor_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", "q"}], "}"}], ",", 
     RowBox[{"Catch", "@", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"M", "=", 
           RowBox[{"ManifoldOfCovD", "@", 
            RowBox[{"CovDOfMetric", "@", "g"}]}]}], ",", 
          RowBox[{"CD", "=", 
           RowBox[{"CovDOfMetric", "@", "g"}]}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"i1", "=", 
             RowBox[{"DummyIn", "[", 
              RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ",", 
            RowBox[{"i2", "=", 
             RowBox[{"DummyIn", "[", 
              RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ",", 
            RowBox[{"sy1", "=", 
             RowBox[{
              RowBox[{"SymbolOfCovD", "[", "CD", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", 
            RowBox[{"sy2", "=", 
             RowBox[{
              RowBox[{"SymbolOfCovD", "[", "CD", "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{"metlist", "=", 
             RowBox[{"Select", "[", 
              RowBox[{"$Metrics", ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"InducedFrom", "[", "#", "]"}], "===", "Null"}], 
                "&"}]}], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", "TODO", " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Not", "@", 
              RowBox[{"DefTensorQ", "[", "conffactor", "]"}]}], ",", 
             RowBox[{"DefTensor", "[", 
              RowBox[{
               RowBox[{"conffactor", "[", 
                RowBox[{
                 RowBox[{"LI", "[", "n", "]"}], ",", 
                 RowBox[{"LI", "[", "q", "]"}]}], "]"}], ",", 
               RowBox[{"{", "M", "}"}], ",", 
               RowBox[{"PrintAs", "->", 
                RowBox[{"ToString", "[", "conffactor", "]"}]}]}], "]"}]}], 
            "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Off", "[", 
            StyleBox[
             RowBox[{"DefMetric", "::", "old"}], "MessageName"], "]"}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{"Annoying", " ", "message", " ", "turned", " ", "off"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Not", "[", 
              RowBox[{"DefTensorQ", "[", 
               RowBox[{"ConformalMetricName", "[", 
                RowBox[{"g", ",", "conffactor"}], "]"}], "]"}], "]"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"DefMetric", "[", 
               RowBox[{
                RowBox[{"-", "1"}], ",", 
                RowBox[{
                 RowBox[{"ConformalMetricName", "[", 
                  RowBox[{"g", ",", "conffactor"}], "]"}], "[", 
                 RowBox[{
                  RowBox[{"-", "i1"}], ",", 
                  RowBox[{"-", "i2"}]}], "]"}], ",", 
                RowBox[{"SymbolJoin", "[", 
                 RowBox[{"CD", ",", "conffactor", ",", "2"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\"\<:\>\"", ",", 
                  RowBox[{"StringJoin", "[", 
                   RowBox[{"sy2", ",", 
                    RowBox[{"ToString", "[", "conffactor", "]"}], ",", 
                    RowBox[{"ToString", "[", "2", "]"}]}], "]"}]}], "}"}], 
                ",", 
                RowBox[{"PrintAs", "\[Rule]", 
                 RowBox[{"StringJoin", "[", 
                  RowBox[{"\"\<[\>\"", ",", 
                   RowBox[{"PrintAs", "[", "g", "]"}], ",", 
                   RowBox[{"\"\<\\!\\(\>\"", "<>", 
                    RowBox[{"PrintAs", "[", "conffactor", "]"}], "<>", 
                    "\"\<\\^2\\)\>\""}], ",", "\"\<]\>\""}], 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"ToString", "[", "conffactor", "]"}], ",", 
                    RowBox[{"ToString", "[", "2", "]"}]}], "*)"}], "]"}]}], 
                ",", 
                RowBox[{"ConformalTo", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "i1"}], ",", 
                    RowBox[{"-", "i2"}]}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"conffactor", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], "^", "2"}]}], 
                  "}"}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"On", "[", 
            StyleBox[
             RowBox[{"DefMetric", "::", "old"}], "MessageName"], "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "We", " ", "have", " ", "to", " ", "ensure", " ", "it", " ", "is",
              " ", "safe"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Perturbation", "[", 
             RowBox[{
              RowBox[{"conffactor", "[", 
               RowBox[{
                RowBox[{"LI", "[", "0", "]"}], ",", 
                RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], "]"}], 
              ",", "n_"}], "]"}], "^:=", 
            RowBox[{"0", "/;", 
             RowBox[{"n", "\[GreaterEqual]", "1"}]}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"Off", "[", 
            StyleBox[
             RowBox[{"ConformalRules", "::", "unknown"}], "MessageName"], 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "We", " ", "use", " ", "the", " ", "error", " ", "sent", " ", 
             "by", " ", "ConformalRules", " ", "to", " ", "chekc", " ", 
             "whether", " ", "or", " ", "not", " ", "the", " ", "metric", " ",
              "in", " ", "the", " ", "list", " ", "metlist", " ", "is", " ", 
             "conformallyr", " ", "elated", " ", "to", " ", "the", " ", 
             "metric", " ", 
             RowBox[{"g", ".", "\[IndentingNewLine]", "If"}], " ", "it", " ", 
             "is", " ", "the", " ", "case", " ", "we", " ", "enforce", " ", 
             "transitivity", " ", "of", " ", "the", " ", "conformal", " ", 
             RowBox[{"relations", "."}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Catch", "@", 
                 RowBox[{"ConformalRules", "[", 
                  RowBox[{"g", ",", "#"}], "]"}]}], "=!=", "Null"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"SetConformalTo", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"SymbolJoin", "[", 
                   RowBox[{"g", ",", "conffactor", ",", "2"}], "]"}], "[", 
                  RowBox[{
                   RowBox[{"-", "i1"}], ",", 
                   RowBox[{"-", "i2"}]}], "]"}], ",", " ", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{
                    RowBox[{"-", "i1"}], ",", " ", 
                    RowBox[{"-", "i2"}]}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"ConformalFactor", "[", 
                    RowBox[{"g", ",", "#"}], "]"}], "*", " ", 
                    RowBox[{
                    RowBox[{"conffactor", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], "^", "2"}]}]}], 
                  "}"}]}], "]"}]}], "]"}], "&"}], "/@", "metlist"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"On", "[", 
            StyleBox[
             RowBox[{"ConformalRules", "::", "unknown"}], "MessageName"], 
            "]"}], ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"DefConformalMetric", ",", "2"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "DefConformalMetric", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5627601247209377`*^9, 3.562760349944799*^9}, {
   3.5627607457289248`*^9, 3.562760866381476*^9}, {3.562760965806519*^9, 
   3.562760985106327*^9}, {3.562772867746181*^9, 3.56277292751643*^9}, {
   3.562773773312913*^9, 3.5627738047117558`*^9}, {3.562777982286633*^9, 
   3.562777982755105*^9}, {3.562780666871127*^9, 3.5627806820443993`*^9}, {
   3.562781364190624*^9, 3.562781384413813*^9}, {3.562781612983766*^9, 
   3.562781613909204*^9}, {3.5627823999943323`*^9, 3.5627824460786247`*^9}, {
   3.5627824984986343`*^9, 3.562782505746401*^9}, {3.562782611368066*^9, 
   3.5627826184221897`*^9}, {3.562782964302932*^9, 3.56278296464427*^9}, {
   3.562783970142561*^9, 3.562784019155953*^9}, {3.562784087402396*^9, 
   3.5627841188271914`*^9}, {3.562784150238614*^9, 3.5627841628250647`*^9}, {
   3.5627843914577208`*^9, 3.562784393845275*^9}, {3.562784472619465*^9, 
   3.56278448481526*^9}, {3.56278558036479*^9, 3.562785583327721*^9}, {
   3.562959812074374*^9, 3.562959812431806*^9}, {3.5631047971660223`*^9, 
   3.563104820798047*^9}, {3.563129219486157*^9, 3.563129240242572*^9}, {
   3.563130805748403*^9, 3.563130806637805*^9}, {3.563133940073533*^9, 
   3.563133967146793*^9}, {3.563135596812633*^9, 3.563135613310514*^9}, {
   3.563136268993793*^9, 3.56313628174776*^9}, {3.563136632491972*^9, 
   3.563136684806753*^9}, {3.56313708181492*^9, 3.563137087580468*^9}, {
   3.563137781146431*^9, 3.563137802310577*^9}, {3.563141799117889*^9, 
   3.5631418338189573`*^9}, {3.563141896238042*^9, 3.56314201153013*^9}, {
   3.5631723229872017`*^9, 3.5631723283035107`*^9}, {3.563189806628152*^9, 
   3.563189806760989*^9}, {3.563421196839411*^9, 3.5634211994132557`*^9}, {
   3.563421254773675*^9, 3.563421256841691*^9}, {3.563421380804472*^9, 
   3.563421420355103*^9}, {3.5634214711213923`*^9, 3.5634215277439127`*^9}, {
   3.563421597757928*^9, 3.563421705008443*^9}, {3.5634220217687607`*^9, 
   3.563422044002646*^9}, {3.5634222769290543`*^9, 3.563422278513356*^9}, {
   3.563423015948781*^9, 3.563423081669485*^9}, {3.5634231172401114`*^9, 
   3.563423187922883*^9}, {3.563424801179564*^9, 3.5634248245125647`*^9}, {
   3.563424908531249*^9, 3.563424956072044*^9}, {3.563425022079919*^9, 
   3.563425049413769*^9}, {3.563425818945105*^9, 3.563425822455955*^9}, {
   3.5634258698321857`*^9, 3.563425893107386*^9}, {3.563425975631507*^9, 
   3.563426100247265*^9}, {3.563426280472279*^9, 3.563426296068883*^9}, {
   3.5634264868383093`*^9, 3.563426489371773*^9}, {3.563426971281028*^9, 
   3.563426978613619*^9}, {3.563427046041026*^9, 3.5634270502640676`*^9}, {
   3.563427321157537*^9, 3.563427340329987*^9}, {3.563427602891082*^9, 
   3.563427616208476*^9}, {3.563428772421063*^9, 3.563428774365336*^9}, {
   3.5634289672691507`*^9, 3.563428968733038*^9}, {3.5635167783936462`*^9, 
   3.563516798213976*^9}, {3.563529035330271*^9, 3.563529036532387*^9}, {
   3.5635939710700483`*^9, 3.563594017417486*^9}, {3.5635941477691107`*^9, 
   3.563594182587888*^9}, {3.5635942274158573`*^9, 3.563594230298634*^9}, {
   3.563594272222814*^9, 3.563594296151588*^9}, {3.563594344539567*^9, 
   3.563594372108596*^9}, {3.56359440226295*^9, 3.5635944231367683`*^9}, {
   3.5635944908794928`*^9, 3.563594522607706*^9}, {3.563607710165032*^9, 
   3.563607745221634*^9}, {3.563610435664812*^9, 3.56361044438039*^9}, {
   3.5637044793622637`*^9, 3.5637044870019493`*^9}, {3.5637091987484694`*^9, 
   3.56370920223866*^9}, {3.563737464320524*^9, 3.563737474972657*^9}, {
   3.5637733234355307`*^9, 3.563773358376976*^9}, 3.5638777116805143`*^9, {
   3.5638790971951857`*^9, 3.5638791044171133`*^9}, {3.564718808669401*^9, 
   3.564718812713306*^9}, {3.564726021719398*^9, 3.564726029660433*^9}, 
   3.564726585523014*^9, {3.5663168435171003`*^9, 3.566316844085518*^9}, 
   3.568457984320285*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConfHead", "[", 
     RowBox[{"_", ",", "_"}], "]"}], "[", 
    RowBox[{"delta", "[", 
     RowBox[{"\[Mu]_", ",", "\[Nu]_"}], "]"}], "]"}], ":=", 
   RowBox[{"delta", "[", 
    RowBox[{"\[Mu]", ",", "\[Nu]"}], "]"}]}], 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Because", " ", "I", " ", "know", " ", "that", " ", "when", " ", "there", 
     " ", "is", " ", "delta", " ", "function", " ", "in", " ", "an", " ", 
     "expression"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
      "it", " ", "is", " ", "always", " ", "with", " ", "one", " ", "index", 
       " ", "up", " ", "and", " ", "one", " ", "down"}], "..."}], "so", " ", 
     "this", " ", "should", " ", "be", " ", 
     RowBox[{"fine", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConfHead", "[", 
     RowBox[{
      RowBox[{"metric1_", "?", "MetricQ"}], ",", 
      RowBox[{"metric2_", "?", "MetricQ"}]}], "]"}], "[", 
    RowBox[{
     RowBox[{"ConfHead", "[", 
      RowBox[{
       RowBox[{"metric2_", "?", "MetricQ"}], ",", 
       RowBox[{"metric1_", "?", "MetricQ"}]}], "]"}], "[", "expr_", "]"}], 
    "]"}], ":=", "expr"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Not", " ", "necessary"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConfHead", "[", 
    RowBox[{
     RowBox[{"metric1_", "?", "MetricQ"}], ",", 
     RowBox[{"metric1_", "?", "MetricQ"}]}], "]"}], "[", "expr_", "]"}], ":=",
   "expr"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConfHead", "[", 
     RowBox[{
      RowBox[{"metric2_", "?", "MetricQ"}], ",", 
      RowBox[{"metric3_", "?", "MetricQ"}]}], "]"}], "[", 
    RowBox[{
     RowBox[{"ConfHead", "[", 
      RowBox[{
       RowBox[{"metric1_", "?", "MetricQ"}], ",", 
       RowBox[{"metric2_", "?", "MetricQ"}]}], "]"}], "[", "expr_", "]"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{"ConfHead", "[", 
     RowBox[{"metric1", ",", "metric3"}], "]"}], "[", "expr", "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Updated", ".", " ", "New"}], " ", "definition"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"ConfHead", "/:", 
     RowBox[{"IsIndexOf", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ConfHead", "[", 
         RowBox[{"_", ",", "_"}], "]"}], "[", 
        RowBox[{
         RowBox[{"tens_", "?", "xTensorQ"}], "[", "inds___", "]"}], "]"}], 
       ",", "i2_", ",", "delta"}], "]"}], ":=", "False"}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Thanks", " ", "to", " ", "Jolyon", " ", "and", " ", "Leo", " ", 
     "Stein"}], ",", " ", 
    RowBox[{
    "the", " ", "definition", " ", "below", " ", "should", " ", "be", " ", 
     "much", " ", "more", " ", 
     RowBox[{"general", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "The", " ", "main", " ", "reason", " ", "is", " ", "that", " ", "the", " ",
     "delta", " ", "tensor", " ", "is", " ", "greedy", " ", "and", " ", 
    "wants", " ", "to", " ", "contract", " ", "through", " ", "expressions", 
    " ", "like", "\n", 
    RowBox[{
     RowBox[{
      RowBox[{"ConfHead", "[", "...", "]"}], "[", 
      RowBox[{"f", "[", 
       RowBox[{"Scalar", "[", 
        RowBox[{"phi", "[", "]"}], "]"}], "]"}], "]"}], ".", 
     "\[IndentingNewLine]", "The"}], " ", "new", " ", "definition", " ", 
    "below", " ", "should", " ", "avoid", " ", "that", " ", "to", " ", 
    RowBox[{"happen", "."}]}], "\[IndentingNewLine]", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ConfHead", "/:", 
   RowBox[{"IsIndexOf", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ConfHead", "[", 
       RowBox[{"_", ",", "_"}], "]"}], "[", "_", "]"}], ",", "_", ",", 
     "delta"}], "]"}], ":=", "False"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5627429098239803`*^9, 3.562743027214861*^9}, {
   3.5627599439311028`*^9, 3.56275996343778*^9}, {3.562761068374967*^9, 
   3.562761100469842*^9}, 3.562762721061398*^9, 3.562762780988717*^9, 
   3.5629309791745663`*^9, {3.563104868420679*^9, 3.5631048705679817`*^9}, {
   3.563471764601796*^9, 3.563471766920884*^9}, {3.563559178015921*^9, 
   3.563559193019215*^9}, {3.5641615142918653`*^9, 3.564161514492464*^9}, {
   3.56416175343919*^9, 3.564161776862027*^9}, {3.564162663212943*^9, 
   3.5641626695021963`*^9}, {3.564167431145329*^9, 3.564167431614917*^9}, {
   3.564718821279149*^9, 3.5647188224793386`*^9}, {3.564727239268979*^9, 
   3.564727256578135*^9}, {3.576830699942545*^9, 3.57683072739616*^9}, {
   3.576830763934701*^9, 3.57683088228205*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$BoolBasicConformalWeight", "=", "True"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"WeightOfIndicesList", "[", "indices_List", "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"aindex", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"indices", ",", 
         RowBox[{
          RowBox[{"Not", "[", 
           RowBox[{"LIndexQ", "[", "#", "]"}], "]"}], "&"}]}], "]"}]}], "}"}],
      ",", 
     RowBox[{
      RowBox[{"Length", "@", 
       RowBox[{"Select", "[", 
        RowBox[{"aindex", ",", "DownIndexQ"}], "]"}]}], "-", 
      RowBox[{"Length", "@", 
       RowBox[{"Select", "[", 
        RowBox[{"aindex", ",", "UpIndexQ"}], "]"}]}]}]}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"Conformal", " ", "weight", " ", "of", " ", "a", " ", "tensor"}], 
   " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConformalWeight", "[", 
    RowBox[{"tens_", "?", "xTensorQ"}], "]"}], ":=", "0"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConformalWeight", "[", 
    RowBox[{
     RowBox[{"tens_", "?", "xTensorQ"}], "[", "indices___", "]"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"ConformalWeight", "[", "tens", "]"}], "+", 
    RowBox[{"WeightOfIndicesList", "[", 
     RowBox[{"{", "indices", "}"}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConformalWeight", "[", 
     RowBox[{"f_", "?", "ScalarFunctionQ"}], "]"}], ":=", "0"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyChangeChristoffel", "[", 
    RowBox[{"expr_", ",", "cd_", ",", "cd_"}], "]"}], ":=", "expr"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MyChangeChristoffel", "[", 
    RowBox[{"expr_", ",", "cd2list_List", ",", "cd1_"}], "]"}], ":=", 
   RowBox[{"Fold", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"MyChangeChristoffel", "[", 
       RowBox[{"#1", ",", "#2", ",", "cd1"}], "]"}], "&"}], ",", "expr", ",", 
     "cd2list"}], "]"}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"MyChangeChristoffel", "[", 
   RowBox[{"expr_", ",", "cd2_", ",", "cd1_"}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vb", "=", 
      RowBox[{"Tangent", "[", 
       RowBox[{"ManifoldOfCovD", "[", "cd1", "]"}], "]"}]}], "}"}], ",", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"chr1", "=", 
         RowBox[{"Head", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Christoffel", "[", "cd1", "]"}], ")"}], "[", 
           RowBox[{
            RowBox[{"DummyIn", "[", "vb", "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"DummyIn", "[", "vb", "]"}]}], ",", 
            RowBox[{"-", 
             RowBox[{"DummyIn", "[", "vb", "]"}]}]}], "]"}], "]"}]}], ",", 
        RowBox[{"chr2", "=", 
         RowBox[{"Head", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Christoffel", "[", "cd2", "]"}], ")"}], "[", 
           RowBox[{
            RowBox[{"DummyIn", "[", "vb", "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"DummyIn", "[", "vb", "]"}]}], ",", 
            RowBox[{"-", 
             RowBox[{"DummyIn", "[", "vb", "]"}]}]}], "]"}], "]"}]}], ",", 
        RowBox[{"chr21", "=", 
         RowBox[{"Head", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Christoffel", "@@", 
             RowBox[{"Sort", "[", 
              RowBox[{"{", 
               RowBox[{"cd2", ",", "cd1"}], "}"}], "]"}]}], ")"}], "[", 
           RowBox[{
            RowBox[{"DummyIn", "[", "vb", "]"}], ",", 
            RowBox[{"-", 
             RowBox[{"DummyIn", "[", "vb", "]"}]}], ",", 
            RowBox[{"-", 
             RowBox[{"DummyIn", "[", "vb", "]"}]}]}], "]"}], "]"}]}], ",", 
        RowBox[{"sign", "=", 
         RowBox[{"Order", "[", 
          RowBox[{"cd2", ",", "cd1"}], "]"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"expr", "/.", 
       RowBox[{
        RowBox[{"chr2", "[", 
         RowBox[{"i1_", ",", "i2_", ",", "i3_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"chr1", "[", 
          RowBox[{"i1", ",", "i2", ",", "i3"}], "]"}], "+", 
         RowBox[{"sign", "*", 
          RowBox[{"chr21", "[", 
           RowBox[{"i1", ",", "i2", ",", "i3"}], "]"}]}]}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.5627429098239803`*^9, 3.562743027214861*^9}, {
   3.5627599439311028`*^9, 3.56275996343778*^9}, {3.562761068374967*^9, 
   3.562761114847815*^9}, {3.562761242202577*^9, 3.562761242807414*^9}, {
   3.562761276238146*^9, 3.562761277557671*^9}, {3.562765867317285*^9, 
   3.562765927069659*^9}, 3.5627661330724583`*^9, {3.562769177969594*^9, 
   3.562769185669799*^9}, {3.563273002680345*^9, 3.5632730642630777`*^9}, {
   3.563428038705475*^9, 3.56342806857477*^9}, {3.56342809912191*^9, 
   3.563428101023857*^9}, {3.5634281356846247`*^9, 3.5634282427070417`*^9}, {
   3.563428325336768*^9, 3.563428350017105*^9}, {3.5634284017758207`*^9, 
   3.5634284035261593`*^9}, 3.563428435874475*^9, {3.5634338231641197`*^9, 
   3.563433834073967*^9}, {3.563460404508383*^9, 3.563460455346219*^9}, {
   3.5634612356676283`*^9, 3.5634612376245813`*^9}, {3.5634623864396687`*^9, 
   3.563462389247456*^9}, 3.5634717846038933`*^9, {3.563559213235042*^9, 
   3.5635592211096077`*^9}, {3.56373763300491*^9, 3.563737651635652*^9}, {
   3.5638727521606493`*^9, 3.56387275449889*^9}, {3.56387421897565*^9, 
   3.563874323577114*^9}, {3.563874366503263*^9, 3.5638743951302557`*^9}, {
   3.563874808246751*^9, 3.56387490762182*^9}, 3.5638749507307777`*^9, {
   3.563875488558158*^9, 3.563875490717947*^9}, {3.5638755968673286`*^9, 
   3.5638756414215717`*^9}, {3.563875678012257*^9, 3.5638756817061453`*^9}, 
   3.5638757794947853`*^9, {3.563875812600354*^9, 3.5638758266940603`*^9}, {
   3.563875925885531*^9, 3.563875941444069*^9}, {3.56387735894291*^9, 
   3.563877362135376*^9}, {3.5638774195789423`*^9, 3.563877419957591*^9}, {
   3.5641679031388617`*^9, 3.5641679131412687`*^9}, {3.564167987004674*^9, 
   3.564168000252524*^9}, {3.564718828801539*^9, 3.56471883424477*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ExistInertHead", "[", "head_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Length", "@", 
     RowBox[{"Cases", "[", 
      RowBox[{"$InertHeads", ",", "head"}], "]"}]}], ">", "0"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RulesConf", "[", 
   RowBox[{
    RowBox[{"metric1_", "?", "MetricQ"}], ",", 
    RowBox[{"metric2_", "?", "MetricQ"}]}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "cd1", ",", "cd2", ",", "confa2", ",", "confa", ",", "M", ",", "res"}], 
      
      RowBox[{"(*", 
       RowBox[{",", "i1", ",", "i2", ",", "i3", ",", "i4"}], "*)"}], "}"}], 
     ",", 
     RowBox[{
      RowBox[{"cd1", "=", 
       RowBox[{"CovDOfMetric", "[", "metric1", "]"}]}], ";", 
      RowBox[{"cd2", "=", 
       RowBox[{"CovDOfMetric", "[", "metric2", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"confa2", "=", 
       RowBox[{"ConformalFactor", "[", 
        RowBox[{"metric2", ",", "metric1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"confa", "=", 
       RowBox[{
        RowBox[{"Sqrt", "[", 
         RowBox[{"ConformalFactor", "[", 
          RowBox[{"metric2", ",", "metric1"}], "]"}], "]"}], "/.", 
        RowBox[{
         RowBox[{"Sqrt", "[", 
          RowBox[{"x_", "^", "2"}], "]"}], ":>", "x"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"ManifoldOfCovD", "[", "cd1", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"inds", "=", 
          RowBox[{"DummyIn", "/@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Tangent", "[", "M", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"Range", "[", "4", "]"}], "}"}]}], "]"}]}]}], "}"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"i1", "=", 
             RowBox[{"inds", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", 
            RowBox[{"i2", "=", 
             RowBox[{"inds", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ",", 
            RowBox[{"i3", "=", 
             RowBox[{"inds", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], ",", 
            RowBox[{"i4", "=", 
             RowBox[{"inds", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}]}], "}"}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Once", " ", "confheads", " ", "are", " ", "put", " ", "on", " ", 
            "expression", " ", 
            RowBox[{"(", 
             RowBox[{
             "as", " ", "a", " ", "result", " ", "of", " ", "a", " ", 
              "formal", " ", "conformal", " ", "transformation"}], ")"}], " ",
             "then", " ", "we", " ", "remove", " ", "them", " ", "by", " ", 
            "expressing", " ", "what", " ", "they", " ", "mean", " ", "in", 
            " ", "function", " ", "of", " ", "the", " ", "original", " ", 
            "tensors", " ", "and", " ", "the", " ", "scale", " ", "factor"}], 
           " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"res", "=", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"ConfHead", "[", 
                 RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Riemann", "@", "cd1"}], ")"}], "[", 
                 RowBox[{"i1_", ",", "i2_", ",", "i3_", ",", "i4_"}], "]"}], 
                "]"}], ":>", 
               RowBox[{
                RowBox[{"confa", "^", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"WeightOfIndicesList", "[", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", "i2", ",", "i3", ",", "i4"}], "}"}], 
                    "]"}], "-", "2"}], ")"}]}], 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Riemann", "@", "cd2"}], ")"}], "[", 
                 RowBox[{"i1", ",", "i2", ",", "i3", ",", "i4"}], "]"}]}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ConfHead", "[", 
                 RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Ricci", "@", "cd1"}], ")"}], "[", 
                 RowBox[{"i1_", ",", "i2_"}], "]"}], "]"}], ":>", 
               RowBox[{
                RowBox[{"confa", "^", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"WeightOfIndicesList", "[", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", "i2"}], "}"}], "]"}], "-", "2"}], 
                  ")"}]}], 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Ricci", "@", "cd2"}], ")"}], "[", 
                 RowBox[{"i1", ",", "i2"}], "]"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ConfHead", "[", 
                 RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"RicciScalar", "@", "cd1"}], ")"}], "[", "]"}], 
                "]"}], "\[RuleDelayed]", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"RicciScalar", "@", "cd2"}], ")"}], "[", "]"}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ConfHead", "[", 
                 RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Christoffel", "@", "cd1"}], ")"}], "[", 
                 RowBox[{"i1_", ",", "i2_", ",", "i3_"}], "]"}], "]"}], ":>", 
               
               RowBox[{
                RowBox[{"confa", "^", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"WeightOfIndicesList", "[", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", "i2", ",", "i3"}], "}"}], "]"}], "-", 
                   "1"}], ")"}]}], "*", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Christoffel", "@", "cd2"}], ")"}], "[", 
                 RowBox[{"i1", ",", "i2", ",", "i3"}], "]"}]}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ConfHead", "[", 
                 RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"Determinant", "[", 
                   RowBox[{"metric1", ",", "AIndex"}], "]"}], ")"}], "[", 
                 "]"}], "]"}], "\[RuleDelayed]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "This", " ", "is", " ", "removed", " ", "because", " ", "now",
                  " ", "xTensor", " ", "is", " ", "patched", " ", 
                 RowBox[{
                  RowBox[{"confa2", "^", 
                   RowBox[{"DimOfManifold", "[", "M", "]"}]}], ".", " ", 
                  "Thanks"}], " ", "to", " ", "Leo", " ", 
                 RowBox[{"Stein", "."}]}], "*)"}], 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"Determinant", "[", 
                  RowBox[{"metric2", ",", "AIndex"}], "]"}], ")"}], "[", 
                "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "This", " ", "line", " ", "below", " ", "is", " ", "not", " ",
                  "working", " ", 
                 RowBox[{"well", ".", "  ", "The"}], " ", "problem", " ", 
                 "should", " ", "be", " ", "considered", " ", "later", " ", 
                 "when", " ", "xTensor", " ", "knows", " ", "how", " ", "to", 
                 " ", "handle", " ", "the", " ", "epsilon", " ", "of", " ", 
                 "a", " ", "frozen", " ", 
                 RowBox[{"metric", ".", " ", "So"}], " ", "this", " ", 
                 "really", " ", "works", " ", "only", " ", "when", " ", 
                 "metric1", " ", "is", " ", "the", " ", "ambient", " ", 
                 "metric"}], "..."}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ConfHead", "[", 
                 RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"epsilon", "@", "metric1"}], ")"}], "[", 
                 RowBox[{"inds__", "?", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "#", "}"}], "]"}], "===", 
                    RowBox[{"DimOfManifold", "[", "M", "]"}]}], "&"}], 
                   ")"}]}], "]"}], "]"}], "\[RuleDelayed]", 
               RowBox[{"(*", 
                RowBox[{"confa2", "^", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"DimOfManifold", "[", "M", "]"}], "/", "2"}], 
                  ")"}]}], "*)"}], 
               RowBox[{
                RowBox[{"confa", "^", 
                 RowBox[{"(", 
                  RowBox[{"WeightOfIndicesList", "[", 
                   RowBox[{"{", "inds", "}"}], "]"}], ")"}]}], 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"epsilon", "@", "metric1"}], ")"}], "[", "inds", 
                 "]"}]}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Not", " ", "really", " ", "satisfactory", " ", "but", " ", 
                "minimalist", " ", "for", " ", "scalar", " ", "functions"}], 
               " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "Following", " ", "Leo", " ", "Stein", " ", "suggestion"}], 
                ",", " ", 
                RowBox[{
                "we", " ", "allow", " ", "the", " ", "scalar", " ", 
                 "function", " ", "to", " ", "have", " ", "several", " ", 
                 "arguments"}]}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ConfHead", "[", 
                 RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"f_", "?", "ScalarFunctionQ"}], "[", "arg___", "]"}],
                 "]"}], ":>", 
               RowBox[{
                RowBox[{"Simplify", "[", 
                 RowBox[{
                  RowBox[{"confa2", "^", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"ConformalWeight", "[", "f", "]"}], ")"}], "/", 
                    "2"}], ")"}]}], ",", 
                  RowBox[{"Assumptions", "\[Rule]", 
                   RowBox[{"confa", ">", "0"}]}]}], "]"}], 
                RowBox[{"f", "[", "arg", "]"}]}]}], ",", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ConfHead", "[", 
                 RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"tens_", "?", "xTensorQ"}], "[", "indss___", "]"}], 
                "]"}], "\[RuleDelayed]", 
               RowBox[{
                RowBox[{"Simplify", "[", 
                 RowBox[{
                  RowBox[{"confa2", "^", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"ConformalWeight", "[", 
                    RowBox[{"tens", "[", "indss", "]"}], "]"}], "/", "2"}], 
                    ")"}]}], ",", 
                  RowBox[{"Assumptions", "\[Rule]", 
                   RowBox[{"confa", ">", "0"}]}]}], "]"}], 
                RowBox[{"tens", "[", "indss", "]"}]}]}]}], 
             "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
   "\[IndentingNewLine]", ")"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.508858442344201*^9, 3.5088584855291224`*^9}, {
   3.508858515737979*^9, 3.508858527639187*^9}, {3.508858598755756*^9, 
   3.508858604713735*^9}, {3.508858635226184*^9, 3.508858653667942*^9}, {
   3.508858701730991*^9, 3.508858718714973*^9}, {3.508858864803953*^9, 
   3.508858889095913*^9}, {3.508859084915316*^9, 3.508859090334206*^9}, {
   3.508859126301537*^9, 3.508859142500868*^9}, {3.508859351836598*^9, 
   3.508859376418871*^9}, {3.5088594447394953`*^9, 3.508859455490157*^9}, {
   3.508859522436391*^9, 3.5088595394384737`*^9}, {3.5088596387195177`*^9, 
   3.508859650737022*^9}, 3.508861226891127*^9, 3.509395875070408*^9, {
   3.509395908617353*^9, 3.509395915557078*^9}, {3.509396450749666*^9, 
   3.509396468446534*^9}, {3.50939660079399*^9, 3.50939661458706*^9}, {
   3.5093976113073473`*^9, 3.509397612057722*^9}, {3.5094655108671083`*^9, 
   3.509465553524117*^9}, {3.509465701506712*^9, 3.509465772466549*^9}, {
   3.50946582693104*^9, 3.509465855818592*^9}, {3.509467664472555*^9, 
   3.509467687228209*^9}, {3.509467792507319*^9, 3.509467876818708*^9}, {
   3.509467908428914*^9, 3.5094679310863447`*^9}, {3.5094680531994047`*^9, 
   3.509468144007649*^9}, {3.509468221178644*^9, 3.5094683138555098`*^9}, {
   3.5094684943682623`*^9, 3.509468570128002*^9}, {3.509468736320863*^9, 
   3.5094687749854813`*^9}, {3.509823750622862*^9, 3.509823751279566*^9}, {
   3.512196933062645*^9, 3.5121969393695383`*^9}, {3.512197088142097*^9, 
   3.5121971025505753`*^9}, {3.5122068970848923`*^9, 3.512206900716251*^9}, 
   3.512207257922839*^9, 3.512217370707282*^9, {3.512219213043172*^9, 
   3.512219248392877*^9}, {3.5122193330687723`*^9, 3.5122193386146593`*^9}, {
   3.512219823019206*^9, 3.512219836924304*^9}, {3.51222016944867*^9, 
   3.5122202571971188`*^9}, {3.512220328598393*^9, 3.512220349433587*^9}, {
   3.51222038565556*^9, 3.512220398278717*^9}, {3.512220616415495*^9, 
   3.512220634038397*^9}, 3.512220706637846*^9, {3.5122269739978857`*^9, 
   3.512227030393865*^9}, {3.512227087519516*^9, 3.51222712747828*^9}, {
   3.512227173829421*^9, 3.5122272922086487`*^9}, {3.5122273565748243`*^9, 
   3.5122274346275063`*^9}, {3.5122275758156853`*^9, 3.51222757905402*^9}, {
   3.512227699048643*^9, 3.512227722926651*^9}, {3.512227787912772*^9, 
   3.512227796268093*^9}, {3.5122321754826393`*^9, 3.512232231793695*^9}, {
   3.512232267838018*^9, 3.512232278201414*^9}, {3.51223243643406*^9, 
   3.512232452573696*^9}, {3.512234153450561*^9, 3.512234158440197*^9}, {
   3.5122345205918007`*^9, 3.512234523440422*^9}, {3.5122348121144657`*^9, 
   3.51223490689885*^9}, {3.512234954268499*^9, 3.512234997368232*^9}, {
   3.512235052401833*^9, 3.512235054424354*^9}, {3.51223511813691*^9, 
   3.512235187980153*^9}, {3.5122353063646584`*^9, 3.5122353114142523`*^9}, {
   3.512235812782494*^9, 3.5122358205261173`*^9}, {3.512235860501031*^9, 
   3.5122358624183493`*^9}, {3.5122359441878347`*^9, 3.51223596542597*^9}, {
   3.5122360558097258`*^9, 3.512236057814745*^9}, 3.5122360973652067`*^9, 
   3.5122361473876123`*^9, {3.5122362804106827`*^9, 3.512236282886857*^9}, {
   3.512236496470682*^9, 3.512236501173482*^9}, {3.5122365583786287`*^9, 
   3.5122365793678713`*^9}, {3.51223684968503*^9, 3.512236883843096*^9}, {
   3.512236938403097*^9, 3.5122369583872843`*^9}, {3.512237025323091*^9, 
   3.512237059260633*^9}, {3.512238841014659*^9, 3.5122388835835238`*^9}, {
   3.512239245594296*^9, 3.512239250041147*^9}, 3.512239519860394*^9, {
   3.512239592471937*^9, 3.512239597251141*^9}, {3.512245831112752*^9, 
   3.512245832850235*^9}, {3.5122465968034897`*^9, 3.512246597931012*^9}, {
   3.5122954806611137`*^9, 3.51229551612883*^9}, {3.519709825096231*^9, 
   3.5197098717038193`*^9}, {3.561804484411677*^9, 3.5618045039845963`*^9}, {
   3.562761384455841*^9, 3.562761411413368*^9}, {3.562761493149208*^9, 
   3.5627614951796494`*^9}, {3.562761559605171*^9, 3.562761569577518*^9}, 
   3.562761648390821*^9, {3.562761780086969*^9, 3.5627618267256403`*^9}, {
   3.562761858785336*^9, 3.562761859527337*^9}, {3.562762331463935*^9, 
   3.562762338334084*^9}, {3.5627624312751083`*^9, 3.5627624927032022`*^9}, {
   3.5627625291017647`*^9, 3.562762529732768*^9}, {3.562762671938952*^9, 
   3.5627626868034782`*^9}, {3.562762786001501*^9, 3.5627627892408123`*^9}, {
   3.562763541410318*^9, 3.562763571160331*^9}, {3.5627636596858*^9, 
   3.56276369698209*^9}, {3.5627637471592617`*^9, 3.5627637591380672`*^9}, {
   3.5627638057321243`*^9, 3.562763812836376*^9}, {3.5627639995124807`*^9, 
   3.562764078384655*^9}, {3.562764199067149*^9, 3.5627642028880997`*^9}, {
   3.562764251915113*^9, 3.562764269752178*^9}, 3.5627643783936853`*^9, {
   3.56276443439015*^9, 3.56276451304274*^9}, {3.5627647867380047`*^9, 
   3.562764809866083*^9}, {3.5627648432785177`*^9, 3.562764855369115*^9}, {
   3.562764890710806*^9, 3.562764894606036*^9}, {3.562764964364325*^9, 
   3.5627649708908043`*^9}, {3.5627650667407827`*^9, 
   3.5627650925406446`*^9}, {3.562765193360723*^9, 3.56276521037932*^9}, {
   3.562765261210011*^9, 3.562765298695374*^9}, {3.562765347731086*^9, 
   3.562765363039649*^9}, {3.562765430933527*^9, 3.562765456973625*^9}, {
   3.562765531168042*^9, 3.562765537051086*^9}, {3.562765602892321*^9, 
   3.562765605464768*^9}, {3.5627656405387363`*^9, 3.562765641977766*^9}, {
   3.562765678337104*^9, 3.562765686083744*^9}, {3.562765732343638*^9, 
   3.5627657360766153`*^9}, {3.562768241455614*^9, 3.562768242742853*^9}, {
   3.562769090615851*^9, 3.5627691126491547`*^9}, {3.5627693100252123`*^9, 
   3.562769327683413*^9}, {3.562769438305193*^9, 3.5627694865315638`*^9}, {
   3.562824815813527*^9, 3.562824827869734*^9}, {3.5629309659106293`*^9, 
   3.562930983246045*^9}, {3.563093628356411*^9, 3.563093657082294*^9}, {
   3.5630947930630407`*^9, 3.56309480837151*^9}, {3.56309488359208*^9, 
   3.5630949033523912`*^9}, {3.563095138313108*^9, 3.5630951511534986`*^9}, {
   3.563095208551353*^9, 3.563095238064776*^9}, {3.5630954704714413`*^9, 
   3.563095529746813*^9}, {3.563095576112398*^9, 3.563095577992601*^9}, {
   3.563100652245392*^9, 3.5631006553937693`*^9}, {3.563272906233708*^9, 
   3.563272939091174*^9}, {3.563273830538301*^9, 3.563273839311698*^9}, {
   3.563428262355997*^9, 3.563428286414879*^9}, {3.563460809715321*^9, 
   3.563460883517541*^9}, {3.563460927436322*^9, 3.563460950527717*^9}, {
   3.5634610971778297`*^9, 3.5634611155681458`*^9}, {3.563461175472362*^9, 
   3.563461204872499*^9}, {3.563461344619548*^9, 3.563461348660201*^9}, {
   3.56346251737545*^9, 3.563462578433744*^9}, {3.563462839782181*^9, 
   3.56346291684827*^9}, {3.563521787974472*^9, 3.563521796623468*^9}, {
   3.563522201672209*^9, 3.563522210781996*^9}, {3.56352235023742*^9, 
   3.563522359614151*^9}, {3.5637374956720037`*^9, 3.563737513251944*^9}, {
   3.5641615010264473`*^9, 3.564161528665696*^9}, {3.564161792651681*^9, 
   3.564161794071846*^9}, {3.564161873588952*^9, 3.564161905192809*^9}, {
   3.56416193558115*^9, 3.56416194988861*^9}, {3.564167853466734*^9, 
   3.564167885207028*^9}, {3.564168022377754*^9, 3.564168024175915*^9}, {
   3.564168086777007*^9, 3.564168151492519*^9}, {3.564168578584429*^9, 
   3.564168578899851*^9}, {3.564169263740671*^9, 3.564169285254972*^9}, {
   3.5641699514568777`*^9, 3.564169958648657*^9}, {3.564170030939014*^9, 
   3.564170031709496*^9}, {3.564170627603503*^9, 3.564170655388357*^9}, {
   3.564171068312146*^9, 3.564171081239284*^9}, {3.5647188375955153`*^9, 
   3.564718925093058*^9}, {3.564718955744403*^9, 3.564718991948147*^9}, {
   3.5647272690029793`*^9, 3.564727270566086*^9}, {3.57248614934402*^9, 
   3.572486166131538*^9}, {3.572486211518249*^9, 3.5724862411070213`*^9}, {
   3.572486735081953*^9, 3.5724868394899178`*^9}, {3.572486914923908*^9, 
   3.572486943737566*^9}, {3.572487043198532*^9, 3.572487075050811*^9}, {
   3.572487359721281*^9, 3.572487390210189*^9}, 3.573280114172586*^9, {
   3.573451183710997*^9, 3.573451244850823*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RemoveInducedDerivative", "[", 
     RowBox[{"expr_", ",", "cd_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "res", "}"}], ",", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"h", "=", 
          RowBox[{"MetricOfCovD", "@", "cd"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"InducedFrom", "@", "h"}], "===", "Null"}], ",", "expr", 
          ",", "\[IndentingNewLine]", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"g", "=", 
              RowBox[{"First", "@", 
               RowBox[{"InducedFrom", "@", "h"}]}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"With", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"CD", "=", 
                RowBox[{"CovDOfMetric", "@", "g"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"res", "=", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"expr", "//.", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"cd", "[", "ind_", "]"}], "[", "Expr___", "]"}], ":>", 
                    RowBox[{
                    RowBox[{"Projector", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"CD", "[", "ind", "]"}], "[", "Expr", "]"}], 
                    "]"}]}]}], ")"}], "/.", 
                 RowBox[{
                  RowBox[{"Projector", "[", "h", "]"}], "\[Rule]", 
                  RowBox[{"ProjectWith", "[", "h", "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"res", "=!=", "expr"}], ",", 
                 RowBox[{
                  RowBox[{
                  "Print", "[", 
                   "\"\<** Warning: you are using ToMetric or Conformal with \
induced covariant derivatives. \\nThese induced derivatives are first \
expressed in function of the covariant derivative form which they are induced \
since we do not know very well how to handle that. **\>\"", "]"}], ";"}]}], 
                "]"}], ";", "\[IndentingNewLine]", "res"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"RemoveAllInducedDerivatives", "[", "expr_", "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"InducedMetrics", "=", 
        RowBox[{"Select", "[", 
         RowBox[{"$Metrics", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"InducedFrom", "[", "#", "]"}], "=!=", "Null"}], "&"}]}], 
         "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Fold", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"RemoveInducedDerivative", "[", 
          RowBox[{"#1", ",", 
           RowBox[{"CovDOfMetric", "[", "#2", "]"}]}], "]"}], "&"}], ",", 
        "expr", ",", "InducedMetrics"}], "]"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ToMetric", "[", 
     RowBox[{"expr_", ",", 
      RowBox[{"metric1_", "?", "MetricQ"}]}], "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"InducedFrom", "@", "metric1"}], "=!=", "Null"}], ",", "expr", 
      ",", "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"res", ",", "preexpression"}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Off", "[", 
          StyleBox[
           RowBox[{"ConformalRules", "::", "unknown"}], "MessageName"], 
          StyleBox["]", "MessageName"]}], 
         StyleBox[";", "MessageName"], "\[IndentingNewLine]", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"cd1", "=", 
              RowBox[{"CovDOfMetric", "[", "metric1", "]"}]}], ",", 
             RowBox[{"$CovDsNotInduced", "=", 
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"Rest", "@", "$CovDs"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"InducedFrom", "[", 
                   RowBox[{"MetricOfCovD", "[", "#", "]"}], "]"}], "===", 
                  "Null"}], "&"}]}], "]"}]}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"$CovDsNotInducedRelatedTocd1", "=", 
               RowBox[{"Select", "[", 
                RowBox[{"$CovDsNotInduced", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Catch", "@", 
                    RowBox[{"ConformalRules", "[", 
                    RowBox[{"metric1", ",", 
                    RowBox[{"MetricOfCovD", "[", "#", "]"}]}], "]"}]}], "=!=",
                     "Null"}], ")"}], "&"}]}], "]"}]}], "}"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"preexpression", "=", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"RemoveAllInducedDerivatives", "[", "expr", "]"}],
                     "//", "ProjectorToMetric"}], "//", "EinsteinToRicci"}], "//",
                    "WeylToRiemann"}], "//", "ContractMetric"}], "//", 
                 "ToCanonical"}], ")"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"res", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ChangeCovD", "[", 
                    RowBox[{"#", ",", "$CovDsNotInduced", ",", "cd1"}], "]"}],
                     "&"}], "@", "\[IndentingNewLine]", 
                    RowBox[{"ChristoffelToGradConformal", "[", 
                    RowBox[{
                    "#", ",", "$CovDsNotInducedRelatedTocd1", ",", "cd1"}], 
                    "]"}]}], "&"}], "@", "\[IndentingNewLine]", 
                    RowBox[{"MyChangeChristoffel", "[", 
                    RowBox[{
                    "#", ",", "$CovDsNotInducedRelatedTocd1", ",", "cd1"}], 
                    "]"}]}], "&"}], "@", "\[IndentingNewLine]", 
                    RowBox[{"ChangeCovD", "[", 
                    RowBox[{"#", ",", "$CovDsNotInduced", ",", "cd1"}], 
                    "]"}]}], "&"}], "@", "\[IndentingNewLine]", 
                  RowBox[{"ChangeCurvature", "[", 
                   RowBox[{"#", ",", "$CovDsNotInduced", ",", "cd1"}], 
                   "]"}]}], "&"}], "@", "preexpression"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Off", "[", 
               StyleBox[
                RowBox[{"ConformalRules", "::", "unknown"}], "MessageName"], 
               StyleBox["]", "MessageName"]}], 
              StyleBox[";", "MessageName"], 
              StyleBox["\[IndentingNewLine]", "MessageName"], 
              StyleBox["\[IndentingNewLine]", "MessageName"], 
              RowBox[{
               StyleBox["Fold", "MessageName"], 
               StyleBox["[", "MessageName"], 
               StyleBox[
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#1", "/.", 
                    RowBox[{"ConformalRules", "[", 
                    RowBox[{
                    RowBox[{"MetricOfCovD", "[", "#2", "]"}], ",", 
                    "metric1"}], "]"}]}], ")"}], "&"}], ",", "res", ",", 
                 "$CovDsNotInducedRelatedTocd1"}], "MessageName"], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], 
     StyleBox["\[IndentingNewLine]", "MessageName"], 
     StyleBox["]", "MessageName"]}]}], 
   StyleBox[";", "MessageName"]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ToMetric", "[", "expr_", "]"}], ":=", 
    RowBox[{"ToMetric", "[", 
     RowBox[{"expr", ",", 
      RowBox[{"First", "@", "$Metrics"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"ToMetric", ",", 
   RowBox[{"{", 
    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "ToMetric", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5638727806950903`*^9, 3.563872917993548*^9}, {
   3.563873028816762*^9, 3.563873031121623*^9}, {3.563873066059112*^9, 
   3.563873068970976*^9}, {3.563873116430852*^9, 3.5638731427716208`*^9}, {
   3.563873245621101*^9, 3.563873248295521*^9}, {3.563873303618046*^9, 
   3.563873386668886*^9}, {3.5638734974309*^9, 3.563873499679378*^9}, {
   3.563873547930009*^9, 3.563873550846099*^9}, {3.5638744147446423`*^9, 
   3.5638744166780357`*^9}, {3.5638780667306023`*^9, 3.5638781982599688`*^9}, 
   3.563878463866621*^9, {3.564063382627818*^9, 3.564063389127658*^9}, {
   3.5640634829995747`*^9, 3.564063487133016*^9}, {3.564163687302367*^9, 
   3.56416368850581*^9}, {3.564163832803364*^9, 3.564163853377365*^9}, {
   3.564164036951326*^9, 3.564164083997697*^9}, {3.5641658129907017`*^9, 
   3.564165839746565*^9}, {3.56416587090333*^9, 3.5641658720685997`*^9}, {
   3.564166024025523*^9, 3.564166025456334*^9}, {3.5641661981742697`*^9, 
   3.5641661997765427`*^9}, {3.5641667677850437`*^9, 3.564166873188354*^9}, {
   3.5641669313718348`*^9, 3.564166943576644*^9}, {3.564166994285495*^9, 
   3.5641670746152143`*^9}, {3.5641671744831533`*^9, 3.564167189304613*^9}, {
   3.564167256342731*^9, 3.564167264819952*^9}, {3.5647189305602016`*^9, 
   3.5647189327371683`*^9}, {3.564726040545745*^9, 3.564726075448565*^9}, 
   3.5684579765474987`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SeparateIndicesDownOfInverseMetric", "[", "invmetric_", "]"}], 
   "[", "expr_", "]"}], ":=", " ", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"invmetric", "=!=", 
     RowBox[{"Inv", "[", "invmetric", "]"}]}], ",", 
    RowBox[{"Fold", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"SeparateMetric", "[", 
         RowBox[{"First", "@", "$Metrics"}], "]"}], "[", 
        RowBox[{"#1", ",", "#2"}], "]"}], "&"}], ",", "expr", ",", 
      RowBox[{
       RowBox[{"IndicesOf", "[", 
        RowBox[{"Down", ",", "invmetric"}], "]"}], "[", "expr", "]"}]}], 
     "]"}], ",", "expr"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.512217024184719*^9, 3.512217047511861*^9}, {
   3.5122171179519997`*^9, 3.512217187660056*^9}, {3.512217464441905*^9, 
   3.512217572676424*^9}, {3.5122176082435513`*^9, 3.5122176296406403`*^9}, {
   3.512217722670237*^9, 3.5122177229649153`*^9}, {3.51221779260592*^9, 
   3.5122177950906982`*^9}, {3.5122186935273523`*^9, 3.51221872433224*^9}, {
   3.512218785434855*^9, 3.512218813017639*^9}, {3.5122188597544518`*^9, 
   3.512218899049959*^9}, {3.512218930424416*^9, 3.512218931678142*^9}, {
   3.512219015292704*^9, 3.512219037315407*^9}, {3.512219151433202*^9, 
   3.51221919193756*^9}, {3.512219537334247*^9, 3.512219565102446*^9}, {
   3.51221965022227*^9, 3.5122197192321978`*^9}, {3.512219999738373*^9, 
   3.512220013955456*^9}, {3.512220056725851*^9, 3.5122200640814133`*^9}, {
   3.512220095751432*^9, 3.512220157988028*^9}, {3.5122204104529667`*^9, 
   3.512220422453183*^9}, {3.512220460847077*^9, 3.512220464350485*^9}, {
   3.512220517745043*^9, 3.512220576334478*^9}, {3.51222063613179*^9, 
   3.512220691987445*^9}, {3.5122212613235083`*^9, 3.512221267469199*^9}, {
   3.512221366144924*^9, 3.5122214337697372`*^9}, {3.512221470257477*^9, 
   3.5122214708288593`*^9}, {3.512221512254106*^9, 3.512221515805979*^9}, {
   3.51222157917146*^9, 3.5122216545727253`*^9}, {3.5122217667463818`*^9, 
   3.5122217700249567`*^9}, {3.512221918104381*^9, 3.5122219245211487`*^9}, {
   3.512221981711296*^9, 3.512222014281852*^9}, {3.512222126735215*^9, 
   3.512222136227551*^9}, {3.512222201283257*^9, 3.5122222113347063`*^9}, {
   3.512222243975617*^9, 3.512222248250169*^9}, {3.5122222802976503`*^9, 
   3.512222290053368*^9}, {3.512222323660473*^9, 3.512222429025775*^9}, {
   3.512222531386104*^9, 3.512222601152915*^9}, {3.51222263177318*^9, 
   3.51222263610793*^9}, {3.512222690029228*^9, 3.512222693128252*^9}, {
   3.512222728859332*^9, 3.5122227564661627`*^9}, {3.512222996395195*^9, 
   3.512223026414377*^9}, {3.512223092596637*^9, 3.512223103587287*^9}, {
   3.512223255153935*^9, 3.512223260966133*^9}, {3.512223316445632*^9, 
   3.512223353079961*^9}, {3.5122234087459393`*^9, 3.512223410477187*^9}, {
   3.5122236101860037`*^9, 3.512223715486086*^9}, {3.512223747638056*^9, 
   3.512223754346181*^9}, {3.5122238935687323`*^9, 3.512223949252881*^9}, {
   3.512223995109467*^9, 3.5122239997216263`*^9}, {3.5122241465399647`*^9, 
   3.512224206263569*^9}, {3.512224304139059*^9, 3.512224362248686*^9}, {
   3.5122244123663483`*^9, 3.512224468987484*^9}, {3.512225159791996*^9, 
   3.512225187791506*^9}, {3.512225227932087*^9, 3.512225274761587*^9}, {
   3.5122261706214952`*^9, 3.512226172707993*^9}, {3.5122264729099693`*^9, 
   3.512226474130844*^9}, {3.512226586514841*^9, 3.512226593739541*^9}, {
   3.512226646460278*^9, 3.51222666902391*^9}, {3.512227887308902*^9, 
   3.512227907336279*^9}, {3.512234186451302*^9, 3.5122342066256113`*^9}, {
   3.512234282527575*^9, 3.5122343160086327`*^9}, {3.512234531764027*^9, 
   3.5122345329415817`*^9}, 3.512234921977254*^9, {3.512235427071748*^9, 
   3.512235447991049*^9}, {3.5122354779915113`*^9, 3.512235505622384*^9}, {
   3.512235662913525*^9, 3.512235672850067*^9}, {3.51223580482406*^9, 
   3.512235807988041*^9}, {3.512235970202718*^9, 3.5122359777630663`*^9}, {
   3.512236209610037*^9, 3.512236216434803*^9}, {3.512236248389203*^9, 
   3.512236249792376*^9}, {3.512236285227689*^9, 3.512236289567008*^9}, {
   3.5122363313469677`*^9, 3.51223639277032*^9}, {3.512236532749749*^9, 
   3.512236547177519*^9}, {3.51223673638997*^9, 3.512236767584962*^9}, {
   3.512236800107481*^9, 3.5122368336596737`*^9}, {3.5122369007324743`*^9, 
   3.5122369041168423`*^9}, {3.512237007279296*^9, 3.5122370162505903`*^9}, {
   3.512239328905218*^9, 3.512239332526173*^9}, {3.5122396040002728`*^9, 
   3.512239632176947*^9}, {3.51224090218546*^9, 3.512240943590166*^9}, {
   3.512241014898028*^9, 3.5122410526352167`*^9}, {3.512241125199999*^9, 
   3.512241127775445*^9}, {3.5122413017585382`*^9, 3.512241308517445*^9}, {
   3.512241391069498*^9, 3.512241400216138*^9}, {3.512241716987899*^9, 
   3.512241717433277*^9}, {3.512244056340551*^9, 3.512244068575629*^9}, {
   3.512244107166397*^9, 3.512244109189127*^9}, {3.5122442227572327`*^9, 
   3.512244224506654*^9}, {3.512244267085352*^9, 3.512244268754511*^9}, {
   3.5122443760860167`*^9, 3.512244410290779*^9}, {3.512244456702623*^9, 
   3.512244459491452*^9}, {3.512244577485985*^9, 3.512244602031704*^9}, {
   3.5122447488769083`*^9, 3.5122447521069202`*^9}, {3.5122448782455683`*^9, 
   3.51224492464859*^9}, {3.51224495630317*^9, 3.512244961042726*^9}, {
   3.512245281914782*^9, 3.5122452866003942`*^9}, {3.512245456288817*^9, 
   3.512245459239984*^9}, {3.512245798322731*^9, 3.512245899942173*^9}, {
   3.51224596543334*^9, 3.512245968746402*^9}, {3.512246002050489*^9, 
   3.5122460271061563`*^9}, {3.512246080889415*^9, 3.512246115188861*^9}, {
   3.5122461801261377`*^9, 3.512246203453806*^9}, {3.51224734250808*^9, 
   3.512247345805436*^9}, {3.51224739233162*^9, 3.512247406160964*^9}, {
   3.512247467325145*^9, 3.5122474703472023`*^9}, {3.5122730376194153`*^9, 
   3.512273078491025*^9}, {3.5122732716185303`*^9, 3.512273273842444*^9}, {
   3.512273370605762*^9, 3.512273382656664*^9}, {3.512273500957448*^9, 
   3.512273527881122*^9}, {3.512273587643199*^9, 3.5122735943451757`*^9}, {
   3.5122852250620193`*^9, 3.512285237598214*^9}, {3.51228548394818*^9, 
   3.512285489104547*^9}, {3.512288051888577*^9, 3.512288136088068*^9}, {
   3.5122882099202833`*^9, 3.512288210845973*^9}, {3.512288603439122*^9, 
   3.512288641938745*^9}, {3.512288823957465*^9, 3.512288841608663*^9}, {
   3.512288882515072*^9, 3.512288882681773*^9}, {3.512307170819191*^9, 
   3.512307172528792*^9}, {3.5123072584348717`*^9, 3.51230726291322*^9}, {
   3.512307311531719*^9, 3.512307316301035*^9}, {3.512307368130629*^9, 
   3.5123073726471777`*^9}, {3.512307408732143*^9, 3.512307411122777*^9}, {
   3.512307460197645*^9, 3.512307462659512*^9}, {3.512307494735756*^9, 
   3.51230750273271*^9}, {3.512307609218398*^9, 3.512307658511571*^9}, {
   3.5123077367276697`*^9, 3.512307746342572*^9}, {3.512307818802199*^9, 
   3.512307819830123*^9}, {3.512307920503327*^9, 3.512307926901696*^9}, {
   3.512308938664963*^9, 3.512308997264019*^9}, {3.51971045439085*^9, 
   3.519710534412126*^9}, {3.519710719467849*^9, 3.519710750107098*^9}, {
   3.5197108958531513`*^9, 3.519710897329976*^9}, {3.519711060266473*^9, 
   3.519711061865967*^9}, {3.5197113644501047`*^9, 3.5197113696703043`*^9}, {
   3.5197120818660192`*^9, 3.5197121125770407`*^9}, {3.5618047160261917`*^9, 
   3.5618048163013983`*^9}, {3.561804887620872*^9, 3.561804929457172*^9}, {
   3.5618050127588873`*^9, 3.561805023381901*^9}, {3.561805074267334*^9, 
   3.561805354494647*^9}, {3.5618053894961042`*^9, 3.5618055197491817`*^9}, {
   3.5618055656534653`*^9, 3.5618059611469803`*^9}, {3.561805991249591*^9, 
   3.5618060106342497`*^9}, {3.5627616820207157`*^9, 3.56276168992072*^9}, {
   3.56276596957833*^9, 3.562766025204669*^9}, {3.562766061640709*^9, 
   3.562766073458618*^9}, {3.562766291815064*^9, 3.562766331665114*^9}, {
   3.5627674006308203`*^9, 3.562767404987379*^9}, {3.562767513854919*^9, 
   3.5627675151517553`*^9}, {3.562767796858349*^9, 3.5627678064463663`*^9}, 
   3.562767870823268*^9, {3.5627679586130743`*^9, 3.5627680141568937`*^9}, {
   3.5627680668683662`*^9, 3.5627680799684258`*^9}, {3.5627681657784967`*^9, 
   3.562768170167585*^9}, {3.562768298530258*^9, 3.562768302471459*^9}, {
   3.562768456916039*^9, 3.5627684597095737`*^9}, {3.562768495334859*^9, 
   3.562768498881195*^9}, {3.562768547976069*^9, 3.562768583468534*^9}, {
   3.562768638194366*^9, 3.5627686385036077`*^9}, {3.562768782932548*^9, 
   3.562768814272478*^9}, {3.5627688629793367`*^9, 3.562768898815456*^9}, {
   3.562769005178116*^9, 3.562769007288054*^9}, {3.562769200365547*^9, 
   3.562769224410635*^9}, {3.562780111718876*^9, 3.5627801255389977`*^9}, {
   3.562930936813553*^9, 3.562930939626328*^9}, {3.562958806061393*^9, 
   3.56295882642273*^9}, {3.5631048447879333`*^9, 3.563104847406558*^9}, {
   3.563197063026619*^9, 3.563197082747797*^9}, {3.563416271531083*^9, 
   3.5634162784168463`*^9}, {3.563416929000143*^9, 3.563416932083634*^9}, {
   3.56341817000346*^9, 3.5634182322404327`*^9}, {3.5634183435393457`*^9, 
   3.563418347884831*^9}, {3.5634186085012283`*^9, 3.563418610546639*^9}, {
   3.5634274204126463`*^9, 3.5634274214903593`*^9}, {3.563462967924803*^9, 
   3.563463061653015*^9}, {3.563464240503646*^9, 3.5634642624863653`*^9}, {
   3.56346429825308*^9, 3.5634642998856363`*^9}, {3.563464367845727*^9, 
   3.563464378157462*^9}, {3.5634718962338142`*^9, 3.563471964770048*^9}, {
   3.56347210091696*^9, 3.563472120823599*^9}, {3.5635223325045643`*^9, 
   3.5635223400067863`*^9}, {3.563559230326127*^9, 3.563559248205258*^9}, {
   3.563704505524445*^9, 3.563704561214109*^9}, {3.563704640352831*^9, 
   3.563704655436604*^9}, {3.563704786534521*^9, 3.563704797621953*^9}, {
   3.5637048545375137`*^9, 3.5637049946903877`*^9}, {3.56370602473597*^9, 
   3.5637060378045464`*^9}, {3.563706137235108*^9, 3.563706213866803*^9}, {
   3.563706247792411*^9, 3.563706254361273*^9}, {3.563706328690659*^9, 
   3.5637063294429703`*^9}, {3.563706408859529*^9, 3.563706479740589*^9}, 
   3.563706546468041*^9, {3.563706590228731*^9, 3.563706595922023*^9}, {
   3.563707230281886*^9, 3.563707267842819*^9}, {3.563707467579307*^9, 
   3.563707492629238*^9}, {3.563707779901173*^9, 3.563707781806424*^9}, {
   3.563707826682317*^9, 3.5637078361454773`*^9}, {3.5637079160258636`*^9, 
   3.563707918794465*^9}, {3.563707986328764*^9, 3.563708011332543*^9}, {
   3.56373752505263*^9, 3.563737590948493*^9}, {3.563793756833386*^9, 
   3.5637937836591787`*^9}, {3.5637938963836412`*^9, 
   3.5637939440518627`*^9}, {3.563873076566382*^9, 3.563873079954752*^9}, {
   3.564718940506362*^9, 3.5647189412211857`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Conformal", "[", 
      RowBox[{"metricbase_", "?", "MetricQ"}], "]"}], "[", 
     RowBox[{
      RowBox[{"metric1_", "?", "MetricQ"}], ",", 
      RowBox[{"metric2_", "?", "MetricQ"}]}], "]"}], "[", "expr_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "cdb", ",", "cd1", ",", "cd2", ",", "res", ",", "res2", ",", "oldpre", 
       ",", "resbis", ",", "exprnoproj", ",", "M", ",", "i1", ",", "i2", ",", 
       "beforeputtingconfheads", ",", "IDInvMetric"}], "}"}], ",", 
     RowBox[{
      RowBox[{"oldpre", "=", "$PrePrint"}], ";", 
      RowBox[{"$PrePrint", "=", "Identity"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "we", " ", "define", " ", "the", " ", "Covds", " ", "associated", " ",
          "with", " ", "the", " ", 
         RowBox[{"metric", ".", " ", "The"}], " ", "starting", " ", "metric", 
         " ", "is", " ", "metric1"}], ",", " ", 
        RowBox[{
        "the", " ", "conformally", " ", "transformed", " ", "metric", " ", 
         "is", " ", "metric2"}], ",", " ", 
        RowBox[{
        "and", " ", "metricbase", " ", "i", " ", "the", " ", "base", " ", 
         "metric", " ", "for", " ", "raising", " ", "and", " ", "lowering", 
         " ", 
         RowBox[{"indiced", ".", " ", "It"}], " ", "might", " ", "be", " ", 
         "one", " ", "of", " ", "the", " ", "other", " ", "two"}], ",", " ", 
        RowBox[{
         RowBox[{"but", " ", "it", " ", "might", " ", "not", " ", "be"}], 
         "..."}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"cdb", "=", 
       RowBox[{"CovDOfMetric", "[", "metricbase", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cd1", "=", 
       RowBox[{"CovDOfMetric", "[", "metric1", "]"}]}], ";", 
      RowBox[{"Off", "[", 
       RowBox[{"ConformalFactor", "::", "\"\<unknown\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cd2", "=", 
       RowBox[{"CovDOfMetric", "[", "metric2", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"exprnoproj", "=", 
       RowBox[{"expr", "//", "ProjectorToMetric"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"ManifoldOfCovD", "[", "cd1", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i1", "=", 
       RowBox[{"DummyIn", "[", 
        RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"i2", "=", 
       RowBox[{"DummyIn", "[", 
        RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"IDInvMetric", "=", 
       RowBox[{"SeparateIndicesDownOfInverseMetric", "[", 
        RowBox[{"Inv", "[", "metric1", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"beforeputtingconfheads", "=", 
       RowBox[{
        RowBox[{"IDInvMetric", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"IndicesDown", "@", 
             RowBox[{"ToMetric", "[", 
              RowBox[{"exprnoproj", ",", "metric1"}], "]"}]}], ")"}], 
           "\[IndentingNewLine]", "/.", 
           RowBox[{
            RowBox[{"Scalar", "[", "ex_", "]"}], "\[RuleDelayed]", 
            RowBox[{"Scalar", "[", 
             RowBox[{"IndicesDown", "[", "ex", "]"}], "]"}]}]}], "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"sf_", "?", "ScalarFunctionQ"}], "[", "args___", "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"sf", "@@", 
            RowBox[{"IndicesDown", "/@", 
             RowBox[{"{", "args", "}"}]}]}]}]}], "]"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"/.", 
          RowBox[{
           RowBox[{"Scalar", "[", "ex_", "]"}], "\[RuleDelayed]", 
           RowBox[{"Scalar", "[", 
            RowBox[{"IDInvMetric", "[", "ex", "]"}], "]"}]}]}], "/.", 
         RowBox[{
          RowBox[{
           RowBox[{"sf_", "?", "ScalarFunctionQ"}], "[", "args___", "]"}], 
          "\[RuleDelayed]", 
          RowBox[{"sf", "@@", 
           RowBox[{"IDInvMetric", "/@", 
            RowBox[{"{", "args", "}"}]}]}]}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Above", " ", "we", " ", "make", " ", "sure", " ", "that", " ", 
        "IndicesDown", " ", "and", " ", "SeparateIndicesDownOfInverseMetric", 
        " ", "goes", " ", "inside", " ", "the", " ", "scalar", " ", "Head"}], 
       "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "We", " ", "use", " ", "ToMetric", " ", "to", " ", "have", " ", "only",
         " ", "references", " ", "to", " ", "the", " ", "metric1", " ", "and",
         " ", "its", " ", "associated", " ", "CovD", " ", "and", " ", 
        "curvature", " ", "tensors"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<beforeputtingconfheads \>\"", ",", "beforeputtingconfheads"}], 
         "]"}], ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Then", " ", "we", " ", "place", " ", "the", " ", "ConfHead", " ", 
        "on", " ", "every", " ", "expression", " ", "to", " ", "perform", " ",
         "formally", " ", "the", " ", "conformal", " ", 
        RowBox[{"transformation", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"res", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"beforeputtingconfheads", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "Dirty", " ", "case", " ", "of", " ", "scalar", " ", 
               "functions"}], " ", "*)"}], "\[IndentingNewLine]", "/.", 
             RowBox[{
              RowBox[{
               RowBox[{"f_", "?", "ScalarFunctionQ"}], "[", "ex___", "]"}], 
              "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"ConfHead", "[", 
                RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
               RowBox[{"f", "[", "ex", "]"}], "]"}]}]}], 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", "tensors", " ", "*)"}], "\[IndentingNewLine]", 
            "/.", 
            RowBox[{
             RowBox[{
              RowBox[{"tens_", "?", "xTensorQ"}], "[", "inds___", "]"}], ":>", 
             RowBox[{
              RowBox[{"ConfHead", "[", 
               RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
              RowBox[{"tens", "[", "inds", "]"}], "]"}]}]}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"Covariant", " ", "derivatives"}], " ", "*)"}], 
           "\[IndentingNewLine]", "/.", 
           RowBox[{
            RowBox[{"cd1", "[", 
             RowBox[{"i1_", "?", "DownIndexQ"}], "]"}], ":>", 
            RowBox[{"cd2", "[", "i1", "]"}]}]}], "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "Now", " ", "that", " ", "we", " ", "have", " ", "ConfHead", " ", 
            "everywhere", " ", "we", " ", "need", " ", "to", " ", "remove", 
            " ", "the", " ", "head", " ", "by", " ", "specifying", " ", "the",
             " ", "change"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "First", " ", "Obvious", " ", "rules", " ", "for", " ", "metric", 
            " ", "and", " ", "inverse", " ", "metric"}], "*)"}], 
          "\[IndentingNewLine]", "/.", 
          RowBox[{
           RowBox[{
            RowBox[{"ConfHead", "[", 
             RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
            RowBox[{"metric1", "[", 
             RowBox[{
              RowBox[{"i1_", "?", "DownIndexQ"}], ",", 
              RowBox[{"i2_", "?", "DownIndexQ"}]}], "]"}], "]"}], ":>", 
           RowBox[{"metric2", "[", 
            RowBox[{"i1", ",", "i2"}], "]"}]}]}], "\[IndentingNewLine]", "/.", 
         RowBox[{
          RowBox[{
           RowBox[{"ConfHead", "[", 
            RowBox[{"metric1", ",", "metric2"}], "]"}], "[", 
           RowBox[{
            RowBox[{"Inv", "[", "metric1", "]"}], "[", 
            RowBox[{
             RowBox[{"i1_", "?", "UpIndexQ"}], ",", 
             RowBox[{"i2_", "?", "UpIndexQ"}]}], "]"}], "]"}], ":>", 
          RowBox[{
           RowBox[{"Inv", "[", "metric2", "]"}], "[", 
           RowBox[{"i1", ",", "i2"}], "]"}]}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "And", " ", "then", " ", "all", " ", "other", " ", "rules", " ", "to", 
        " ", "remove", " ", "the", " ", "ConfHead"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"resbis", "=", 
       RowBox[{"res", "//.", 
        RowBox[{"RulesConf", "[", 
         RowBox[{"metric1", ",", "metric2"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
        "So", " ", "here", " ", "we", " ", "have", " ", "conformally", " ", 
         "transformed", " ", "the", " ", "expression"}], ",", " ", 
        RowBox[{
         RowBox[{
          RowBox[{
          "but", " ", "now", " ", "we", " ", "want", " ", "to", " ", 
           "express", " ", "it", " ", "in", " ", "function", " ", "of", " ", 
           "the", " ", "original", " ", "metric", " ", "and", " ", "orginal", 
           " ", "covD", " ", "etc"}], "..."}], "\[IndentingNewLine]", 
         "Indeed", " ", "at", " ", "that", " ", "point"}], ",", " ", 
        RowBox[{
        "we", " ", "still", " ", "have", " ", "the", " ", "second", " ", 
         "metric"}], ",", " ", 
        RowBox[{
        "and", " ", "the", " ", "Riemann", " ", "of", " ", "the", " ", 
         "second", " ", "metric", " ", "for", " ", 
         RowBox[{"instance", ".", " ", "SO"}], " ", "we", " ", "use", " ", 
         "again", " ", "ToMetric"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"$PrePrint", "=", "oldpre"}], ";", "\[IndentingNewLine]", 
      RowBox[{"On", "[", 
       RowBox[{"ConformalFactor", "::", "\"\<unknown\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Off", "[", 
       RowBox[{"ToCanonical", "::", "\"\<cmods\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"res2", "=", 
       RowBox[{"ToCanonical", "@", 
        RowBox[{"ContractMetric", "@", 
         RowBox[{"NoScalar", "[", 
          RowBox[{"ToMetric", "[", 
           RowBox[{"resbis", ",", "metricbase"}], "]"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"On", "[", 
       RowBox[{"ToCanonical", "::", "\"\<cmods\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "res2"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "In", " ", "case", " ", "the", " ", "base", " ", "metric", " ", "is", " ",
      "unspecified"}], ",", " ", 
    RowBox[{
     RowBox[{
     "it", " ", "is", " ", "the", " ", "base", " ", "metric", " ", "of", " ", 
      "course"}], "..."}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Conformal", "[", 
     RowBox[{
      RowBox[{"metric1_", "?", "MetricQ"}], ",", 
      RowBox[{"metric2_", "?", "MetricQ"}]}], "]"}], "[", "expr_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"Conformal", "[", 
      RowBox[{"First", "@", "$Metrics"}], "]"}], "[", 
     RowBox[{"metric1", ",", "metric2"}], "]"}], "[", "expr", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.512217024184719*^9, 3.512217047511861*^9}, {
   3.5122171179519997`*^9, 3.512217187660056*^9}, {3.512217464441905*^9, 
   3.512217572676424*^9}, {3.5122176082435513`*^9, 3.5122176296406403`*^9}, {
   3.512217722670237*^9, 3.5122177229649153`*^9}, {3.51221779260592*^9, 
   3.5122177950906982`*^9}, {3.5122186935273523`*^9, 3.51221872433224*^9}, {
   3.512218785434855*^9, 3.512218813017639*^9}, {3.5122188597544518`*^9, 
   3.512218899049959*^9}, {3.512218930424416*^9, 3.512218931678142*^9}, {
   3.512219015292704*^9, 3.512219037315407*^9}, {3.512219151433202*^9, 
   3.51221919193756*^9}, {3.512219537334247*^9, 3.512219565102446*^9}, {
   3.51221965022227*^9, 3.5122197192321978`*^9}, {3.512219999738373*^9, 
   3.512220013955456*^9}, {3.512220056725851*^9, 3.5122200640814133`*^9}, {
   3.512220095751432*^9, 3.512220157988028*^9}, {3.5122204104529667`*^9, 
   3.512220422453183*^9}, {3.512220460847077*^9, 3.512220464350485*^9}, {
   3.512220517745043*^9, 3.512220576334478*^9}, {3.51222063613179*^9, 
   3.512220691987445*^9}, {3.5122212613235083`*^9, 3.512221267469199*^9}, {
   3.512221366144924*^9, 3.5122214337697372`*^9}, {3.512221470257477*^9, 
   3.5122214708288593`*^9}, {3.512221512254106*^9, 3.512221515805979*^9}, {
   3.51222157917146*^9, 3.5122216545727253`*^9}, {3.5122217667463818`*^9, 
   3.5122217700249567`*^9}, {3.512221918104381*^9, 3.5122219245211487`*^9}, {
   3.512221981711296*^9, 3.512222014281852*^9}, {3.512222126735215*^9, 
   3.512222136227551*^9}, {3.512222201283257*^9, 3.5122222113347063`*^9}, {
   3.512222243975617*^9, 3.512222248250169*^9}, {3.5122222802976503`*^9, 
   3.512222290053368*^9}, {3.512222323660473*^9, 3.512222429025775*^9}, {
   3.512222531386104*^9, 3.512222601152915*^9}, {3.51222263177318*^9, 
   3.51222263610793*^9}, {3.512222690029228*^9, 3.512222693128252*^9}, {
   3.512222728859332*^9, 3.5122227564661627`*^9}, {3.512222996395195*^9, 
   3.512223026414377*^9}, {3.512223092596637*^9, 3.512223103587287*^9}, {
   3.512223255153935*^9, 3.512223260966133*^9}, {3.512223316445632*^9, 
   3.512223353079961*^9}, {3.5122234087459393`*^9, 3.512223410477187*^9}, {
   3.5122236101860037`*^9, 3.512223715486086*^9}, {3.512223747638056*^9, 
   3.512223754346181*^9}, {3.5122238935687323`*^9, 3.512223949252881*^9}, {
   3.512223995109467*^9, 3.5122239997216263`*^9}, {3.5122241465399647`*^9, 
   3.512224206263569*^9}, {3.512224304139059*^9, 3.512224362248686*^9}, {
   3.5122244123663483`*^9, 3.512224468987484*^9}, {3.512225159791996*^9, 
   3.512225187791506*^9}, {3.512225227932087*^9, 3.512225274761587*^9}, {
   3.5122261706214952`*^9, 3.512226172707993*^9}, {3.5122264729099693`*^9, 
   3.512226474130844*^9}, {3.512226586514841*^9, 3.512226593739541*^9}, {
   3.512226646460278*^9, 3.51222666902391*^9}, {3.512227887308902*^9, 
   3.512227907336279*^9}, {3.512234186451302*^9, 3.5122342066256113`*^9}, {
   3.512234282527575*^9, 3.5122343160086327`*^9}, {3.512234531764027*^9, 
   3.5122345329415817`*^9}, 3.512234921977254*^9, {3.512235427071748*^9, 
   3.512235447991049*^9}, {3.5122354779915113`*^9, 3.512235505622384*^9}, {
   3.512235662913525*^9, 3.512235672850067*^9}, {3.51223580482406*^9, 
   3.512235807988041*^9}, {3.512235970202718*^9, 3.5122359777630663`*^9}, {
   3.512236209610037*^9, 3.512236216434803*^9}, {3.512236248389203*^9, 
   3.512236249792376*^9}, {3.512236285227689*^9, 3.512236289567008*^9}, {
   3.5122363313469677`*^9, 3.51223639277032*^9}, {3.512236532749749*^9, 
   3.512236547177519*^9}, {3.51223673638997*^9, 3.512236767584962*^9}, {
   3.512236800107481*^9, 3.5122368336596737`*^9}, {3.5122369007324743`*^9, 
   3.5122369041168423`*^9}, {3.512237007279296*^9, 3.5122370162505903`*^9}, {
   3.512239328905218*^9, 3.512239332526173*^9}, {3.5122396040002728`*^9, 
   3.512239632176947*^9}, {3.51224090218546*^9, 3.512240943590166*^9}, {
   3.512241014898028*^9, 3.5122410526352167`*^9}, {3.512241125199999*^9, 
   3.512241127775445*^9}, {3.5122413017585382`*^9, 3.512241308517445*^9}, {
   3.512241391069498*^9, 3.512241400216138*^9}, {3.512241716987899*^9, 
   3.512241717433277*^9}, {3.512244056340551*^9, 3.512244068575629*^9}, {
   3.512244107166397*^9, 3.512244109189127*^9}, {3.5122442227572327`*^9, 
   3.512244224506654*^9}, {3.512244267085352*^9, 3.512244268754511*^9}, {
   3.5122443760860167`*^9, 3.512244410290779*^9}, {3.512244456702623*^9, 
   3.512244459491452*^9}, {3.512244577485985*^9, 3.512244602031704*^9}, {
   3.5122447488769083`*^9, 3.5122447521069202`*^9}, {3.5122448782455683`*^9, 
   3.51224492464859*^9}, {3.51224495630317*^9, 3.512244961042726*^9}, {
   3.512245281914782*^9, 3.5122452866003942`*^9}, {3.512245456288817*^9, 
   3.512245459239984*^9}, {3.512245798322731*^9, 3.512245899942173*^9}, {
   3.51224596543334*^9, 3.512245968746402*^9}, {3.512246002050489*^9, 
   3.5122460271061563`*^9}, {3.512246080889415*^9, 3.512246115188861*^9}, {
   3.5122461801261377`*^9, 3.512246203453806*^9}, {3.51224734250808*^9, 
   3.512247345805436*^9}, {3.51224739233162*^9, 3.512247406160964*^9}, {
   3.512247467325145*^9, 3.5122474703472023`*^9}, {3.5122730376194153`*^9, 
   3.512273078491025*^9}, {3.5122732716185303`*^9, 3.512273273842444*^9}, {
   3.512273370605762*^9, 3.512273382656664*^9}, {3.512273500957448*^9, 
   3.512273527881122*^9}, {3.512273587643199*^9, 3.5122735943451757`*^9}, {
   3.5122852250620193`*^9, 3.512285237598214*^9}, {3.51228548394818*^9, 
   3.512285489104547*^9}, {3.512288051888577*^9, 3.512288136088068*^9}, {
   3.5122882099202833`*^9, 3.512288210845973*^9}, {3.512288603439122*^9, 
   3.512288641938745*^9}, {3.512288823957465*^9, 3.512288841608663*^9}, {
   3.512288882515072*^9, 3.512288882681773*^9}, {3.512307170819191*^9, 
   3.512307172528792*^9}, {3.5123072584348717`*^9, 3.51230726291322*^9}, {
   3.512307311531719*^9, 3.512307316301035*^9}, {3.512307368130629*^9, 
   3.5123073726471777`*^9}, {3.512307408732143*^9, 3.512307411122777*^9}, {
   3.512307460197645*^9, 3.512307462659512*^9}, {3.512307494735756*^9, 
   3.51230750273271*^9}, {3.512307609218398*^9, 3.512307658511571*^9}, {
   3.5123077367276697`*^9, 3.512307746342572*^9}, {3.512307818802199*^9, 
   3.512307819830123*^9}, {3.512307920503327*^9, 3.512307926901696*^9}, {
   3.512308938664963*^9, 3.512308997264019*^9}, {3.51971045439085*^9, 
   3.519710534412126*^9}, {3.519710719467849*^9, 3.519710750107098*^9}, {
   3.5197108958531513`*^9, 3.519710897329976*^9}, {3.519711060266473*^9, 
   3.519711061865967*^9}, {3.5197113644501047`*^9, 3.5197113696703043`*^9}, {
   3.5197120818660192`*^9, 3.5197121125770407`*^9}, {3.5618047160261917`*^9, 
   3.5618048163013983`*^9}, {3.561804887620872*^9, 3.561804929457172*^9}, {
   3.5618050127588873`*^9, 3.561805023381901*^9}, {3.561805074267334*^9, 
   3.561805354494647*^9}, {3.5618053894961042`*^9, 3.5618055197491817`*^9}, {
   3.5618055656534653`*^9, 3.5618059611469803`*^9}, {3.561805991249591*^9, 
   3.5618060106342497`*^9}, {3.5627616820207157`*^9, 3.56276168992072*^9}, {
   3.56276596957833*^9, 3.562766025204669*^9}, {3.562766061640709*^9, 
   3.562766073458618*^9}, {3.562766291815064*^9, 3.562766331665114*^9}, {
   3.5627674006308203`*^9, 3.562767404987379*^9}, {3.562767513854919*^9, 
   3.5627675151517553`*^9}, {3.562767796858349*^9, 3.5627678064463663`*^9}, 
   3.562767870823268*^9, {3.5627679586130743`*^9, 3.5627680141568937`*^9}, {
   3.5627680668683662`*^9, 3.5627680799684258`*^9}, {3.5627681657784967`*^9, 
   3.562768170167585*^9}, {3.562768298530258*^9, 3.562768302471459*^9}, {
   3.562768456916039*^9, 3.5627684597095737`*^9}, {3.562768495334859*^9, 
   3.562768498881195*^9}, {3.562768547976069*^9, 3.562768583468534*^9}, {
   3.562768638194366*^9, 3.5627686385036077`*^9}, {3.562768782932548*^9, 
   3.562768814272478*^9}, {3.5627688629793367`*^9, 3.562768898815456*^9}, {
   3.562769005178116*^9, 3.562769007288054*^9}, {3.562769200365547*^9, 
   3.562769224410635*^9}, {3.562780111718876*^9, 3.5627801255389977`*^9}, {
   3.562930936813553*^9, 3.562930939626328*^9}, {3.562958806061393*^9, 
   3.56295882642273*^9}, {3.5631048447879333`*^9, 3.563104847406558*^9}, {
   3.563197063026619*^9, 3.563197082747797*^9}, {3.563416271531083*^9, 
   3.5634162784168463`*^9}, {3.563416929000143*^9, 3.563416932083634*^9}, {
   3.56341817000346*^9, 3.5634182322404327`*^9}, {3.5634183435393457`*^9, 
   3.563418347884831*^9}, {3.5634186085012283`*^9, 3.563418610546639*^9}, {
   3.5634274204126463`*^9, 3.5634274214903593`*^9}, {3.563462967924803*^9, 
   3.563463061653015*^9}, {3.563464240503646*^9, 3.5634642624863653`*^9}, {
   3.56346429825308*^9, 3.5634642998856363`*^9}, {3.563464367845727*^9, 
   3.563464378157462*^9}, {3.5634718962338142`*^9, 3.563471964770048*^9}, {
   3.56347210091696*^9, 3.563472120823599*^9}, {3.5635223325045643`*^9, 
   3.5635223400067863`*^9}, {3.563559230326127*^9, 3.563559248205258*^9}, {
   3.563704505524445*^9, 3.563704561214109*^9}, {3.563704640352831*^9, 
   3.563704655436604*^9}, {3.563704786534521*^9, 3.563704797621953*^9}, {
   3.5637048545375137`*^9, 3.5637049946903877`*^9}, {3.56370602473597*^9, 
   3.5637060378045464`*^9}, {3.563706137235108*^9, 3.563706213866803*^9}, {
   3.563706247792411*^9, 3.563706254361273*^9}, {3.563706328690659*^9, 
   3.5637063294429703`*^9}, {3.563706408859529*^9, 3.563706479740589*^9}, 
   3.563706546468041*^9, {3.563706590228731*^9, 3.563706595922023*^9}, {
   3.563707230281886*^9, 3.563707267842819*^9}, {3.563707467579307*^9, 
   3.563707492629238*^9}, {3.563707779901173*^9, 3.563707781806424*^9}, {
   3.563707826682317*^9, 3.5637078361454773`*^9}, {3.5637079160258636`*^9, 
   3.563707918794465*^9}, {3.563707986328764*^9, 3.563708011332543*^9}, {
   3.56373752505263*^9, 3.563737554634923*^9}, {3.563737598088162*^9, 
   3.563737627876051*^9}, {3.56373766513905*^9, 3.5637377037034187`*^9}, {
   3.563876597203391*^9, 3.563876616404044*^9}, {3.563876784436736*^9, 
   3.563876794193465*^9}, {3.563877433115058*^9, 3.56387744207892*^9}, {
   3.563878292569212*^9, 3.563878314720924*^9}, 3.5638784474625807`*^9, {
   3.563878489664034*^9, 3.563878499650709*^9}, {3.563878870283716*^9, 
   3.563878871542533*^9}, {3.564161667910536*^9, 3.564161671177657*^9}, {
   3.564161962712569*^9, 3.5641619830860777`*^9}, {3.5641622157716846`*^9, 
   3.564162245940296*^9}, {3.564162438923851*^9, 3.564162440563018*^9}, {
   3.564162649746389*^9, 3.564162651942753*^9}, {3.564170223708001*^9, 
   3.564170275260001*^9}, {3.564170332599704*^9, 3.564170333069323*^9}, {
   3.5641705039490623`*^9, 3.564170506129019*^9}, {3.5641712683314657`*^9, 
   3.564171269624807*^9}, {3.564171478866151*^9, 3.564171515630094*^9}, {
   3.5647189470379744`*^9, 3.564718947476727*^9}, {3.564718998161414*^9, 
   3.564719037968137*^9}, {3.564726083295789*^9, 3.5647260834510317`*^9}, {
   3.564727277941307*^9, 3.564727285517412*^9}, 3.56482671579257*^9, {
   3.573474372723119*^9, 3.573474372805661*^9}, {3.573568982122159*^9, 
   3.573569076140094*^9}, {3.573569107103606*^9, 3.573569292599285*^9}, {
   3.57356943487951*^9, 3.573569449531076*^9}, {3.5735697894496937`*^9, 
   3.573569790923087*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
2.7 From conformal time derivatives to cosmic time derivatives\
\>", "Subsubsection",
 CellChangeTimes->{{3.570006154347445*^9, 3.570006172693984*^9}, {
  3.570012030166933*^9, 3.570012032333322*^9}, {3.577160783261237*^9, 
  3.577160784372856*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ToCosmicTime", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"$ConformalTime", "===", "False"}], ",", "expr", ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"$ConformalTime", "=", "False"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"cd1", "=", 
           RowBox[{"CovDOfMetric", "[", "h", "]"}]}], ",", "i1", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"n", "=", 
           RowBox[{"Last", "@", 
            RowBox[{"InducedFrom", "@", "h"}]}]}], ",", "exprtemp", ",", 
          "res"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"i1", "=", 
          RowBox[{"DummyIn", "[", 
           RowBox[{"Tangent", "[", 
            RowBox[{"ManifoldOfCovD", "[", "cd1", "]"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"exprtemp", "=", "expr"}], 
         RowBox[{"(*", 
          RowBox[{"/.", 
           RowBox[{
            RowBox[{
             RowBox[{"Tens_", "?", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"DefProjectedTensorQ", "[", 
                  RowBox[{"#", ",", "h"}], "]"}], ")"}], "&"}], ")"}]}], "[", 
             
             RowBox[{
              RowBox[{"LI", "[", "p_", "]"}], ",", 
              RowBox[{"LI", "[", "q_", "]"}], ",", "inds___"}], "]"}], 
            "\[RuleDelayed]", 
            RowBox[{"ConformalToCosmic", "[", 
             RowBox[{"Tens", "[", 
              RowBox[{
               RowBox[{"LI", "[", "p", "]"}], ",", 
               RowBox[{"LI", "[", "q", "]"}], ",", "inds"}], "]"}], "]"}]}]}],
           "*)"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"res", "=", 
          RowBox[{
           RowBox[{"PostProcess", "[", "h", "]"}], "@", 
           RowBox[{"NoScalar", "@", 
            RowBox[{"SameDummies", "@", 
             RowBox[{"ToCanonical", "@", 
              RowBox[{"ContractMetric", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"exprtemp", "\[IndentingNewLine]", "/.", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", "IntegerQ"}], "]"}]}], "]"}], 
                   "\[RuleDelayed]", 
                   RowBox[{"ToCanonical", "[", 
                    RowBox[{
                    RowBox[{"Nest", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "i1", "]"}], "]"}], "[", "#", "]"}], 
                    "&"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}], 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "q"}], 
                    "]"}], ",", 
                    RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
                    "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "/.", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"K", "[", "h", "]"}], "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", "IntegerQ"}], "]"}], ",", "i1_", ",", 
                    "i2_"}], "]"}], "\[RuleDelayed]", 
                  RowBox[{"ToCanonical", "[", 
                   RowBox[{
                    RowBox[{"Nest", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "i1", "]"}], "]"}], "[", "#", "]"}], 
                    "&"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}], 
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], ",", "q"}], "]"}], ",", 
                    RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
                   "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "/.", 
                RowBox[{
                 RowBox[{
                  RowBox[{"tens_", "?", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"DefProjectedTensorQ", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&&", 
                    RowBox[{"#", "=!=", 
                    RowBox[{"K", "[", "h", "]"}]}], "&&", 
                    RowBox[{"#", "=!=", 
                    RowBox[{"a", "[", "h", "]"}]}], "&&", 
                    RowBox[{"#", "=!=", 
                    RowBox[{"H", "[", "h", "]"}]}]}], ")"}], "&"}], ")"}]}], 
                  "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "p_", "]"}], ",", 
                   RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", "IntegerQ"}], "]"}], ",", "inds___"}], 
                  "]"}], "\[RuleDelayed]", 
                 RowBox[{"ToCanonical", "[", 
                  RowBox[{
                   RowBox[{"Nest", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "i1", "]"}], "]"}], "[", "#", "]"}], 
                    "&"}], ",", 
                    RowBox[{"tens", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "inds"}], "]"}], ",", 
                    "q"}], "]"}], ",", 
                   RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
                  "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}]}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"$ConformalTime", "=", "True"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ToConformalTime", "[", 
   RowBox[{"expr_", ",", 
    RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"$ConformalTime", "===", "True"}], ",", "expr", ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$ConformalTime", "=", "True"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"cd1", "=", 
          RowBox[{"CovDOfMetric", "[", "h", "]"}]}], ",", "i1", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"n", "=", 
          RowBox[{"Last", "@", 
           RowBox[{"InducedFrom", "@", "h"}]}]}], ",", "exprtemp", ",", 
         "res"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"i1", "=", 
         RowBox[{"DummyIn", "[", 
          RowBox[{"Tangent", "[", 
           RowBox[{"ManifoldOfCovD", "[", "cd1", "]"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"exprtemp", "=", "expr"}], 
        RowBox[{"(*", 
         RowBox[{"/.", 
          RowBox[{
           RowBox[{
            RowBox[{"Tens_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"DefProjectedTensorQ", "[", 
                 RowBox[{"#", ",", "h"}], "]"}], ")"}], "&"}], ")"}]}], "[", 
            RowBox[{
             RowBox[{"LI", "[", "p_", "]"}], ",", 
             RowBox[{"LI", "[", "q_", "]"}], ",", "inds___"}], "]"}], 
           "\[RuleDelayed]", 
           RowBox[{"CosmicToConformal", "[", 
            RowBox[{"Tens", "[", 
             RowBox[{
              RowBox[{"LI", "[", "p", "]"}], ",", 
              RowBox[{"LI", "[", "q", "]"}], ",", "inds"}], "]"}], "]"}]}]}], 
         "*)"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"res", "=", 
         RowBox[{
          RowBox[{"PostProcess", "[", "h", "]"}], "@", 
          RowBox[{"NoScalar", "@", 
           RowBox[{"SameDummies", "@", 
            RowBox[{"ToCanonical", "@", 
             RowBox[{"ContractMetric", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"exprtemp", "\[IndentingNewLine]", "/.", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"H", "[", "h", "]"}], "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", "IntegerQ"}], "]"}]}], "]"}], 
                  "\[RuleDelayed]", 
                  RowBox[{"ToCanonical", "[", 
                   RowBox[{
                    RowBox[{"Nest", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "i1", "]"}], "]"}], "[", "#", "]"}], 
                    "&"}], ",", 
                    RowBox[{
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}], "*", 
                    RowBox[{
                    RowBox[{"H", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], ",", "q"}], 
                    "]"}], ",", 
                    RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
                   "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "/.", 
                RowBox[{
                 RowBox[{
                  RowBox[{"K", "[", "h", "]"}], "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "0", "]"}], ",", 
                   RowBox[{"LI", "[", 
                    RowBox[{"q_", "?", "IntegerQ"}], "]"}], ",", "i1_", ",", 
                   "i2_"}], "]"}], "\[RuleDelayed]", 
                 RowBox[{"ToCanonical", "[", 
                  RowBox[{
                   RowBox[{"Nest", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "i1", "]"}], "]"}], "[", "#", "]"}], 
                    "&"}], ",", 
                    RowBox[{
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}], 
                    RowBox[{
                    RowBox[{"K", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "i1", ",", "i2"}], 
                    "]"}]}], ",", "q"}], "]"}], ",", 
                   RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
                  "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "/.", 
               RowBox[{
                RowBox[{
                 RowBox[{"tens_", "?", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"DefProjectedTensorQ", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&&", 
                    RowBox[{"#", "=!=", 
                    RowBox[{"K", "[", "h", "]"}]}], "&&", 
                    RowBox[{"#", "=!=", 
                    RowBox[{"a", "[", "h", "]"}]}], "&&", 
                    RowBox[{"#", "=!=", 
                    RowBox[{"H", "[", "h", "]"}]}]}], ")"}], "&"}], ")"}]}], 
                 "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "p_", "]"}], ",", 
                  RowBox[{"LI", "[", 
                   RowBox[{"q_", "?", "IntegerQ"}], "]"}], ",", "inds___"}], 
                 "]"}], "\[RuleDelayed]", 
                RowBox[{"ToCanonical", "[", 
                 RowBox[{
                  RowBox[{"Nest", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}], 
                    RowBox[{
                    RowBox[{"LieD", "[", 
                    RowBox[{"n", "[", "i1", "]"}], "]"}], "[", "#", "]"}]}], 
                    "&"}], ",", 
                    RowBox[{"tens", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "p", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "inds"}], "]"}], ",", 
                    "q"}], "]"}], ",", 
                  RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
                 "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
              "]"}]}]}]}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"$ConformalTime", "=", "False"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.570006193647854*^9, 3.5700062145314283`*^9}, {
   3.570006245105526*^9, 3.570006324634433*^9}, {3.570006368041864*^9, 
   3.5700064378561707`*^9}, {3.5700065096454678`*^9, 3.570006510198049*^9}, {
   3.5700067879850397`*^9, 3.570006826539567*^9}, {3.5700068586889343`*^9, 
   3.570007028979341*^9}, 3.570007059990807*^9, {3.570007139124914*^9, 
   3.5700071902931423`*^9}, {3.5700073252661448`*^9, 3.570007363040457*^9}, {
   3.5700074037447643`*^9, 3.570007405567124*^9}, {3.57000745011025*^9, 
   3.570007452308223*^9}, {3.5700075061961737`*^9, 3.5700075225441504`*^9}, 
   3.570007557595215*^9, {3.570007605928342*^9, 3.5700076342023983`*^9}, {
   3.5700076975043*^9, 3.5700078078192987`*^9}, {3.570007840988888*^9, 
   3.570007851299806*^9}, {3.570007894175269*^9, 3.570007898220149*^9}, {
   3.570008286499155*^9, 3.570008304917439*^9}, {3.570008489345194*^9, 
   3.570008540391509*^9}, {3.5700085958038177`*^9, 3.570008621250063*^9}, {
   3.57000865691294*^9, 3.570008658208735*^9}, 3.570008729705905*^9, {
   3.570008805613862*^9, 3.5700088098150377`*^9}, {3.570008854150256*^9, 
   3.570009009077808*^9}, {3.570009072701165*^9, 3.5700090737770844`*^9}, {
   3.57000913563735*^9, 3.570009141412572*^9}, {3.5700091982485657`*^9, 
   3.570009302988201*^9}, {3.570009362559559*^9, 3.5700094149309263`*^9}, {
   3.570009508761829*^9, 3.5700095111929502`*^9}, {3.570009601216977*^9, 
   3.570009727815775*^9}, {3.570010023210189*^9, 3.57001008253714*^9}, {
   3.57001021200004*^9, 3.5700102198544807`*^9}, {3.57001088248568*^9, 
   3.570010917844303*^9}, {3.570010951934786*^9, 3.570010974238243*^9}, {
   3.570011113250354*^9, 3.570011114187173*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["2.8 1 + 3 Splitting of Covariant derivative", "Subsubsection",
 CellChangeTimes->{{3.5629070216953163`*^9, 3.5629070450094357`*^9}, {
  3.563741851669447*^9, 3.563741860820567*^9}, {3.577160785476288*^9, 
  3.577160786211588*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "This", " ", "function", " ", "creates", " ", "a", " ", "list", " ", "of",
      " ", "Covds", " ", "of", " ", "a", " ", 
     RowBox[{"tensor", ".", " ", "That"}], " ", "is", " ", "tens"}], ",", 
    RowBox[{"CD", "[", "tens", "]"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"CD", "[", 
       RowBox[{"CD", "[", "tens", "]"}], "]"}], " ", "etc"}], "..."}]}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"TablePatternsCovDs", "[", 
     RowBox[{
      RowBox[{"tens_", "[", "inds___", "]"}], ",", "CD_", ",", 
      RowBox[{"n_:", "10"}]}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"M", "=", 
        RowBox[{"ManifoldOfCovD", "@", "CD"}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"tens", "[", "inds", "]"}], "}"}], ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Fold", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"CD", "[", "#2", "]"}], "@", "#1"}], ")"}], "&"}], 
              ",", 
              RowBox[{"tens", "[", "inds", "]"}], ",", "#"}], "]"}], "&"}], 
           "[", 
           RowBox[{"Take", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Pattern", "[", 
                RowBox[{"#", ",", "_"}], "]"}], "&"}], "/@", 
              RowBox[{"DummyIn", "/@", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Tangent", "[", "M", "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"Range", "[", "n", "]"}], "}"}]}], "]"}]}]}], ",", 
             "i"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5628524165579147`*^9, 3.562852459950708*^9}, {
   3.562852521469261*^9, 3.562852716531543*^9}, {3.56285280270122*^9, 
   3.5628528241763678`*^9}, {3.562852860319392*^9, 3.562852862885676*^9}, 
   3.562852938643854*^9, {3.5628550064183807`*^9, 3.562855008280697*^9}, {
   3.562855305300766*^9, 3.562855307458774*^9}, {3.562855342680915*^9, 
   3.5628553580230713`*^9}, {3.562855395816695*^9, 3.562855493312042*^9}, {
   3.562855672128683*^9, 3.562855674947558*^9}, {3.562855705979685*^9, 
   3.562855745215382*^9}, {3.562855834479697*^9, 3.562855919374391*^9}, {
   3.5628559495462418`*^9, 3.562855959830159*^9}, {3.562855994817829*^9, 
   3.562855996410336*^9}, {3.562856058532906*^9, 3.562856067561316*^9}, {
   3.562856348795816*^9, 3.562856376930189*^9}, {3.562856487634591*^9, 
   3.562856506950039*^9}, {3.562856591515787*^9, 3.5628566179728947`*^9}, {
   3.562856655843794*^9, 3.5628569562560663`*^9}, {3.562857042568256*^9, 
   3.562857051786644*^9}, {3.562857087518365*^9, 3.562857089046356*^9}, {
   3.562867655603628*^9, 3.5628676772981367`*^9}, {3.562867718201264*^9, 
   3.562867810778425*^9}, {3.562867854593412*^9, 3.5628678572974443`*^9}, {
   3.562867928969345*^9, 3.562867991038229*^9}, {3.56286812187549*^9, 
   3.562868124171238*^9}, {3.562868181782991*^9, 3.562868197073942*^9}, {
   3.5628682339102583`*^9, 3.56286828737857*^9}, {3.562868523966084*^9, 
   3.56286857646734*^9}, {3.5628686484223747`*^9, 3.5628686733326*^9}, {
   3.56286879167104*^9, 3.562868800068625*^9}, 3.562905106610783*^9, {
   3.5629051681795187`*^9, 3.562905270867152*^9}, {3.562905305987751*^9, 
   3.5629053445984917`*^9}, {3.562905401394644*^9, 3.562905405537713*^9}, {
   3.562905521835458*^9, 3.562905558824545*^9}, {3.562905647462377*^9, 
   3.5629056561568747`*^9}, {3.5629056887035627`*^9, 3.562905770047553*^9}, {
   3.56290582238654*^9, 3.5629058470903177`*^9}, {3.562905885852364*^9, 
   3.562905890754026*^9}, {3.562905922251334*^9, 3.562905926017475*^9}, {
   3.562905961906399*^9, 3.5629059945219584`*^9}, {3.5629060767069902`*^9, 
   3.5629060941011868`*^9}, {3.56290628925358*^9, 3.562906363768013*^9}, {
   3.562906449134036*^9, 3.562906458460319*^9}, {3.562906716915649*^9, 
   3.562906814550714*^9}, {3.5629072466911173`*^9, 3.5629072499368887`*^9}, {
   3.562907296693408*^9, 3.56290735717111*^9}, {3.5629073908139277`*^9, 
   3.562907552288406*^9}, {3.562907679624529*^9, 3.562907726089517*^9}, {
   3.5629077582714443`*^9, 3.56290778488559*^9}, 3.562907824510667*^9, {
   3.5629078754580812`*^9, 3.562907879150251*^9}, {3.562910344880671*^9, 
   3.562910456180378*^9}, {3.5629107876561213`*^9, 3.562910829754397*^9}, {
   3.5629108978791847`*^9, 3.5629109044897957`*^9}, {3.562910992036852*^9, 
   3.5629109943906918`*^9}, {3.562911029742922*^9, 3.562911160032372*^9}, {
   3.562911211684855*^9, 3.562911425541544*^9}, {3.562911473222527*^9, 
   3.562911489897435*^9}, {3.5629116175219*^9, 3.56291163359575*^9}, {
   3.562911970475092*^9, 3.562911980575223*^9}, {3.562912796667245*^9, 
   3.562912805809779*^9}, {3.5629179948384867`*^9, 3.562917997666113*^9}, {
   3.562918114966703*^9, 3.5629181219821873`*^9}, {3.562918200073524*^9, 
   3.562918201762773*^9}, {3.562923876020924*^9, 3.5629238864679327`*^9}, 
   3.5629241323293257`*^9, {3.5629241686607847`*^9, 3.562924187563471*^9}, {
   3.5629242566247807`*^9, 3.5629242648042707`*^9}, {3.562924304523918*^9, 
   3.5629243176692247`*^9}, {3.5629244006988077`*^9, 
   3.5629244070473957`*^9}, {3.562924628853231*^9, 3.56292466729364*^9}, {
   3.562924765372452*^9, 3.562924782199082*^9}, {3.562925495993284*^9, 
   3.5629255470866203`*^9}, {3.56292558367142*^9, 3.562925583867325*^9}, {
   3.562925621526841*^9, 3.5629256225673447`*^9}, {3.562925815581368*^9, 
   3.5629258251963463`*^9}, {3.562926633820242*^9, 3.56292666242437*^9}, {
   3.562926941914639*^9, 3.562926947042026*^9}, {3.562927069789877*^9, 
   3.562927090235753*^9}, {3.562927277521556*^9, 3.562927277659165*^9}, {
   3.56292730824395*^9, 3.5629273601916656`*^9}, {3.5629274109709063`*^9, 
   3.562927421720168*^9}, {3.56292907257882*^9, 3.5629290854466343`*^9}, {
   3.5629293492026787`*^9, 3.562929374835043*^9}, {3.562929485075652*^9, 
   3.562929485669655*^9}, {3.5629295827465343`*^9, 3.562929590849304*^9}, 
   3.5629357262366447`*^9, {3.56293600824209*^9, 3.562936071104042*^9}, {
   3.5629361067281637`*^9, 3.562936108685486*^9}, {3.56293626746994*^9, 
   3.562936293576869*^9}, {3.562937109345849*^9, 3.562937168901948*^9}, {
   3.562937360942108*^9, 3.562937363687628*^9}, {3.562937448950692*^9, 
   3.562937473050267*^9}, {3.562957937942622*^9, 3.56295802661027*^9}, {
   3.562961299571691*^9, 3.562961304498604*^9}, {3.562961529392666*^9, 
   3.5629615368732767`*^9}, {3.562964630820101*^9, 3.562964635210095*^9}, {
   3.562965226258108*^9, 3.562965226511752*^9}, {3.5629676300879583`*^9, 
   3.562967642931344*^9}, {3.563014323236003*^9, 3.563014402946411*^9}, {
   3.5630938352513237`*^9, 3.563093850673772*^9}, {3.563095742071075*^9, 
   3.563095820103189*^9}, {3.5630995326208963`*^9, 3.563099535094035*^9}, {
   3.563102903157853*^9, 3.563102907463283*^9}, {3.56310554037939*^9, 
   3.563105542318925*^9}, {3.56312789535492*^9, 3.563127899577694*^9}, {
   3.563127964532061*^9, 3.563127975919963*^9}, {3.563132570441373*^9, 
   3.563132576166358*^9}, {3.563165601624716*^9, 3.5631656029229918`*^9}, {
   3.5631661189533997`*^9, 3.563166120724555*^9}, {3.5631954274399357`*^9, 
   3.56319542978942*^9}, {3.563250234474473*^9, 3.563250255706704*^9}, 
   3.563251035092008*^9, {3.563251468335986*^9, 3.563251547784548*^9}, {
   3.563252412664584*^9, 3.563252456028247*^9}, {3.563252526021194*^9, 
   3.563252593587635*^9}, {3.563252629029231*^9, 3.563252645757395*^9}, {
   3.5632527509978943`*^9, 3.563252768784857*^9}, {3.56325286585124*^9, 
   3.563252919790251*^9}, 3.5632530454654913`*^9, {3.563253265141367*^9, 
   3.563253281740768*^9}, {3.5632533783769693`*^9, 3.563253393320752*^9}, {
   3.563253433174117*^9, 3.5632534454908743`*^9}, {3.5632534973507137`*^9, 
   3.563253504837504*^9}, {3.563259524846602*^9, 3.5632596974567213`*^9}, {
   3.5632597406169577`*^9, 3.563259761899407*^9}, {3.563259802680559*^9, 
   3.563259895711051*^9}, {3.563262039877717*^9, 3.5632621431826487`*^9}, {
   3.5632623678936577`*^9, 3.563262398140737*^9}, {3.563262461821126*^9, 
   3.563262493066577*^9}, {3.56326254682751*^9, 3.5632626054607153`*^9}, {
   3.563262642651513*^9, 3.563262660941393*^9}, {3.563262701275879*^9, 
   3.563262720284727*^9}, {3.563263320621584*^9, 3.563263322271826*^9}, {
   3.563263425266287*^9, 3.5632634306666927`*^9}, {3.563263474397436*^9, 
   3.563263478240734*^9}, {3.5632667475523777`*^9, 3.5632667931315536`*^9}, {
   3.563266834539609*^9, 3.563267042737144*^9}, {3.5632670775603*^9, 
   3.563267296742725*^9}, 3.56326736671743*^9, {3.56326742748615*^9, 
   3.5632674498936253`*^9}, {3.563267481299204*^9, 3.563267495144902*^9}, {
   3.5632675486315813`*^9, 3.563267561860854*^9}, {3.563268146993556*^9, 
   3.563268162119389*^9}, 3.563268390839431*^9, {3.563268550690136*^9, 
   3.563268555772613*^9}, {3.563268990840621*^9, 3.563269033788218*^9}, {
   3.5632713674855623`*^9, 3.563271404752861*^9}, {3.563271571167657*^9, 
   3.5632715823216743`*^9}, {3.563274443533703*^9, 3.563274447545665*^9}, {
   3.56361671128797*^9, 3.563616718625326*^9}, {3.5637043760032387`*^9, 
   3.563704379094421*^9}, {3.563737715235821*^9, 3.5637377277675467`*^9}, {
   3.5638653196718473`*^9, 3.563865347815227*^9}, {3.563866732956081*^9, 
   3.563866749512106*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PutFreeIndicesDown", "[", "expr_", "]"}], ":=", 
   RowBox[{"Fold", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ReplaceIndex", "[", 
       RowBox[{"#1", ",", 
        RowBox[{"#2", "\[Rule]", 
         RowBox[{"ChangeIndex", "[", "#2", "]"}]}]}], "]"}], "&"}], ",", 
     "expr", ",", 
     RowBox[{
      RowBox[{"IndicesOf", "[", 
       RowBox[{"Free", ",", "Up"}], "]"}], "[", "expr", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PutFreeIndicesUp", "[", "expr_", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{"Fold", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ReplaceIndex", "[", 
        RowBox[{"#1", ",", 
         RowBox[{"#2", "\[Rule]", 
          RowBox[{"ChangeIndex", "[", "#2", "]"}]}]}], "]"}], "&"}], ",", 
      "expr", ",", 
      RowBox[{
       RowBox[{"IndicesOf", "[", 
        RowBox[{"Free", ",", "Down"}], "]"}], "[", "expr", "]"}]}], "]"}], 
    ")"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PatternSymbolQ", "[", "expr_Symbol", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{"expr", "===", "Pattern"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PatternTestSymbolQ", "[", "expr_Symbol", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{"expr", "===", "PatternTest"}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PutPatternIndicesDown", "[", "expr_", "]"}], ":=", 
   RowBox[{"Fold", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#1", "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"pat_", "?", "PatternSymbolQ"}], "[", 
          RowBox[{"#2", ",", "st_"}], "]"}], "\[RuleDelayed]", 
         RowBox[{"-", 
          RowBox[{"pat", "[", 
           RowBox[{"#2", ",", "st"}], "]"}]}]}]}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"a_", "?", "PatternTestSymbolQ"}], "[", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{
            RowBox[{"pat_", "?", "PatternSymbolQ"}], "[", 
            RowBox[{"#2", ",", "st_"}], "]"}]}], ",", "fun_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{"-", 
         RowBox[{"a", "[", 
          RowBox[{
           RowBox[{"pat", "[", 
            RowBox[{"#2", ",", "st"}], "]"}], ",", "fun"}], "]"}]}]}]}], 
      "&"}], ",", "expr", ",", 
     RowBox[{
      RowBox[{"IndicesOf", "[", 
       RowBox[{"Free", ",", "Up"}], "]"}], "[", 
      RowBox[{"RemovePatterns", "[", "expr", "]"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PutPatternIndicesUp", "[", "expr_", "]"}], ":=", 
   RowBox[{"Fold", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#1", "/.", 
        RowBox[{
         RowBox[{
          RowBox[{"pat_", "?", "PatternSymbolQ"}], "[", 
          RowBox[{
           RowBox[{"ChangeIndex", "[", "#2", "]"}], ",", "st_"}], "]"}], 
         "\[RuleDelayed]", 
         RowBox[{"-", 
          RowBox[{"pat", "[", 
           RowBox[{
            RowBox[{"Evaluate", "@", 
             RowBox[{"ChangeIndex", "[", "#2", "]"}]}], ",", "st"}], 
           "]"}]}]}]}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"a_", "?", "PatternTestSymbolQ"}], "[", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{
            RowBox[{"pat_", "?", "PatternSymbolQ"}], "[", 
            RowBox[{
             RowBox[{"Evaluate", "@", 
              RowBox[{"ChangeIndex", "[", "#2", "]"}]}], ",", "st_"}], 
            "]"}]}], ",", "fun_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{"-", 
         RowBox[{"a", "[", 
          RowBox[{
           RowBox[{"pat", "[", 
            RowBox[{
             RowBox[{"Evaluate", "@", 
              RowBox[{"ChangeIndex", "[", "#2", "]"}]}], ",", "st"}], "]"}], 
           ",", "fun"}], "]"}]}]}]}], "&"}], ",", "expr", ",", 
     RowBox[{
      RowBox[{"IndicesOf", "[", 
       RowBox[{"Free", ",", "Down"}], "]"}], "[", 
      RowBox[{"RemovePatterns", "[", "expr", "]"}], "]"}]}], "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5628524165579147`*^9, 3.562852459950708*^9}, {
   3.562852521469261*^9, 3.562852716531543*^9}, {3.56285280270122*^9, 
   3.5628528241763678`*^9}, {3.562852860319392*^9, 3.562852862885676*^9}, 
   3.562852938643854*^9, {3.5628550064183807`*^9, 3.562855008280697*^9}, {
   3.562855305300766*^9, 3.562855307458774*^9}, {3.562855342680915*^9, 
   3.5628553580230713`*^9}, {3.562855395816695*^9, 3.562855493312042*^9}, {
   3.562855672128683*^9, 3.562855674947558*^9}, {3.562855705979685*^9, 
   3.562855745215382*^9}, {3.562855834479697*^9, 3.562855919374391*^9}, {
   3.5628559495462418`*^9, 3.562855959830159*^9}, {3.562855994817829*^9, 
   3.562855996410336*^9}, {3.562856058532906*^9, 3.562856067561316*^9}, {
   3.562856348795816*^9, 3.562856376930189*^9}, {3.562856487634591*^9, 
   3.562856506950039*^9}, {3.562856591515787*^9, 3.5628566179728947`*^9}, {
   3.562856655843794*^9, 3.5628569562560663`*^9}, {3.562857042568256*^9, 
   3.562857051786644*^9}, {3.562857087518365*^9, 3.562857089046356*^9}, {
   3.562867655603628*^9, 3.5628676772981367`*^9}, {3.562867718201264*^9, 
   3.562867810778425*^9}, {3.562867854593412*^9, 3.5628678572974443`*^9}, {
   3.562867928969345*^9, 3.562867991038229*^9}, {3.56286812187549*^9, 
   3.562868124171238*^9}, {3.562868181782991*^9, 3.562868197073942*^9}, {
   3.5628682339102583`*^9, 3.56286828737857*^9}, {3.562868523966084*^9, 
   3.56286857646734*^9}, {3.5628686484223747`*^9, 3.5628686733326*^9}, {
   3.56286879167104*^9, 3.562868800068625*^9}, 3.562905106610783*^9, {
   3.5629051681795187`*^9, 3.562905270867152*^9}, {3.562905305987751*^9, 
   3.5629053445984917`*^9}, {3.562905401394644*^9, 3.562905405537713*^9}, {
   3.562905521835458*^9, 3.562905558824545*^9}, {3.562905647462377*^9, 
   3.5629056561568747`*^9}, {3.5629056887035627`*^9, 3.562905770047553*^9}, {
   3.56290582238654*^9, 3.5629058470903177`*^9}, {3.562905885852364*^9, 
   3.562905890754026*^9}, {3.562905922251334*^9, 3.562905926017475*^9}, {
   3.562905961906399*^9, 3.5629059945219584`*^9}, {3.5629060767069902`*^9, 
   3.5629060941011868`*^9}, {3.56290628925358*^9, 3.562906363768013*^9}, {
   3.562906449134036*^9, 3.562906458460319*^9}, {3.562906716915649*^9, 
   3.562906814550714*^9}, {3.5629072466911173`*^9, 3.5629072499368887`*^9}, {
   3.562907296693408*^9, 3.56290735717111*^9}, {3.5629073908139277`*^9, 
   3.562907552288406*^9}, {3.562907679624529*^9, 3.562907726089517*^9}, {
   3.5629077582714443`*^9, 3.56290778488559*^9}, 3.562907824510667*^9, {
   3.5629078754580812`*^9, 3.562907879150251*^9}, {3.562910344880671*^9, 
   3.562910456180378*^9}, {3.5629107876561213`*^9, 3.562910829754397*^9}, {
   3.5629108978791847`*^9, 3.5629109044897957`*^9}, {3.562910992036852*^9, 
   3.5629109943906918`*^9}, {3.562911029742922*^9, 3.562911160032372*^9}, {
   3.562911211684855*^9, 3.562911425541544*^9}, {3.562911473222527*^9, 
   3.562911489897435*^9}, {3.5629116175219*^9, 3.56291163359575*^9}, {
   3.562911970475092*^9, 3.562911980575223*^9}, {3.562912796667245*^9, 
   3.562912805809779*^9}, {3.5629179948384867`*^9, 3.562917997666113*^9}, {
   3.562918114966703*^9, 3.5629181219821873`*^9}, {3.562918200073524*^9, 
   3.562918201762773*^9}, {3.562923876020924*^9, 3.5629238864679327`*^9}, 
   3.5629241323293257`*^9, {3.5629241686607847`*^9, 3.562924187563471*^9}, {
   3.5629242566247807`*^9, 3.5629242648042707`*^9}, {3.562924304523918*^9, 
   3.5629243176692247`*^9}, {3.5629244006988077`*^9, 
   3.5629244070473957`*^9}, {3.562924628853231*^9, 3.56292466729364*^9}, {
   3.562924765372452*^9, 3.562924782199082*^9}, {3.562925495993284*^9, 
   3.5629255470866203`*^9}, {3.56292558367142*^9, 3.562925583867325*^9}, {
   3.562925621526841*^9, 3.5629256225673447`*^9}, {3.562925815581368*^9, 
   3.5629258251963463`*^9}, {3.562926633820242*^9, 3.56292666242437*^9}, {
   3.562926941914639*^9, 3.562926947042026*^9}, {3.562927069789877*^9, 
   3.562927090235753*^9}, {3.562927277521556*^9, 3.562927277659165*^9}, {
   3.56292730824395*^9, 3.5629273601916656`*^9}, {3.5629274109709063`*^9, 
   3.562927421720168*^9}, {3.56292907257882*^9, 3.5629290854466343`*^9}, {
   3.5629293492026787`*^9, 3.562929374835043*^9}, {3.562929485075652*^9, 
   3.562929485669655*^9}, {3.5629295827465343`*^9, 3.562929590849304*^9}, 
   3.5629357262366447`*^9, {3.56293600824209*^9, 3.562936071104042*^9}, {
   3.5629361067281637`*^9, 3.562936108685486*^9}, {3.56293626746994*^9, 
   3.562936293576869*^9}, {3.562937109345849*^9, 3.562937168901948*^9}, {
   3.562937360942108*^9, 3.562937363687628*^9}, {3.562937448950692*^9, 
   3.562937473050267*^9}, {3.562957937942622*^9, 3.56295802661027*^9}, {
   3.562961299571691*^9, 3.562961304498604*^9}, {3.562961529392666*^9, 
   3.5629615368732767`*^9}, {3.562964630820101*^9, 3.562964635210095*^9}, {
   3.562965226258108*^9, 3.562965226511752*^9}, {3.5629676300879583`*^9, 
   3.562967642931344*^9}, {3.563014323236003*^9, 3.563014402946411*^9}, {
   3.5630938352513237`*^9, 3.563093850673772*^9}, {3.563095742071075*^9, 
   3.563095820103189*^9}, {3.5630995326208963`*^9, 3.563099535094035*^9}, {
   3.563102903157853*^9, 3.563102907463283*^9}, {3.56310554037939*^9, 
   3.563105542318925*^9}, {3.56312789535492*^9, 3.563127899577694*^9}, {
   3.563127964532061*^9, 3.563127975919963*^9}, {3.563132570441373*^9, 
   3.563132576166358*^9}, {3.563165601624716*^9, 3.5631656029229918`*^9}, {
   3.5631661189533997`*^9, 3.563166120724555*^9}, {3.5631954274399357`*^9, 
   3.56319542978942*^9}, {3.563250234474473*^9, 3.563250255706704*^9}, 
   3.563251035092008*^9, {3.563251468335986*^9, 3.563251547784548*^9}, {
   3.563252412664584*^9, 3.563252456028247*^9}, {3.563252526021194*^9, 
   3.563252593587635*^9}, {3.563252629029231*^9, 3.563252645757395*^9}, {
   3.5632527509978943`*^9, 3.563252768784857*^9}, {3.56325286585124*^9, 
   3.563252919790251*^9}, 3.5632530454654913`*^9, {3.563253265141367*^9, 
   3.563253281740768*^9}, {3.5632533783769693`*^9, 3.563253393320752*^9}, {
   3.563253433174117*^9, 3.5632534454908743`*^9}, {3.5632534973507137`*^9, 
   3.563253504837504*^9}, {3.563259524846602*^9, 3.5632596974567213`*^9}, {
   3.5632597406169577`*^9, 3.563259761899407*^9}, {3.563259802680559*^9, 
   3.563259895711051*^9}, {3.563262039877717*^9, 3.5632621431826487`*^9}, {
   3.5632623678936577`*^9, 3.563262398140737*^9}, {3.563262461821126*^9, 
   3.563262493066577*^9}, {3.56326254682751*^9, 3.5632626054607153`*^9}, {
   3.563262642651513*^9, 3.563262660941393*^9}, {3.563262701275879*^9, 
   3.563262720284727*^9}, {3.563263320621584*^9, 3.563263322271826*^9}, {
   3.563263425266287*^9, 3.5632634306666927`*^9}, {3.563263474397436*^9, 
   3.563263478240734*^9}, {3.5632667475523777`*^9, 3.5632667931315536`*^9}, {
   3.563266834539609*^9, 3.563267042737144*^9}, {3.5632670775603*^9, 
   3.563267296742725*^9}, 3.56326736671743*^9, {3.56326742748615*^9, 
   3.5632674498936253`*^9}, {3.563267481299204*^9, 3.563267495144902*^9}, {
   3.5632675486315813`*^9, 3.563267561860854*^9}, {3.563268146993556*^9, 
   3.563268162119389*^9}, 3.563268390839431*^9, {3.563268550690136*^9, 
   3.563268555772613*^9}, {3.563268990840621*^9, 3.563269033788218*^9}, {
   3.5632713674855623`*^9, 3.563271404752861*^9}, {3.563271571167657*^9, 
   3.5632715823216743`*^9}, {3.563274443533703*^9, 3.563274447545665*^9}, {
   3.56361671128797*^9, 3.563616718625326*^9}, {3.5637043760032387`*^9, 
   3.563704379094421*^9}, {3.563737715235821*^9, 3.563737729733186*^9}, {
   3.564304972091915*^9, 3.564304986364291*^9}, {3.564305042902364*^9, 
   3.5643051150474167`*^9}, 3.564305153296651*^9, {3.564306670145719*^9, 
   3.5643066735405416`*^9}, {3.564396099110149*^9, 3.564396114300674*^9}, {
   3.564396160800638*^9, 3.564396165558785*^9}, {3.564420817687559*^9, 
   3.564420818390512*^9}, {3.5647190479623337`*^9, 3.564719048721092*^9}}],

Cell["\<\
This function builds all the replacement rules with CovDs from a given Rule.
  That is , it the rule is lhs :> ... then it buils {lhs :> .., CD[]@lhs :> \
..., CD[]@CD[]@lhs :> ...} .
  It looks in the expression in which the Rule is to be replaced at the \
maximum number of CovD (the max number of CovD is stored in the variable \
CDmax)\
\>", "Text",
 CellChangeTimes->{{3.563737833705258*^9, 3.563737960940387*^9}, {
  3.564396174675912*^9, 3.564396176533855*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"RemovePatterns", "[", "expr_", "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"expr", "/.", 
        RowBox[{"hp_HoldPattern", "\[RuleDelayed]", 
         RowBox[{"First", "@", "hp"}]}]}], ")"}], "/.", 
      RowBox[{"a_PatternTest", ":>", 
       RowBox[{"First", "@", "a"}]}]}], "/.", 
     RowBox[{"a_Pattern", ":>", 
      RowBox[{"First", "@", "a"}]}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RemovePatternTests", "[", "expr_", "]"}], ":=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"expr", "/.", 
       RowBox[{"hp_HoldPattern", "\[RuleDelayed]", 
        RowBox[{"First", "@", "hp"}]}]}], ")"}], "/.", 
     RowBox[{"a_PatternTest", ":>", 
      RowBox[{"First", "@", "a"}]}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"RulesSplitCovDsOfTensor", "[", 
       RowBox[{"expr_", ",", "replacerule_", ",", 
        RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
        RowBox[{"n_:", "10"}]}], "]"}], ":=", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "dummies", ",", "dummiesup", ",", "tableleft", ",", "tableright", 
          ",", "replacevaluesplit", ",", "testpatternlistnmax", ",", 
          "ListBool", ",", "CDmax", ",", "res", ",", 
          "testpatternlistnmaxnopat", ",", "Listlhsrhs", ",", "ruletemp", ",",
           "pairsimplified", ",", "restemp", ",", "rhsCDcd", ",", 
          "freeupleft", ",", "freedownleft", ",", "freeupright", ",", 
          "leftreplaceruledownindices", ",", "rightreplaceruledownindices", 
          ",", "dummiesdown", ",", "tableleftupindices", ",", 
          "rightdownindices", ",", "tablerightdown"}], "}"}], ",", 
        RowBox[{"Catch", "@", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"g", "=", 
              RowBox[{"First", "@", 
               RowBox[{"InducedFrom", "@", "h"}]}]}], ",", 
             RowBox[{"u", "=", 
              RowBox[{"Last", "@", 
               RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"CD", "=", 
                RowBox[{"CovDOfMetric", "[", "g", "]"}]}], ",", 
               RowBox[{"cd", "=", 
                RowBox[{"CovDOfMetric", "[", "h", "]"}]}], ",", 
               RowBox[{"M", "=", 
                RowBox[{"ManifoldOfCovD", "@", 
                 RowBox[{"CovDOfMetric", "[", "g", "]"}]}]}], ",", 
               RowBox[{"indicesright", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Pattern", "[", 
                   RowBox[{"#", ",", "_"}], "]"}], "&"}], "/@", 
                 RowBox[{"FindFreeIndices", "[", 
                  RowBox[{"Last", "@", "replacerule"}], "]"}]}]}], ",", 
               RowBox[{"indicesleft", "=", 
                RowBox[{"FindFreeIndices", "[", 
                 RowBox[{"First", "@", "replacerule"}], "]"}]}]}], "}"}], ",",
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
               "In", " ", "this", " ", "fuynction", " ", "we", " ", "will", 
                " ", "precompute", " ", "the", " ", "rules", " ", "for", " ", 
                "the", " ", "CovDs", " ", "of", " ", "tensor", " ", "for", 
                " ", "which", " ", "the", " ", "rule", " ", "is", " ", 
                "given", " ", "in", " ", "the", " ", "argument", " ", 
                RowBox[{"replacerule", ".", "\[IndentingNewLine]", "For"}], 
                " ", "instance", " ", "if", " ", "we", " ", "compute", " ", 
                "the", " ", "perturbation", " ", "of", " ", "the", " ", 
                "Ricci", " ", "tensor"}], ",", " ", 
               RowBox[{
               "there", " ", "will", " ", "be", " ", "several", " ", "terms", 
                " ", "with", " ", "two", " ", "covariant", " ", "derivatives",
                 " ", "of", " ", "the", " ", "perturbed", " ", 
                RowBox[{"metric", ".", " ", "By"}], " ", "precomputing", " ", 
                "the", " ", "rule", " ", "once", " ", "instead", " ", "of", 
                " ", "several", " ", "times"}], ",", " ", 
               RowBox[{
               "we", " ", "shall", " ", "save", " ", "sone", " ", "computing",
                 " ", 
                RowBox[{"time", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"testpatternlistnmax", "=", 
               RowBox[{"TablePatternsCovDs", "[", 
                RowBox[{
                 RowBox[{"First", "@", "replacerule"}], ",", "CD", ",", "n"}],
                 "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "For", " ", "every", " ", "number", " ", "of", " ", "CovD", 
                 " ", "we", " ", "look", " ", "at", " ", "a", " ", "match", 
                 " ", "and", " ", "give", " ", "a", " ", "list", " ", "of", 
                 " ", "the", " ", 
                 RowBox[{"booleans", ".", " ", 
                  RowBox[{"{", 
                   RowBox[{"True", ",", "True", ",", 
                    RowBox[{"False", "..."}]}], "}"}]}], 
                 "\[IndentingNewLine]", "means", " ", "that", " ", "there", 
                 " ", "is", " ", "terms", " ", "with", " ", "no", " ", 
                 "CovD"}], ",", " ", 
                RowBox[{"terms", " ", "with", " ", "one"}], ",", " ", 
                RowBox[{
                "but", " ", "no", " ", "terms", " ", "with", " ", "two", " ", 
                 
                 RowBox[{"CovD", "[", "tens", "]"}], " ", "for", " ", 
                 RowBox[{"instance", "."}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"ListBool", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "\[GreaterEqual]", "1"}], ")"}], "&"}], "/@", 
                RowBox[{"Length", "/@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"Expand", "@", "expr"}], ",", "#", ",", 
                    "Infinity"}], "]"}], "&"}], "/@", "testpatternlistnmax"}],
                   ")"}]}]}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Then", " ", "we", " ", "look", " ", "at", " ", "the", " ", 
                "maximum", " ", "number", " ", "of", " ", "CovDs"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"CDmax", "=", 
               RowBox[{"Max", "[", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"Max", "@", 
                   RowBox[{"Position", "[", 
                    RowBox[{"ListBool", ",", "True"}], "]"}]}], "-", "1"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"CDmax", "===", "n"}], ",", 
                RowBox[{"Throw", "[", 
                 RowBox[{"Message", "[", 
                  RowBox[{
                   RowBox[{"RulesSplitCovDsOfTensor", "::", "maxcovdnumber"}],
                    ",", "n"}], "]"}], "]"}]}], "]"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"dummiesdown", "=", 
               RowBox[{"Take", "[", 
                RowBox[{"ChangeIndex", "/@", 
                 RowBox[{"DummyIn", "/@", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"Tangent", "[", "M", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Range", "[", "CDmax", "]"}], "}"}]}], "]"}]}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"dummiesup", "=", 
               RowBox[{"ChangeIndex", "/@", "dummiesdown"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"Off", "[", 
               StyleBox[
                RowBox[{"Pattern", "::", "patvar"}], "MessageName"], "]"}], 
              ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"freedownleft", "=", 
               RowBox[{
                RowBox[{"IndicesOf", "[", 
                 RowBox[{"Free", ",", "Down"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"First", "@", "replacerule"}], "/.", 
                 RowBox[{"pat_Pattern", "\[RuleDelayed]", 
                  RowBox[{"First", "[", "pat", "]"}]}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "freedownleft", "]"}], "=!=", "0"}], 
                ",", 
                RowBox[{
                 RowBox[{
                 "Print", "[", 
                  "\"\<** Warning: The rule should be defined with general \
position of indices, and not just for down indices. The free indices which \
were in down position are going to be raised before defining the rule. \
**\>\"", "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"tableleftupindices", "=", 
               RowBox[{"PutPatternIndicesUp", "[", 
                RowBox[{
                 RowBox[{"First", "@", "replacerule"}], "//", 
                 "ProjectorToMetric"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"rightdownindices", "=", 
               RowBox[{"PutFreeIndicesDown", "[", 
                RowBox[{"Last", "@", "replacerule"}], "]"}]}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "We", " ", "build", " ", "the", " ", "left", " ", "hand", " ", 
                "side"}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"tableleft", "=", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", "tableleftupindices", "}"}], ",", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Fold", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"CD", "[", 
                    RowBox[{"Pattern", "[", 
                    RowBox[{"#2", ",", 
                    RowBox[{"Blank", "[", "]"}]}], "]"}], "]"}], "@", "#1"}], 
                    ")"}], "&"}], ",", "tableleftupindices", ",", "#"}], 
                    "]"}], "&"}], "[", 
                    RowBox[{"Take", "[", 
                    RowBox[{"dummiesup", ",", "i"}], "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "CDmax"}], "}"}]}], "]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "Then", " ", "the", " ", "list", " ", "of", " ", "right", " ", 
                "hand", " ", "sides"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"replacevaluesplit", "=", "rightdownindices"}], ";", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"tablerightdown", "=", 
               RowBox[{"Join", "[", 
                RowBox[{
                 RowBox[{"{", "replacevaluesplit", "}"}], ",", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Fold", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"CD", "[", "#2", "]"}], "@", "#1"}], ")"}], "&"}],
                     ",", "replacevaluesplit", ",", "#"}], "]"}], "&"}], "[", 
                    
                    RowBox[{"Take", "[", 
                    RowBox[{"dummiesdown", ",", "i"}], "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", "CDmax"}], "}"}]}], "]"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "And", " ", "gather", " ", "the", " ", "list", " ", "of", " ", 
                "rules"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"Listlhsrhs", "=", 
               RowBox[{"Reverse", "@", 
                RowBox[{"Transpose", "[", 
                 RowBox[{"{", 
                  RowBox[{"tableleft", ",", "tablerightdown"}], "}"}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"res", "=", 
               RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "Now", " ", "we", " ", "will", " ", "replace", " ", "the", 
                 " ", "rhs", " ", "by", " ", "its", " ", "evaluated", " ", 
                 "form", " ", "when", " ", "using", " ", "SplitCovDs", " ", 
                 "on", " ", "it"}], ",", " ", 
                RowBox[{
                "so", " ", "as", " ", "to", " ", "save", " ", "time", " ", 
                 "when", " ", "using", " ", "the", " ", 
                 RowBox[{"rule", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"rhsCDcd", "=", 
                   RowBox[{"SplitCovDs", "[", 
                    RowBox[{
                    RowBox[{"IndicesDown", "[", 
                    RowBox[{"Last", "[", "#", "]"}], "]"}], ",", "CD", ",", 
                    "cd"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"restemp", "=", 
                   RowBox[{"AbsoluteTiming", "[", 
                    RowBox[{"PutFreeIndicesUp", "@", 
                    RowBox[{"PutScalar", "@", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"FixedPoint", "[", 
                    RowBox[{"GradNormalToExtrinsicK", ",", 
                    RowBox[{"rhsCDcd", "/.", 
                    RowBox[{
                    RowBox[{"Projector", "[", "h", "]"}], "\[Rule]", 
                    RowBox[{"ProjectWith", "[", "h", "]"}]}]}]}], "]"}], "//.",
                     "res"}], "//.", "$MyRules"}], "]"}]}]}]}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"pairsimplified", "=", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "[", "#", "]"}], ",", 
                    RowBox[{"Last", "@", "restemp"}]}], "}"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"ruletemp", "=", 
                   RowBox[{"Apply", "[", 
                    RowBox[{"IndexRuleDelayed", ",", "pairsimplified"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{"$CacheRules", ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToCanonical", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"First", "[", "#", "]"}], "/.", 
                    RowBox[{"pat_Pattern", "\[RuleDelayed]", 
                    RowBox[{"First", "[", "pat", "]"}]}]}], ")"}], "/.", 
                    "$MyRules"}], ")"}], "-", 
                    RowBox[{"(", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"First", "[", "#", "]"}], "/.", 
                    RowBox[{"pat_Pattern", "\[RuleDelayed]", 
                    RowBox[{"First", "[", "pat", "]"}]}]}], ")"}], ")"}]}], 
                    "]"}], "===", "0"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"$MyRules", ",", "ruletemp"}], "]"}], ";", 
                    RowBox[{"If", "[", 
                    RowBox[{"$DefInfoQ", ",", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<The rule \>\"", ",", " ", 
                    RowBox[{"ruletemp", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    "\"\< --> ... has been appended to $MyRules\>\""}], 
                    "]"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], "]"}], 
                    ";"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"res", ",", "ruletemp"}], "]"}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}]}], ")"}], "&"}], "/@", 
               "Listlhsrhs"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"On", "[", 
               StyleBox[
                RowBox[{"Pattern", "::", "patvar"}], "MessageName"], "]"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{"$CacheRules", ",", 
                RowBox[{"{", "}"}], ",", "res"}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
    "*)"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5628524165579147`*^9, 3.562852459950708*^9}, {
   3.562852521469261*^9, 3.562852716531543*^9}, {3.56285280270122*^9, 
   3.5628528241763678`*^9}, {3.562852860319392*^9, 3.562852862885676*^9}, 
   3.562852938643854*^9, {3.5628550064183807`*^9, 3.562855008280697*^9}, {
   3.562855305300766*^9, 3.562855307458774*^9}, {3.562855342680915*^9, 
   3.5628553580230713`*^9}, {3.562855395816695*^9, 3.562855493312042*^9}, {
   3.562855672128683*^9, 3.562855674947558*^9}, {3.562855705979685*^9, 
   3.562855745215382*^9}, {3.562855834479697*^9, 3.562855919374391*^9}, {
   3.5628559495462418`*^9, 3.562855959830159*^9}, {3.562855994817829*^9, 
   3.562855996410336*^9}, {3.562856058532906*^9, 3.562856067561316*^9}, {
   3.562856348795816*^9, 3.562856376930189*^9}, {3.562856487634591*^9, 
   3.562856506950039*^9}, {3.562856591515787*^9, 3.5628566179728947`*^9}, {
   3.562856655843794*^9, 3.5628569562560663`*^9}, {3.562857042568256*^9, 
   3.562857051786644*^9}, {3.562857087518365*^9, 3.562857089046356*^9}, {
   3.562867655603628*^9, 3.5628676772981367`*^9}, {3.562867718201264*^9, 
   3.562867810778425*^9}, {3.562867854593412*^9, 3.5628678572974443`*^9}, {
   3.562867928969345*^9, 3.562867991038229*^9}, {3.56286812187549*^9, 
   3.562868124171238*^9}, {3.562868181782991*^9, 3.562868197073942*^9}, {
   3.5628682339102583`*^9, 3.56286828737857*^9}, {3.562868523966084*^9, 
   3.56286857646734*^9}, {3.5628686484223747`*^9, 3.5628686733326*^9}, {
   3.56286879167104*^9, 3.562868800068625*^9}, 3.562905106610783*^9, {
   3.5629051681795187`*^9, 3.562905270867152*^9}, {3.562905305987751*^9, 
   3.5629053445984917`*^9}, {3.562905401394644*^9, 3.562905405537713*^9}, {
   3.562905521835458*^9, 3.562905558824545*^9}, {3.562905647462377*^9, 
   3.5629056561568747`*^9}, {3.5629056887035627`*^9, 3.562905770047553*^9}, {
   3.56290582238654*^9, 3.5629058470903177`*^9}, {3.562905885852364*^9, 
   3.562905890754026*^9}, {3.562905922251334*^9, 3.562905926017475*^9}, {
   3.562905961906399*^9, 3.5629059945219584`*^9}, {3.5629060767069902`*^9, 
   3.5629060941011868`*^9}, {3.56290628925358*^9, 3.562906363768013*^9}, {
   3.562906449134036*^9, 3.562906458460319*^9}, {3.562906716915649*^9, 
   3.562906814550714*^9}, {3.5629072466911173`*^9, 3.5629072499368887`*^9}, {
   3.562907296693408*^9, 3.56290735717111*^9}, {3.5629073908139277`*^9, 
   3.562907552288406*^9}, {3.562907679624529*^9, 3.562907726089517*^9}, {
   3.5629077582714443`*^9, 3.56290778488559*^9}, 3.562907824510667*^9, {
   3.5629078754580812`*^9, 3.562907879150251*^9}, {3.562910344880671*^9, 
   3.562910456180378*^9}, {3.5629107876561213`*^9, 3.562910829754397*^9}, {
   3.5629108978791847`*^9, 3.5629109044897957`*^9}, {3.562910992036852*^9, 
   3.5629109943906918`*^9}, {3.562911029742922*^9, 3.562911160032372*^9}, {
   3.562911211684855*^9, 3.562911425541544*^9}, {3.562911473222527*^9, 
   3.562911489897435*^9}, {3.5629116175219*^9, 3.56291163359575*^9}, {
   3.562911970475092*^9, 3.562911980575223*^9}, {3.562912796667245*^9, 
   3.562912805809779*^9}, {3.5629179948384867`*^9, 3.562917997666113*^9}, {
   3.562918114966703*^9, 3.5629181219821873`*^9}, {3.562918200073524*^9, 
   3.562918201762773*^9}, {3.562923876020924*^9, 3.5629238864679327`*^9}, 
   3.5629241323293257`*^9, {3.5629241686607847`*^9, 3.562924187563471*^9}, {
   3.5629242566247807`*^9, 3.5629242648042707`*^9}, {3.562924304523918*^9, 
   3.5629243176692247`*^9}, {3.5629244006988077`*^9, 
   3.5629244070473957`*^9}, {3.562924628853231*^9, 3.56292466729364*^9}, {
   3.562924765372452*^9, 3.562924782199082*^9}, {3.562925495993284*^9, 
   3.5629255470866203`*^9}, {3.56292558367142*^9, 3.562925583867325*^9}, {
   3.562925621526841*^9, 3.5629256225673447`*^9}, {3.562925815581368*^9, 
   3.5629258251963463`*^9}, {3.562926633820242*^9, 3.56292666242437*^9}, {
   3.562926941914639*^9, 3.562926947042026*^9}, {3.562927069789877*^9, 
   3.562927090235753*^9}, {3.562927277521556*^9, 3.562927277659165*^9}, {
   3.56292730824395*^9, 3.5629273601916656`*^9}, {3.5629274109709063`*^9, 
   3.562927421720168*^9}, {3.56292907257882*^9, 3.5629290854466343`*^9}, {
   3.5629293492026787`*^9, 3.562929374835043*^9}, {3.562929485075652*^9, 
   3.562929485669655*^9}, {3.5629295827465343`*^9, 3.562929590849304*^9}, 
   3.5629357262366447`*^9, {3.56293600824209*^9, 3.562936071104042*^9}, {
   3.5629361067281637`*^9, 3.562936108685486*^9}, {3.56293626746994*^9, 
   3.562936293576869*^9}, {3.562937109345849*^9, 3.562937168901948*^9}, {
   3.562937360942108*^9, 3.562937363687628*^9}, {3.562937448950692*^9, 
   3.562937473050267*^9}, {3.562957937942622*^9, 3.56295802661027*^9}, {
   3.562961299571691*^9, 3.562961304498604*^9}, {3.562961529392666*^9, 
   3.5629615368732767`*^9}, {3.562964630820101*^9, 3.562964635210095*^9}, {
   3.562965226258108*^9, 3.562965226511752*^9}, {3.5629676300879583`*^9, 
   3.562967642931344*^9}, {3.563014323236003*^9, 3.563014402946411*^9}, {
   3.5630938352513237`*^9, 3.563093850673772*^9}, {3.563095742071075*^9, 
   3.563095820103189*^9}, {3.5630995326208963`*^9, 3.563099535094035*^9}, {
   3.563102903157853*^9, 3.563102907463283*^9}, {3.56310554037939*^9, 
   3.563105542318925*^9}, {3.56312789535492*^9, 3.563127899577694*^9}, {
   3.563127964532061*^9, 3.563127975919963*^9}, {3.563132570441373*^9, 
   3.563132576166358*^9}, {3.563165601624716*^9, 3.5631656029229918`*^9}, {
   3.5631661189533997`*^9, 3.563166120724555*^9}, {3.5631954274399357`*^9, 
   3.56319542978942*^9}, {3.563250234474473*^9, 3.563250255706704*^9}, 
   3.563251035092008*^9, {3.563251468335986*^9, 3.563251547784548*^9}, {
   3.563252412664584*^9, 3.563252456028247*^9}, {3.563252526021194*^9, 
   3.563252593587635*^9}, {3.563252629029231*^9, 3.563252645757395*^9}, {
   3.5632527509978943`*^9, 3.563252768784857*^9}, {3.56325286585124*^9, 
   3.563252919790251*^9}, 3.5632530454654913`*^9, {3.563253265141367*^9, 
   3.563253281740768*^9}, {3.5632533783769693`*^9, 3.563253393320752*^9}, {
   3.563253433174117*^9, 3.5632534454908743`*^9}, {3.5632534973507137`*^9, 
   3.563253504837504*^9}, {3.563259524846602*^9, 3.5632596974567213`*^9}, {
   3.5632597406169577`*^9, 3.563259761899407*^9}, {3.563259802680559*^9, 
   3.563259895711051*^9}, {3.563262039877717*^9, 3.5632621431826487`*^9}, {
   3.5632623678936577`*^9, 3.563262398140737*^9}, {3.563262461821126*^9, 
   3.563262493066577*^9}, {3.56326254682751*^9, 3.5632626054607153`*^9}, {
   3.563262642651513*^9, 3.563262660941393*^9}, {3.563262701275879*^9, 
   3.563262720284727*^9}, {3.563263320621584*^9, 3.563263322271826*^9}, {
   3.563263425266287*^9, 3.5632634306666927`*^9}, {3.563263474397436*^9, 
   3.563263478240734*^9}, {3.5632667475523777`*^9, 3.5632667931315536`*^9}, {
   3.563266834539609*^9, 3.563267042737144*^9}, {3.5632670775603*^9, 
   3.563267296742725*^9}, 3.56326736671743*^9, {3.56326742748615*^9, 
   3.5632674498936253`*^9}, {3.563267481299204*^9, 3.563267495144902*^9}, {
   3.5632675486315813`*^9, 3.563267561860854*^9}, {3.563268146993556*^9, 
   3.563268162119389*^9}, 3.563268390839431*^9, {3.563268550690136*^9, 
   3.563268555772613*^9}, {3.563268990840621*^9, 3.563269033788218*^9}, {
   3.5632713674855623`*^9, 3.563271404752861*^9}, {3.563271571167657*^9, 
   3.5632715823216743`*^9}, {3.563274443533703*^9, 3.563274447545665*^9}, {
   3.56361671128797*^9, 3.563616718625326*^9}, {3.5637043760032387`*^9, 
   3.563704379094421*^9}, {3.563737715235821*^9, 3.56373782748849*^9}, {
   3.563783782101664*^9, 3.563783800895533*^9}, {3.563783990302075*^9, 
   3.5637839920527687`*^9}, {3.5637841547671328`*^9, 3.563784155323979*^9}, {
   3.56378418946672*^9, 3.563784192086899*^9}, {3.563784222838448*^9, 
   3.563784228169651*^9}, {3.563784303311713*^9, 3.56378430437869*^9}, {
   3.563784342917975*^9, 3.5637843552774267`*^9}, {3.563865355721725*^9, 
   3.563865758778309*^9}, {3.5638657954834013`*^9, 3.563865809183197*^9}, {
   3.563866728110874*^9, 3.5638667287267437`*^9}, {3.563870458140439*^9, 
   3.563870469997664*^9}, {3.564302616119409*^9, 3.564302616808229*^9}, {
   3.564304611506126*^9, 3.564304612633461*^9}, {3.56440412486485*^9, 
   3.564404130895355*^9}, {3.5644042143735332`*^9, 3.564404215263362*^9}, {
   3.564411846537426*^9, 3.564411854083392*^9}, {3.5644810495371*^9, 
   3.564481102808178*^9}, 3.5647265051111603`*^9, 3.564738124126696*^9, 
   3.564755902285671*^9, {3.569897843830451*^9, 3.5698978478373632`*^9}}],

Cell["To parameterize the constants as in Ellis MacCallum 1969", "Text",
 CellChangeTimes->{{3.563737969530991*^9, 3.5637379779644136`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ConstantsDecompositionRules", "[", 
    RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g", "=", 
       RowBox[{"First", "@", 
        RowBox[{"InducedFrom", "@", "h"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"M", "=", 
         RowBox[{"ManifoldOfCovD", "@", 
          RowBox[{"CovDOfMetric", "[", "g", "]"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"i", "=", 
            RowBox[{"DummyIn", "[", 
             RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ",", 
           RowBox[{"dim", "=", 
            RowBox[{"DimOfManifold", "@", "M"}]}], ",", 
           RowBox[{"j", "=", 
            RowBox[{"DummyIn", "[", 
             RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ",", 
           RowBox[{"k", "=", 
            RowBox[{"DummyIn", "[", 
             RowBox[{"Tangent", "[", "M", "]"}], "]"}]}], ",", 
           RowBox[{"\[Mu]", "=", 
            RowBox[{"DummyIn", "[", 
             RowBox[{"Tangent", "[", "M", "]"}], "]"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"$OpenConstantsOfStructure", "&&", 
            RowBox[{"Not", "[", 
             RowBox[{"TensorNullQ", "[", 
              RowBox[{"CS", "[", "h", "]"}], "]"}], "]"}], "&&", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"SpaceType", "[", "h", "]"}], "===", 
               "\"\<BianchiB\>\""}], "||", 
              RowBox[{
               RowBox[{"SpaceType", "[", "h", "]"}], "===", 
               "\"\<BianchiA\>\""}]}], ")"}], "&&", 
            RowBox[{"dim", "===", "4"}]}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"MakeRule", "[", 
            RowBox[{
             RowBox[{"Evaluate", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"CS", "[", "h", "]"}], "[", 
                 RowBox[{"i", ",", "j", ",", "k"}], "]"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"epsilon", "[", "h", "]"}], "[", 
                   RowBox[{"j", ",", "k", ",", 
                    RowBox[{"-", "\[Mu]"}]}], "]"}], 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"nt", "[", "h", "]"}], "[", 
                    RowBox[{"\[Mu]", ",", "i"}], "]"}], ")"}]}], "+", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"av", "[", "h", "]"}], "[", "j", "]"}], 
                  RowBox[{"h", "[", 
                   RowBox[{"i", ",", "k"}], "]"}]}], "-", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"av", "[", "h", "]"}], "[", "k", "]"}], 
                  RowBox[{"h", "[", 
                   RowBox[{"i", ",", "j"}], "]"}]}]}]}], "}"}], "]"}], ",", 
             RowBox[{"MetricOn", "->", "All"}]}], "]"}], ",", 
           RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"ConstantsDecompositionRules", ",", "1"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", "ConstantsDecompositionRules", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ToBianchiType", "[", 
   RowBox[{"h_", "?", "InducedMetricQ"}], "]"}], ":=", 
  RowBox[{"Function", "[", 
   RowBox[{"expr", ",", 
    RowBox[{"expr", "/.", 
     RowBox[{"ConstantsDecompositionRules", "[", "h", "]"}]}]}], 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5629375011935053`*^9, 3.5629376064704113`*^9}, {
   3.562937815976932*^9, 3.562937876580975*^9}, 3.562938028068122*^9, 
   3.56293810785345*^9, {3.563017990824974*^9, 3.563018014635062*^9}, {
   3.5630703321014233`*^9, 3.5630703633360653`*^9}, {3.563070407588615*^9, 
   3.563070429367363*^9}, {3.563070626469461*^9, 3.5630706497028847`*^9}, {
   3.563070699705744*^9, 3.56307076244846*^9}, 3.563515882036543*^9, {
   3.563733937526608*^9, 3.563733971590721*^9}, {3.563865819534556*^9, 
   3.563865840781789*^9}, {3.5647261724430304`*^9, 3.564726179270516*^9}, 
   3.564726506600141*^9, {3.5647558306232557`*^9, 3.564755831708288*^9}, {
   3.5647566758528967`*^9, 3.564756677549333*^9}, {3.5654498770439568`*^9, 
   3.56544988127297*^9}, 3.568446529668466*^9, {3.569340486589727*^9, 
   3.569340496996581*^9}, {3.569340710573032*^9, 3.569340711970089*^9}, {
   3.569413607697233*^9, 3.5694136083447037`*^9}, {3.569418934468495*^9, 
   3.569418938489949*^9}, {3.5694194459830837`*^9, 3.569419451014863*^9}, {
   3.569577884288622*^9, 3.569577889434697*^9}, {3.5695781730562153`*^9, 
   3.5695782143778152`*^9}, 3.56957857775364*^9, 3.569580509255817*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"CommuteCDSafe", "[", 
   RowBox[{"expr_", ",", "cd_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"restemp", ",", "counter", ",", "res", ",", "restemp0"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<CommuteCDSafe\>\"", ",", "$SortCovDAutomatic", ",", 
        "$DebugInfoQ"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{"$SortCovDAutomatic", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{"$DebugInfoQ", ",", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<Preliminar Canonicalisation. \>\"", "]"}], 
           ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"restemp0", "=", 
         RowBox[{"SameDummies", "@", 
          RowBox[{"ToCanonical", "@", "expr"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"SortCovDsStart", "[", "cd", "]"}], ";", 
        RowBox[{"If", "[", 
         RowBox[{"$DebugInfoQ", ",", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<First Canonicalisation with automatic sorting of Cov Ds.  \>\
\"", ",", 
             RowBox[{"Length", "[", "restemp0", "]"}], ",", 
             "\"\< terms.\>\""}], "]"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"counter", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"restemp", "=", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{"$DebugInfoQ", ",", 
                RowBox[{
                 RowBox[{"counter", "=", 
                  RowBox[{"counter", "+", "1"}]}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"counter", ",", "10"}], "]"}], "===", "0"}], 
                   RowBox[{"(*", 
                    RowBox[{"||", 
                    RowBox[{"counter", "\[GreaterEqual]", "4180"}]}], "*)"}], 
                   ",", 
                   RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<We canonicalize term \>\"", ",", "counter", ",", 
                    "\"\< \>\"", ",", "#"}], "]"}], ";"}]}], "]"}], ";"}]}], 
               "]"}], ";", 
              RowBox[{"SameDummies", "@", 
               RowBox[{"ToCanonical", "@", 
                RowBox[{"ContractMetric", "[", "#", "]"}]}]}]}], ")"}], "&"}],
            ",", "restemp0"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", "Print", "}"}], ",", 
          RowBox[{
           RowBox[{"SortCovDsStop", "[", "cd", "]"}], ";"}]}], "]"}], ";"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Block", "[", 
         RowBox[{
          RowBox[{"{", "Print", "}"}], ",", 
          RowBox[{
           RowBox[{"Off", "[", 
            StyleBox[
             RowBox[{"Unset", "::", "norep"}], "MessageName"], "]"}], ";", 
           RowBox[{"SortCovDsStop", "[", "cd", "]"}], ";", 
           RowBox[{"On", "[", 
            StyleBox[
             RowBox[{"Unset", "::", "norep"}], "MessageName"], "]"}], ";"}]}],
          "]"}], ";", 
        RowBox[{"restemp", "=", "res"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Entering", " ", "the", " ", "Cov", " ", "Ds", " ", "sorting", " ", 
        "defined", " ", "by", " ", 
        RowBox[{"BackgroundSLicing", ".", " ", "Made"}], " ", "to", " ", 
        "gather", " ", "the", " ", "Laplacian", " ", "near", " ", "the", " ", 
        "perturbations"}], ",", " ", 
       RowBox[{
       "and", " ", "to", " ", "use", " ", "the", " ", "transversailty", " ", 
        RowBox[{"conditions", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"$DebugInfoQ", ",", 
       RowBox[{
        RowBox[{
        "Print", "[", "\"\<Entering the commutation of Cov Ds...\>\"", "]"}], 
        ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"counter", "=", "0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{"FixedPoint", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"counter", "=", 
            RowBox[{"counter", "+", "1"}]}], ";", 
           RowBox[{"If", "[", 
            RowBox[{"$DebugInfoQ", ",", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<We commute the Cov Ds for the \>\"", ",", "counter", ",", 
                "\"\< time.\>\""}], "]"}], ";"}]}], "]"}], ";", 
           RowBox[{"SameDummies", "@", 
            RowBox[{"ToCanonical", "@", 
             RowBox[{"ContractMetric", "[", 
              RowBox[{"#", "/.", "$CommutecdRules"}], "]"}]}]}]}], ")"}], 
         "&"}], ",", "restemp", ",", "10"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"$DebugInfoQ", ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<Induced Derivatives were commuted \>\"", ",", "counter", ",", 
          "\"\< times\>\""}], "]"}], ";"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"counter", "\[GreaterEqual]", "9"}], ",", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<** Warning, the induced derivatives are commuting endlessly. \
Stopped after 10 iterations to avoid an infinite loop. This is anormal \
behaviour. **\>\"", "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "res"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5628524165579147`*^9, 3.562852459950708*^9}, {
   3.562852521469261*^9, 3.562852716531543*^9}, {3.56285280270122*^9, 
   3.5628528241763678`*^9}, {3.562852860319392*^9, 3.562852862885676*^9}, 
   3.562852938643854*^9, {3.5628550064183807`*^9, 3.562855008280697*^9}, {
   3.562855305300766*^9, 3.562855307458774*^9}, {3.562855342680915*^9, 
   3.5628553580230713`*^9}, {3.562855395816695*^9, 3.562855493312042*^9}, {
   3.562855672128683*^9, 3.562855674947558*^9}, {3.562855705979685*^9, 
   3.562855745215382*^9}, {3.562855834479697*^9, 3.562855919374391*^9}, {
   3.5628559495462418`*^9, 3.562855959830159*^9}, {3.562855994817829*^9, 
   3.562855996410336*^9}, {3.562856058532906*^9, 3.562856067561316*^9}, {
   3.562856348795816*^9, 3.562856376930189*^9}, {3.562856487634591*^9, 
   3.562856506950039*^9}, {3.562856591515787*^9, 3.5628566179728947`*^9}, {
   3.562856655843794*^9, 3.5628569562560663`*^9}, {3.562857042568256*^9, 
   3.562857051786644*^9}, {3.562857087518365*^9, 3.562857089046356*^9}, {
   3.562867655603628*^9, 3.5628676772981367`*^9}, {3.562867718201264*^9, 
   3.562867810778425*^9}, {3.562867854593412*^9, 3.5628678572974443`*^9}, {
   3.562867928969345*^9, 3.562867991038229*^9}, {3.56286812187549*^9, 
   3.562868124171238*^9}, {3.562868181782991*^9, 3.562868197073942*^9}, {
   3.5628682339102583`*^9, 3.56286828737857*^9}, {3.562868523966084*^9, 
   3.56286857646734*^9}, {3.5628686484223747`*^9, 3.5628686733326*^9}, {
   3.56286879167104*^9, 3.562868800068625*^9}, 3.562905106610783*^9, {
   3.5629051681795187`*^9, 3.562905270867152*^9}, {3.562905305987751*^9, 
   3.5629053445984917`*^9}, {3.562905401394644*^9, 3.562905405537713*^9}, {
   3.562905521835458*^9, 3.562905558824545*^9}, {3.562905647462377*^9, 
   3.5629056561568747`*^9}, {3.5629056887035627`*^9, 3.562905770047553*^9}, {
   3.56290582238654*^9, 3.5629058470903177`*^9}, {3.562905885852364*^9, 
   3.562905890754026*^9}, {3.562905922251334*^9, 3.562905926017475*^9}, {
   3.562905961906399*^9, 3.5629059945219584`*^9}, {3.5629060767069902`*^9, 
   3.5629060941011868`*^9}, {3.56290628925358*^9, 3.562906363768013*^9}, {
   3.562906449134036*^9, 3.562906458460319*^9}, {3.562906716915649*^9, 
   3.562906814550714*^9}, {3.5629072466911173`*^9, 3.5629072499368887`*^9}, {
   3.562907296693408*^9, 3.56290735717111*^9}, {3.5629073908139277`*^9, 
   3.562907552288406*^9}, {3.562907679624529*^9, 3.562907726089517*^9}, {
   3.5629077582714443`*^9, 3.56290778488559*^9}, 3.562907824510667*^9, {
   3.5629078754580812`*^9, 3.562907879150251*^9}, {3.562910344880671*^9, 
   3.562910456180378*^9}, {3.5629107876561213`*^9, 3.562910829754397*^9}, {
   3.5629108978791847`*^9, 3.5629109044897957`*^9}, {3.562910992036852*^9, 
   3.5629109943906918`*^9}, {3.562911029742922*^9, 3.562911160032372*^9}, {
   3.562911211684855*^9, 3.562911425541544*^9}, {3.562911473222527*^9, 
   3.562911489897435*^9}, {3.5629116175219*^9, 3.56291163359575*^9}, {
   3.562911970475092*^9, 3.562911980575223*^9}, {3.562912796667245*^9, 
   3.562912805809779*^9}, {3.5629179948384867`*^9, 3.562917997666113*^9}, {
   3.562918114966703*^9, 3.5629181219821873`*^9}, {3.562918200073524*^9, 
   3.562918201762773*^9}, {3.562923876020924*^9, 3.5629238864679327`*^9}, 
   3.5629241323293257`*^9, {3.5629241686607847`*^9, 3.562924187563471*^9}, {
   3.5629242566247807`*^9, 3.5629242648042707`*^9}, {3.562924304523918*^9, 
   3.5629243176692247`*^9}, {3.5629244006988077`*^9, 
   3.5629244070473957`*^9}, {3.562924628853231*^9, 3.56292466729364*^9}, {
   3.562924765372452*^9, 3.562924782199082*^9}, {3.562925495993284*^9, 
   3.5629255470866203`*^9}, {3.56292558367142*^9, 3.562925583867325*^9}, {
   3.562925621526841*^9, 3.5629256225673447`*^9}, {3.562925815581368*^9, 
   3.5629258251963463`*^9}, {3.562926633820242*^9, 3.56292666242437*^9}, {
   3.562926941914639*^9, 3.562926947042026*^9}, {3.562927069789877*^9, 
   3.562927090235753*^9}, {3.562927277521556*^9, 3.562927277659165*^9}, {
   3.56292730824395*^9, 3.5629273601916656`*^9}, {3.5629274109709063`*^9, 
   3.562927421720168*^9}, {3.56292907257882*^9, 3.5629290854466343`*^9}, {
   3.5629293492026787`*^9, 3.562929374835043*^9}, {3.562929485075652*^9, 
   3.562929485669655*^9}, {3.5629295827465343`*^9, 3.562929590849304*^9}, 
   3.5629357262366447`*^9, {3.56293600824209*^9, 3.562936071104042*^9}, {
   3.5629361067281637`*^9, 3.562936108685486*^9}, {3.56293626746994*^9, 
   3.562936293576869*^9}, {3.562937109345849*^9, 3.562937168901948*^9}, {
   3.562937360942108*^9, 3.562937363687628*^9}, {3.562937448950692*^9, 
   3.562937473050267*^9}, {3.562937856650069*^9, 3.562937880675099*^9}, {
   3.562955592038746*^9, 3.5629555979518423`*^9}, {3.5629567832539473`*^9, 
   3.562956785098456*^9}, {3.562961587081999*^9, 3.562961605923909*^9}, {
   3.563069595207354*^9, 3.5630696339075603`*^9}, {3.563069819921566*^9, 
   3.56306982851803*^9}, {3.563095839025219*^9, 3.563095909774371*^9}, 
   3.5630982104938393`*^9, {3.563099541171316*^9, 3.563099579953062*^9}, {
   3.5631058477975063`*^9, 3.563105856547336*^9}, {3.5631260437318583`*^9, 
   3.563126067827273*^9}, {3.563133116377721*^9, 3.5631331176289263`*^9}, {
   3.563133582229692*^9, 3.563133594306888*^9}, {3.563137187097125*^9, 
   3.563137187362524*^9}, {3.563165902252475*^9, 3.5631659086299*^9}, {
   3.5631660783646393`*^9, 3.563166093787979*^9}, {3.5631894360325336`*^9, 
   3.563189472780759*^9}, {3.563191236279255*^9, 3.563191238551008*^9}, {
   3.563194499267851*^9, 3.5631945160858088`*^9}, {3.563194635872604*^9, 
   3.563194642505599*^9}, {3.5631947735228*^9, 3.563194807659112*^9}, {
   3.563194854307837*^9, 3.5631948586159763`*^9}, {3.563194896299491*^9, 
   3.563194921011524*^9}, {3.5631950936222897`*^9, 3.5631950941138277`*^9}, {
   3.563195182563718*^9, 3.563195188390386*^9}, {3.5631952489749327`*^9, 
   3.563195254338257*^9}, {3.563195691821329*^9, 3.563195791309004*^9}, {
   3.5631958475877333`*^9, 3.563195861083066*^9}, {3.5631961504524107`*^9, 
   3.563196151519375*^9}, {3.563196213905962*^9, 3.56319621706498*^9}, {
   3.563197014870224*^9, 3.563197022201551*^9}, {3.563197351713956*^9, 
   3.563197441455806*^9}, 3.5631975733458023`*^9, {3.563197737877398*^9, 
   3.563197749315443*^9}, {3.563199699379925*^9, 3.563199714913583*^9}, {
   3.563199762873644*^9, 3.5631997692957697`*^9}, {3.563199987568522*^9, 
   3.563200111278008*^9}, {3.563200206893519*^9, 3.563200290523624*^9}, {
   3.563249879628025*^9, 3.563249885007575*^9}, {3.56325080588892*^9, 
   3.5632508073426933`*^9}, {3.563250842625846*^9, 3.563250865881493*^9}, {
   3.563250951725938*^9, 3.563250980524789*^9}, {3.5632627923320007`*^9, 
   3.563262798863152*^9}, {3.563274133052644*^9, 3.563274163982911*^9}, {
   3.56327690794376*^9, 3.5632769436576757`*^9}, {3.563281601995462*^9, 
   3.5632816104426527`*^9}, 3.5635158836922827`*^9, {3.563516681980158*^9, 
   3.5635167486528254`*^9}, {3.563516827248497*^9, 3.563516897328389*^9}, {
   3.563607756864265*^9, 3.56360789590526*^9}, {3.563607926854671*^9, 
   3.5636079573137608`*^9}, {3.563608009974718*^9, 3.5636081462888603`*^9}, {
   3.563608228164453*^9, 3.563608273352408*^9}, 3.563610055145021*^9, {
   3.563610909297475*^9, 3.563610913014409*^9}, {3.5636109738618937`*^9, 
   3.563611017021298*^9}, {3.563616799130622*^9, 3.563616801456029*^9}, {
   3.563620420365302*^9, 3.563620423377379*^9}, {3.5636204795216637`*^9, 
   3.563620489791706*^9}, {3.5636206368410053`*^9, 3.563620637558693*^9}, {
   3.563620693298932*^9, 3.563620693972068*^9}, {3.563620755235409*^9, 
   3.563620761900063*^9}, {3.563621938982972*^9, 3.563621944245366*^9}, {
   3.5636225994889717`*^9, 3.563622604559595*^9}, {3.5637034838320227`*^9, 
   3.563703517275028*^9}, {3.563703604018244*^9, 3.56370361081754*^9}, {
   3.563704407413773*^9, 3.563704423622078*^9}, {3.563708529679536*^9, 
   3.563708575552445*^9}, {3.5637106323327303`*^9, 3.56371067858922*^9}, {
   3.563710777464366*^9, 3.5637107859869223`*^9}, {3.563737988742277*^9, 
   3.5637379904401703`*^9}, {3.5644765055506287`*^9, 3.564476546009198*^9}, {
   3.5644765814857807`*^9, 3.5644765816663*^9}, {3.5644766871799994`*^9, 
   3.564476695433463*^9}, {3.565436688345557*^9, 3.565436695643126*^9}, {
   3.56543705932824*^9, 3.56543706241569*^9}, {3.565437388662547*^9, 
   3.565437414212736*^9}, {3.565437461953534*^9, 3.565437469710787*^9}, {
   3.5654382347160597`*^9, 3.565438235805737*^9}, {3.565445452270911*^9, 
   3.565445458377383*^9}, {3.565447351105071*^9, 3.565447369598137*^9}, {
   3.565447401866866*^9, 3.5654474194872637`*^9}, {3.565453032478733*^9, 
   3.5654530519790688`*^9}, {3.565453502725585*^9, 3.565453504437155*^9}, {
   3.565455131765129*^9, 3.565455225867777*^9}, {3.5654552722846403`*^9, 
   3.5654553006493473`*^9}, {3.565456774440423*^9, 3.565456785622487*^9}, {
   3.565457403425869*^9, 3.565457413163961*^9}, {3.565458760489118*^9, 
   3.565458774266775*^9}, {3.565458969659021*^9, 3.565459007187608*^9}, {
   3.565459421305068*^9, 3.565459689454562*^9}, {3.565459898137168*^9, 
   3.565459900885171*^9}, {3.565460129954775*^9, 3.565460130321514*^9}, {
   3.565491647803761*^9, 3.565491705490391*^9}, {3.565492268054426*^9, 
   3.5654922771045094`*^9}, {3.565497192181058*^9, 3.5654971996493473`*^9}, {
   3.5655158670044518`*^9, 3.565515869746286*^9}, {3.565515926263752*^9, 
   3.56551598324181*^9}, {3.565516156232039*^9, 3.565516174979731*^9}, {
   3.565516735644949*^9, 3.565516840552009*^9}, {3.565516874150134*^9, 
   3.565516879271202*^9}, {3.5655170598304358`*^9, 3.565517064314942*^9}, {
   3.565517725299468*^9, 3.565517725396893*^9}, {3.565517980514011*^9, 
   3.565518013203237*^9}, {3.5655182615139627`*^9, 3.565518281846521*^9}, {
   3.565518651501793*^9, 3.5655186628305063`*^9}, {3.565518829070312*^9, 
   3.565518898062907*^9}, {3.5655221028155937`*^9, 3.5655221115703707`*^9}, {
   3.5655225152329407`*^9, 3.565522517616886*^9}, {3.568187241426408*^9, 
   3.568187247181405*^9}, {3.5681873579731903`*^9, 3.568187358078114*^9}, {
   3.5681877993318853`*^9, 3.568187799561626*^9}, {3.568187868057835*^9, 
   3.568187869596208*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SplitCovDs", "[", 
    RowBox[{"expr_", ",", "CD_", ",", "cd_"}], "]"}], ":=", 
   RowBox[{"FixedPoint", "[", 
    RowBox[{
     RowBox[{"FixedPoint", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"GradNormalToExtrinsicK", "[", "#", "]"}], "&"}], ",", 
       RowBox[{
        RowBox[{"ToInducedDerivative", "[", 
         RowBox[{"#", ",", "CD", ",", "cd"}], "]"}], "&"}]}], "]"}], ",", 
     "expr"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5628524165579147`*^9, 3.562852459950708*^9}, {
   3.562852521469261*^9, 3.562852716531543*^9}, {3.56285280270122*^9, 
   3.5628528241763678`*^9}, {3.562852860319392*^9, 3.562852862885676*^9}, 
   3.562852938643854*^9, {3.5628550064183807`*^9, 3.562855008280697*^9}, {
   3.562855305300766*^9, 3.562855307458774*^9}, {3.562855342680915*^9, 
   3.5628553580230713`*^9}, {3.562855395816695*^9, 3.562855493312042*^9}, {
   3.562855672128683*^9, 3.562855674947558*^9}, {3.562855705979685*^9, 
   3.562855745215382*^9}, {3.562855834479697*^9, 3.562855919374391*^9}, {
   3.5628559495462418`*^9, 3.562855959830159*^9}, {3.562855994817829*^9, 
   3.562855996410336*^9}, {3.562856058532906*^9, 3.562856067561316*^9}, {
   3.562856348795816*^9, 3.562856376930189*^9}, {3.562856487634591*^9, 
   3.562856506950039*^9}, {3.562856591515787*^9, 3.5628566179728947`*^9}, {
   3.562856655843794*^9, 3.5628569562560663`*^9}, {3.562857042568256*^9, 
   3.562857051786644*^9}, {3.562857087518365*^9, 3.562857089046356*^9}, {
   3.562867655603628*^9, 3.5628676772981367`*^9}, {3.562867718201264*^9, 
   3.562867810778425*^9}, {3.562867854593412*^9, 3.5628678572974443`*^9}, {
   3.562867928969345*^9, 3.562867991038229*^9}, {3.56286812187549*^9, 
   3.562868124171238*^9}, {3.562868181782991*^9, 3.562868197073942*^9}, {
   3.5628682339102583`*^9, 3.56286828737857*^9}, {3.562868523966084*^9, 
   3.56286857646734*^9}, {3.5628686484223747`*^9, 3.5628686733326*^9}, {
   3.56286879167104*^9, 3.562868800068625*^9}, 3.562905106610783*^9, {
   3.5629051681795187`*^9, 3.562905270867152*^9}, {3.562905305987751*^9, 
   3.5629053445984917`*^9}, {3.562905401394644*^9, 3.562905405537713*^9}, {
   3.562905521835458*^9, 3.562905558824545*^9}, {3.562905647462377*^9, 
   3.5629056561568747`*^9}, {3.5629056887035627`*^9, 3.562905770047553*^9}, {
   3.56290582238654*^9, 3.5629058470903177`*^9}, {3.562905885852364*^9, 
   3.562905890754026*^9}, {3.562905922251334*^9, 3.562905926017475*^9}, {
   3.562905961906399*^9, 3.5629059945219584`*^9}, {3.5629060767069902`*^9, 
   3.5629060941011868`*^9}, {3.56290628925358*^9, 3.562906363768013*^9}, {
   3.562906449134036*^9, 3.562906458460319*^9}, {3.562906716915649*^9, 
   3.562906814550714*^9}, {3.5629072466911173`*^9, 3.5629072499368887`*^9}, {
   3.562907296693408*^9, 3.56290735717111*^9}, {3.5629073908139277`*^9, 
   3.562907552288406*^9}, {3.562907679624529*^9, 3.562907726089517*^9}, {
   3.5629077582714443`*^9, 3.56290778488559*^9}, 3.562907824510667*^9, {
   3.5629078754580812`*^9, 3.562907879150251*^9}, {3.562910344880671*^9, 
   3.562910456180378*^9}, {3.5629107876561213`*^9, 3.562910829754397*^9}, {
   3.5629108978791847`*^9, 3.5629109044897957`*^9}, {3.562910992036852*^9, 
   3.5629109943906918`*^9}, {3.562911029742922*^9, 3.562911160032372*^9}, {
   3.562911211684855*^9, 3.562911425541544*^9}, {3.562911473222527*^9, 
   3.562911489897435*^9}, {3.5629116175219*^9, 3.56291163359575*^9}, {
   3.562911970475092*^9, 3.562911980575223*^9}, {3.562912796667245*^9, 
   3.562912805809779*^9}, {3.5629179948384867`*^9, 3.562917997666113*^9}, {
   3.562918114966703*^9, 3.5629181219821873`*^9}, {3.562918200073524*^9, 
   3.562918201762773*^9}, {3.562923876020924*^9, 3.5629238864679327`*^9}, 
   3.5629241323293257`*^9, {3.5629241686607847`*^9, 3.562924187563471*^9}, {
   3.5629242566247807`*^9, 3.5629242648042707`*^9}, {3.562924304523918*^9, 
   3.5629243176692247`*^9}, {3.5629244006988077`*^9, 
   3.5629244070473957`*^9}, {3.562924628853231*^9, 3.56292466729364*^9}, {
   3.562924765372452*^9, 3.562924782199082*^9}, {3.562925495993284*^9, 
   3.5629255470866203`*^9}, {3.56292558367142*^9, 3.562925583867325*^9}, {
   3.562925621526841*^9, 3.5629256225673447`*^9}, {3.562925815581368*^9, 
   3.5629258251963463`*^9}, {3.562926633820242*^9, 3.56292666242437*^9}, {
   3.562926941914639*^9, 3.562926947042026*^9}, {3.562927069789877*^9, 
   3.562927090235753*^9}, {3.562927277521556*^9, 3.562927277659165*^9}, {
   3.56292730824395*^9, 3.5629273601916656`*^9}, {3.5629274109709063`*^9, 
   3.562927421720168*^9}, {3.56292907257882*^9, 3.5629290854466343`*^9}, {
   3.5629293492026787`*^9, 3.562929374835043*^9}, {3.562929485075652*^9, 
   3.562929485669655*^9}, {3.5629295827465343`*^9, 3.562929590849304*^9}, 
   3.5629357262366447`*^9, {3.56293600824209*^9, 3.562936071104042*^9}, {
   3.5629361067281637`*^9, 3.562936108685486*^9}, {3.56293626746994*^9, 
   3.562936293576869*^9}, {3.562937109345849*^9, 3.562937168901948*^9}, {
   3.562937360942108*^9, 3.562937363687628*^9}, {3.562937448950692*^9, 
   3.562937473050267*^9}, {3.562937856650069*^9, 3.562937880675099*^9}, {
   3.562955592038746*^9, 3.5629555979518423`*^9}, {3.5629567832539473`*^9, 
   3.562956785098456*^9}, {3.562961587081999*^9, 3.562961605923909*^9}, {
   3.563069595207354*^9, 3.5630696339075603`*^9}, {3.563069819921566*^9, 
   3.56306982851803*^9}, {3.563095839025219*^9, 3.563095909774371*^9}, 
   3.5630982104938393`*^9, {3.563099541171316*^9, 3.563099579953062*^9}, {
   3.5631058477975063`*^9, 3.563105856547336*^9}, {3.5631260437318583`*^9, 
   3.563126067827273*^9}, {3.563133116377721*^9, 3.5631331176289263`*^9}, {
   3.563133582229692*^9, 3.563133594306888*^9}, {3.563137187097125*^9, 
   3.563137187362524*^9}, {3.563165902252475*^9, 3.5631659086299*^9}, {
   3.5631660783646393`*^9, 3.563166093787979*^9}, {3.5631894360325336`*^9, 
   3.563189472780759*^9}, {3.563191236279255*^9, 3.563191238551008*^9}, {
   3.563194499267851*^9, 3.5631945160858088`*^9}, {3.563194635872604*^9, 
   3.563194642505599*^9}, {3.5631947735228*^9, 3.563194807659112*^9}, {
   3.563194854307837*^9, 3.5631948586159763`*^9}, {3.563194896299491*^9, 
   3.563194921011524*^9}, {3.5631950936222897`*^9, 3.5631950941138277`*^9}, {
   3.563195182563718*^9, 3.563195188390386*^9}, {3.5631952489749327`*^9, 
   3.563195254338257*^9}, {3.563195691821329*^9, 3.563195791309004*^9}, {
   3.5631958475877333`*^9, 3.563195861083066*^9}, {3.5631961504524107`*^9, 
   3.563196151519375*^9}, {3.563196213905962*^9, 3.56319621706498*^9}, {
   3.563197014870224*^9, 3.563197022201551*^9}, {3.563197351713956*^9, 
   3.563197441455806*^9}, 3.5631975733458023`*^9, {3.563197737877398*^9, 
   3.563197749315443*^9}, {3.563199699379925*^9, 3.563199714913583*^9}, {
   3.563199762873644*^9, 3.5631997692957697`*^9}, {3.563199987568522*^9, 
   3.563200111278008*^9}, {3.563200206893519*^9, 3.563200290523624*^9}, {
   3.563249879628025*^9, 3.563249885007575*^9}, {3.56325080588892*^9, 
   3.5632508073426933`*^9}, {3.563250842625846*^9, 3.563250865881493*^9}, {
   3.563250951725938*^9, 3.563250980524789*^9}, {3.5632627923320007`*^9, 
   3.563262798863152*^9}, {3.563274133052644*^9, 3.563274163982911*^9}, {
   3.56327690794376*^9, 3.5632769436576757`*^9}, {3.563281601995462*^9, 
   3.5632816104426527`*^9}, 3.5635158836922827`*^9, {3.563516681980158*^9, 
   3.5635167486528254`*^9}, {3.563516827248497*^9, 3.563516897328389*^9}, {
   3.563607756864265*^9, 3.56360789590526*^9}, {3.563607926854671*^9, 
   3.5636079573137608`*^9}, {3.563608009974718*^9, 3.5636081462888603`*^9}, {
   3.563608228164453*^9, 3.563608273352408*^9}, 3.563610055145021*^9, {
   3.563610909297475*^9, 3.563610913014409*^9}, {3.5636109738618937`*^9, 
   3.563611017021298*^9}, {3.563616799130622*^9, 3.563616801456029*^9}, {
   3.563620420365302*^9, 3.563620423377379*^9}, {3.5636204795216637`*^9, 
   3.563620489791706*^9}, {3.5636206368410053`*^9, 3.563620637558693*^9}, {
   3.563620693298932*^9, 3.563620693972068*^9}, {3.563620755235409*^9, 
   3.563620761900063*^9}, {3.563621938982972*^9, 3.563621944245366*^9}, {
   3.5636225994889717`*^9, 3.563622604559595*^9}, {3.5637034838320227`*^9, 
   3.563703517275028*^9}, {3.563703604018244*^9, 3.56370361081754*^9}, {
   3.563704407413773*^9, 3.563704423622078*^9}, {3.563708529679536*^9, 
   3.563708575552445*^9}, {3.5637106323327303`*^9, 3.56371067858922*^9}, {
   3.563710777464366*^9, 3.5637107859869223`*^9}, {3.563737988742277*^9, 
   3.563738000157528*^9}}],

Cell["\<\
The function which splits an expression, given some rules chosen the user, by \
splitting essentially all the Covariant derivative which appear in this \
expression.\
\>", "Text",
 CellChangeTimes->{{3.5637419648644876`*^9, 3.563742022014234*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CheckSTFTensors", "[", 
     RowBox[{"expr_", ",", "h_", ",", "exceptlist_List"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "tens", "}"}], ",", 
      RowBox[{
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"listpb", "=", 
           RowBox[{"Cases", "[", 
            RowBox[{
             RowBox[{"Expand", "@", "expr"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"tens_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"And", "@@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Function", "[", 
                    RowBox[{"t", ",", 
                    RowBox[{"t", "=!=", "#"}]}], "]"}], "/@", "exceptlist"}], 
                    ")"}]}], ")"}], "&&", 
                   RowBox[{"xTensorQ", "[", "#", "]"}], "&&", 
                   RowBox[{"Not", "@", 
                    RowBox[{"DefProjectedTensorQ", "[", 
                    RowBox[{"#", ",", "h"}], "]"}]}]}], "&"}], ")"}]}], "[", 
               "inds___", "]"}], "\[Rule]", "tens"}], ",", "Infinity"}], 
            "]"}]}], "}"}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<** Warning: the tensor \>\"", ",", "#", ",", 
             "\"\< was not defined with DefProjectedTensor. The rules \
necessary for its splitting were thus not defined. **\>\""}], "]"}], "&"}], "/@", 
          RowBox[{"(", 
           RowBox[{"DeleteDuplicates", "@", "listpb"}], ")"}]}]}], "]"}], 
       ";"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Warning", " ", "message", " ", "to", " ", "update"}], " ", 
    "\[Rule]", " ", 
    RowBox[{
    "the", " ", "slicing", " ", "should", " ", "be", " ", "taken", " ", 
     "into", " ", 
     RowBox[{"account", "."}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"CheckSTFTensors", "[", 
     RowBox[{"expr_", ",", "h_"}], "]"}], ":=", 
    RowBox[{"CheckSTFTensors", "[", 
     RowBox[{"expr", ",", "h", ",", 
      RowBox[{"{", "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"SplitPerturbationsOld", "[", 
      RowBox[{"expr_", ",", "ListPairs_List", ",", 
       RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"res", ",", "restemp", ",", "restemp2", ",", "resfinal"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"g", "=", 
            RowBox[{"First", "@", 
             RowBox[{"InducedFrom", "@", "h"}]}]}], ",", 
           RowBox[{"u", "=", 
            RowBox[{"Last", "@", 
             RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CD", "=", 
              RowBox[{"CovDOfMetric", "[", "g", "]"}]}], ",", 
             RowBox[{"cd", "=", 
              RowBox[{"CovDOfMetric", "[", "h", "]"}]}], ",", 
             RowBox[{"rules", "=", 
              RowBox[{"Flatten", "@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"RulesSplitCovDsOfTensor", "[", 
                   RowBox[{"expr", ",", "#", ",", "h"}], "]"}], "&"}], "/@", 
                 "ListPairs"}], ")"}]}]}]}], "}"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"res", "=", 
             RowBox[{
             "AbsoluteTiming", "[", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"restemp", "=", 
                RowBox[{"IndicesDown", "[", 
                 RowBox[{"Identity", "[", 
                  RowBox[{"org", "[", 
                   RowBox[{
                    RowBox[{"(", "expr", ")"}], "//", "ProjectorToMetric"}], 
                   "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"restemp2", " ", "=", " ", 
                RowBox[{"FixedPoint", "[", 
                 RowBox[{"GradNormalToExtrinsicK", ",", 
                  RowBox[{
                   RowBox[{"SplitCovDs", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"restemp", "//.", "rules"}], "//.", "$MyRules"}], 
                    ")"}], ",", "CD", ",", "cd"}], "]"}], "//", 
                   RowBox[{
                    RowBox[{"GaussCodazzi", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"org", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"org", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"restemp2", "/.", "BackgroundFieldRule"}], ")"}], 
                    "/.", 
                    RowBox[{
                    RowBox[{"Projector", "[", "h", "]"}], "\[Rule]", 
                    RowBox[{"ProjectWith", "[", "h", "]"}]}]}], "]"}], "//", 
                    RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], "//", 
                   RowBox[{
                    RowBox[{"CommuteCDSafe", "[", 
                    RowBox[{"#", ",", "cd"}], "]"}], "&"}]}], ")"}], "/.", 
                 RowBox[{"ConstantsDecompositionRules", "[", "h", "]"}]}], 
                "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"CheckSTFTensors", "[", 
             RowBox[{"res", ",", "h", ",", 
              RowBox[{"{", 
               RowBox[{"g", ",", "u", ",", 
                RowBox[{"Riemann", "[", "cd", "]"}], ",", 
                RowBox[{"Ricci", "[", "cd", "]"}], ",", 
                RowBox[{"RicciScalar", "[", "cd", "]"}], ",", "h", ",", 
                RowBox[{"CS", "[", "h", "]"}], ",", 
                RowBox[{"nt", "[", "h", "]"}], ",", 
                RowBox[{"av", "[", "h", "]"}], ",", 
                RowBox[{"\[ScriptK]", "[", "h", "]"}], ",", "delta", ",", 
                RowBox[{"epsilon", "[", "h", "]"}], ",", 
                RowBox[{"epsilon", "[", "g", "]"}]}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"$DefInfoQ", ",", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<The Splitting of \>\"", ",", 
                 RowBox[{"Take", "[", 
                  RowBox[{"expr", ",", "1"}], "]"}], ",", 
                 "\"\< +... was performed in \>\"", ",", 
                 RowBox[{"First", "@", "res"}], " ", ",", 
                 "\"\< seconds.\>\""}], "]"}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"resfinal", "=", 
             RowBox[{"ScreenDollarIndices", "@", 
              RowBox[{"collect", "@", 
               RowBox[{"(*", 
                RowBox[{"ToCanonical", "@", 
                 RowBox[{"ContractMetric", "@"}]}], "*)"}], 
               RowBox[{"NoScalar", "[", 
                RowBox[{"Last", "@", "res"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"$SortCovDAutomatic", ",", 
              RowBox[{
               RowBox[{"Off", "[", 
                StyleBox[
                 RowBox[{"Unset", "::", "norep"}], "MessageName"], "]"}], ";", 
               RowBox[{"Block", "[", 
                RowBox[{
                 RowBox[{"{", "Print", "}"}], ",", 
                 RowBox[{"SortCovDsStop", "[", "cd", "]"}]}], "]"}], ";", 
               RowBox[{"On", "[", 
                StyleBox[
                 RowBox[{"Unset", "::", "norep"}], "MessageName"], "]"}], 
               ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "resfinal"}]}], "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "*)"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5628524165579147`*^9, 3.562852459950708*^9}, {
   3.562852521469261*^9, 3.562852716531543*^9}, {3.56285280270122*^9, 
   3.5628528241763678`*^9}, {3.562852860319392*^9, 3.562852862885676*^9}, 
   3.562852938643854*^9, {3.5628550064183807`*^9, 3.562855008280697*^9}, {
   3.562855305300766*^9, 3.562855307458774*^9}, {3.562855342680915*^9, 
   3.5628553580230713`*^9}, {3.562855395816695*^9, 3.562855493312042*^9}, {
   3.562855672128683*^9, 3.562855674947558*^9}, {3.562855705979685*^9, 
   3.562855745215382*^9}, {3.562855834479697*^9, 3.562855919374391*^9}, {
   3.5628559495462418`*^9, 3.562855959830159*^9}, {3.562855994817829*^9, 
   3.562855996410336*^9}, {3.562856058532906*^9, 3.562856067561316*^9}, {
   3.562856348795816*^9, 3.562856376930189*^9}, {3.562856487634591*^9, 
   3.562856506950039*^9}, {3.562856591515787*^9, 3.5628566179728947`*^9}, {
   3.562856655843794*^9, 3.5628569562560663`*^9}, {3.562857042568256*^9, 
   3.562857051786644*^9}, {3.562857087518365*^9, 3.562857089046356*^9}, {
   3.562867655603628*^9, 3.5628676772981367`*^9}, {3.562867718201264*^9, 
   3.562867810778425*^9}, {3.562867854593412*^9, 3.5628678572974443`*^9}, {
   3.562867928969345*^9, 3.562867991038229*^9}, {3.56286812187549*^9, 
   3.562868124171238*^9}, {3.562868181782991*^9, 3.562868197073942*^9}, {
   3.5628682339102583`*^9, 3.56286828737857*^9}, {3.562868523966084*^9, 
   3.56286857646734*^9}, {3.5628686484223747`*^9, 3.5628686733326*^9}, {
   3.56286879167104*^9, 3.562868800068625*^9}, 3.562905106610783*^9, {
   3.5629051681795187`*^9, 3.562905270867152*^9}, {3.562905305987751*^9, 
   3.5629053445984917`*^9}, {3.562905401394644*^9, 3.562905405537713*^9}, {
   3.562905521835458*^9, 3.562905558824545*^9}, {3.562905647462377*^9, 
   3.5629056561568747`*^9}, {3.5629056887035627`*^9, 3.562905770047553*^9}, {
   3.56290582238654*^9, 3.5629058470903177`*^9}, {3.562905885852364*^9, 
   3.562905890754026*^9}, {3.562905922251334*^9, 3.562905926017475*^9}, {
   3.562905961906399*^9, 3.5629059945219584`*^9}, {3.5629060767069902`*^9, 
   3.5629060941011868`*^9}, {3.56290628925358*^9, 3.562906363768013*^9}, {
   3.562906449134036*^9, 3.562906458460319*^9}, {3.562906716915649*^9, 
   3.562906814550714*^9}, {3.5629072466911173`*^9, 3.5629072499368887`*^9}, {
   3.562907296693408*^9, 3.56290735717111*^9}, {3.5629073908139277`*^9, 
   3.562907552288406*^9}, {3.562907679624529*^9, 3.562907726089517*^9}, {
   3.5629077582714443`*^9, 3.56290778488559*^9}, 3.562907824510667*^9, {
   3.5629078754580812`*^9, 3.562907879150251*^9}, {3.562910344880671*^9, 
   3.562910456180378*^9}, {3.5629107876561213`*^9, 3.562910829754397*^9}, {
   3.5629108978791847`*^9, 3.5629109044897957`*^9}, {3.562910992036852*^9, 
   3.5629109943906918`*^9}, {3.562911029742922*^9, 3.562911160032372*^9}, {
   3.562911211684855*^9, 3.562911425541544*^9}, {3.562911473222527*^9, 
   3.562911489897435*^9}, {3.5629116175219*^9, 3.56291163359575*^9}, {
   3.562911970475092*^9, 3.562911980575223*^9}, {3.562912796667245*^9, 
   3.562912805809779*^9}, {3.5629179948384867`*^9, 3.562917997666113*^9}, {
   3.562918114966703*^9, 3.5629181219821873`*^9}, {3.562918200073524*^9, 
   3.562918201762773*^9}, {3.562923876020924*^9, 3.5629238864679327`*^9}, 
   3.5629241323293257`*^9, {3.5629241686607847`*^9, 3.562924187563471*^9}, {
   3.5629242566247807`*^9, 3.5629242648042707`*^9}, {3.562924304523918*^9, 
   3.5629243176692247`*^9}, {3.5629244006988077`*^9, 
   3.5629244070473957`*^9}, {3.562924628853231*^9, 3.56292466729364*^9}, {
   3.562924765372452*^9, 3.562924782199082*^9}, {3.562925495993284*^9, 
   3.5629255470866203`*^9}, {3.56292558367142*^9, 3.562925583867325*^9}, {
   3.562925621526841*^9, 3.5629256225673447`*^9}, {3.562925815581368*^9, 
   3.5629258251963463`*^9}, {3.562926633820242*^9, 3.56292666242437*^9}, {
   3.562926941914639*^9, 3.562926947042026*^9}, {3.562927069789877*^9, 
   3.562927090235753*^9}, {3.562927277521556*^9, 3.562927277659165*^9}, {
   3.56292730824395*^9, 3.5629273601916656`*^9}, {3.5629274109709063`*^9, 
   3.562927421720168*^9}, {3.56292907257882*^9, 3.5629290854466343`*^9}, {
   3.5629293492026787`*^9, 3.562929374835043*^9}, {3.562929485075652*^9, 
   3.562929485669655*^9}, {3.5629295827465343`*^9, 3.562929590849304*^9}, 
   3.5629357262366447`*^9, {3.56293600824209*^9, 3.562936071104042*^9}, {
   3.5629361067281637`*^9, 3.562936108685486*^9}, {3.56293626746994*^9, 
   3.562936293576869*^9}, {3.562937109345849*^9, 3.562937168901948*^9}, {
   3.562937360942108*^9, 3.562937363687628*^9}, {3.562937448950692*^9, 
   3.562937473050267*^9}, {3.562937856650069*^9, 3.562937880675099*^9}, {
   3.562955592038746*^9, 3.5629555979518423`*^9}, {3.5629567832539473`*^9, 
   3.562956785098456*^9}, {3.562961587081999*^9, 3.562961605923909*^9}, {
   3.563069595207354*^9, 3.5630696339075603`*^9}, {3.563069819921566*^9, 
   3.56306982851803*^9}, {3.563095839025219*^9, 3.563095909774371*^9}, 
   3.5630982104938393`*^9, {3.563099541171316*^9, 3.563099579953062*^9}, {
   3.5631058477975063`*^9, 3.563105856547336*^9}, {3.5631260437318583`*^9, 
   3.563126067827273*^9}, {3.563133116377721*^9, 3.5631331176289263`*^9}, {
   3.563133582229692*^9, 3.563133594306888*^9}, {3.563137187097125*^9, 
   3.563137187362524*^9}, {3.563165902252475*^9, 3.5631659086299*^9}, {
   3.5631660783646393`*^9, 3.563166093787979*^9}, {3.5631894360325336`*^9, 
   3.563189472780759*^9}, {3.563191236279255*^9, 3.563191238551008*^9}, {
   3.563194499267851*^9, 3.5631945160858088`*^9}, {3.563194635872604*^9, 
   3.563194642505599*^9}, {3.5631947735228*^9, 3.563194807659112*^9}, {
   3.563194854307837*^9, 3.5631948586159763`*^9}, {3.563194896299491*^9, 
   3.563194921011524*^9}, {3.5631950936222897`*^9, 3.5631950941138277`*^9}, {
   3.563195182563718*^9, 3.563195188390386*^9}, {3.5631952489749327`*^9, 
   3.563195254338257*^9}, {3.563195691821329*^9, 3.563195791309004*^9}, {
   3.5631958475877333`*^9, 3.563195861083066*^9}, {3.5631961504524107`*^9, 
   3.563196151519375*^9}, {3.563196213905962*^9, 3.56319621706498*^9}, {
   3.563197014870224*^9, 3.563197022201551*^9}, {3.563197351713956*^9, 
   3.563197441455806*^9}, 3.5631975733458023`*^9, {3.563197737877398*^9, 
   3.563197749315443*^9}, {3.563199699379925*^9, 3.563199714913583*^9}, {
   3.563199762873644*^9, 3.5631997692957697`*^9}, {3.563199987568522*^9, 
   3.563200111278008*^9}, {3.563200206893519*^9, 3.563200290523624*^9}, {
   3.563249879628025*^9, 3.563249885007575*^9}, {3.56325080588892*^9, 
   3.5632508073426933`*^9}, {3.563250842625846*^9, 3.563250865881493*^9}, {
   3.563250951725938*^9, 3.563250980524789*^9}, {3.5632627923320007`*^9, 
   3.563262798863152*^9}, {3.563274133052644*^9, 3.563274163982911*^9}, {
   3.56327690794376*^9, 3.5632769436576757`*^9}, {3.563281601995462*^9, 
   3.5632816104426527`*^9}, 3.5635158836922827`*^9, {3.563516681980158*^9, 
   3.5635167486528254`*^9}, {3.563516827248497*^9, 3.563516897328389*^9}, {
   3.563607756864265*^9, 3.56360789590526*^9}, {3.563607926854671*^9, 
   3.5636079573137608`*^9}, {3.563608009974718*^9, 3.5636081462888603`*^9}, {
   3.563608228164453*^9, 3.563608273352408*^9}, 3.563610055145021*^9, {
   3.563610909297475*^9, 3.563610913014409*^9}, {3.5636109738618937`*^9, 
   3.563611017021298*^9}, {3.563616799130622*^9, 3.563616801456029*^9}, {
   3.563620420365302*^9, 3.563620423377379*^9}, {3.5636204795216637`*^9, 
   3.563620489791706*^9}, {3.5636206368410053`*^9, 3.563620637558693*^9}, {
   3.563620693298932*^9, 3.563620693972068*^9}, {3.563620755235409*^9, 
   3.563620761900063*^9}, {3.563621938982972*^9, 3.563621944245366*^9}, {
   3.5636225994889717`*^9, 3.563622604559595*^9}, {3.5637034838320227`*^9, 
   3.563703517275028*^9}, {3.563703604018244*^9, 3.56370361081754*^9}, {
   3.563704407413773*^9, 3.563704423622078*^9}, {3.563708529679536*^9, 
   3.563708575552445*^9}, {3.5637106323327303`*^9, 3.56371067858922*^9}, {
   3.563710777464366*^9, 3.5637107859869223`*^9}, {3.563737988742277*^9, 
   3.5637380234169893`*^9}, 3.563741872759575*^9, {3.5637796974798603`*^9, 
   3.56377971939081*^9}, {3.563780013485862*^9, 3.563780016771063*^9}, {
   3.563780649406559*^9, 3.563780660666103*^9}, {3.5637823073685513`*^9, 
   3.563782394600459*^9}, {3.563782428098522*^9, 3.563782472516926*^9}, {
   3.563782657447805*^9, 3.5637826655333157`*^9}, {3.563782728198793*^9, 
   3.563782749199848*^9}, {3.563783033149207*^9, 3.5637830575556917`*^9}, 
   3.563783093090589*^9, {3.563783220392363*^9, 3.5637832902887163`*^9}, {
   3.563783340806924*^9, 3.5637833734789047`*^9}, {3.563783404788663*^9, 
   3.5637834078011417`*^9}, {3.563784279741947*^9, 3.563784360672297*^9}, {
   3.563784413227977*^9, 3.563784574609989*^9}, {3.563784610935598*^9, 
   3.563784728656878*^9}, {3.563865849361137*^9, 3.5638658930829268`*^9}, {
   3.563878583202306*^9, 3.563878598667478*^9}, {3.563882558182786*^9, 
   3.563882561456833*^9}, {3.563882940433413*^9, 3.563882942297976*^9}, {
   3.563949547152444*^9, 3.563949573538637*^9}, {3.563949668772047*^9, 
   3.563949701982514*^9}, {3.563950032657592*^9, 3.5639500339034452`*^9}, {
   3.563950072150239*^9, 3.563950106410049*^9}, {3.564135012964959*^9, 
   3.564135014202598*^9}, {3.5641682715177813`*^9, 3.564168275626409*^9}, {
   3.5641717908115883`*^9, 3.564171821238686*^9}, {3.564406228516817*^9, 
   3.564406233308413*^9}, {3.5644062938021393`*^9, 3.564406347101707*^9}, {
   3.564406410818582*^9, 3.5644066117745123`*^9}, {3.5644066505309563`*^9, 
   3.5644066898373613`*^9}, {3.564406727803422*^9, 3.564406749234138*^9}, {
   3.564407015499415*^9, 3.564407023056334*^9}, 3.564407116372725*^9, {
   3.564407176323818*^9, 3.564407194906856*^9}, {3.5644072489057426`*^9, 
   3.564407250038659*^9}, 3.5644104915028152`*^9, {3.5644113527386208`*^9, 
   3.564411367797236*^9}, {3.56455434308645*^9, 3.564554359544191*^9}, {
   3.564555393133541*^9, 3.564555396258601*^9}, 3.564630841669621*^9, {
   3.564716425154224*^9, 3.5647164264576473`*^9}, 3.564717158482072*^9, {
   3.5647171890105886`*^9, 3.564717193179182*^9}, {3.5647190765572023`*^9, 
   3.564719085665038*^9}, {3.5647235301048307`*^9, 3.564723532080017*^9}, {
   3.564724006217435*^9, 3.5647240067829227`*^9}, {3.564726189950038*^9, 
   3.5647262004231586`*^9}, 3.564726508183153*^9, 3.5647558333664293`*^9, 
   3.564755904089076*^9, 3.564756026257552*^9, {3.565223213509671*^9, 
   3.5652232443734913`*^9}, {3.565453587039379*^9, 3.565453599834857*^9}, {
   3.5654551203799353`*^9, 3.565455122748302*^9}, {3.565458148513191*^9, 
   3.565458182077178*^9}, {3.567258478416439*^9, 3.5672584955555687`*^9}, {
   3.567258742753734*^9, 3.567258757124956*^9}, {3.567260800840177*^9, 
   3.567260822598619*^9}, 3.567488433197556*^9, {3.567496454823605*^9, 
   3.56749647204177*^9}, 3.568458169631958*^9, 3.569340498293494*^9, 
   3.5693407130204144`*^9, 3.569413608712461*^9, 3.569418939206543*^9, 
   3.569577891613662*^9, {3.569897857071744*^9, 3.569897859656307*^9}}],

Cell["\<\
Some other useful tools to implement the ' SplitPerturbations' function\
\>", "Text",
 CellChangeTimes->{{3.564719582488071*^9, 3.564719607551281*^9}, {
  3.564719673050034*^9, 3.564719674174384*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FullToInducedDerivative", "[", 
     RowBox[{"expr_", ",", "CD_", ",", "cd_"}], "]"}], ":=", 
    RowBox[{"FixedPoint", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"ToInducedDerivative", "[", 
           RowBox[{"#", ",", "CD", ",", "cd"}], "]"}], "//", 
          "ProjectorToMetric"}], "//", "GradNormalToExtrinsicK"}], ")"}], 
       "&"}], ",", "expr"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"PutDownCD", "[", 
     RowBox[{"expr_", ",", "supercd_", ",", "cd_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"indmetric", "=", 
        RowBox[{"MetricOfCovD", "[", "cd", "]"}]}], "}"}], ",", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"vector", "=", 
          RowBox[{"Last", "@", 
           RowBox[{"InducedFrom", "[", "indmetric", "]"}]}]}], "}"}], ",", 
        RowBox[{"expr", "/.", 
         RowBox[{
          RowBox[{
           RowBox[{"supercd", "[", "ind_", "]"}], "[", 
           RowBox[{"expr1", ":", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"_", "?", "xTensorQ"}], "[", "___", "]"}], "|", 
              RowBox[{
               RowBox[{"cd", "[", "_", "]"}], "[", "_", "]"}], "|", 
              RowBox[{
               RowBox[{"LieD", "[", "_", "]"}], "[", "_", "]"}]}], ")"}]}], 
           "]"}], "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"IndicesDown", "[", 
            RowBox[{
             RowBox[{"supercd", "[", "ind", "]"}], "[", "expr1", "]"}], "]"}],
            "/;", 
           RowBox[{
            RowBox[{"OrthogonalToVectorQ", "[", "vector", "]"}], "[", "expr1",
             "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FullToInducedDerivativeAndCDDown", "[", 
     RowBox[{"expr_", ",", "CD_", ",", "cd_"}], "]"}], ":=", 
    RowBox[{"FixedPoint", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"ToInducedDerivative", "[", 
           RowBox[{
            RowBox[{"PutDownCD", "[", 
             RowBox[{"#", ",", "CD", ",", "cd"}], "]"}], ",", "CD", ",", 
            "cd"}], "]"}], "//", "ProjectorToMetric"}], "//", 
         "GradNormalToExtrinsicK"}], ")"}], "&"}], ",", "expr"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContractMetricOutSideProjector", "[", 
    RowBox[{"expr_Plus", ",", "cd_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"ContractMetricOutSideProjector", "[", 
      RowBox[{"#", ",", "cd"}], "]"}], "&"}], "/@", "expr"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContractMetricOutSideProjector", "[", 
    RowBox[{
     RowBox[{"rest_.", " ", 
      RowBox[{
       RowBox[{"ih_", "?", "InertHeadQ"}], "[", "inside_", "]"}]}], ",", 
     "cd_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"ContractMetric", "[", "rest", "]"}], 
    RowBox[{"ih", "[", "inside", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContractMetricOutSideProjector", "[", 
    RowBox[{
     RowBox[{"rest_.", "  ", 
      RowBox[{
       RowBox[{"LieD", "[", "u_", "]"}], "[", "ex_", "]"}]}], ",", "cd_"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{"ContractMetric", "[", "rest", "]"}], 
    RowBox[{
     RowBox[{"LieD", "[", "u", "]"}], "[", "ex", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContractMetricOutSideProjector", "[", 
    RowBox[{
     RowBox[{"rest_.", "  ", 
      RowBox[{
       RowBox[{"cd_", "[", "a_", "]"}], "[", "ex_", "]"}]}], ",", "cd_"}], 
    "]"}], ":=", 
   RowBox[{
    RowBox[{"ContractMetric", "[", "rest", "]"}], 
    RowBox[{
     RowBox[{"cd", "[", "a", "]"}], "[", "ex", "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ContractMetricOutSideProjector", "[", 
    RowBox[{"rest_", ",", "cd_"}], "]"}], ":=", 
   RowBox[{"ContractMetric", "[", "rest", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5628524165579147`*^9, 3.562852459950708*^9}, {
   3.562852521469261*^9, 3.562852716531543*^9}, {3.56285280270122*^9, 
   3.5628528241763678`*^9}, {3.562852860319392*^9, 3.562852862885676*^9}, 
   3.562852938643854*^9, {3.5628550064183807`*^9, 3.562855008280697*^9}, {
   3.562855305300766*^9, 3.562855307458774*^9}, {3.562855342680915*^9, 
   3.5628553580230713`*^9}, {3.562855395816695*^9, 3.562855493312042*^9}, {
   3.562855672128683*^9, 3.562855674947558*^9}, {3.562855705979685*^9, 
   3.562855745215382*^9}, {3.562855834479697*^9, 3.562855919374391*^9}, {
   3.5628559495462418`*^9, 3.562855959830159*^9}, {3.562855994817829*^9, 
   3.562855996410336*^9}, {3.562856058532906*^9, 3.562856067561316*^9}, {
   3.562856348795816*^9, 3.562856376930189*^9}, {3.562856487634591*^9, 
   3.562856506950039*^9}, {3.562856591515787*^9, 3.5628566179728947`*^9}, {
   3.562856655843794*^9, 3.5628569562560663`*^9}, {3.562857042568256*^9, 
   3.562857051786644*^9}, {3.562857087518365*^9, 3.562857089046356*^9}, {
   3.562867655603628*^9, 3.5628676772981367`*^9}, {3.562867718201264*^9, 
   3.562867810778425*^9}, {3.562867854593412*^9, 3.5628678572974443`*^9}, {
   3.562867928969345*^9, 3.562867991038229*^9}, {3.56286812187549*^9, 
   3.562868124171238*^9}, {3.562868181782991*^9, 3.562868197073942*^9}, {
   3.5628682339102583`*^9, 3.56286828737857*^9}, {3.562868523966084*^9, 
   3.56286857646734*^9}, {3.5628686484223747`*^9, 3.5628686733326*^9}, {
   3.56286879167104*^9, 3.562868800068625*^9}, 3.562905106610783*^9, {
   3.5629051681795187`*^9, 3.562905270867152*^9}, {3.562905305987751*^9, 
   3.5629053445984917`*^9}, {3.562905401394644*^9, 3.562905405537713*^9}, {
   3.562905521835458*^9, 3.562905558824545*^9}, {3.562905647462377*^9, 
   3.5629056561568747`*^9}, {3.5629056887035627`*^9, 3.562905770047553*^9}, {
   3.56290582238654*^9, 3.5629058470903177`*^9}, {3.562905885852364*^9, 
   3.562905890754026*^9}, {3.562905922251334*^9, 3.562905926017475*^9}, {
   3.562905961906399*^9, 3.5629059945219584`*^9}, {3.5629060767069902`*^9, 
   3.5629060941011868`*^9}, {3.56290628925358*^9, 3.562906363768013*^9}, {
   3.562906449134036*^9, 3.562906458460319*^9}, {3.562906716915649*^9, 
   3.562906814550714*^9}, {3.5629072466911173`*^9, 3.5629072499368887`*^9}, {
   3.562907296693408*^9, 3.56290735717111*^9}, {3.5629073908139277`*^9, 
   3.562907552288406*^9}, {3.562907679624529*^9, 3.562907726089517*^9}, {
   3.5629077582714443`*^9, 3.56290778488559*^9}, 3.562907824510667*^9, {
   3.5629078754580812`*^9, 3.562907879150251*^9}, {3.562910344880671*^9, 
   3.562910456180378*^9}, {3.5629107876561213`*^9, 3.562910829754397*^9}, {
   3.5629108978791847`*^9, 3.5629109044897957`*^9}, {3.562910992036852*^9, 
   3.5629109943906918`*^9}, {3.562911029742922*^9, 3.562911160032372*^9}, {
   3.562911211684855*^9, 3.562911425541544*^9}, {3.562911473222527*^9, 
   3.562911489897435*^9}, {3.5629116175219*^9, 3.56291163359575*^9}, {
   3.562911970475092*^9, 3.562911980575223*^9}, {3.562912796667245*^9, 
   3.562912805809779*^9}, {3.5629179948384867`*^9, 3.562917997666113*^9}, {
   3.562918114966703*^9, 3.5629181219821873`*^9}, {3.562918200073524*^9, 
   3.562918201762773*^9}, {3.562923876020924*^9, 3.5629238864679327`*^9}, 
   3.5629241323293257`*^9, {3.5629241686607847`*^9, 3.562924187563471*^9}, {
   3.5629242566247807`*^9, 3.5629242648042707`*^9}, {3.562924304523918*^9, 
   3.5629243176692247`*^9}, {3.5629244006988077`*^9, 
   3.5629244070473957`*^9}, {3.562924628853231*^9, 3.56292466729364*^9}, {
   3.562924765372452*^9, 3.562924782199082*^9}, {3.562925495993284*^9, 
   3.5629255470866203`*^9}, {3.56292558367142*^9, 3.562925583867325*^9}, {
   3.562925621526841*^9, 3.5629256225673447`*^9}, {3.562925815581368*^9, 
   3.5629258251963463`*^9}, {3.562926633820242*^9, 3.56292666242437*^9}, {
   3.562926941914639*^9, 3.562926947042026*^9}, {3.562927069789877*^9, 
   3.562927090235753*^9}, {3.562927277521556*^9, 3.562927277659165*^9}, {
   3.56292730824395*^9, 3.5629273601916656`*^9}, {3.5629274109709063`*^9, 
   3.562927421720168*^9}, {3.56292907257882*^9, 3.5629290854466343`*^9}, {
   3.5629293492026787`*^9, 3.562929374835043*^9}, {3.562929485075652*^9, 
   3.562929485669655*^9}, {3.5629295827465343`*^9, 3.562929590849304*^9}, 
   3.5629357262366447`*^9, {3.56293600824209*^9, 3.562936071104042*^9}, {
   3.5629361067281637`*^9, 3.562936108685486*^9}, {3.56293626746994*^9, 
   3.562936293576869*^9}, {3.562937109345849*^9, 3.562937168901948*^9}, {
   3.562937360942108*^9, 3.562937363687628*^9}, {3.562937448950692*^9, 
   3.562937473050267*^9}, {3.562937856650069*^9, 3.562937880675099*^9}, {
   3.562955592038746*^9, 3.5629555979518423`*^9}, {3.5629567832539473`*^9, 
   3.562956785098456*^9}, {3.562961587081999*^9, 3.562961605923909*^9}, {
   3.563069595207354*^9, 3.5630696339075603`*^9}, {3.563069819921566*^9, 
   3.56306982851803*^9}, {3.563095839025219*^9, 3.563095909774371*^9}, 
   3.5630982104938393`*^9, {3.563099541171316*^9, 3.563099579953062*^9}, {
   3.5631058477975063`*^9, 3.563105856547336*^9}, {3.5631260437318583`*^9, 
   3.563126067827273*^9}, {3.563133116377721*^9, 3.5631331176289263`*^9}, {
   3.563133582229692*^9, 3.563133594306888*^9}, {3.563137187097125*^9, 
   3.563137187362524*^9}, {3.563165902252475*^9, 3.5631659086299*^9}, {
   3.5631660783646393`*^9, 3.563166093787979*^9}, {3.5631894360325336`*^9, 
   3.563189472780759*^9}, {3.563191236279255*^9, 3.563191238551008*^9}, {
   3.563194499267851*^9, 3.5631945160858088`*^9}, {3.563194635872604*^9, 
   3.563194642505599*^9}, {3.5631947735228*^9, 3.563194807659112*^9}, {
   3.563194854307837*^9, 3.5631948586159763`*^9}, {3.563194896299491*^9, 
   3.563194921011524*^9}, {3.5631950936222897`*^9, 3.5631950941138277`*^9}, {
   3.563195182563718*^9, 3.563195188390386*^9}, {3.5631952489749327`*^9, 
   3.563195254338257*^9}, {3.563195691821329*^9, 3.563195791309004*^9}, {
   3.5631958475877333`*^9, 3.563195861083066*^9}, {3.5631961504524107`*^9, 
   3.563196151519375*^9}, {3.563196213905962*^9, 3.56319621706498*^9}, {
   3.563197014870224*^9, 3.563197022201551*^9}, {3.563197351713956*^9, 
   3.563197441455806*^9}, 3.5631975733458023`*^9, {3.563197737877398*^9, 
   3.563197749315443*^9}, {3.563199699379925*^9, 3.563199714913583*^9}, {
   3.563199762873644*^9, 3.5631997692957697`*^9}, {3.563199987568522*^9, 
   3.563200111278008*^9}, {3.563200206893519*^9, 3.563200290523624*^9}, {
   3.563249879628025*^9, 3.563249885007575*^9}, {3.56325080588892*^9, 
   3.5632508073426933`*^9}, {3.563250842625846*^9, 3.563250865881493*^9}, {
   3.563250951725938*^9, 3.563250980524789*^9}, {3.5632627923320007`*^9, 
   3.563262798863152*^9}, {3.563274133052644*^9, 3.563274163982911*^9}, {
   3.56327690794376*^9, 3.5632769436576757`*^9}, {3.563281601995462*^9, 
   3.5632816104426527`*^9}, 3.5635158836922827`*^9, {3.563516681980158*^9, 
   3.5635167486528254`*^9}, {3.563516827248497*^9, 3.563516897328389*^9}, {
   3.563607756864265*^9, 3.56360789590526*^9}, {3.563607926854671*^9, 
   3.5636079573137608`*^9}, {3.563608009974718*^9, 3.5636081462888603`*^9}, {
   3.563608228164453*^9, 3.563608273352408*^9}, 3.563610055145021*^9, {
   3.563610909297475*^9, 3.563610913014409*^9}, {3.5636109738618937`*^9, 
   3.563611017021298*^9}, {3.563616799130622*^9, 3.563616801456029*^9}, {
   3.563620420365302*^9, 3.563620423377379*^9}, {3.5636204795216637`*^9, 
   3.563620489791706*^9}, {3.5636206368410053`*^9, 3.563620637558693*^9}, {
   3.563620693298932*^9, 3.563620693972068*^9}, {3.563620755235409*^9, 
   3.563620761900063*^9}, {3.563621938982972*^9, 3.563621944245366*^9}, {
   3.5636225994889717`*^9, 3.563622604559595*^9}, {3.5637034838320227`*^9, 
   3.563703517275028*^9}, {3.563703604018244*^9, 3.56370361081754*^9}, {
   3.563704407413773*^9, 3.563704423622078*^9}, {3.563708529679536*^9, 
   3.563708575552445*^9}, {3.5637106323327303`*^9, 3.56371067858922*^9}, {
   3.563710777464366*^9, 3.5637107859869223`*^9}, {3.563737988742277*^9, 
   3.5637380234169893`*^9}, 3.563741872759575*^9, {3.5637796974798603`*^9, 
   3.56377971939081*^9}, {3.563780013485862*^9, 3.563780016771063*^9}, {
   3.563780649406559*^9, 3.563780660666103*^9}, {3.5637823073685513`*^9, 
   3.563782394600459*^9}, {3.563782428098522*^9, 3.563782472516926*^9}, {
   3.563782657447805*^9, 3.5637826655333157`*^9}, {3.563782728198793*^9, 
   3.563782749199848*^9}, {3.563783033149207*^9, 3.5637830575556917`*^9}, 
   3.563783093090589*^9, {3.563783220392363*^9, 3.5637832902887163`*^9}, {
   3.563783340806924*^9, 3.5637833734789047`*^9}, {3.563783404788663*^9, 
   3.5637834078011417`*^9}, {3.563784279741947*^9, 3.563784360672297*^9}, {
   3.563784413227977*^9, 3.563784574609989*^9}, {3.563784610935598*^9, 
   3.563784728656878*^9}, {3.563865849361137*^9, 3.5638658930829268`*^9}, {
   3.563878583202306*^9, 3.563878598667478*^9}, {3.563882558182786*^9, 
   3.563882561456833*^9}, {3.563882940433413*^9, 3.563882942297976*^9}, {
   3.563949547152444*^9, 3.563949573538637*^9}, {3.563949668772047*^9, 
   3.563949701982514*^9}, {3.563950032657592*^9, 3.5639500339034452`*^9}, {
   3.563950072150239*^9, 3.563950106410049*^9}, {3.564135012964959*^9, 
   3.564135014202598*^9}, {3.5641682715177813`*^9, 3.564168275626409*^9}, {
   3.5641717908115883`*^9, 3.564171821238686*^9}, {3.564406228516817*^9, 
   3.564406233308413*^9}, {3.5644062938021393`*^9, 3.564406347101707*^9}, {
   3.564406410818582*^9, 3.5644066117745123`*^9}, {3.5644066505309563`*^9, 
   3.5644066898373613`*^9}, {3.564406727803422*^9, 3.564406749234138*^9}, {
   3.564407015499415*^9, 3.564407023056334*^9}, 3.564407116372725*^9, {
   3.564407176323818*^9, 3.564407194906856*^9}, {3.5644072489057426`*^9, 
   3.564407250038659*^9}, {3.5644104915028152`*^9, 3.564410494954287*^9}, {
   3.564410721118602*^9, 3.564410724669277*^9}, {3.564410807148636*^9, 
   3.564410812018652*^9}, {3.5644109829639072`*^9, 3.564411013266807*^9}, {
   3.564411166823515*^9, 3.564411177189744*^9}, {3.564411214875478*^9, 
   3.564411236395726*^9}, {3.5644113235264997`*^9, 3.5644113445942373`*^9}, {
   3.564411407720696*^9, 3.564411430478607*^9}, {3.564411586951376*^9, 
   3.564411588980434*^9}, {3.564411862864236*^9, 3.564411895531382*^9}, {
   3.564411995437627*^9, 3.5644120231172256`*^9}, {3.564414483239661*^9, 
   3.564414488912243*^9}, {3.564417536025161*^9, 3.564417538423377*^9}, {
   3.564417574965026*^9, 3.564417577019937*^9}, {3.5644768990761127`*^9, 
   3.5644769399091063`*^9}, {3.5644770271977577`*^9, 3.564477028595047*^9}, {
   3.564480162111466*^9, 3.56448018737499*^9}, {3.564480325700612*^9, 
   3.5644803268089943`*^9}, {3.564480536711246*^9, 3.564480540182959*^9}, {
   3.564480855765221*^9, 3.564480888387504*^9}, {3.5644820857734756`*^9, 
   3.5644821193446093`*^9}, {3.564482182928316*^9, 3.5644822006989107`*^9}, {
   3.564482238309154*^9, 3.564482242733157*^9}, {3.564482301103109*^9, 
   3.564482337675538*^9}, {3.564482535096418*^9, 3.564482561972519*^9}, {
   3.564482702936996*^9, 3.5644827195261383`*^9}, {3.564485018013644*^9, 
   3.564485019711907*^9}, {3.5644850965290613`*^9, 3.564485105481379*^9}, {
   3.5644877884326344`*^9, 3.564487794568677*^9}, 3.564487856463213*^9, {
   3.564487971174859*^9, 3.564487978044776*^9}, {3.564494746265608*^9, 
   3.56449479609063*^9}, {3.56454787672775*^9, 3.564547979973995*^9}, {
   3.564548055544333*^9, 3.564548175448244*^9}, {3.564548242252202*^9, 
   3.5645482628809443`*^9}, {3.564549014617476*^9, 3.564549106558462*^9}, {
   3.564549257472334*^9, 3.564549266846478*^9}, {3.5645527524083967`*^9, 
   3.564552829507935*^9}, {3.564552876519161*^9, 3.564552876678666*^9}, {
   3.564553140870921*^9, 3.564553147237072*^9}, {3.564553208149702*^9, 
   3.5645532908114977`*^9}, {3.5645536577045717`*^9, 3.564553665060978*^9}, 
   3.5645539718851547`*^9, {3.56455411029329*^9, 3.564554147591611*^9}, {
   3.564554368783483*^9, 3.564554380510343*^9}, {3.564554491403123*^9, 
   3.564554553741049*^9}, {3.5645546291263742`*^9, 3.564554722663958*^9}, {
   3.56455537815193*^9, 3.564555384387025*^9}, {3.5646277486378098`*^9, 
   3.5646277618970213`*^9}, {3.564627847903694*^9, 3.5646278492388372`*^9}, {
   3.564627970031576*^9, 3.56462800039342*^9}, 3.564630864702817*^9, {
   3.564631093414463*^9, 3.564631097855893*^9}, {3.5646341982224207`*^9, 
   3.5646341996777277`*^9}, {3.5646346388800907`*^9, 3.564634646978853*^9}, {
   3.56463473859181*^9, 3.5646347456170607`*^9}, {3.564634779380975*^9, 
   3.5646347795408373`*^9}, {3.564634825563258*^9, 3.564634826825548*^9}, {
   3.564635774140471*^9, 3.5646357773281116`*^9}, {3.5646359640382338`*^9, 
   3.5646359752478523`*^9}, {3.564636566848361*^9, 3.564636591442293*^9}, {
   3.564636801500062*^9, 3.5646368015717163`*^9}, {3.564636872784657*^9, 
   3.564636888739345*^9}, {3.564637009186913*^9, 3.564637045993822*^9}, {
   3.564637199382668*^9, 3.564637202175243*^9}, {3.564637262524954*^9, 
   3.564637264534471*^9}, {3.564637376393779*^9, 3.564637382659829*^9}, 
   3.564637522551907*^9, {3.564637640434972*^9, 3.564637641809186*^9}, {
   3.5646376837930717`*^9, 3.5646376846285267`*^9}, {3.564637806054147*^9, 
   3.56463780789657*^9}, {3.5646379188448772`*^9, 3.564637936756772*^9}, {
   3.5646380600774193`*^9, 3.5646380734520617`*^9}, {3.5646381090692*^9, 
   3.5646381351968737`*^9}, {3.564638240537498*^9, 3.564638244810758*^9}, {
   3.564638285218979*^9, 3.564638292181546*^9}, {3.564638339522517*^9, 
   3.564638371441064*^9}, {3.564638545570763*^9, 3.564638549654153*^9}, {
   3.564638749481962*^9, 3.564638767860092*^9}, {3.564638829562582*^9, 
   3.564638838785118*^9}, {3.5646389745072727`*^9, 3.564638983785885*^9}, {
   3.564639022291367*^9, 3.564639033093417*^9}, {3.5646391264451933`*^9, 
   3.564639169777048*^9}, {3.564639250222288*^9, 3.564639252084536*^9}, {
   3.564639346785388*^9, 3.564639394951599*^9}, {3.5646395619084387`*^9, 
   3.564639566888175*^9}, {3.564640374677628*^9, 3.564640384935698*^9}, {
   3.564640957009074*^9, 3.564640974179881*^9}, {3.5646411300066566`*^9, 
   3.564641148769965*^9}, {3.564641727867228*^9, 3.564641731836069*^9}, {
   3.564641920937546*^9, 3.564641928121626*^9}, {3.564642088827351*^9, 
   3.5646421418255863`*^9}, {3.564642535630274*^9, 3.564642551031948*^9}, {
   3.5646426227140627`*^9, 3.5646427104953127`*^9}, {3.564642920102272*^9, 
   3.564642923796947*^9}, {3.564642959264131*^9, 3.5646429852008333`*^9}, {
   3.5646430503759727`*^9, 3.5646430790469103`*^9}, {3.5646587214777737`*^9, 
   3.5646587513812637`*^9}, {3.564659020380402*^9, 3.564659020944235*^9}, 
   3.5646591067868032`*^9, {3.5646591911791573`*^9, 3.564659195803722*^9}, {
   3.564666661132585*^9, 3.564666670871717*^9}, {3.564666707858262*^9, 
   3.564666710578855*^9}, {3.564668262177066*^9, 3.56466826750177*^9}, {
   3.5646684898279867`*^9, 3.5646684901988363`*^9}, 3.564668570210752*^9, 
   3.564668782884563*^9, {3.5646688130432177`*^9, 3.564668818271387*^9}, {
   3.5646689329955807`*^9, 3.564668934221806*^9}, {3.564669055899938*^9, 
   3.564669063434751*^9}, {3.564669141254422*^9, 3.564669143166037*^9}, {
   3.564716396103277*^9, 3.5647164032407427`*^9}, {3.564716736453866*^9, 
   3.564716742642951*^9}, {3.564719093507579*^9, 3.564719151256853*^9}, {
   3.5647192534535303`*^9, 3.5647194259959183`*^9}, {3.564719576167082*^9, 
   3.5647195800576143`*^9}, 3.564723675963142*^9, 3.564723952230307*^9, 
   3.5647559060172367`*^9, 3.568298432295041*^9, 3.568458172238147*^9}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "If", " ", "the", " ", "background", " ", "field", " ", "method", " ", 
     "is", " ", "used"}], ",", " ", 
    RowBox[{
    "this", " ", "rule", " ", "ensures", " ", "that", " ", "tensor", " ", 
     "with", " ", "a", " ", "label", " ", "index", " ", "for", " ", "order", 
     " ", "strictly", " ", "larger", " ", "than", " ", "1", " ", 
     RowBox[{"vanish", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"BackgroundFieldRule", ":=", 
    RowBox[{"If", "[", 
     RowBox[{"BackgroundFieldMethod", ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"tens_", "?", "xTensorQ"}], "[", "inds___", "]"}], 
        "\[RuleDelayed]", 
        RowBox[{"0", "/;", 
         RowBox[{
          RowBox[{"PerturbationOrder", "[", 
           RowBox[{"tens", "[", "inds", "]"}], "]"}], ">", "1"}]}]}], "}"}], 
      ",", 
      RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RulesCovDsOfTensor", "[", 
      RowBox[{"expr_", ",", "replacerule_", ",", "rulesprojected_", ",", 
       RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
       RowBox[{"n_:", "10"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "dummies", ",", "dummiesup", ",", "tableleft", ",", "tableright", ",",
          "testpatternlistnmax", ",", "ListBool", ",", "CDmax", ",", 
         "freedownleft", ",", "dummiesdown", ",", "leftupindices", ",", 
         "leftupindicesnopattern", ",", "tableleftnopattern", ",", 
         "Listlhsrhsnoreplace", ",", "temp", ",", "tempdown", ",", "rhs", ",",
          "rulepert", ",", "leftupindicesnopatterntests", ",", "tobecan", ",",
          "oncecan", ",", "RulesCovDs"}], "}"}], ",", 
       RowBox[{"Catch", "@", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"g", "=", 
             RowBox[{"First", "@", 
              RowBox[{"InducedFrom", "@", "h"}]}]}], ",", 
            RowBox[{"u", "=", 
             RowBox[{"Last", "@", 
              RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"CD", "=", 
               RowBox[{"CovDOfMetric", "[", "g", "]"}]}], ",", 
              RowBox[{"cd", "=", 
               RowBox[{"CovDOfMetric", "[", "h", "]"}]}], ",", 
              RowBox[{"M", "=", 
               RowBox[{"ManifoldOfCovD", "@", 
                RowBox[{"CovDOfMetric", "[", "g", "]"}]}]}], ",", 
              RowBox[{"indicesright", "=", 
               RowBox[{
                RowBox[{
                 RowBox[{"Pattern", "[", 
                  RowBox[{"#", ",", "_"}], "]"}], "&"}], "/@", 
                RowBox[{"FindFreeIndices", "[", 
                 RowBox[{"Last", "@", "replacerule"}], "]"}]}]}], ",", 
              RowBox[{"indicesleft", "=", 
               RowBox[{"FindFreeIndices", "[", 
                RowBox[{"First", "@", "replacerule"}], "]"}]}]}], "}"}], ",", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "In", " ", "this", " ", "fuynction", " ", "we", " ", "will", 
               " ", "precompute", " ", "the", " ", "rules", " ", "for", " ", 
               "the", " ", "CovDs", " ", "of", " ", "tensor", " ", "for", " ",
                "which", " ", "the", " ", "rule", " ", "is", " ", "given", 
               " ", "in", " ", "the", " ", "argument", " ", 
               RowBox[{"replacerule", ".", "\[IndentingNewLine]", "For"}], 
               " ", "instance", " ", "if", " ", "we", " ", "compute", " ", 
               "the", " ", "perturbation", " ", "of", " ", "the", " ", 
               "Ricci", " ", "tensor"}], ",", " ", 
              RowBox[{
              "there", " ", "will", " ", "be", " ", "several", " ", "terms", 
               " ", "with", " ", "two", " ", "covariant", " ", "derivatives", 
               " ", "of", " ", "the", " ", "perturbed", " ", 
               RowBox[{"metric", ".", " ", "By"}], " ", "precomputing", " ", 
               "the", " ", "rule", " ", "once", " ", "instead", " ", "of", 
               " ", "several", " ", "times"}], ",", " ", 
              RowBox[{
              "we", " ", "shall", " ", "save", " ", "sone", " ", "computing", 
               " ", 
               RowBox[{"time", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
            
            RowBox[{
             RowBox[{"testpatternlistnmax", "=", 
              RowBox[{"TablePatternsCovDs", "[", 
               RowBox[{
                RowBox[{"First", "@", "replacerule"}], ",", "CD", ",", "n"}], 
               "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{
               "For", " ", "every", " ", "number", " ", "of", " ", "CovD", 
                " ", "we", " ", "look", " ", "at", " ", "a", " ", "match", 
                " ", "and", " ", "give", " ", "a", " ", "list", " ", "of", 
                " ", "the", " ", 
                RowBox[{"booleans", ".", " ", 
                 RowBox[{"{", 
                  RowBox[{"True", ",", "True", ",", 
                   RowBox[{"False", "..."}]}], "}"}]}], "\[IndentingNewLine]",
                 "means", " ", "that", " ", "there", " ", "is", " ", "terms", 
                " ", "with", " ", "no", " ", "CovD"}], ",", " ", 
               RowBox[{"terms", " ", "with", " ", "one"}], ",", " ", 
               RowBox[{
               "but", " ", "no", " ", "terms", " ", "with", " ", "two", " ", 
                RowBox[{"CovD", "[", "tens", "]"}], " ", "for", " ", 
                RowBox[{"instance", "."}]}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"ListBool", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#", "\[GreaterEqual]", "1"}], ")"}], "&"}], "/@", 
               RowBox[{"Length", "/@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"Expand", "@", "expr"}], ",", "#", ",", 
                    "Infinity"}], "]"}], "&"}], "/@", "testpatternlistnmax"}],
                  ")"}]}]}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "Then", " ", "we", " ", "look", " ", "at", " ", "the", " ", 
               "maximum", " ", "number", " ", "of", " ", "CovDs"}], " ", 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"CDmax", "=", 
              RowBox[{"Max", "[", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"Max", "@", 
                  RowBox[{"Position", "[", 
                   RowBox[{"ListBool", ",", "True"}], "]"}]}], "-", "1"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"CDmax", "===", "n"}], ",", 
               RowBox[{"Throw", "[", 
                RowBox[{"Message", "[", 
                 RowBox[{
                  RowBox[{"RulesSplitCovDsOfTensor", "::", "maxcovdnumber"}], 
                  ",", "n"}], "]"}], "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"dummiesdown", "=", 
              RowBox[{"Take", "[", 
               RowBox[{"ChangeIndex", "/@", 
                RowBox[{"DummyIn", "/@", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Tangent", "[", "M", "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"Range", "[", "CDmax", "]"}], "}"}]}], "]"}]}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"dummiesup", "=", 
              RowBox[{"ChangeIndex", "/@", "dummiesdown"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Off", "[", 
              StyleBox[
               RowBox[{"Pattern", "::", "patvar"}], "MessageName"], "]"}], 
             ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"freedownleft", "=", 
              RowBox[{
               RowBox[{"IndicesOf", "[", 
                RowBox[{"Free", ",", "Down"}], "]"}], "[", 
               RowBox[{"RemovePatterns", "@", 
                RowBox[{"First", "@", "replacerule"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"leftupindices", "=", 
              RowBox[{"PutPatternIndicesUp", "[", 
               RowBox[{
                RowBox[{"First", "@", "replacerule"}], "//", 
                "ProjectorToMetric"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"leftupindicesnopattern", "=", 
              RowBox[{"RemovePatterns", "[", "leftupindices", "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"leftupindicesnopatterntests", "=", 
              RowBox[{"RemovePatternTests", "[", "leftupindices", "]"}]}], 
             ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "We", " ", "build", " ", "the", " ", "left", " ", "hand", " ", 
               "side"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"tableleft", "=", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"{", "leftupindices", "}"}], ",", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Fold", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"CD", "[", 
                    RowBox[{"Pattern", "[", 
                    RowBox[{"#2", ",", 
                    RowBox[{"Blank", "[", "]"}]}], "]"}], "]"}], "@", "#1"}], 
                    ")"}], "&"}], ",", "leftupindices", ",", "#"}], "]"}], 
                    "&"}], "[", 
                   RowBox[{"Take", "[", 
                    RowBox[{"dummiesup", ",", "i"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "1", ",", "CDmax"}], "}"}]}], "]"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"tableleftnopattern", "=", 
              RowBox[{"RemovePatterns", "/@", "tableleft"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Listlhsrhsnoreplace", "=", 
              RowBox[{"Reverse", "@", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{"tableleft", ",", "tableleftnopattern"}], "}"}], 
                "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             
             RowBox[{"RulesCovDs", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"(", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"tempdown", "=", 
                   RowBox[{"IndicesDown", "[", 
                    RowBox[{"Last", "@", "#"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"rulepert", "=", 
                   RowBox[{"leftupindicesnopatterntests", "->", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"InducedDecomposition", "[", 
                    RowBox[{"leftupindicesnopattern", ",", 
                    RowBox[{"{", 
                    RowBox[{"h", ",", "u"}], "}"}]}], "]"}], "/.", 
                    "rulesprojected"}], "/.", 
                    RowBox[{"Scalar", "\[Rule]", "ProtectMyScalar"}]}], 
                    ")"}]}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"temp", "=", 
                   RowBox[{"tempdown", "/.", "rulepert"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"tobecan", "=", 
                   RowBox[{"FullToInducedDerivative", "[", 
                    RowBox[{"temp", ",", "CD", ",", "cd"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"oncecan", "=", 
                   RowBox[{"ContractMetricOutSideProjector", "[", 
                    RowBox[{
                    RowBox[{"Expand", "@", "tobecan"}], ",", "cd"}], "]"}]}], 
                  ";", "\[IndentingNewLine]", 
                  RowBox[{"rhs", "=", 
                   RowBox[{"ToCanonical", "[", 
                    RowBox[{"oncecan", ",", 
                    RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", 
                  RowBox[{"IndexRule", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"First", "@", "#"}], ")"}], "/.", 
                    RowBox[{"hp_HoldPattern", "\[RuleDelayed]", 
                    RowBox[{"First", "@", "hp"}]}]}], ")"}], ",", "rhs"}], 
                   "]"}]}], ")"}], "&"}], "/@", "Listlhsrhsnoreplace"}]}], 
             ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             "RulesCovDs"}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ProjectionAndBackgroundRuleQ", "[", 
      RowBox[{"rule_", ",", 
       RowBox[{"h_", "?", "InducedMetricQ"}], ",", "n_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"PerturbationOrder", "[", 
         RowBox[{"RemovePatterns", "[", 
          RowBox[{"First", "@", "rule"}], "]"}], "]"}], "===", "0"}], ")"}], "&&", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Projector", "[", "h", "]"}], "[", 
          RowBox[{"Last", "@", "rule"}], "]"}], "===", "0"}], "||", 
        RowBox[{
         RowBox[{"OrthogonalToVectorQ", "[", "n", "]"}], "[", 
         RowBox[{"Last", "@", "rule"}], "]"}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SplitPerturbations", "[", 
      RowBox[{"expr_", ",", "ListPairs_List", ",", 
       RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "res", ",", "restemp", ",", "resfinal", ",", "restemp2", ",", "res0", 
         ",", "res1", ",", "res2", ",", "res3", ",", "res4", ",", "res4bis", 
         ",", "res6bis", ",", "res6ter", ",", "res6quater", ",", "res4ter", 
         ",", "res4quater", ",", "res5", ",", "res6", ",", "res7", ",", 
         "res8", ",", "counter", ",", "rules", ",", 
         "rulesprojectedandbackground", ",", "$Rulecdh"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"g", "=", 
            RowBox[{"First", "@", 
             RowBox[{"InducedFrom", "@", "h"}]}]}], ",", 
           RowBox[{"u", "=", 
            RowBox[{"Last", "@", 
             RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CD", "=", 
              RowBox[{"CovDOfMetric", "[", "g", "]"}]}], ",", 
             RowBox[{"cd", "=", 
              RowBox[{"CovDOfMetric", "[", "h", "]"}]}]}], "}"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"counter", "=", "0"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"rulesprojectedandbackground", "=", 
             RowBox[{"Select", "[", 
              RowBox[{"ListPairs", ",", 
               RowBox[{
                RowBox[{"ProjectionAndBackgroundRuleQ", "[", 
                 RowBox[{"#", ",", "h", ",", "u"}], "]"}], "&"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"rules", "=", 
             RowBox[{"Flatten", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"RulesCovDsOfTensor", "[", 
                  RowBox[{
                  "expr", ",", "#", ",", "rulesprojectedandbackground", ",", 
                   "h"}], "]"}], "&"}], "/@", "ListPairs"}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{"$DebugInfoQ", ",", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<rules \>\"", ",", "rules"}], "]"}]}], "]"}], 
              ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"res", "=", 
             RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"res0", "=", 
                RowBox[{
                 RowBox[{"FullToInducedDerivativeAndCDDown", "[", 
                  RowBox[{
                   RowBox[{"org", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"expr", "//", "ProjectorToMetric"}], "//", 
                    RowBox[{
                    RowBox[{"GaussCodazzi", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], ")"}], "/.", 
                    RowBox[{
                    RowBox[{"Projector", "[", "h", "]"}], "\[Rule]", 
                    RowBox[{"ProjectWith", "[", "h", "]"}]}]}], "]"}], ",", 
                   "CD", ",", "cd"}], "]"}], "//", "ProjectorToMetric"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{"$DebugInfoQ", ",", 
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<Stage 0  \>\"", ",", " ", "res0"}], "]"}]}], 
                  "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"res1", " ", "=", 
                RowBox[{"ToCanonical", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"res0", "/.", "rules"}], ")"}], "/.", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ih_", "?", "InertHeadQ"}], "[", "ex_", "]"}], 
                    "\[RuleDelayed]", 
                    RowBox[{"ih", "[", 
                    RowBox[{"ToCanonical", "[", "ex", "]"}], "]"}]}]}], ",", 
                  RowBox[{"UseMetricOnVBundle", "\[Rule]", "None"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{"$DebugInfoQ", ",", 
                   RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<Stage 1  \>\"", ",", " ", "res1", ",", 
                    "\"\< \\n \>\"", ",", 
                    RowBox[{"res1", "/.", "ListPairs"}]}], " ", "]"}]}], 
                  "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"res2", "=", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"res1", "//.", "ListPairs"}], ")"}], "/.", 
                   "BackgroundFieldRule"}], ")"}], "/.", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Projector", "[", "h", "]"}], "[", "exp___", "]"}],
                   ":>", 
                  RowBox[{
                   RowBox[{"Projector", "[", "h", "]"}], "[", 
                   RowBox[{"Expand", "@", 
                    RowBox[{"NoScalar", "[", "exp", "]"}]}], "]"}]}]}]}], ";",
                "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{"$DebugInfoQ", ",", 
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<Stage 2  \>\"", ",", "res2"}], "]"}]}], 
                  "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"res3", "=", 
                RowBox[{"(", 
                 RowBox[{"res2", "/.", 
                  RowBox[{
                   RowBox[{"ProtectMyScalar", "[", "exp_", "]"}], 
                   "\[RuleDelayed]", 
                   RowBox[{"IndicesDown", "[", 
                    RowBox[{"ToCanonical", "[", 
                    RowBox[{"NoScalar", "@", "exp"}], "]"}], "]"}]}]}], 
                 RowBox[{"(*", 
                  RowBox[{"Expand", "[", 
                   RowBox[{"NoScalar", "@", "exp"}], "]"}], "*)"}], ")"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{"$DebugInfoQ", ",", 
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<Stage 3  \>\"", ",", "res3"}], "]"}]}], 
                  "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"res4", "=", 
                RowBox[{"NoScalar", "[", 
                 RowBox[{"res3", "/.", 
                  RowBox[{
                   RowBox[{"Projector", "[", "h", "]"}], "\[Rule]", 
                   RowBox[{"ProjectWith", "[", "h", "]"}]}]}], "]"}]}], 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"//", "ContractMetric"}], "//", "ToCanonical"}], 
                "*)"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{"$DebugInfoQ", ",", 
                   RowBox[{
                   "Print", "[", "\"\<Ready for canonicalization.\>\"", 
                    "]"}]}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"res4bis", "=", 
                RowBox[{"SameDummies", "@", 
                 RowBox[{"ContractMetric", "@", "res4"}]}]}], 
               RowBox[{"(*", 
                RowBox[{"ParallelMap", "[", 
                 RowBox[{"ContractMetric", ",", "res4", ",", 
                  RowBox[{"Method", "\[Rule]", "\"\<CoarsestGrained\>\""}]}], 
                 "]"}], "*)"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{"$DebugInfoQ", ",", 
                   RowBox[{"Print", "[", "\"\<Stage 4 bis\>\"", "]"}]}], 
                  "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{"$DebugInfoQ", ",", 
                 RowBox[{
                  RowBox[{"Print", "[", 
                   RowBox[{
                   "\"\<Number of terms to be canonicalized before Expand : \
\>\"", ",", 
                    RowBox[{"Length", "[", "res4bis", "]"}], ",", 
                    "\"\<  \>\"", ",", 
                    RowBox[{"LeafCount", "[", "res4bis", "]"}], ",", 
                    "\"\<. Head is \>\"", ",", 
                    RowBox[{"Head", "[", "res4bis", "]"}]}], "]"}], ";"}]}], 
                "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"res4quater", "=", "res4bis"}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"res4ter", "=", 
                  RowBox[{"Map", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$DebugInfoQ", ",", 
                    RowBox[{
                    RowBox[{"counter", "=", 
                    RowBox[{"counter", "+", "1"}]}], ";", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"counter", ",", "50"}], "]"}], "===", "0"}], ",", 
                    
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<We expand term \>\"", ",", "counter", ",", 
                    "\"\< \>\"", ",", 
                    RowBox[{"SameDummies", "@", 
                    RowBox[{"Expand", "@", "#"}]}]}], "]"}], ";"}]}], "]"}], 
                    ";"}]}], "]"}], ";", 
                    RowBox[{"SameDummies", "@", 
                    RowBox[{"Expand", "[", "#", "]"}]}]}], ")"}], "&"}], ",", 
                    "res4bis"}], "]"}]}], 
                 RowBox[{"(*", 
                  RowBox[{"ParallelMap", "[", 
                   RowBox[{"Expand", ",", "res4bis", ",", 
                    RowBox[{
                    "Method", "\[Rule]", "\"\<CoarsestGrained\>\""}]}], "]"}],
                   "*)"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{"$DebugInfoQ", ",", 
                   RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<Number of terms after Expand on each term: \>\"", 
                    ",", 
                    RowBox[{"Length", "[", "res4ter", "]"}], ",", 
                    "\"\<  \>\"", ",", 
                    RowBox[{"LeafCount", "[", "res4ter", "]"}], ",", 
                    "\"\<. Head is \>\"", ",", 
                    RowBox[{"Head", "[", "res4ter", "]"}]}], "]"}], ";"}]}], 
                  "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"res4quater", "=", 
                  RowBox[{"FixedPoint", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"SameDummies", "@", 
                    RowBox[{"Expand", "[", "#", "]"}]}], "&"}], ",", 
                    "res4ter"}], "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{"$DebugInfoQ", ",", 
                   RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<Expand applied globally. Canonicalisation started.\>\
\"", "]"}], ";"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"counter", "=", "0"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"res5", "=", 
                   RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{"$DebugInfoQ", ",", 
                    RowBox[{
                    RowBox[{"counter", "=", 
                    RowBox[{"counter", "+", "1"}]}], ";", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"counter", ",", "50"}], "]"}], "===", "0"}], ",", 
                    
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<We Canonicalize the term \>\"", ",", "counter", ",", 
                    "\"\< \>\"", ",", "#"}], "]"}], ";"}]}], "]"}], ";"}]}], 
                    "]"}], ";", 
                    RowBox[{"ToCanonical", "[", "#", "]"}]}], ")"}], "&"}], 
                    ",", "res4quater"}], "]"}]}], 
                  RowBox[{"(*", 
                   RowBox[{"ParallelMap", "[", 
                    RowBox[{"ToCanonical", ",", "res4ter", ",", 
                    RowBox[{
                    "Method", "\[Rule]", "\"\<CoarsestGrained\>\""}]}], "]"}],
                    "*)"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{"$DebugInfoQ", ",", 
                    RowBox[{
                    "Print", "[", "\"\<Main Canonicalisation performed\>\"", 
                    "]"}]}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
                "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"res6", "=", 
                RowBox[{"(", 
                 RowBox[{"(*", "res5", "*)"}], 
                 RowBox[{
                  RowBox[{"res4quater", "//", 
                   RowBox[{
                    RowBox[{"MetricToProjector", "[", 
                    RowBox[{"#", ",", "h"}], "]"}], "&"}]}], "//", 
                  RowBox[{
                   RowBox[{"CommuteCDSafe", "[", 
                    RowBox[{"#", ",", "cd"}], "]"}], "&"}]}], ")"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{"$DebugInfoQ", ",", 
                 RowBox[{"Print", "[", "\"\<Stage 6\>\"", "]"}]}], "]"}], ";",
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"FlatSpaceBool", "[", 
                  RowBox[{"SpaceType", "[", "h", "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"res6quater", "=", "res6"}], ";"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"res6bis", "=", 
                   RowBox[{"FixedPoint", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SameDummies", "@", 
                    RowBox[{"Expand", "[", "#", "]"}]}], "&"}], ",", 
                    RowBox[{"(", 
                    RowBox[{"res6", "/.", 
                    RowBox[{"ConstantsOfStructureRules", "[", "h", "]"}]}], 
                    RowBox[{"(*", 
                    RowBox[{"/.", 
                    RowBox[{"ConstantsDecompositionRules", "[", "h", "]"}]}], 
                    "*)"}], ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{"$DebugInfoQ", ",", 
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<Canonicalisation of \>\"", ",", 
                    RowBox[{"Length", "[", "res6bis", "]"}], ",", 
                    "\"\< terms starting\>\""}], "]"}], ";"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"res6ter", "=", 
                   RowBox[{"SameDummies", "@", 
                    RowBox[{"ToCanonical", "@", 
                    RowBox[{"ContractMetric", "[", "res6bis", "]"}]}]}]}], 
                  ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"res6quater", "=", 
                   RowBox[{"FixedPoint", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SameDummies", "@", 
                    RowBox[{"Expand", "[", "#", "]"}]}], "&"}], ",", 
                    RowBox[{"(", 
                    RowBox[{"res6ter", 
                    RowBox[{"(*", 
                    RowBox[{"/.", 
                    RowBox[{"ConstantsOfStructureRules", "[", "h", "]"}]}], 
                    "*)"}], "/.", 
                    RowBox[{"ConstantsDecompositionRules", "[", "h", "]"}]}], 
                    ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{"$DebugInfoQ", ",", 
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<Canonicalisation of \>\"", ",", 
                    RowBox[{"Length", "[", "res6quater", "]"}], ",", 
                    "\"\< terms starting\>\""}], "]"}], ";"}]}], "]"}], 
                  ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"res7", "=", 
                RowBox[{"SameDummies", "@", 
                 RowBox[{"ToCanonical", "@", 
                  RowBox[{"ContractMetric", "[", "res6quater", "]"}]}]}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{"$DebugInfoQ", ",", 
                 RowBox[{
                 "Print", "[", "\"\<Riemann replaced and simplified. \>\"", 
                  RowBox[{"(*", 
                   RowBox[{",", "res7"}], "*)"}], "]"}]}], "]"}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", "res7"}], 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", "res7", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"//", "ContractMetric"}], "//", "ToCanonical"}], 
                    "*)"}], ")"}], "/.", 
                    RowBox[{"ConstantsDecompositionRules", "[", "h", "]"}]}], 
                   ")"}], "//", "ContractMetric"}], "//", "ToCanonical"}], "//",
                 "SameDummies"}], "*)"}], "\[IndentingNewLine]", "]"}]}], ";",
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"$DebugInfoQ", ",", 
              RowBox[{
              "Print", "[", 
               "\"\<Constants of structure opened and simplified. \>\"", 
               "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{"$DebugInfoQ", ",", 
                RowBox[{"Print", "[", "\"\<Stage 7\>\"", "]"}]}], "]"}], 
              ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<res 5 \>\"", ",", "res5"}], "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<res  \>\"", ",", "res"}], "]"}], ";"}], "*)"}], 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"CheckSTFTensors", "[", 
             RowBox[{
              RowBox[{"Last", "@", "res"}], ",", "h", ",", 
              RowBox[{"{", 
               RowBox[{"g", ",", "u", ",", 
                RowBox[{"Riemann", "[", "cd", "]"}], ",", 
                RowBox[{"Ricci", "[", "cd", "]"}], ",", 
                RowBox[{"RicciScalar", "[", "cd", "]"}], ",", "h", ",", 
                RowBox[{"CS", "[", "h", "]"}], ",", 
                RowBox[{"nt", "[", "h", "]"}], ",", 
                RowBox[{"av", "[", "h", "]"}], ",", 
                RowBox[{"\[ScriptK]", "[", "h", "]"}], ",", "delta", ",", 
                RowBox[{"epsilon", "[", "h", "]"}], ",", 
                RowBox[{"epsilon", "[", "g", "]"}]}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"$DefInfoQ", ",", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<The Splitting of \>\"", ",", 
                 RowBox[{"Take", "[", 
                  RowBox[{"expr", ",", "1"}], "]"}], ",", 
                 "\"\< +... was performed in \>\"", ",", 
                 RowBox[{"First", "@", "res"}], " ", ",", 
                 "\"\< seconds.\>\""}], "]"}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"res8", "=", 
             RowBox[{"(*", 
              RowBox[{"ToCanonical", "@", 
               RowBox[{"ContractMetric", "@"}]}], "*)"}], 
             RowBox[{"NoScalar", "[", 
              RowBox[{"Last", "@", "res"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "Brute", " ", "force", " ", "contractions", " ", "of", " ", 
              "induced", " ", "derivatives", " ", "with", " ", "indiced", " ", 
              RowBox[{"covD", "."}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"resfinal", "=", 
             RowBox[{
              RowBox[{"PostProcess", "[", "h", "]"}], "[", "res8", "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "The", " ", "default", " ", "in", " ", "xTensor", " ", "is", 
               " ", "to", " ", "not", " ", "commute", " ", "the", " ", 
               "induced", " ", "Covariant", " ", 
               RowBox[{"derivatives", ".", " ", "So"}], " ", "we", " ", "set",
                " ", "it", " ", 
               RowBox[{"back", ".", " ", "Indeed"}]}], ",", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                "in", " ", "some", " ", "cases", " ", "I", " ", "have", " ", 
                 "noteiced", " ", "it", " ", "can", " ", "conflict", " ", 
                 "with", " ", "xPert", " ", "and", " ", "Conformal"}], 
                "..."}], " ", "I", " ", "am", " ", "not", " ", "sure", " ", 
               RowBox[{"why", ".", " ", "Anyway"}]}], ",", " ", 
              RowBox[{
              "It", " ", "is", " ", "better", " ", "to", " ", "avoird", " ", 
               "automatic", " ", "commutation", " ", "of", " ", "cd", " ", 
               "in", " ", "general", " ", "except", " ", 
               RowBox[{"in", " ", "'"}], 
               RowBox[{"SplitPerturbations", "'"}], " ", "since", " ", "we", 
               " ", "want", " ", "maximal", " ", 
               RowBox[{"simplification", "."}]}]}], "*)"}], 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{"$SortCovDAutomatic", ",", 
                RowBox[{
                 RowBox[{"Off", "[", 
                  StyleBox[
                   RowBox[{"Unset", "::", "norep"}], "MessageName"], "]"}], 
                 ";", 
                 RowBox[{"Block", "[", 
                  RowBox[{
                   RowBox[{"{", "Print", "}"}], ",", 
                   RowBox[{"SortCovDsStop", "[", "cd", "]"}]}], "]"}], ";", 
                 RowBox[{"On", "[", 
                  StyleBox[
                   RowBox[{"Unset", "::", "norep"}], "MessageName"], "]"}], 
                 ";"}]}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "resfinal"}]}], "\[IndentingNewLine]", 
          "]"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"IndicesDownOnLieDerivatives", "[", "expression_", "]"}], ":=", 
     RowBox[{"expression", "/.", 
      RowBox[{
       RowBox[{
        RowBox[{"expr_", "?", "DefProjectedTensorQ"}], "[", 
        RowBox[{
         RowBox[{"LI", "[", "n_", "]"}], ",", 
         RowBox[{"LI", "[", 
          RowBox[{"q_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", "\[GreaterEqual]", "1"}], "&"}], ")"}]}], "]"}], 
         ",", "inds__"}], "]"}], " ", "\[RuleDelayed]", 
       RowBox[{"IndicesDown", "[", 
        RowBox[{"expr", "[", 
         RowBox[{
          RowBox[{"LI", "[", "n", "]"}], ",", 
          RowBox[{"LI", "[", "q", "]"}], ",", "inds"}], "]"}], "]"}]}]}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PostProcess", "[", "h_", "]"}], "[", "expr_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"AnisotropyBool", "@", 
        RowBox[{"SpaceType", "[", "h", "]"}]}], "||", 
       RowBox[{"BianchiBool", "@", 
        RowBox[{"SpaceType", "[", "h", "]"}]}]}], ",", "\[IndentingNewLine]", 
      
      RowBox[{"ScreenDollarIndices", "@", 
       RowBox[{"collect", "@", 
        RowBox[{"SameDummies", "@", 
         RowBox[{"Expand", "[", 
          RowBox[{
           RowBox[{"IndicesDownOnLieDerivatives", "[", "expr", "]"}], "//.", 
           RowBox[{"$Rulecdh", "[", "h", "]"}]}], "]"}]}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"ScreenDollarIndices", "@", 
       RowBox[{"collect", "[", "expr", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SplitPerturbations", "[", 
     RowBox[{"expr_", ",", 
      RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
    RowBox[{"SplitPerturbations", "[", 
     RowBox[{"expr", ",", 
      RowBox[{"{", "}"}], ",", "h"}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"SetNumberOfArguments", "[", 
    RowBox[{"SplitPerturbations", ",", 
     RowBox[{"{", 
      RowBox[{"2", ",", "3"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Protect", "[", "SplitPerturbations", "]"}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5628524165579147`*^9, 3.562852459950708*^9}, {
   3.562852521469261*^9, 3.562852716531543*^9}, {3.56285280270122*^9, 
   3.5628528241763678`*^9}, {3.562852860319392*^9, 3.562852862885676*^9}, 
   3.562852938643854*^9, {3.5628550064183807`*^9, 3.562855008280697*^9}, {
   3.562855305300766*^9, 3.562855307458774*^9}, {3.562855342680915*^9, 
   3.5628553580230713`*^9}, {3.562855395816695*^9, 3.562855493312042*^9}, {
   3.562855672128683*^9, 3.562855674947558*^9}, {3.562855705979685*^9, 
   3.562855745215382*^9}, {3.562855834479697*^9, 3.562855919374391*^9}, {
   3.5628559495462418`*^9, 3.562855959830159*^9}, {3.562855994817829*^9, 
   3.562855996410336*^9}, {3.562856058532906*^9, 3.562856067561316*^9}, {
   3.562856348795816*^9, 3.562856376930189*^9}, {3.562856487634591*^9, 
   3.562856506950039*^9}, {3.562856591515787*^9, 3.5628566179728947`*^9}, {
   3.562856655843794*^9, 3.5628569562560663`*^9}, {3.562857042568256*^9, 
   3.562857051786644*^9}, {3.562857087518365*^9, 3.562857089046356*^9}, {
   3.562867655603628*^9, 3.5628676772981367`*^9}, {3.562867718201264*^9, 
   3.562867810778425*^9}, {3.562867854593412*^9, 3.5628678572974443`*^9}, {
   3.562867928969345*^9, 3.562867991038229*^9}, {3.56286812187549*^9, 
   3.562868124171238*^9}, {3.562868181782991*^9, 3.562868197073942*^9}, {
   3.5628682339102583`*^9, 3.56286828737857*^9}, {3.562868523966084*^9, 
   3.56286857646734*^9}, {3.5628686484223747`*^9, 3.5628686733326*^9}, {
   3.56286879167104*^9, 3.562868800068625*^9}, 3.562905106610783*^9, {
   3.5629051681795187`*^9, 3.562905270867152*^9}, {3.562905305987751*^9, 
   3.5629053445984917`*^9}, {3.562905401394644*^9, 3.562905405537713*^9}, {
   3.562905521835458*^9, 3.562905558824545*^9}, {3.562905647462377*^9, 
   3.5629056561568747`*^9}, {3.5629056887035627`*^9, 3.562905770047553*^9}, {
   3.56290582238654*^9, 3.5629058470903177`*^9}, {3.562905885852364*^9, 
   3.562905890754026*^9}, {3.562905922251334*^9, 3.562905926017475*^9}, {
   3.562905961906399*^9, 3.5629059945219584`*^9}, {3.5629060767069902`*^9, 
   3.5629060941011868`*^9}, {3.56290628925358*^9, 3.562906363768013*^9}, {
   3.562906449134036*^9, 3.562906458460319*^9}, {3.562906716915649*^9, 
   3.562906814550714*^9}, {3.5629072466911173`*^9, 3.5629072499368887`*^9}, {
   3.562907296693408*^9, 3.56290735717111*^9}, {3.5629073908139277`*^9, 
   3.562907552288406*^9}, {3.562907679624529*^9, 3.562907726089517*^9}, {
   3.5629077582714443`*^9, 3.56290778488559*^9}, 3.562907824510667*^9, {
   3.5629078754580812`*^9, 3.562907879150251*^9}, {3.562910344880671*^9, 
   3.562910456180378*^9}, {3.5629107876561213`*^9, 3.562910829754397*^9}, {
   3.5629108978791847`*^9, 3.5629109044897957`*^9}, {3.562910992036852*^9, 
   3.5629109943906918`*^9}, {3.562911029742922*^9, 3.562911160032372*^9}, {
   3.562911211684855*^9, 3.562911425541544*^9}, {3.562911473222527*^9, 
   3.562911489897435*^9}, {3.5629116175219*^9, 3.56291163359575*^9}, {
   3.562911970475092*^9, 3.562911980575223*^9}, {3.562912796667245*^9, 
   3.562912805809779*^9}, {3.5629179948384867`*^9, 3.562917997666113*^9}, {
   3.562918114966703*^9, 3.5629181219821873`*^9}, {3.562918200073524*^9, 
   3.562918201762773*^9}, {3.562923876020924*^9, 3.5629238864679327`*^9}, 
   3.5629241323293257`*^9, {3.5629241686607847`*^9, 3.562924187563471*^9}, {
   3.5629242566247807`*^9, 3.5629242648042707`*^9}, {3.562924304523918*^9, 
   3.5629243176692247`*^9}, {3.5629244006988077`*^9, 
   3.5629244070473957`*^9}, {3.562924628853231*^9, 3.56292466729364*^9}, {
   3.562924765372452*^9, 3.562924782199082*^9}, {3.562925495993284*^9, 
   3.5629255470866203`*^9}, {3.56292558367142*^9, 3.562925583867325*^9}, {
   3.562925621526841*^9, 3.5629256225673447`*^9}, {3.562925815581368*^9, 
   3.5629258251963463`*^9}, {3.562926633820242*^9, 3.56292666242437*^9}, {
   3.562926941914639*^9, 3.562926947042026*^9}, {3.562927069789877*^9, 
   3.562927090235753*^9}, {3.562927277521556*^9, 3.562927277659165*^9}, {
   3.56292730824395*^9, 3.5629273601916656`*^9}, {3.5629274109709063`*^9, 
   3.562927421720168*^9}, {3.56292907257882*^9, 3.5629290854466343`*^9}, {
   3.5629293492026787`*^9, 3.562929374835043*^9}, {3.562929485075652*^9, 
   3.562929485669655*^9}, {3.5629295827465343`*^9, 3.562929590849304*^9}, 
   3.5629357262366447`*^9, {3.56293600824209*^9, 3.562936071104042*^9}, {
   3.5629361067281637`*^9, 3.562936108685486*^9}, {3.56293626746994*^9, 
   3.562936293576869*^9}, {3.562937109345849*^9, 3.562937168901948*^9}, {
   3.562937360942108*^9, 3.562937363687628*^9}, {3.562937448950692*^9, 
   3.562937473050267*^9}, {3.562937856650069*^9, 3.562937880675099*^9}, {
   3.562955592038746*^9, 3.5629555979518423`*^9}, {3.5629567832539473`*^9, 
   3.562956785098456*^9}, {3.562961587081999*^9, 3.562961605923909*^9}, {
   3.563069595207354*^9, 3.5630696339075603`*^9}, {3.563069819921566*^9, 
   3.56306982851803*^9}, {3.563095839025219*^9, 3.563095909774371*^9}, 
   3.5630982104938393`*^9, {3.563099541171316*^9, 3.563099579953062*^9}, {
   3.5631058477975063`*^9, 3.563105856547336*^9}, {3.5631260437318583`*^9, 
   3.563126067827273*^9}, {3.563133116377721*^9, 3.5631331176289263`*^9}, {
   3.563133582229692*^9, 3.563133594306888*^9}, {3.563137187097125*^9, 
   3.563137187362524*^9}, {3.563165902252475*^9, 3.5631659086299*^9}, {
   3.5631660783646393`*^9, 3.563166093787979*^9}, {3.5631894360325336`*^9, 
   3.563189472780759*^9}, {3.563191236279255*^9, 3.563191238551008*^9}, {
   3.563194499267851*^9, 3.5631945160858088`*^9}, {3.563194635872604*^9, 
   3.563194642505599*^9}, {3.5631947735228*^9, 3.563194807659112*^9}, {
   3.563194854307837*^9, 3.5631948586159763`*^9}, {3.563194896299491*^9, 
   3.563194921011524*^9}, {3.5631950936222897`*^9, 3.5631950941138277`*^9}, {
   3.563195182563718*^9, 3.563195188390386*^9}, {3.5631952489749327`*^9, 
   3.563195254338257*^9}, {3.563195691821329*^9, 3.563195791309004*^9}, {
   3.5631958475877333`*^9, 3.563195861083066*^9}, {3.5631961504524107`*^9, 
   3.563196151519375*^9}, {3.563196213905962*^9, 3.56319621706498*^9}, {
   3.563197014870224*^9, 3.563197022201551*^9}, {3.563197351713956*^9, 
   3.563197441455806*^9}, 3.5631975733458023`*^9, {3.563197737877398*^9, 
   3.563197749315443*^9}, {3.563199699379925*^9, 3.563199714913583*^9}, {
   3.563199762873644*^9, 3.5631997692957697`*^9}, {3.563199987568522*^9, 
   3.563200111278008*^9}, {3.563200206893519*^9, 3.563200290523624*^9}, {
   3.563249879628025*^9, 3.563249885007575*^9}, {3.56325080588892*^9, 
   3.5632508073426933`*^9}, {3.563250842625846*^9, 3.563250865881493*^9}, {
   3.563250951725938*^9, 3.563250980524789*^9}, {3.5632627923320007`*^9, 
   3.563262798863152*^9}, {3.563274133052644*^9, 3.563274163982911*^9}, {
   3.56327690794376*^9, 3.5632769436576757`*^9}, {3.563281601995462*^9, 
   3.5632816104426527`*^9}, 3.5635158836922827`*^9, {3.563516681980158*^9, 
   3.5635167486528254`*^9}, {3.563516827248497*^9, 3.563516897328389*^9}, {
   3.563607756864265*^9, 3.56360789590526*^9}, {3.563607926854671*^9, 
   3.5636079573137608`*^9}, {3.563608009974718*^9, 3.5636081462888603`*^9}, {
   3.563608228164453*^9, 3.563608273352408*^9}, 3.563610055145021*^9, {
   3.563610909297475*^9, 3.563610913014409*^9}, {3.5636109738618937`*^9, 
   3.563611017021298*^9}, {3.563616799130622*^9, 3.563616801456029*^9}, {
   3.563620420365302*^9, 3.563620423377379*^9}, {3.5636204795216637`*^9, 
   3.563620489791706*^9}, {3.5636206368410053`*^9, 3.563620637558693*^9}, {
   3.563620693298932*^9, 3.563620693972068*^9}, {3.563620755235409*^9, 
   3.563620761900063*^9}, {3.563621938982972*^9, 3.563621944245366*^9}, {
   3.5636225994889717`*^9, 3.563622604559595*^9}, {3.5637034838320227`*^9, 
   3.563703517275028*^9}, {3.563703604018244*^9, 3.56370361081754*^9}, {
   3.563704407413773*^9, 3.563704423622078*^9}, {3.563708529679536*^9, 
   3.563708575552445*^9}, {3.5637106323327303`*^9, 3.56371067858922*^9}, {
   3.563710777464366*^9, 3.5637107859869223`*^9}, {3.563737988742277*^9, 
   3.5637380234169893`*^9}, 3.563741872759575*^9, {3.5637796974798603`*^9, 
   3.56377971939081*^9}, {3.563780013485862*^9, 3.563780016771063*^9}, {
   3.563780649406559*^9, 3.563780660666103*^9}, {3.5637823073685513`*^9, 
   3.563782394600459*^9}, {3.563782428098522*^9, 3.563782472516926*^9}, {
   3.563782657447805*^9, 3.5637826655333157`*^9}, {3.563782728198793*^9, 
   3.563782749199848*^9}, {3.563783033149207*^9, 3.5637830575556917`*^9}, 
   3.563783093090589*^9, {3.563783220392363*^9, 3.5637832902887163`*^9}, {
   3.563783340806924*^9, 3.5637833734789047`*^9}, {3.563783404788663*^9, 
   3.5637834078011417`*^9}, {3.563784279741947*^9, 3.563784360672297*^9}, {
   3.563784413227977*^9, 3.563784574609989*^9}, {3.563784610935598*^9, 
   3.563784728656878*^9}, {3.563865849361137*^9, 3.5638658930829268`*^9}, {
   3.563878583202306*^9, 3.563878598667478*^9}, {3.563882558182786*^9, 
   3.563882561456833*^9}, {3.563882940433413*^9, 3.563882942297976*^9}, {
   3.563949547152444*^9, 3.563949573538637*^9}, {3.563949668772047*^9, 
   3.563949701982514*^9}, {3.563950032657592*^9, 3.5639500339034452`*^9}, {
   3.563950072150239*^9, 3.563950106410049*^9}, {3.564135012964959*^9, 
   3.564135014202598*^9}, {3.5641682715177813`*^9, 3.564168275626409*^9}, {
   3.5641717908115883`*^9, 3.564171821238686*^9}, {3.564406228516817*^9, 
   3.564406233308413*^9}, {3.5644062938021393`*^9, 3.564406347101707*^9}, {
   3.564406410818582*^9, 3.5644066117745123`*^9}, {3.5644066505309563`*^9, 
   3.5644066898373613`*^9}, {3.564406727803422*^9, 3.564406749234138*^9}, {
   3.564407015499415*^9, 3.564407023056334*^9}, 3.564407116372725*^9, {
   3.564407176323818*^9, 3.564407194906856*^9}, {3.5644072489057426`*^9, 
   3.564407250038659*^9}, {3.5644104915028152`*^9, 3.564410494954287*^9}, {
   3.564410721118602*^9, 3.564410724669277*^9}, {3.564410807148636*^9, 
   3.564410812018652*^9}, {3.5644109829639072`*^9, 3.564411013266807*^9}, {
   3.564411166823515*^9, 3.564411177189744*^9}, {3.564411214875478*^9, 
   3.564411236395726*^9}, {3.5644113235264997`*^9, 3.5644113445942373`*^9}, {
   3.564411407720696*^9, 3.564411430478607*^9}, {3.564411586951376*^9, 
   3.564411588980434*^9}, {3.564411862864236*^9, 3.564411895531382*^9}, {
   3.564411995437627*^9, 3.5644120231172256`*^9}, {3.564414483239661*^9, 
   3.564414488912243*^9}, {3.564417536025161*^9, 3.564417538423377*^9}, {
   3.564417574965026*^9, 3.564417577019937*^9}, {3.5644768990761127`*^9, 
   3.5644769399091063`*^9}, {3.5644770271977577`*^9, 3.564477028595047*^9}, {
   3.564480162111466*^9, 3.56448018737499*^9}, {3.564480325700612*^9, 
   3.5644803268089943`*^9}, {3.564480536711246*^9, 3.564480540182959*^9}, {
   3.564480855765221*^9, 3.564480888387504*^9}, {3.5644820857734756`*^9, 
   3.5644821193446093`*^9}, {3.564482182928316*^9, 3.5644822006989107`*^9}, {
   3.564482238309154*^9, 3.564482242733157*^9}, {3.564482301103109*^9, 
   3.564482337675538*^9}, {3.564482535096418*^9, 3.564482561972519*^9}, {
   3.564482702936996*^9, 3.5644827195261383`*^9}, {3.564485018013644*^9, 
   3.564485019711907*^9}, {3.5644850965290613`*^9, 3.564485105481379*^9}, {
   3.5644877884326344`*^9, 3.564487794568677*^9}, 3.564487856463213*^9, {
   3.564487971174859*^9, 3.564487978044776*^9}, {3.564494746265608*^9, 
   3.56449479609063*^9}, {3.56454787672775*^9, 3.564547979973995*^9}, {
   3.564548055544333*^9, 3.564548175448244*^9}, {3.564548242252202*^9, 
   3.5645482628809443`*^9}, {3.564549014617476*^9, 3.564549106558462*^9}, {
   3.564549257472334*^9, 3.564549266846478*^9}, {3.5645527524083967`*^9, 
   3.564552829507935*^9}, {3.564552876519161*^9, 3.564552876678666*^9}, {
   3.564553140870921*^9, 3.564553147237072*^9}, {3.564553208149702*^9, 
   3.5645532908114977`*^9}, {3.5645536577045717`*^9, 3.564553665060978*^9}, 
   3.5645539718851547`*^9, {3.56455411029329*^9, 3.564554147591611*^9}, {
   3.564554368783483*^9, 3.564554380510343*^9}, {3.564554491403123*^9, 
   3.564554553741049*^9}, {3.5645546291263742`*^9, 3.564554722663958*^9}, {
   3.56455537815193*^9, 3.564555384387025*^9}, {3.5646277486378098`*^9, 
   3.5646277618970213`*^9}, {3.564627847903694*^9, 3.5646278492388372`*^9}, {
   3.564627970031576*^9, 3.56462800039342*^9}, 3.564630864702817*^9, {
   3.564631093414463*^9, 3.564631097855893*^9}, {3.5646341982224207`*^9, 
   3.5646341996777277`*^9}, {3.5646346388800907`*^9, 3.564634646978853*^9}, {
   3.56463473859181*^9, 3.5646347456170607`*^9}, {3.564634779380975*^9, 
   3.5646347795408373`*^9}, {3.564634825563258*^9, 3.564634826825548*^9}, {
   3.564635774140471*^9, 3.5646357773281116`*^9}, {3.5646359640382338`*^9, 
   3.5646359752478523`*^9}, {3.564636566848361*^9, 3.564636591442293*^9}, {
   3.564636801500062*^9, 3.5646368015717163`*^9}, {3.564636872784657*^9, 
   3.564636888739345*^9}, {3.564637009186913*^9, 3.564637045993822*^9}, {
   3.564637199382668*^9, 3.564637202175243*^9}, {3.564637262524954*^9, 
   3.564637264534471*^9}, {3.564637376393779*^9, 3.564637382659829*^9}, 
   3.564637522551907*^9, {3.564637640434972*^9, 3.564637641809186*^9}, {
   3.5646376837930717`*^9, 3.5646376846285267`*^9}, {3.564637806054147*^9, 
   3.56463780789657*^9}, {3.5646379188448772`*^9, 3.564637936756772*^9}, {
   3.5646380600774193`*^9, 3.5646380734520617`*^9}, {3.5646381090692*^9, 
   3.5646381351968737`*^9}, {3.564638240537498*^9, 3.564638244810758*^9}, {
   3.564638285218979*^9, 3.564638292181546*^9}, {3.564638339522517*^9, 
   3.564638371441064*^9}, {3.564638545570763*^9, 3.564638549654153*^9}, {
   3.564638749481962*^9, 3.564638767860092*^9}, {3.564638829562582*^9, 
   3.564638838785118*^9}, {3.5646389745072727`*^9, 3.564638983785885*^9}, {
   3.564639022291367*^9, 3.564639033093417*^9}, {3.5646391264451933`*^9, 
   3.564639169777048*^9}, {3.564639250222288*^9, 3.564639252084536*^9}, {
   3.564639346785388*^9, 3.564639394951599*^9}, {3.5646395619084387`*^9, 
   3.564639566888175*^9}, {3.564640374677628*^9, 3.564640384935698*^9}, {
   3.564640957009074*^9, 3.564640974179881*^9}, {3.5646411300066566`*^9, 
   3.564641148769965*^9}, {3.564641727867228*^9, 3.564641731836069*^9}, {
   3.564641920937546*^9, 3.564641928121626*^9}, {3.564642088827351*^9, 
   3.5646421418255863`*^9}, {3.564642535630274*^9, 3.564642551031948*^9}, {
   3.5646426227140627`*^9, 3.5646427104953127`*^9}, {3.564642920102272*^9, 
   3.564642923796947*^9}, {3.564642959264131*^9, 3.5646429852008333`*^9}, {
   3.5646430503759727`*^9, 3.5646430790469103`*^9}, {3.5646587214777737`*^9, 
   3.5646587513812637`*^9}, {3.564659020380402*^9, 3.564659020944235*^9}, 
   3.5646591067868032`*^9, {3.5646591911791573`*^9, 3.564659195803722*^9}, {
   3.564666661132585*^9, 3.564666670871717*^9}, {3.564666707858262*^9, 
   3.564666710578855*^9}, {3.564668262177066*^9, 3.56466826750177*^9}, {
   3.5646684898279867`*^9, 3.5646684901988363`*^9}, 3.564668570210752*^9, 
   3.564668782884563*^9, {3.5646688130432177`*^9, 3.564668818271387*^9}, {
   3.5646689329955807`*^9, 3.564668934221806*^9}, {3.564669055899938*^9, 
   3.564669063434751*^9}, {3.564669141254422*^9, 3.564669143166037*^9}, {
   3.564716396103277*^9, 3.5647164032407427`*^9}, {3.564716736453866*^9, 
   3.564716742642951*^9}, {3.564719093507579*^9, 3.564719151256853*^9}, {
   3.5647192534535303`*^9, 3.5647194259959183`*^9}, {3.564719576167082*^9, 
   3.5647195800576143`*^9}, {3.564719681094248*^9, 3.5647196912496977`*^9}, {
   3.56472379582685*^9, 3.564723850333194*^9}, {3.564723898600716*^9, 
   3.5647239007726*^9}, {3.56472401810216*^9, 3.5647240187960167`*^9}, {
   3.564724469527577*^9, 3.564724471899591*^9}, {3.564724596197064*^9, 
   3.564724637618062*^9}, {3.564724817339123*^9, 3.5647248301676073`*^9}, {
   3.564725021424034*^9, 3.564725038860404*^9}, {3.564726512738955*^9, 
   3.564726517990505*^9}, {3.564740155076425*^9, 3.564740177572233*^9}, {
   3.564740390214847*^9, 3.564740398052825*^9}, {3.564740556649097*^9, 
   3.564740584430641*^9}, {3.564741127918716*^9, 3.5647411322760468`*^9}, {
   3.564741213876336*^9, 3.564741216562441*^9}, {3.564741255388933*^9, 
   3.564741279621955*^9}, {3.564741530735968*^9, 3.564741546660595*^9}, {
   3.564742862290247*^9, 3.564742954108136*^9}, {3.564743073720673*^9, 
   3.56474311130263*^9}, 3.564743161668799*^9, {3.564747007706696*^9, 
   3.564747024930089*^9}, {3.5647472742721977`*^9, 3.564747305948605*^9}, 
   3.5647494137615337`*^9, {3.56474952980365*^9, 3.564749532433619*^9}, 
   3.564755834604056*^9, {3.564755908322631*^9, 3.564755910263755*^9}, 
   3.564756011417572*^9, {3.56522326255787*^9, 3.5652232661408253`*^9}, {
   3.565453629281747*^9, 3.5654536417339582`*^9}, {3.5654536952187233`*^9, 
   3.5654537067665854`*^9}, {3.565454594115212*^9, 3.565454597300219*^9}, {
   3.5654547270521297`*^9, 3.56545473023044*^9}, {3.565455110422041*^9, 
   3.565455113083831*^9}, {3.565455322858988*^9, 3.565455326646501*^9}, {
   3.565456083179336*^9, 3.5654561484055243`*^9}, {3.56545679549151*^9, 
   3.565456796698515*^9}, {3.565458192157947*^9, 3.565458197413221*^9}, {
   3.5654590988317537`*^9, 3.565459100146474*^9}, {3.5654598124740343`*^9, 
   3.565459813759243*^9}, 3.565491676900778*^9, {3.565491781813552*^9, 
   3.565491809829011*^9}, {3.565492241904114*^9, 3.565492244523601*^9}, {
   3.565492603756583*^9, 3.565492668736339*^9}, {3.5654940455387697`*^9, 
   3.565494062529704*^9}, {3.565494947936805*^9, 3.565494949943487*^9}, {
   3.565495060170371*^9, 3.565495089189231*^9}, {3.5654961026597233`*^9, 
   3.56549617547344*^9}, {3.565496494834783*^9, 3.565496540352158*^9}, {
   3.5654965853034563`*^9, 3.565496600638064*^9}, {3.565497353377378*^9, 
   3.5654973755977087`*^9}, {3.565497525885971*^9, 3.565497547351245*^9}, {
   3.565498162336986*^9, 3.5654981649062767`*^9}, {3.565498211043154*^9, 
   3.565498246883564*^9}, {3.565498362839737*^9, 3.565498377703525*^9}, {
   3.565498438940349*^9, 3.565498442027712*^9}, {3.565498530934744*^9, 
   3.565498619585636*^9}, {3.565498670789104*^9, 3.565498676289817*^9}, {
   3.565498743371395*^9, 3.56549876102388*^9}, {3.565498826074419*^9, 
   3.565498853248682*^9}, {3.5654989489515533`*^9, 3.565498956786448*^9}, 
   3.56549904560989*^9, {3.5654991709645967`*^9, 3.5654991782039137`*^9}, {
   3.5654992907730837`*^9, 3.565499296206028*^9}, {3.565500075793585*^9, 
   3.565500121554515*^9}, {3.565500285074683*^9, 3.5655002879527397`*^9}, {
   3.565500766855811*^9, 3.5655008337845*^9}, {3.565500965459591*^9, 
   3.5655009979386806`*^9}, {3.565501147064465*^9, 3.565501156783128*^9}, {
   3.565501346024048*^9, 3.565501370501709*^9}, {3.565501408003359*^9, 
   3.5655014126079817`*^9}, {3.56550148459046*^9, 3.5655015303302917`*^9}, {
   3.5655018047189693`*^9, 3.565501804980715*^9}, {3.565502145169126*^9, 
   3.565502205694474*^9}, {3.565502362174672*^9, 3.565502403037237*^9}, {
   3.565502443134059*^9, 3.565502463335429*^9}, {3.565503002234098*^9, 
   3.565503012215701*^9}, {3.565503050332426*^9, 3.5655030525229807`*^9}, {
   3.565503812250792*^9, 3.565503816606955*^9}, {3.565504024774507*^9, 
   3.565504031153194*^9}, {3.565513879486882*^9, 3.565513882926646*^9}, {
   3.565514963797585*^9, 3.56551497924972*^9}, {3.56551587942415*^9, 
   3.565515892112117*^9}, {3.565516081940497*^9, 3.565516095026733*^9}, {
   3.565517534837133*^9, 3.5655175378104963`*^9}, {3.565517661615752*^9, 
   3.565517672431637*^9}, {3.565520194194096*^9, 3.565520247177485*^9}, {
   3.565522129650607*^9, 3.56552217260501*^9}, {3.565522981690695*^9, 
   3.565523000373163*^9}, {3.565523937314163*^9, 3.565523947053019*^9}, 
   3.5655282772844553`*^9, {3.5655286118475246`*^9, 3.565528613770239*^9}, {
   3.5655287094703293`*^9, 3.565528743691184*^9}, {3.56553012229782*^9, 
   3.565530213261747*^9}, {3.565530327500042*^9, 3.565530329289712*^9}, {
   3.565530904132111*^9, 3.5655309813635*^9}, {3.5655328053417377`*^9, 
   3.565532810436142*^9}, {3.565539558452018*^9, 3.565539591983054*^9}, 
   3.565539684073165*^9, {3.565540027697304*^9, 3.5655400415043077`*^9}, {
   3.565540110578553*^9, 3.565540111059059*^9}, {3.5657727391775846`*^9, 
   3.565772790075531*^9}, {3.565772888428319*^9, 3.5657729009577227`*^9}, {
   3.56577294302561*^9, 3.5657729476570807`*^9}, {3.5657733193802547`*^9, 
   3.565773325659298*^9}, {3.565773380460644*^9, 3.565773399153098*^9}, 
   3.565773508395957*^9, {3.565774120362013*^9, 3.565774145837262*^9}, {
   3.567258501084064*^9, 3.567258501205275*^9}, {3.567258759978113*^9, 
   3.5672587601012783`*^9}, {3.567260826421777*^9, 3.567260826526888*^9}, {
   3.568187608539379*^9, 3.5681876129229527`*^9}, {3.568187683142952*^9, 
   3.568187686740972*^9}, 3.568298433680159*^9, {3.5684357533582277`*^9, 
   3.568435756149407*^9}, {3.568436087227141*^9, 3.568436089306863*^9}, {
   3.5684361609726353`*^9, 3.568436164355722*^9}, {3.5684363416543407`*^9, 
   3.568436343640133*^9}, {3.5684363900828733`*^9, 3.5684364070643997`*^9}, {
   3.568436760621532*^9, 3.5684367734996157`*^9}, {3.568438071533403*^9, 
   3.568438156652874*^9}, {3.568438304816889*^9, 3.568438330288563*^9}, {
   3.568438531571601*^9, 3.568438583019655*^9}, {3.568438681626318*^9, 
   3.568438700217389*^9}, {3.568438751141891*^9, 3.568438838763982*^9}, {
   3.568440620358314*^9, 3.568440668104886*^9}, {3.568442674591185*^9, 
   3.568442756243031*^9}, {3.568442798995919*^9, 3.568442812408473*^9}, {
   3.568442927970283*^9, 3.568442969829801*^9}, 3.56845794870347*^9, {
   3.569340499406437*^9, 3.5693405019035892`*^9}, {3.5693407143346643`*^9, 
   3.569340716258359*^9}, {3.569413609076824*^9, 3.569413609707932*^9}, {
   3.5694189404191732`*^9, 3.56941894234761*^9}, {3.5695778928346643`*^9, 
   3.569577895444419*^9}, {3.569578995925724*^9, 3.569579016392487*^9}, 
   3.569579095303886*^9, {3.5696691452724*^9, 3.5696691464701357`*^9}, {
   3.5699013065853558`*^9, 3.569901330889339*^9}, {3.569901793529573*^9, 
   3.569901810037979*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["2.9 Automatization of the whole process", "Subsubsection",
 CellChangeTimes->{{3.563741878461034*^9, 3.5637419428974333`*^9}, {
  3.564719702105548*^9, 3.564719708903805*^9}, {3.570011319827112*^9, 
  3.570011320572576*^9}, {3.5771607876993504`*^9, 3.5771607884826612`*^9}}],

Cell["\<\
These are more advanced functions for a user not interested in understanding \
the details, and who wants a quick and simple answer\
\>", "Text",
 CellChangeTimes->{{3.563741918380197*^9, 3.563741933338868*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ToxPandFromRules", "[", 
     RowBox[{"expr_", ",", "RulesList_List", ",", "h_", 
      RowBox[{"(*", 
       RowBox[{"?", "InducedMetricQ"}], "*)"}], ",", "n_"}], 
     RowBox[{"(*", 
      RowBox[{"?", "IntegerQ"}], "*)"}], "]"}], ":=", "\[IndentingNewLine]", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"g", "=", 
        RowBox[{"First", "@", 
         RowBox[{"InducedFrom", "@", "h"}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Not", "[", 
           RowBox[{"DefTensorQ", "[", 
            RowBox[{"ConformalMetricName", "[", 
             RowBox[{"g", ",", 
              RowBox[{"a", "[", "h", "]"}]}], "]"}], "]"}], "]"}], "&&", 
          RowBox[{
           RowBox[{"SpaceType", "[", "h", "]"}], "=!=", 
           "\"\<Minkowski\>\""}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{"$DefInfoQ", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{
              "\"\<** Warning: The conformally related metric \>\"", ",", 
               RowBox[{"ConformalMetricName", "[", 
                RowBox[{"g", ",", 
                 RowBox[{"a", "[", "h", "]"}]}], "]"}], ",", 
               "\"\<  was not previously defined **\>\""}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
             "Print", "[", 
              "\"\<** We call DefConformalMetric in order to define it. \
**\>\"", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"DefConformalMetric", "[", 
           RowBox[{"g", ",", 
            RowBox[{"a", "[", "h", "]"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"SplitPerturbations", "[", 
        RowBox[{
         RowBox[{"ExpandPerturbation", "@", 
          RowBox[{"Perturbed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Conformal", "[", 
              RowBox[{"g", ",", 
               RowBox[{"ConformalMetricName", "[", 
                RowBox[{"g", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"SpaceType", "[", "h", "]"}], "=!=", 
                    "\"\<Minkowski\>\""}], ",", 
                   RowBox[{"a", "[", "h", "]"}], ",", "1"}], "]"}]}], "]"}]}],
               "]"}], "[", "expr", "]"}], ",", "n"}], "]"}]}], ",", 
         "RulesList", ",", "h"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ToxPandFromRules", "[", 
     RowBox[{"expr_", ",", 
      RowBox[{"h_", "?", "InducedMetricQ"}], ",", "n_"}], "]"}], ":=", 
    RowBox[{"ToxPandFromRules", "[", 
     RowBox[{"expr", ",", 
      RowBox[{"{", "}"}], ",", "h", ",", "n"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"ToxPandFromRules", ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "4"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "ToxPandFromRules", "]"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ToxPand", "[", 
    RowBox[{"expr_", ",", "dg_", ",", "uf_", ",", "duf_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
     RowBox[{"gauge_", "?", "GaugeQ"}], ",", 
     RowBox[{"order_", "?", "IntegerQ"}], ",", 
     RowBox[{"tiltvalue_:", "\"\<NotTilted\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "ruleslist", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"g", "=", 
         RowBox[{"First", "@", 
          RowBox[{"InducedFrom", "@", "h"}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ruleslist", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"SplitMetric", "[", 
            RowBox[{"g", ",", "dg", ",", "h", ",", "gauge"}], "]"}], ",", 
           RowBox[{"SplitMatter", "[", 
            RowBox[{"uf", ",", "duf", ",", 
             RowBox[{"-", "1"}], ",", "h", ",", "gauge", ",", "order", ",", 
             "tiltvalue"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Not", "[", 
            RowBox[{"DefTensorQ", "[", 
             RowBox[{"Evaluate", "[", 
              RowBox[{"ConformalMetricName", "[", 
               RowBox[{"g", ",", 
                RowBox[{"a", "[", "h", "]"}]}], "]"}], "]"}], "]"}], "]"}], "&&", 
           RowBox[{
            RowBox[{"SpaceType", "[", "h", "]"}], "=!=", 
            "\"\<Minkowski\>\""}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{"$DefInfoQ", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<** Warning: The conformally related metric \>\"", ",", 
                RowBox[{"ConformalMetricName", "[", 
                 RowBox[{"g", ",", 
                  RowBox[{"a", "[", "h", "]"}]}], "]"}], ",", 
                "\"\<  was not previously defined **\>\""}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
              "Print", "[", 
               "\"\<** We call DefConformalMetric in order to define it. **\>\
\"", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"DefConformalMetric", "[", 
            RowBox[{"g", ",", 
             RowBox[{"a", "[", "h", "]"}]}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"SplitPerturbations", "[", 
         RowBox[{
          RowBox[{"ExpandPerturbation", "@", 
           RowBox[{"Perturbed", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Conformal", "[", 
               RowBox[{"g", ",", 
                RowBox[{"ConformalMetricName", "[", 
                 RowBox[{"g", ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"SpaceType", "[", "h", "]"}], "=!=", 
                    "\"\<Minkowski\>\""}], ",", 
                    RowBox[{"a", "[", "h", "]"}], ",", "1"}], "]"}]}], 
                 "]"}]}], "]"}], "[", "expr", "]"}], ",", "order"}], "]"}]}], 
          ",", "ruleslist", ",", "h"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetNumberOfArguments", "[", 
   RowBox[{"ToxPand", ",", 
    RowBox[{"{", 
     RowBox[{"7", ",", "8"}], "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "ToxPandFromRules", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5628524165579147`*^9, 3.562852459950708*^9}, {
   3.562852521469261*^9, 3.562852716531543*^9}, {3.56285280270122*^9, 
   3.5628528241763678`*^9}, {3.562852860319392*^9, 3.562852862885676*^9}, 
   3.562852938643854*^9, {3.5628550064183807`*^9, 3.562855008280697*^9}, {
   3.562855305300766*^9, 3.562855307458774*^9}, {3.562855342680915*^9, 
   3.5628553580230713`*^9}, {3.562855395816695*^9, 3.562855493312042*^9}, {
   3.562855672128683*^9, 3.562855674947558*^9}, {3.562855705979685*^9, 
   3.562855745215382*^9}, {3.562855834479697*^9, 3.562855919374391*^9}, {
   3.5628559495462418`*^9, 3.562855959830159*^9}, {3.562855994817829*^9, 
   3.562855996410336*^9}, {3.562856058532906*^9, 3.562856067561316*^9}, {
   3.562856348795816*^9, 3.562856376930189*^9}, {3.562856487634591*^9, 
   3.562856506950039*^9}, {3.562856591515787*^9, 3.5628566179728947`*^9}, {
   3.562856655843794*^9, 3.5628569562560663`*^9}, {3.562857042568256*^9, 
   3.562857051786644*^9}, {3.562857087518365*^9, 3.562857089046356*^9}, {
   3.562867655603628*^9, 3.5628676772981367`*^9}, {3.562867718201264*^9, 
   3.562867810778425*^9}, {3.562867854593412*^9, 3.5628678572974443`*^9}, {
   3.562867928969345*^9, 3.562867991038229*^9}, {3.56286812187549*^9, 
   3.562868124171238*^9}, {3.562868181782991*^9, 3.562868197073942*^9}, {
   3.5628682339102583`*^9, 3.56286828737857*^9}, {3.562868523966084*^9, 
   3.56286857646734*^9}, {3.5628686484223747`*^9, 3.5628686733326*^9}, {
   3.56286879167104*^9, 3.562868800068625*^9}, 3.562905106610783*^9, {
   3.5629051681795187`*^9, 3.562905270867152*^9}, {3.562905305987751*^9, 
   3.5629053445984917`*^9}, {3.562905401394644*^9, 3.562905405537713*^9}, {
   3.562905521835458*^9, 3.562905558824545*^9}, {3.562905647462377*^9, 
   3.5629056561568747`*^9}, {3.5629056887035627`*^9, 3.562905770047553*^9}, {
   3.56290582238654*^9, 3.5629058470903177`*^9}, {3.562905885852364*^9, 
   3.562905890754026*^9}, {3.562905922251334*^9, 3.562905926017475*^9}, {
   3.562905961906399*^9, 3.5629059945219584`*^9}, {3.5629060767069902`*^9, 
   3.5629060941011868`*^9}, {3.56290628925358*^9, 3.562906363768013*^9}, {
   3.562906449134036*^9, 3.562906458460319*^9}, {3.562906716915649*^9, 
   3.562906814550714*^9}, {3.5629072466911173`*^9, 3.5629072499368887`*^9}, {
   3.562907296693408*^9, 3.56290735717111*^9}, {3.5629073908139277`*^9, 
   3.562907552288406*^9}, {3.562907679624529*^9, 3.562907726089517*^9}, {
   3.5629077582714443`*^9, 3.56290778488559*^9}, 3.562907824510667*^9, {
   3.5629078754580812`*^9, 3.562907879150251*^9}, {3.562910344880671*^9, 
   3.562910456180378*^9}, {3.5629107876561213`*^9, 3.562910829754397*^9}, {
   3.5629108978791847`*^9, 3.5629109044897957`*^9}, {3.562910992036852*^9, 
   3.5629109943906918`*^9}, {3.562911029742922*^9, 3.562911160032372*^9}, {
   3.562911211684855*^9, 3.562911425541544*^9}, {3.562911473222527*^9, 
   3.562911489897435*^9}, {3.5629116175219*^9, 3.56291163359575*^9}, {
   3.562911970475092*^9, 3.562911980575223*^9}, {3.562912796667245*^9, 
   3.562912805809779*^9}, {3.5629179948384867`*^9, 3.562917997666113*^9}, {
   3.562918114966703*^9, 3.5629181219821873`*^9}, {3.562918200073524*^9, 
   3.562918201762773*^9}, {3.562923876020924*^9, 3.5629238864679327`*^9}, 
   3.5629241323293257`*^9, {3.5629241686607847`*^9, 3.562924187563471*^9}, {
   3.5629242566247807`*^9, 3.5629242648042707`*^9}, {3.562924304523918*^9, 
   3.5629243176692247`*^9}, {3.5629244006988077`*^9, 
   3.5629244070473957`*^9}, {3.562924628853231*^9, 3.56292466729364*^9}, {
   3.562924765372452*^9, 3.562924782199082*^9}, {3.562925495993284*^9, 
   3.5629255470866203`*^9}, {3.56292558367142*^9, 3.562925583867325*^9}, {
   3.562925621526841*^9, 3.5629256225673447`*^9}, {3.562925815581368*^9, 
   3.5629258251963463`*^9}, {3.562926633820242*^9, 3.56292666242437*^9}, {
   3.562926941914639*^9, 3.562926947042026*^9}, {3.562927069789877*^9, 
   3.562927090235753*^9}, {3.562927277521556*^9, 3.562927277659165*^9}, {
   3.56292730824395*^9, 3.5629273601916656`*^9}, {3.5629274109709063`*^9, 
   3.562927421720168*^9}, {3.56292907257882*^9, 3.5629290854466343`*^9}, {
   3.5629293492026787`*^9, 3.562929374835043*^9}, {3.562929485075652*^9, 
   3.562929485669655*^9}, {3.5629295827465343`*^9, 3.562929590849304*^9}, 
   3.5629357262366447`*^9, {3.56293600824209*^9, 3.562936071104042*^9}, {
   3.5629361067281637`*^9, 3.562936108685486*^9}, {3.56293626746994*^9, 
   3.562936293576869*^9}, {3.562937109345849*^9, 3.562937168901948*^9}, {
   3.562937360942108*^9, 3.562937363687628*^9}, {3.562937448950692*^9, 
   3.562937473050267*^9}, {3.562937856650069*^9, 3.562937880675099*^9}, {
   3.562955592038746*^9, 3.5629555979518423`*^9}, {3.5629567832539473`*^9, 
   3.562956785098456*^9}, {3.562961587081999*^9, 3.562961605923909*^9}, {
   3.563069595207354*^9, 3.5630696339075603`*^9}, {3.563069819921566*^9, 
   3.56306982851803*^9}, {3.563095839025219*^9, 3.563095909774371*^9}, 
   3.5630982104938393`*^9, {3.563099541171316*^9, 3.563099579953062*^9}, {
   3.5631058477975063`*^9, 3.563105856547336*^9}, {3.5631260437318583`*^9, 
   3.563126067827273*^9}, {3.563133116377721*^9, 3.5631331176289263`*^9}, {
   3.563133582229692*^9, 3.563133594306888*^9}, {3.563137187097125*^9, 
   3.563137187362524*^9}, {3.563165902252475*^9, 3.5631659086299*^9}, {
   3.5631660783646393`*^9, 3.563166093787979*^9}, {3.5631894360325336`*^9, 
   3.563189472780759*^9}, {3.563191236279255*^9, 3.563191238551008*^9}, {
   3.563194499267851*^9, 3.5631945160858088`*^9}, {3.563194635872604*^9, 
   3.563194642505599*^9}, {3.5631947735228*^9, 3.563194807659112*^9}, {
   3.563194854307837*^9, 3.5631948586159763`*^9}, {3.563194896299491*^9, 
   3.563194921011524*^9}, {3.5631950936222897`*^9, 3.5631950941138277`*^9}, {
   3.563195182563718*^9, 3.563195188390386*^9}, {3.5631952489749327`*^9, 
   3.563195254338257*^9}, {3.563195691821329*^9, 3.563195791309004*^9}, {
   3.5631958475877333`*^9, 3.563195861083066*^9}, {3.5631961504524107`*^9, 
   3.563196151519375*^9}, {3.563196213905962*^9, 3.56319621706498*^9}, {
   3.563197014870224*^9, 3.563197022201551*^9}, {3.563197351713956*^9, 
   3.563197441455806*^9}, 3.5631975733458023`*^9, {3.563197737877398*^9, 
   3.563197749315443*^9}, {3.563199699379925*^9, 3.563199714913583*^9}, {
   3.563199762873644*^9, 3.5631997692957697`*^9}, {3.563199987568522*^9, 
   3.563200111278008*^9}, {3.563200206893519*^9, 3.563200290523624*^9}, {
   3.563249879628025*^9, 3.563249885007575*^9}, {3.56325080588892*^9, 
   3.5632508073426933`*^9}, {3.563250842625846*^9, 3.563250865881493*^9}, {
   3.563250951725938*^9, 3.563250980524789*^9}, {3.5632627923320007`*^9, 
   3.563262798863152*^9}, {3.563274133052644*^9, 3.563274163982911*^9}, {
   3.56327690794376*^9, 3.5632769436576757`*^9}, {3.563281601995462*^9, 
   3.5632816104426527`*^9}, 3.5635158836922827`*^9, {3.563516681980158*^9, 
   3.5635167486528254`*^9}, {3.563516827248497*^9, 3.563516897328389*^9}, {
   3.563607756864265*^9, 3.56360789590526*^9}, {3.563607926854671*^9, 
   3.5636079573137608`*^9}, {3.563608009974718*^9, 3.5636081462888603`*^9}, {
   3.563608228164453*^9, 3.563608273352408*^9}, 3.563610055145021*^9, {
   3.563610909297475*^9, 3.563610913014409*^9}, {3.5636109738618937`*^9, 
   3.563611017021298*^9}, {3.563616799130622*^9, 3.563616801456029*^9}, {
   3.563620420365302*^9, 3.563620423377379*^9}, {3.5636204795216637`*^9, 
   3.563620489791706*^9}, {3.5636206368410053`*^9, 3.563620637558693*^9}, {
   3.563620693298932*^9, 3.563620693972068*^9}, {3.563620755235409*^9, 
   3.563620761900063*^9}, {3.563621938982972*^9, 3.563621944245366*^9}, {
   3.5636225994889717`*^9, 3.563622604559595*^9}, {3.5637034838320227`*^9, 
   3.563703517275028*^9}, {3.563703604018244*^9, 3.56370361081754*^9}, {
   3.563704407413773*^9, 3.563704423622078*^9}, {3.563708529679536*^9, 
   3.563708575552445*^9}, {3.5637106323327303`*^9, 3.56371067858922*^9}, {
   3.563710777464366*^9, 3.5637107859869223`*^9}, {3.563737988742277*^9, 
   3.5637380234169893`*^9}, {3.563741872759575*^9, 3.5637418763202353`*^9}, {
   3.563779155856762*^9, 3.563779160506233*^9}, {3.563865918469207*^9, 
   3.563865937266115*^9}, {3.563865967523864*^9, 3.5638660255645523`*^9}, {
   3.563866059603855*^9, 3.563866124672698*^9}, {3.563866190173862*^9, 
   3.563866190305456*^9}, {3.563866816156767*^9, 3.5638668180109043`*^9}, 
   3.564134907085648*^9, {3.564135005402932*^9, 3.564135006625469*^9}, {
   3.564480596040924*^9, 3.56448059659496*^9}, 3.5645539740868464`*^9, {
   3.56455402597003*^9, 3.564554026360002*^9}, {3.564630865725464*^9, 
   3.56463086687302*^9}, 3.564673527526607*^9, {3.564725049560597*^9, 
   3.564725122791863*^9}, {3.5647265195250597`*^9, 3.5647265233713093`*^9}, 
   3.564727015650693*^9, {3.564727056597416*^9, 3.564727084872876*^9}, {
   3.564731992055139*^9, 3.56473200278835*^9}, {3.564738884826412*^9, 
   3.56473888667835*^9}, {3.564739008480723*^9, 3.564739014751598*^9}, {
   3.564739202694957*^9, 3.564739244354299*^9}, {3.5650865441634693`*^9, 
   3.5650865569408712`*^9}, {3.56508675357723*^9, 3.565086789892098*^9}, {
   3.565086970646171*^9, 3.565087015188548*^9}, {3.5650872616529818`*^9, 
   3.565087281676724*^9}, {3.5650875203971853`*^9, 3.565087544038047*^9}, {
   3.566316845491311*^9, 3.5663168466117363`*^9}, {3.568438901221279*^9, 
   3.5684389016367273`*^9}, 3.569132575689479*^9, 3.56913280589388*^9, {
   3.569330283416771*^9, 3.569330302184466*^9}, {3.5789793748830643`*^9, 
   3.5789794188238373`*^9}}],

Cell[BoxData[
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"ToxPandFromRules", ",", 
   RowBox[{"{", 
    RowBox[{"3", ",", "4"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.5691323940102386`*^9, 3.569230313269347*^9, 
  3.5693402548584642`*^9, 3.569340515525509*^9, 3.5693407338126497`*^9, 
  3.569418997506999*^9, 3.569578895517424*^9}],

Cell[BoxData[
 RowBox[{"{", "\<\"ToxPandFromRules\"\>", "}"}]], "Output",
 CellChangeTimes->{3.5691323940102386`*^9, 3.569230313269347*^9, 
  3.5693402548584642`*^9, 3.569340515525509*^9, 3.5693407338126497`*^9, 
  3.569418997506999*^9, 3.569578895518858*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["2.10 Vizualization of the results", "Subsubsection",
 CellChangeTimes->{{3.570011325306006*^9, 3.570011332179335*^9}, {
  3.577160790314193*^9, 3.57716079097768*^9}}],

Cell["Function to project along time and space", "Text",
 CellChangeTimes->{{3.563738042826597*^9, 3.5637380484406157`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ExtractComponents", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", "proj_List", ",", 
     "ListIndsToContract_List"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Catch", "@", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"frees", "=", 
         RowBox[{"List", "@@", 
          RowBox[{"FindFreeIndices", "[", "expr", "]"}]}]}], ",", 
        RowBox[{"u", "=", 
         RowBox[{"Last", "@", 
          RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "proj", "]"}], "=!=", 
          RowBox[{"Length", "[", "frees", "]"}]}], ",", 
         RowBox[{"Throw", "@", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"xPanding", "::", "error"}], ",", 
            "\"\<Number of projectors not equal to number of free \
indices.\>\""}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Sort", "[", "ListIndsToContract", "]"}], "=!=", "frees"}], 
         ",", 
         RowBox[{"Throw", "@", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"xPanding", "::", "error"}], ",", " ", 
            "\"\<List of indices on which the projection is taken is not \
equal to the list of free indices\>\""}], "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "frees", " ", "is", " ", "the", " ", "list", " ", "of", " ", "free", 
         " ", "indices", " ", "in", " ", "the", " ", "expression"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Select", "[", 
            RowBox[{"proj", ",", 
             RowBox[{
              RowBox[{"And", "[", 
               RowBox[{
                RowBox[{"#", "=!=", "u"}], ",", 
                RowBox[{"#", "=!=", "h"}], ",", 
                RowBox[{"#", "=!=", "\"\<Space\>\""}], ",", 
                RowBox[{"#", "=!=", "\"\<Time\>\""}]}], "]"}], "&"}]}], "]"}],
            "]"}], "\[NotEqual]", "0"}], ",", 
         RowBox[{"Throw", "@", 
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"ExtractComponents", "::", "invalidprojector"}], ",", 
            "proj"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Then", " ", "it", " ", "performs", " ", "the", " ", "contraction", 
         " ", "according", " ", "to", " ", "what", " ", "is", " ", "written", 
         " ", "in", " ", "proj___"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"PostProcess", "[", "h", "]"}], "[", 
        RowBox[{"NoScalar", "@", 
         RowBox[{"org", "@", 
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", "dummy", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Fold", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"dummy", "=", 
                  RowBox[{
                   RowBox[{"Function", "[", 
                    RowBox[{
                    RowBox[{"{", "ind", "}"}], ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"UpIndexQ", "[", "ind", "]"}], ",", "UpIndex", 
                    ",", "DownIndex"}], "]"}], "[", 
                    RowBox[{"DummyIn", "[", 
                    RowBox[{"VBundleOfIndex", "[", "ind", "]"}], "]"}], 
                    "]"}]}], "]"}], "[", 
                   RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", 
                 RowBox[{
                  RowBox[{"Switch", "[", 
                   RowBox[{
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "h", ",", 
                    RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "dummy"}], ",", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    "\"\<Space\>\"", ",", 
                    RowBox[{"h", "[", 
                    RowBox[{
                    RowBox[{"-", "dummy"}], ",", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", "u", ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"UpIndexQ", "[", "dummy", "]"}], ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "*", 
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}], "]"}]}], ",", 
                    
                    RowBox[{"1", "*", 
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}]}]}], 
                    "]"}], "*", 
                    RowBox[{"u", "[", 
                    RowBox[{"-", "dummy"}], "]"}]}], ",", "\"\<Time\>\"", ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"UpIndexQ", "[", "dummy", "]"}], ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "*", 
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}], "]"}]}], ",", 
                    
                    RowBox[{"1", "*", 
                    RowBox[{"If", "[", 
                    RowBox[{"$ConformalTime", ",", "1", ",", 
                    RowBox[{"1", "/", 
                    RowBox[{
                    RowBox[{"a", "[", "h", "]"}], "[", "]"}]}]}], "]"}]}]}], 
                    "]"}], "*", 
                    RowBox[{"u", "[", 
                    RowBox[{"-", "dummy"}], "]"}]}]}], "]"}], 
                  RowBox[{"ReplaceIndex", "[", 
                   RowBox[{"#1", ",", 
                    RowBox[{
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "\[Rule]", "dummy"}]}], 
                   "]"}]}]}], ")"}], "&"}], ",", "expr", ",", 
              RowBox[{"Transpose", "[", 
               RowBox[{"{", 
                RowBox[{"ListIndsToContract", ",", "proj"}], "}"}], "]"}]}], 
             "]"}]}], "]"}]}]}], "]"}]}]}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtractComponents", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", "proj_List"}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"frees", "=", 
       RowBox[{"List", "@@", 
        RowBox[{"FindFreeIndices", "[", "expr", "]"}]}]}], "}"}], ",", 
     RowBox[{"ExtractComponents", "[", 
      RowBox[{"expr", ",", "h", ",", "proj", ",", "frees"}], "]"}]}], "]"}]}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ExtractComponents", "[", 
   RowBox[{"expr_", ",", 
    RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"VisualizeTensor", "[", 
    RowBox[{"expr", ",", "h"}], "]"}], 
   RowBox[{"(*", "expr", "*)"}], "/;", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "@", 
      RowBox[{
       RowBox[{"IndicesOf", "[", "Free", "]"}], "[", "expr", "]"}]}], "===", 
     "2"}], "||", 
    RowBox[{
     RowBox[{"Length", "@", 
      RowBox[{
       RowBox[{"IndicesOf", "[", "Free", "]"}], "[", "expr", "]"}]}], "===", 
     "1"}]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtractComponents", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
   RowBox[{"expr", "/;", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "@", 
       RowBox[{
        RowBox[{"IndicesOf", "[", "Free", "]"}], "[", "expr", "]"}]}], ">", 
      "2"}], "||", 
     RowBox[{
      RowBox[{"Length", "@", 
       RowBox[{
        RowBox[{"IndicesOf", "[", "Free", "]"}], "[", "expr", "]"}]}], "===", 
      "0"}]}]}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetNumberOfArguments", "[", 
   RowBox[{"ExtractComponents", ",", 
    RowBox[{"{", 
     RowBox[{"2", ",", "4"}], "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "ExtractComponents", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.563101442812063*^9, 3.563101522531887*^9}, {
   3.563101567347636*^9, 3.5631016144544783`*^9}, {3.563101672196907*^9, 
   3.563101673071416*^9}, {3.563101708718153*^9, 3.563101752574326*^9}, {
   3.56310181082303*^9, 3.563101810946432*^9}, {3.56312619458807*^9, 
   3.563126195610319*^9}, {3.5631329895711937`*^9, 3.5631329956810837`*^9}, 
   3.5631335273049793`*^9, {3.563139554915883*^9, 3.56313955674767*^9}, 
   3.5631396894241858`*^9, {3.563139833992004*^9, 3.5631398410612717`*^9}, {
   3.563281699870719*^9, 3.563281798879917*^9}, {3.563281836234747*^9, 
   3.563281843917951*^9}, {3.5632819826906557`*^9, 3.5632820220588837`*^9}, {
   3.563282089054062*^9, 3.5632820909543543`*^9}, {3.563282716878433*^9, 
   3.56328272391578*^9}, 3.563516049527173*^9, {3.5637380342472267`*^9, 
   3.563738038508398*^9}, {3.56386619406983*^9, 3.563866231244021*^9}, {
   3.5640631009625273`*^9, 3.56406310276756*^9}, 3.564063208062042*^9, {
   3.5640633031578712`*^9, 3.564063309882963*^9}, {3.564063594442195*^9, 
   3.564063594935833*^9}, {3.5641145059900627`*^9, 3.564114529797018*^9}, {
   3.564114646443334*^9, 3.5641146816985607`*^9}, {3.564114734882435*^9, 
   3.5641147621528387`*^9}, {3.56412733904099*^9, 3.5641273408381243`*^9}, {
   3.564725157948454*^9, 3.564725219096867*^9}, {3.564726525194993*^9, 
   3.564726528259218*^9}, {3.56843690058893*^9, 3.568436924991744*^9}, {
   3.568436956819029*^9, 3.568436957683154*^9}, {3.568438860237564*^9, 
   3.568438873777649*^9}, {3.569329646218474*^9, 3.5693296607200823`*^9}, {
   3.569899504014201*^9, 3.5698995803223743`*^9}, {3.569899949548476*^9, 
   3.569899956671792*^9}, {3.578891912302754*^9, 3.578892014642111*^9}, {
   3.578892143769924*^9, 3.578892251062426*^9}, {3.5788922831169853`*^9, 
   3.5788923068254337`*^9}}],

Cell["Function to visualize a rank - 2 tensor", "Text",
 CellChangeTimes->{{3.563738053350853*^9, 3.563738068031156*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"VisualizeTensor", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"u", "=", 
        RowBox[{"Last", "@", 
         RowBox[{"InducedFrom", "@", "h"}]}]}], "}"}], ",", 
      RowBox[{"Grid", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"Null", ",", "u", ",", "h"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"u", ",", 
            RowBox[{
             RowBox[{"ExtractComponents", "[", 
              RowBox[{"expr", ",", "h", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<Time\>\"", ",", "\"\<Time\>\""}], "}"}]}], "]"}],
              "//", "$PrePrint"}], ",", 
            RowBox[{
             RowBox[{"ExtractComponents", "[", 
              RowBox[{"expr", ",", "h", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<Time\>\"", ",", "\"\<Space\>\""}], "}"}]}], 
              "]"}], "//", "$PrePrint"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"h", ",", 
            RowBox[{
             RowBox[{"ExtractComponents", "[", 
              RowBox[{"expr", ",", "h", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<Space\>\"", ",", "\"\<Time\>\""}], "}"}]}], 
              "]"}], "//", "$PrePrint"}], ",", 
            RowBox[{
             RowBox[{"ExtractComponents", "[", 
              RowBox[{"expr", ",", "h", ",", 
               RowBox[{"{", 
                RowBox[{"\"\<Space\>\"", ",", "\"\<Space\>\""}], "}"}]}], 
              "]"}], "//", "$PrePrint"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"Frame", "\[Rule]", "All"}]}], "]"}]}], "]"}], "/;", 
    RowBox[{
     RowBox[{"Length", "@", 
      RowBox[{
       RowBox[{"IndicesOf", "[", "Free", "]"}], "[", "expr", "]"}]}], "===", 
     "2"}]}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VisualizeTensor", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"u", "=", 
        RowBox[{"Last", "@", 
         RowBox[{"InducedFrom", "@", "h"}]}]}], "}"}], ",", 
      RowBox[{"Grid", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"u", ",", 
            RowBox[{
             RowBox[{"ExtractComponents", "[", 
              RowBox[{"expr", ",", "h", ",", 
               RowBox[{"{", "\"\<Time\>\"", "}"}]}], "]"}], "//", 
             "$PrePrint"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"h", ",", 
            RowBox[{
             RowBox[{"ExtractComponents", "[", 
              RowBox[{"expr", ",", "h", ",", 
               RowBox[{"{", "\"\<Space\>\"", "}"}]}], "]"}], "//", 
             "$PrePrint"}]}], "}"}]}], "}"}], ",", 
        RowBox[{"Frame", "\[Rule]", "All"}]}], "]"}]}], "]"}], "/;", 
    RowBox[{
     RowBox[{"Length", "@", 
      RowBox[{
       RowBox[{"IndicesOf", "[", "Free", "]"}], "[", "expr", "]"}]}], "===", 
     "1"}]}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"VisualizeTensor", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}]}], "]"}], ":=", 
   RowBox[{"expr", "/;", 
    RowBox[{
     RowBox[{"Not", "[", 
      RowBox[{
       RowBox[{"Length", "@", 
        RowBox[{
         RowBox[{"IndicesOf", "[", "Free", "]"}], "[", "expr", "]"}]}], "===",
        "2"}], "]"}], "&&", 
     RowBox[{"Not", "[", 
      RowBox[{
       RowBox[{"Length", "@", 
        RowBox[{
         RowBox[{"IndicesOf", "[", "Free", "]"}], "[", "expr", "]"}]}], "===",
        "1"}], "]"}]}]}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetNumberOfArguments", "[", 
   RowBox[{"VisualizeTensor", ",", "2"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "VisualizeTensor", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.563101442812063*^9, 3.563101522531887*^9}, {
   3.563101567347636*^9, 3.5631016144544783`*^9}, {3.563101672196907*^9, 
   3.563101673071416*^9}, {3.563101708718153*^9, 3.563101752574326*^9}, {
   3.56310181082303*^9, 3.563101810946432*^9}, {3.56312619458807*^9, 
   3.563126195610319*^9}, {3.5631329895711937`*^9, 3.5631329956810837`*^9}, 
   3.5631335273049793`*^9, {3.563139554915883*^9, 3.56313955674767*^9}, 
   3.5631396894241858`*^9, {3.563139833992004*^9, 3.5631398410612717`*^9}, {
   3.563281699870719*^9, 3.563281798879917*^9}, {3.563281836234747*^9, 
   3.563281843917951*^9}, {3.5632819826906557`*^9, 3.5632820220588837`*^9}, {
   3.563282089054062*^9, 3.5632820909543543`*^9}, {3.563282716878433*^9, 
   3.56328272391578*^9}, 3.563516049527173*^9, {3.5637380342472267`*^9, 
   3.563738038508398*^9}, {3.563866238989524*^9, 3.563866249403232*^9}, {
   3.56411453112704*^9, 3.5641145331894207`*^9}, {3.564114687738451*^9, 
   3.564114710935774*^9}, {3.5641148061466017`*^9, 3.5641148234245863`*^9}, {
   3.5641154668404093`*^9, 3.564115478653047*^9}, {3.564115598796217*^9, 
   3.564115654776415*^9}, {3.56411568804953*^9, 3.564115689952711*^9}, {
   3.5647252268561974`*^9, 3.564725235917102*^9}, {3.5647265295427427`*^9, 
   3.5647265311822968`*^9}, {3.5684369599544163`*^9, 3.568436961602247*^9}, {
   3.5693296663884783`*^9, 3.569329697849668*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ExtractOrder", "[", 
    RowBox[{"expr_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"SeriesCoefficient", "[", 
    RowBox[{"expr", ",", 
     RowBox[{"{", 
      RowBox[{"$PerturbationParameter", ",", "0", ",", "n"}], "}"}]}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetNumberOfArguments", "[", 
   RowBox[{"ExtractOrder", ",", "2"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "ExtractOrder", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.564115231692368*^9, 3.5641152391048*^9}, {
  3.564725241716921*^9, 3.564725246698616*^9}, {3.568436963233728*^9, 
  3.568436964521319*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["2.11 Gauge Transformation", "Subsubsection",
 CellChangeTimes->{{3.562222874495562*^9, 3.5622228793121147`*^9}, {
  3.562303082184424*^9, 3.562303084806079*^9}, {3.562396060948267*^9, 
  3.562396063172824*^9}, {3.5624796809054832`*^9, 3.562479681072302*^9}, {
  3.562938320005794*^9, 3.5629383212969103`*^9}, {3.563556357899065*^9, 
  3.5635563587758083`*^9}, {3.57716079257691*^9, 3.577160793328615*^9}},
 FontSize->12],

Cell["\<\
My Gauge transformation rule, which takes into account the conformal \
transformation and performs the n+1 splitting.
First the expression is conformally transformed. Then, the scale factor is \
allowed to be perturbed and the expression is perturbed.
The major step is to use the function GaugeChange of xPert to perform the \
gauge transformation rule. Finally, in the last step, it is remembered that \
the scale factor cannot be perturebed, so its perturbations are set to 0, and \
the results is returned.\
\>", "Text",
 CellChangeTimes->{{3.562322011940009*^9, 3.5623221720109453`*^9}, {
  3.562327866953315*^9, 3.562327867109425*^9}, {3.563738074761654*^9, 
  3.563738078712949*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SplitGaugeChange", "[", 
    RowBox[{"expr_", ",", "ListPairs_List", ",", "my\[Xi]_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
     RowBox[{"ord_", "?", "IntegerQ"}]}], "]"}], ":=", 
   RowBox[{"Catch", "@", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "temp", ",", "temp1", ",", "rulebackgroundfield", ",", "res", ",", 
        "oldgauge", ",", "ReplaceConfFactorByUnperturbed", ",", "DummyConf", 
        ",", "confpert", ",", "q", ",", "n"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"conffactor", "=", 
           RowBox[{"a", "[", "h", "]"}]}], ",", 
          RowBox[{"g", "=", 
           RowBox[{"First", "@", 
            RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Not", "[", 
             RowBox[{"ScalarTensorQ", "[", "conffactor", "]"}], "]"}], "&&", 
            RowBox[{"conffactor", "=!=", "1"}]}], ",", 
           RowBox[{"Throw", "[", 
            RowBox[{"Message", "[", 
             RowBox[{"ToxPand", "::", "invalidconffactor"}], "]"}], "]"}]}], 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"CD", "=", 
              RowBox[{"CovDOfMetric", "[", "g", "]"}]}], ",", 
             RowBox[{"M", "=", 
              RowBox[{"ManifoldOfCovD", "@", 
               RowBox[{"CovDOfMetric", "[", "g", "]"}]}]}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Off", "[", 
             RowBox[{"TagUnset", "::", "\"\<norep\>\""}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "We", " ", "temporarily", " ", "authorize", " ", "the", " ", 
              "perturbation", " ", "of", " ", "the", " ", "conformal", " ", 
              "factor"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"conffactor", "=!=", "1"}], ",", "\[IndentingNewLine]", 
              
              RowBox[{
               RowBox[{"conffactor", "/:", 
                RowBox[{
                 RowBox[{"Perturbation", "[", 
                  RowBox[{
                   RowBox[{"conffactor", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                    "]"}], ",", "n_"}], "]"}], "=."}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"conffactor", "/:", 
                RowBox[{
                 RowBox[{"Perturbation", "[", 
                  RowBox[{"conffactor", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                   "]"}], "]"}], "=."}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"confpert", "=", 
                RowBox[{"Perturbed", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Conformal", "[", 
                    RowBox[{"g", ",", 
                    RowBox[{"SymbolJoin", "[", 
                    RowBox[{"g", ",", "conffactor", ",", "2"}], "]"}]}], 
                    "]"}], "[", "expr", "]"}], ")"}], ",", "ord"}], "]"}]}], 
               ";"}], ",", "\[IndentingNewLine]", 
              RowBox[{"confpert", "=", 
               RowBox[{"Perturbed", "[", 
                RowBox[{"expr", ",", "ord"}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"$DebugInfoQ", ",", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<confpert \>\"", ",", "confpert"}], "]"}]}], "]"}],
             ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"rulebackgroundfield", "=", 
             RowBox[{"If", "[", 
              RowBox[{"BackgroundFieldMethod", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"CD", "[", "_", "]"}], "[", 
                  RowBox[{"my\[Xi]", "[", "ind___", "]"}], "]"}], 
                 "\[RuleDelayed]", "0"}], "}"}], ",", 
               RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"temp1", "=", 
             RowBox[{"GaugeChange", "[", 
              RowBox[{"confpert", ",", "my\[Xi]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"$DebugInfoQ", ",", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<temp1 \>\"", ",", "temp1"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "Then", " ", "we", " ", "perform", " ", "the", " ", 
              "GaugeChange", " ", "using", " ", "the", " ", "function", " ", 
              "GaugeChange", " ", "of", " ", "xPert"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"temp", "=", 
             RowBox[{"PutScalar", "[", 
              RowBox[{
               RowBox[{"LieDToCovD", "[", 
                RowBox[{
                 RowBox[{"ExpandPerturbation", "[", "temp1", "]"}], ",", 
                 "CD"}], "]"}], "/.", "rulebackgroundfield"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"$DebugInfoQ", ",", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<temp \>\"", ",", "temp"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
             "Then", " ", "we", " ", "say", " ", "again", " ", "that", " ", 
              "the", " ", "conformal", " ", "factor", " ", "should", " ", 
              "not", " ", "be", " ", "perturbed"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"conffactor", "=!=", "1"}], ",", "\[IndentingNewLine]", 
              
              RowBox[{
               RowBox[{
                RowBox[{"Perturbation", "[", 
                 RowBox[{
                  RowBox[{"conffactor", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], 
                   "]"}], ",", "n_"}], "]"}], "^:=", 
                RowBox[{"0", "/;", 
                 RowBox[{"n", "\[GreaterEqual]", "1"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Perturbation", "[", 
                 RowBox[{"conffactor", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "0", "]"}], ",", 
                   RowBox[{"LI", "[", "q_", "]"}], ",", "indices___"}], "]"}],
                  "]"}], "^:=", "0"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
              "And", " ", "we", " ", "split", " ", "the", " ", "result", " ", 
               "with", " ", "all", " ", "the", " ", "rules", " ", "the", " ", 
               "user", " ", "wants", " ", "to", " ", "use"}], ",", " ", 
              RowBox[{
              "including", " ", "those", " ", "for", " ", "the", " ", 
               "vector", " ", "field", " ", "used", " ", "in", " ", "the", 
               " ", "conformal", " ", "transformation"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"res", "=", 
             RowBox[{"SplitPerturbations", "[", 
              RowBox[{
               RowBox[{"(", "temp", ")"}], ",", "ListPairs", ",", "h"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"On", "[", 
             RowBox[{"TagUnset", "::", "\"\<norep\>\""}], "]"}], ";", 
            "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", 
          "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
     "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SplitGaugeChange", "[", 
     RowBox[{"expr_", ",", "my\[Xi]_", ",", 
      RowBox[{"h_", "?", "InducedMetricQ"}], ",", "ord_"}], "]"}], ":=", 
    RowBox[{"SplitGaugeChange", "[", 
     RowBox[{"expr", ",", 
      RowBox[{"{", "}"}], ",", "my\[Xi]", ",", "h", ",", "ord"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetNumberOfArguments", "[", 
   RowBox[{"SplitGaugeChange", ",", 
    RowBox[{"{", 
     RowBox[{"4", ",", "5"}], "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Protect", "[", "SplitGaugeChange", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SplitFieldsAndGaugeChange", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"g_", "?", "MetricQ"}], ",", "dg_", ",", "uf_", ",", "duf_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
     RowBox[{"order_", "?", "IntegerQ"}], ",", 
     RowBox[{"tiltvalue_:", "\"\<NotTilted\>\""}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ord", ",", "n", ",", "res", ",", "ruleslist", ",", 
       "RulesGaugeChange"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"M", "=", 
          RowBox[{"ManifoldOfCovD", "@", 
           RowBox[{"CovDOfMetric", "@", "g"}]}]}], ",", 
         RowBox[{"cd", "=", 
          RowBox[{"CovDOfMetric", "@", "h"}]}], ",", 
         RowBox[{"u", "=", 
          RowBox[{"Last", "@", 
           RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ind", "=", 
           RowBox[{"DummyIn", "@", 
            RowBox[{"Tangent", "@", "M"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"Not", "[", 
             RowBox[{"DefTensorQ", "[", 
              RowBox[{"\[Xi]", "[", "h", "]"}], "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"DefTensor", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Evaluate", "[", 
                 RowBox[{"\[Xi]", "[", "h", "]"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"LI", "[", "ord", "]"}], ",", "ind"}], "]"}], ",", 
               "M"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"RulesGaugeChange", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"\[Xi]", "[", "h", "]"}], "[", 
              RowBox[{
               RowBox[{"LI", "[", "n_", "]"}], ",", "ind_"}], "]"}], 
             "\[RuleDelayed]", 
             RowBox[{"Evaluate", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"T", "[", "h", "]"}], "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "n", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                RowBox[{"u", "[", "ind", "]"}]}], "+", 
               RowBox[{
                RowBox[{"Lv", "[", "h", "]"}], "[", 
                RowBox[{
                 RowBox[{"LI", "[", "n", "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}], ",", "ind"}], "]"}], "+", 
               RowBox[{
                RowBox[{"cd", "[", "ind", "]"}], "[", 
                RowBox[{
                 RowBox[{"Ls", "[", "h", "]"}], "[", 
                 RowBox[{
                  RowBox[{"LI", "[", "n", "]"}], ",", 
                  RowBox[{"LI", "[", "0", "]"}]}], "]"}], "]"}]}], "]"}]}], 
            "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ruleslist", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"RulesGaugeChange", ",", 
             RowBox[{"SplitMetric", "[", 
              RowBox[{"g", ",", "dg", ",", "h", ",", "\"\<AnyGauge\>\""}], 
              "]"}], ",", 
             RowBox[{"SplitMatter", "[", 
              RowBox[{"uf", ",", "duf", ",", 
               RowBox[{"-", "1"}], ",", "h", ",", "\"\<AnyGauge\>\"", ",", 
               "order", ",", "tiltvalue"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"SplitGaugeChange", "[", 
           RowBox[{"expr", ",", "ruleslist", ",", 
            RowBox[{"\[Xi]", "[", "h", "]"}], ",", "h", ",", "order"}], 
           "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetNumberOfArguments", "[", 
   RowBox[{"SplitFieldsAndGaugeChange", ",", 
    RowBox[{"{", 
     RowBox[{"7", ",", "8"}], "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "SplitFieldsAndGaugeChange", "]"}], ";"}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.562319499314612*^9, 3.562319633518879*^9}, {
   3.562319925430423*^9, 3.562319941920436*^9}, 3.562320214934614*^9, {
   3.562320328105035*^9, 3.562320342974311*^9}, {3.562321317277203*^9, 
   3.562321339862718*^9}, 3.562321392383555*^9, {3.562322211162446*^9, 
   3.562322222206418*^9}, {3.562323373088353*^9, 3.562323376248839*^9}, {
   3.5623234357971*^9, 3.562323454978259*^9}, {3.56232840334534*^9, 
   3.562328423738624*^9}, {3.562328710755383*^9, 3.562328724087594*^9}, {
   3.562328755288081*^9, 3.562328804547552*^9}, {3.562335952137892*^9, 
   3.562335954796734*^9}, 3.562336208310914*^9, {3.5623441701028214`*^9, 
   3.5623442677213087`*^9}, {3.5623566815881433`*^9, 3.562356683489728*^9}, 
   3.562356986789041*^9, {3.562358008974512*^9, 3.562358011012228*^9}, {
   3.562358538875*^9, 3.562358540675579*^9}, {3.562358576261671*^9, 
   3.562358579291552*^9}, {3.56235871876066*^9, 3.562358720184703*^9}, {
   3.562389269260209*^9, 3.5623892801717997`*^9}, {3.562389691123003*^9, 
   3.56238969299016*^9}, {3.562389782623966*^9, 3.56238978975134*^9}, {
   3.56239838857408*^9, 3.562398404637742*^9}, {3.5624048617037086`*^9, 
   3.562404887630808*^9}, {3.563101853276718*^9, 3.563101854411759*^9}, {
   3.56310189691008*^9, 3.563101971804761*^9}, {3.5631020238753643`*^9, 
   3.5631020281033907`*^9}, {3.563102120420067*^9, 3.563102195435907*^9}, {
   3.563102256673921*^9, 3.563102256939534*^9}, {3.563102352612496*^9, 
   3.563102355547427*^9}, {3.563126599190899*^9, 3.563126599338731*^9}, {
   3.5631267571838512`*^9, 3.563126780760768*^9}, {3.563126876552457*^9, 
   3.563126876708831*^9}, {3.563127466912765*^9, 3.563127480641574*^9}, {
   3.5631278485711203`*^9, 3.563127851561504*^9}, {3.563128216287201*^9, 
   3.563128250657475*^9}, {3.5631289248358593`*^9, 3.563128971248329*^9}, {
   3.563129006919718*^9, 3.563129150573553*^9}, {3.563129260464764*^9, 
   3.5631293970549726`*^9}, {3.563129428472377*^9, 3.563129763103764*^9}, {
   3.563129811014111*^9, 3.563129867307424*^9}, {3.5631298976914463`*^9, 
   3.563129979991767*^9}, {3.5631301015065002`*^9, 3.563130140738834*^9}, {
   3.56313065152976*^9, 3.56313078869341*^9}, {3.563130831259058*^9, 
   3.563131086618843*^9}, {3.563131126057082*^9, 3.563131140348679*^9}, {
   3.563131174352161*^9, 3.563131185364358*^9}, {3.563131238693509*^9, 
   3.563131239602791*^9}, {3.5631312949060373`*^9, 3.56313129907994*^9}, {
   3.563131435368862*^9, 3.5631314621434813`*^9}, {3.5631314998878202`*^9, 
   3.563131506179859*^9}, {3.563131564380323*^9, 3.563131632773736*^9}, 
   3.563131744641486*^9, {3.5631317893250723`*^9, 3.563131792690111*^9}, {
   3.563131948248316*^9, 3.5631319563899317`*^9}, {3.5631322529185467`*^9, 
   3.563132254942779*^9}, {3.5631324521323433`*^9, 3.563132484004477*^9}, {
   3.5631327183293533`*^9, 3.5631327230720577`*^9}, {3.563132807827553*^9, 
   3.5631328099598827`*^9}, {3.563132912584486*^9, 3.5631329541004333`*^9}, {
   3.563133009699567*^9, 3.5631330134175262`*^9}, {3.5631331547974777`*^9, 
   3.563133187482605*^9}, {3.563133291306717*^9, 3.5631333025887737`*^9}, {
   3.563133773401188*^9, 3.563133807209772*^9}, {3.5631340421910353`*^9, 
   3.56313408150734*^9}, {3.563134363002486*^9, 3.5631344302367887`*^9}, {
   3.563134591646585*^9, 3.563134646660837*^9}, 3.563134839715517*^9, {
   3.563135690635597*^9, 3.563135732862705*^9}, {3.563135772533606*^9, 
   3.563135777626594*^9}, 3.563135958837624*^9, {3.56313629774116*^9, 
   3.563136357567504*^9}, {3.5631365162836*^9, 3.563136544918036*^9}, {
   3.5631373403360987`*^9, 3.563137342879109*^9}, {3.563137844897409*^9, 
   3.5631378720355062`*^9}, {3.563138147314455*^9, 3.563138163383521*^9}, {
   3.563138532456246*^9, 3.563138536455435*^9}, {3.56313881125419*^9, 
   3.56313881284442*^9}, {3.563138976227289*^9, 3.563139013690061*^9}, {
   3.563139482544753*^9, 3.563139506664825*^9}, {3.563139816917287*^9, 
   3.56313981740065*^9}, {3.563140897897044*^9, 3.5631409251412497`*^9}, {
   3.563140966233014*^9, 3.5631410267688026`*^9}, 3.563141139034449*^9, {
   3.563141286041976*^9, 3.56314130516546*^9}, {3.563141372464135*^9, 
   3.5631414760101013`*^9}, 3.563141559679483*^9, {3.563141653833048*^9, 
   3.563141673388898*^9}, {3.563738085056595*^9, 3.5637381840169764`*^9}, {
   3.563768967849766*^9, 3.56376898607802*^9}, {3.563769569437454*^9, 
   3.563769666757856*^9}, {3.5637697840304747`*^9, 3.563769999491357*^9}, {
   3.563770042872192*^9, 3.563770063536846*^9}, {3.5637701616270514`*^9, 
   3.5637701639496517`*^9}, {3.56377022663855*^9, 3.563770227547117*^9}, {
   3.563770323558895*^9, 3.563770335349656*^9}, {3.563770469251843*^9, 
   3.563770489742033*^9}, {3.563770570488605*^9, 3.563770576573202*^9}, {
   3.563770727231551*^9, 3.563770758973274*^9}, {3.563770831593698*^9, 
   3.563770864699223*^9}, {3.56377090451091*^9, 3.563770908300173*^9}, {
   3.563771083322344*^9, 3.563771103597055*^9}, {3.5637712040743217`*^9, 
   3.563771225191763*^9}, {3.563771370218371*^9, 3.563771390611495*^9}, {
   3.563771424138496*^9, 3.5637716066997557`*^9}, {3.5637716418697433`*^9, 
   3.563771677691403*^9}, {3.563773442103325*^9, 3.563773459758294*^9}, 
   3.563779162900676*^9, 3.5637806337961273`*^9, {3.563866260630623*^9, 
   3.563866293744937*^9}, {3.5638663241619053`*^9, 3.563866418446145*^9}, 
   3.563870762671036*^9, {3.563871116941516*^9, 3.5638711371008167`*^9}, {
   3.563871181540659*^9, 3.563871209849821*^9}, {3.563871270400548*^9, 
   3.563871280074163*^9}, {3.563871380000401*^9, 3.563871399847286*^9}, {
   3.5638714616718893`*^9, 3.563871466664546*^9}, {3.563871593104664*^9, 
   3.563871634605501*^9}, {3.563871669201583*^9, 3.563871675069878*^9}, {
   3.5638717202118473`*^9, 3.563871750512451*^9}, {3.564554042049946*^9, 
   3.56455404360702*^9}, 3.564630867987112*^9, {3.564631023838994*^9, 
   3.564631041438259*^9}, {3.56463132164507*^9, 3.564631322092358*^9}, 
   3.564631581647539*^9, {3.5646317181126213`*^9, 3.56463173411193*^9}, {
   3.564714014372347*^9, 3.564714021015265*^9}, {3.564714192253366*^9, 
   3.564714211244645*^9}, {3.564717019365909*^9, 3.564717023078486*^9}, {
   3.564717565919775*^9, 3.5647177402622213`*^9}, {3.56471917375886*^9, 
   3.564719195604878*^9}, {3.564725252720208*^9, 3.5647253248330297`*^9}, {
   3.564726532625361*^9, 3.5647265354016857`*^9}, 3.564726589122796*^9, 
   3.564727057785931*^9, {3.5647320065381823`*^9, 3.564732008629108*^9}, 
   3.564738142517025*^9, {3.5647382824177313`*^9, 3.564738282552362*^9}, {
   3.564738382706686*^9, 3.564738387854733*^9}, {3.564824329569984*^9, 
   3.564824330625787*^9}, 3.5663168477319927`*^9, {3.5683650000178947`*^9, 
   3.568365043225314*^9}, {3.5683652552595987`*^9, 3.568365294963728*^9}, 
   3.569132576842437*^9, 3.569132806851595*^9, {3.569330315479556*^9, 
   3.569330319696822*^9}, {3.569735129931567*^9, 3.569735134004047*^9}, {
   3.578979438359528*^9, 3.578979449336013*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
2.12 Automatic perturbation of the time components for normalized vectors\
\>", "Subsubsection",
 CellChangeTimes->{{3.56355636622129*^9, 3.5635563809513187`*^9}, {
  3.577160794440083*^9, 3.5771607951992207`*^9}}],

Cell["Obvious rules taking into account the gauge choice", "Text",
 CellChangeTimes->{{3.563738192541833*^9, 3.563738198906309*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"RulesVelocitySpatial", "[", 
   RowBox[{
    RowBox[{"h_", "?", "InducedMetricQ"}], ",", "uf_", ",", "duf_", ",", 
    "NormVectorSquare_", ",", 
    RowBox[{"gauge_", "?", "GaugeQ"}], ",", 
    RowBox[{"order_", "?", "IntegerQ"}], ",", 
    RowBox[{"TiltedBool_:", "False"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", ",", "q"}], "}"}], ",", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"M", "=", 
         RowBox[{"ManifoldOfCovD", "@", 
          RowBox[{"CovDOfMetric", "@", "h"}]}]}], ",", 
        RowBox[{"cd", "=", 
         RowBox[{"CovDOfMetric", "@", "h"}]}], ",", 
        RowBox[{"u", "=", 
         RowBox[{"Last", "@", 
          RowBox[{"InducedFrom", "[", "h", "]"}]}]}]}], "}"}], ",", 
      RowBox[{"With", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ind1", "=", 
           RowBox[{"DummyIn", "@", 
            RowBox[{"Tangent", "@", "M"}]}]}], ",", 
          RowBox[{"ind2", "=", 
           RowBox[{"DummyIn", "@", 
            RowBox[{"Tangent", "@", "M"}]}]}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Join", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Flatten", "@", 
            RowBox[{"Join", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"gauge", "===", "\"\<ComovingGauge\>\""}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"\[CurlyPhi]", "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"n_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[GreaterEqual]", "1"}], "&"}], ")"}]}], 
                    "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}]}], "]"}], "\[RuleDelayed]",
                   "0"}], "}"}], ",", 
                RowBox[{"{", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"gauge", "===", "\"\<IsoDensityGauge\>\""}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"\[Rho]", "[", "uf", "]"}], "[", 
                   RowBox[{
                    RowBox[{"LI", "[", 
                    RowBox[{"n_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", "\[GreaterEqual]", "1"}], "&"}], ")"}]}], 
                    "]"}], ",", 
                    RowBox[{"LI", "[", "q_", "]"}]}], "]"}], "\[RuleDelayed]",
                   "0"}], "}"}], ",", 
                RowBox[{"{", "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{"TiltedBool", ",", 
                RowBox[{"{", 
                 RowBox[{"MakeRule", "[", 
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"uf", "[", "ind1", "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Sqrt", "[", 
                    RowBox[{
                    RowBox[{"Scalar", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Vspat", "[", 
                    RowBox[{"h", ",", "uf"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "ind2"}], "]"}], 
                    RowBox[{
                    RowBox[{"Vspat", "[", 
                    RowBox[{"h", ",", "uf"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"-", "ind2"}]}], "]"}]}], "]"}], "-", 
                    "NormVectorSquare"}], "]"}], ")"}], 
                    RowBox[{"u", "[", "ind1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"Vspat", "[", 
                    RowBox[{"h", ",", "uf"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "0", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "ind1"}], "]"}]}]}], 
                    "}"}], "]"}], "]"}], "}"}], ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"MakeRule", "[", 
                  RowBox[{"Evaluate", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"uf", "[", "ind1", "]"}], ",", 
                    RowBox[{"u", "[", "ind1", "]"}]}], "}"}], "]"}], "]"}], 
                 "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"MakeRule", "@", 
                RowBox[{"Evaluate", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"duf", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", "ind1"}], "]"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"Evaluate", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"V0", "[", 
                    RowBox[{"h", ",", "uf"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"u", "[", "ind1", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"gauge", "===", "\"\<ComovingGauge\>\""}], ",", 
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], " ", ",", 
                    RowBox[{
                    RowBox[{"Vs", "[", 
                    RowBox[{"h", ",", "uf"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], " ", "]"}], 
                    "]"}], "+", " ", 
                    RowBox[{"BV1", " ", 
                    RowBox[{
                    RowBox[{"Vv", "[", 
                    RowBox[{"h", ",", "uf"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "1", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "ind1"}], "]"}]}]}], 
                    "]"}]}], "}"}], "]"}]}], "}"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"MakeRule", "@", 
              RowBox[{"Evaluate", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"duf", "[", 
                  RowBox[{
                   RowBox[{"LI", "[", "i", "]"}], ",", "ind1"}], "]"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Evaluate", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"V0", "[", 
                    RowBox[{"h", ",", "uf"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "i", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], 
                    RowBox[{"u", "[", "ind1", "]"}]}], "+", 
                   RowBox[{
                    RowBox[{"cd", "[", "ind1", "]"}], "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"gauge", "===", "\"\<ComovingGauge\>\""}], ",", 
                    RowBox[{"-", 
                    RowBox[{
                    RowBox[{"Bs", "[", "h", "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "i", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], " ", ",", 
                    RowBox[{
                    RowBox[{"Vs", "[", 
                    RowBox[{"h", ",", "uf"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "i", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}]}], " ", "]"}], 
                    "]"}], "+", " ", 
                   RowBox[{
                    RowBox[{"Vv", "[", 
                    RowBox[{"h", ",", "uf"}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "i", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}], ",", "ind1"}], "]"}]}], 
                  "]"}]}], "}"}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "2", ",", "order"}], "}"}]}], "]"}]}], 
          "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.563520778834778*^9, 3.563520790311762*^9}, {
   3.5635216677833*^9, 3.563521702283216*^9}, {3.5635237345013857`*^9, 
   3.563523814717505*^9}, {3.5635238570251617`*^9, 3.56352421272322*^9}, {
   3.563524248111458*^9, 3.563524259098538*^9}, {3.5635242914137373`*^9, 
   3.563524298198615*^9}, {3.5635243332385406`*^9, 3.5635243699872313`*^9}, {
   3.563524428806451*^9, 3.563524437860033*^9}, {3.5635244755672703`*^9, 
   3.5635248598578777`*^9}, {3.5635248921221848`*^9, 3.563525003299048*^9}, {
   3.5635410451624117`*^9, 3.5635410815073557`*^9}, {3.5635411898341503`*^9, 
   3.563541310378499*^9}, {3.5635413779484243`*^9, 3.5635413846098003`*^9}, {
   3.563541571424362*^9, 3.563541582232092*^9}, {3.563541635873334*^9, 
   3.563541638195838*^9}, {3.5635417058491592`*^9, 3.563541753615587*^9}, {
   3.5635417860021*^9, 3.563541795980151*^9}, {3.563541853530245*^9, 
   3.563541856003132*^9}, {3.5635423632021008`*^9, 3.563542419859194*^9}, {
   3.56354294718682*^9, 3.56354298831872*^9}, {3.563543019395944*^9, 
   3.563543061169029*^9}, {3.563545021661408*^9, 3.563545057571978*^9}, {
   3.563545159347065*^9, 3.5635452069264727`*^9}, {3.563545333934032*^9, 
   3.563545362366396*^9}, {3.563545666179039*^9, 3.563545670721554*^9}, {
   3.563545782467217*^9, 3.563545787559348*^9}, {3.5635459874628487`*^9, 
   3.563545988486166*^9}, {3.563546101404894*^9, 3.5635461265370083`*^9}, {
   3.56354617426959*^9, 3.5635462274312897`*^9}, {3.563556427563561*^9, 
   3.56355643439174*^9}, {3.5635564806499567`*^9, 3.563556497583392*^9}, 
   3.5635574795401154`*^9, {3.563558362357111*^9, 3.563558415086349*^9}, {
   3.563558506548587*^9, 3.56355863985538*^9}, {3.563558675814044*^9, 
   3.563558722709284*^9}, {3.563558790702795*^9, 3.563558952730062*^9}, {
   3.563559031285396*^9, 3.5635590349021072`*^9}, {3.563559274286127*^9, 
   3.563559296514781*^9}, 3.563559406592966*^9, {3.563560060441709*^9, 
   3.5635600743807287`*^9}, {3.563560710547267*^9, 3.563560725208477*^9}, {
   3.563560802161806*^9, 3.563560936485051*^9}, {3.5635610118351393`*^9, 
   3.5635610243661747`*^9}, {3.563561216462905*^9, 3.5635612237965612`*^9}, {
   3.5635613018326893`*^9, 3.563561302975378*^9}, {3.563561391090199*^9, 
   3.563561459427946*^9}, {3.563561518416789*^9, 3.563561548045063*^9}, 
   3.5635616874848547`*^9, {3.563561907286665*^9, 3.563561911533354*^9}, {
   3.563561997188102*^9, 3.563562011283951*^9}, 3.563562069658807*^9, {
   3.563562266788005*^9, 3.5635622677450953`*^9}, {3.563562703222294*^9, 
   3.563562713219388*^9}, {3.563567659593308*^9, 3.5635676774372377`*^9}, {
   3.563567717071747*^9, 3.563567749331966*^9}, {3.5635678999689407`*^9, 
   3.563567921609177*^9}, {3.563568042765244*^9, 3.563568068780161*^9}, {
   3.563568252996604*^9, 3.5635682744390907`*^9}, {3.563594304255591*^9, 
   3.563594308815859*^9}, {3.563605573004096*^9, 3.563605619312428*^9}, {
   3.563605674652079*^9, 3.563605679977083*^9}, {3.563605954386462*^9, 
   3.563606192434142*^9}, {3.563606812324347*^9, 3.5636068189053087`*^9}, {
   3.563606978369554*^9, 3.563606980470789*^9}, {3.563607321914282*^9, 
   3.56360733209051*^9}, {3.563607373107593*^9, 3.56360737611777*^9}, {
   3.563607463344499*^9, 3.563607609244001*^9}, {3.56360880690938*^9, 
   3.563608812737124*^9}, 3.563610056641364*^9, {3.56361068314062*^9, 
   3.5636107171743383`*^9}, {3.563610768836444*^9, 3.5636107751890583`*^9}, {
   3.5636108446380577`*^9, 3.5636108616786737`*^9}, {3.563616115379212*^9, 
   3.56361616798389*^9}, 3.563738208666972*^9, {3.563773470212639*^9, 
   3.563773478947031*^9}, {3.5638664855493317`*^9, 3.56386648619088*^9}, {
   3.564481704021697*^9, 3.564481721343348*^9}, {3.564481944763638*^9, 
   3.564481970317597*^9}, {3.564482631821381*^9, 3.564482639775013*^9}, {
   3.564483067625025*^9, 3.5644830711247396`*^9}, {3.564484053488558*^9, 
   3.56448406543259*^9}, {3.564484118776099*^9, 3.564484120033283*^9}, 
   3.564484382588252*^9, {3.5644860106190767`*^9, 3.5644860245752068`*^9}, {
   3.564486246099429*^9, 3.5644863187136393`*^9}, {3.564486460110816*^9, 
   3.564486473248807*^9}, {3.564549852612493*^9, 3.564549959097186*^9}, {
   3.56454998965165*^9, 3.564550094457185*^9}, {3.564550173233346*^9, 
   3.56455022876478*^9}, {3.564550425746014*^9, 3.564550501127487*^9}, {
   3.564550554054222*^9, 3.564550640764291*^9}, {3.564550822303653*^9, 
   3.564550830126507*^9}, {3.5645519722938843`*^9, 3.564552170391246*^9}, {
   3.564552290036368*^9, 3.564552327770875*^9}, {3.564552395577186*^9, 
   3.5645524594293222`*^9}, {3.56455249990238*^9, 3.5645525306486673`*^9}, 
   3.564726539393705*^9, 3.5647270168546133`*^9, 3.564727059689104*^9, {
   3.564738607371128*^9, 3.5647386128741913`*^9}, {3.569330327112337*^9, 
   3.569330337906351*^9}}],

Cell["\<\
The function which builds the time component of the vector from normalization\
\
\>", "Text",
 CellChangeTimes->{{3.563742059326146*^9, 3.5637420769967337`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AllRulesFromProjectedRule", "[", 
    RowBox[{"vector_", ",", "NormVectorSquare_", ",", "RulesVspat_", ",", 
     RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
     RowBox[{"order_", "?", "IntegerQ"}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "RuleBackgroundBoost", ",", "Rulebackgroundvelocity", ",", "RuleBoost", 
       ",", "LocalRulesVspat", ",", "RuleBoostUpton", ",", 
       "RulesBoostUptoOrder", ",", "X", ",", "res", ",", "nloc", ",", "debug",
        ",", "Boost", ",", "Vspatial"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"g", "=", 
          RowBox[{"First", "@", 
           RowBox[{"InducedFrom", "@", "h"}]}]}], ",", 
         RowBox[{"u", "=", 
          RowBox[{"Last", "@", 
           RowBox[{"InducedFrom", "@", "h"}]}]}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"M", "=", 
           RowBox[{"ManifoldOfCovD", "@", 
            RowBox[{"CovDOfMetric", "[", "g", "]"}]}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"i1", "=", 
              RowBox[{"DummyIn", "@", 
               RowBox[{"Tangent", "@", "M"}]}]}], ",", 
             RowBox[{"i2", "=", 
              RowBox[{"DummyIn", "@", 
               RowBox[{"Tangent", "@", "M"}]}]}]}], "}"}], ",", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Block", "[", 
             RowBox[{
              RowBox[{"{", "Print", "}"}], ",", 
              RowBox[{
               RowBox[{"DefTensor", "[", 
                RowBox[{
                 RowBox[{"X", "[", "]"}], ",", "M"}], "]"}], ";"}]}], "]"}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"Boost", "=", 
             RowBox[{"V0", "[", 
              RowBox[{"h", ",", "vector"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Vspatial", "=", 
             RowBox[{"Vspat", "[", 
              RowBox[{"h", ",", "vector"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"LocalRulesVspat", "=", "RulesVspat"}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "This", " ", "is", " ", "because", " ", "I", " ", "have", " ", 
              "problems", " ", "with", " ", "n", " ", "being", " ", 
              "replaced", " ", "automatically", " ", "in", " ", 
              RowBox[{"RulesVspat", ".", " ", "Honestly"}], " ", "I", " ", 
              "am", " ", "not", " ", "sure", " ", "of", " ", "why", " ", 
              "this", " ", 
              RowBox[{"happens", "."}]}], "*)"}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"RuleBackgroundBoost", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RuleBoost", "[", "0", "]"}], ":=", 
             "RuleBackgroundBoost"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RuleBoostUpton", "[", "m_", "]"}], ":=", 
             RowBox[{"Flatten", "@", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"ToCanonical", "@", 
                 RowBox[{"ContractMetric", "[", 
                  RowBox[{"RuleBoost", "[", "i", "]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RuleBoost", "[", 
              RowBox[{"n_", "?", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"#", "\[GreaterEqual]", "1"}], "&"}], ")"}]}], "]"}],
              ":=", 
             RowBox[{"(", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Boost", "[", 
                RowBox[{
                 RowBox[{"LI", "[", "n", "]"}], ",", 
                 RowBox[{"LI", "[", "0", "]"}]}], "]"}], "\[RuleDelayed]", 
               RowBox[{"Evaluate", "[", 
                RowBox[{
                 RowBox[{"ToCanonical", "@", 
                  RowBox[{"ContractMetric", "@", 
                   RowBox[{"PutScalar", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"X", "[", "]"}], "/.", 
                    RowBox[{"First", "@", 
                    RowBox[{"IndexSolve", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"org", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ExpandPerturbation", "@", 
                    RowBox[{"Perturbation", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"g", "[", 
                    RowBox[{
                    RowBox[{"-", "i1"}], ",", 
                    RowBox[{"-", "i2"}]}], "]"}], 
                    RowBox[{"vector", "[", "i1", "]"}], 
                    RowBox[{"vector", "[", "i2", "]"}]}], ",", "n"}], "]"}]}],
                     "/.", "LocalRulesVspat"}], "/.", 
                    RowBox[{
                    RowBox[{"Boost", "[", 
                    RowBox[{
                    RowBox[{"LI", "[", "n", "]"}], ",", 
                    RowBox[{"LI", "[", "0", "]"}]}], "]"}], "\[Rule]", 
                    RowBox[{"X", "[", "]"}]}]}], "]"}], "\[Equal]", "0"}], 
                    ",", 
                    RowBox[{"X", "[", "]"}]}], "]"}]}]}], ")"}], "/.", 
                    RowBox[{"RuleBoostUpton", "[", 
                    RowBox[{"n", "-", "1"}], "]"}]}], "/.", 
                    "LocalRulesVspat"}], "]"}]}]}], "/.", 
                 "BackgroundFieldRule"}], "]"}]}], ")"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"res", "=", 
             RowBox[{"Join", "[", 
              RowBox[{"RulesVspat", "/.", 
               RowBox[{"RuleBoostUpton", "[", "order", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"Block", "[", 
             RowBox[{
              RowBox[{"{", "Print", "}"}], ",", 
              RowBox[{
               RowBox[{"UndefTensor", "[", "X", "]"}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}], 
        "]"}]}], "]"}]}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.563520778834778*^9, 3.563520790311762*^9}, {
   3.5635216677833*^9, 3.563521702283216*^9}, {3.5635237345013857`*^9, 
   3.563523814717505*^9}, {3.5635238570251617`*^9, 3.56352421272322*^9}, {
   3.563524248111458*^9, 3.563524259098538*^9}, {3.5635242914137373`*^9, 
   3.563524298198615*^9}, {3.5635243332385406`*^9, 3.5635243699872313`*^9}, {
   3.563524428806451*^9, 3.563524437860033*^9}, {3.5635244755672703`*^9, 
   3.5635248598578777`*^9}, {3.5635248921221848`*^9, 3.563525003299048*^9}, {
   3.5635410451624117`*^9, 3.5635410815073557`*^9}, {3.5635411898341503`*^9, 
   3.563541310378499*^9}, {3.5635413779484243`*^9, 3.5635413846098003`*^9}, {
   3.563541571424362*^9, 3.563541582232092*^9}, {3.563541635873334*^9, 
   3.563541638195838*^9}, {3.5635417058491592`*^9, 3.563541753615587*^9}, {
   3.5635417860021*^9, 3.563541795980151*^9}, {3.563541853530245*^9, 
   3.563541856003132*^9}, {3.5635423632021008`*^9, 3.563542419859194*^9}, {
   3.56354294718682*^9, 3.56354298831872*^9}, {3.563543019395944*^9, 
   3.563543061169029*^9}, {3.563545021661408*^9, 3.563545057571978*^9}, {
   3.563545159347065*^9, 3.5635452069264727`*^9}, {3.563545333934032*^9, 
   3.563545362366396*^9}, {3.563545666179039*^9, 3.563545670721554*^9}, {
   3.563545782467217*^9, 3.563545787559348*^9}, {3.5635459874628487`*^9, 
   3.563545988486166*^9}, {3.563546101404894*^9, 3.5635461265370083`*^9}, {
   3.56354617426959*^9, 3.5635462274312897`*^9}, {3.563556427563561*^9, 
   3.56355643439174*^9}, {3.5635564806499567`*^9, 3.563556497583392*^9}, 
   3.5635574795401154`*^9, {3.563558362357111*^9, 3.563558415086349*^9}, {
   3.563558506548587*^9, 3.56355863985538*^9}, {3.563558675814044*^9, 
   3.563558722709284*^9}, {3.563558790702795*^9, 3.563558952730062*^9}, {
   3.563559031285396*^9, 3.5635590349021072`*^9}, {3.563559274286127*^9, 
   3.563559296514781*^9}, 3.563559406592966*^9, {3.563560060441709*^9, 
   3.5635600743807287`*^9}, {3.563560710547267*^9, 3.563560725208477*^9}, {
   3.563560802161806*^9, 3.563560936485051*^9}, {3.5635610118351393`*^9, 
   3.5635610243661747`*^9}, {3.563561216462905*^9, 3.5635612237965612`*^9}, {
   3.5635613018326893`*^9, 3.563561302975378*^9}, {3.563561391090199*^9, 
   3.563561459427946*^9}, {3.563561518416789*^9, 3.563561548045063*^9}, 
   3.5635616874848547`*^9, {3.563561907286665*^9, 3.563561911533354*^9}, {
   3.563561997188102*^9, 3.563562011283951*^9}, 3.563562069658807*^9, {
   3.563562266788005*^9, 3.5635622677450953`*^9}, {3.563562703222294*^9, 
   3.563562713219388*^9}, {3.563567659593308*^9, 3.5635676774372377`*^9}, {
   3.563567717071747*^9, 3.563567749331966*^9}, {3.5635678999689407`*^9, 
   3.563567921609177*^9}, {3.563568042765244*^9, 3.563568068780161*^9}, {
   3.563568252996604*^9, 3.5635682744390907`*^9}, {3.563594304255591*^9, 
   3.563594308815859*^9}, {3.563605573004096*^9, 3.563605619312428*^9}, {
   3.563605674652079*^9, 3.563605679977083*^9}, {3.563605954386462*^9, 
   3.563606192434142*^9}, {3.563606812324347*^9, 3.5636068189053087`*^9}, {
   3.563606978369554*^9, 3.563606980470789*^9}, {3.563607321914282*^9, 
   3.56360733209051*^9}, {3.563607373107593*^9, 3.56360737611777*^9}, {
   3.563607463344499*^9, 3.563607609244001*^9}, {3.56360880690938*^9, 
   3.563608812737124*^9}, 3.563610056641364*^9, {3.56361068314062*^9, 
   3.5636107171743383`*^9}, {3.563610768836444*^9, 3.5636107751890583`*^9}, {
   3.5636108446380577`*^9, 3.5636108616786737`*^9}, {3.563616115379212*^9, 
   3.56361616798389*^9}, {3.563738208666972*^9, 3.563738220726568*^9}, {
   3.563738260851533*^9, 3.563738299473621*^9}, {3.563790188599111*^9, 
   3.563790289102786*^9}, {3.563790466145069*^9, 3.563790506941278*^9}, {
   3.563790583230794*^9, 3.56379059508524*^9}, {3.563790625807213*^9, 
   3.5637906581438627`*^9}, {3.5637910883602*^9, 3.56379110076578*^9}, {
   3.5637911937101717`*^9, 3.5637911997485037`*^9}, {3.563791258906734*^9, 
   3.563791268690559*^9}, {3.563791348908732*^9, 3.563791393299487*^9}, {
   3.563866472140087*^9, 3.5638665429222937`*^9}, {3.56454869773871*^9, 
   3.5645487033527403`*^9}, {3.56455070170724*^9, 3.5645507291651697`*^9}, {
   3.564551017042508*^9, 3.564551063623852*^9}, {3.564551143072954*^9, 
   3.564551264650565*^9}, {3.564551297119184*^9, 3.56455138361615*^9}, {
   3.564551426946877*^9, 3.5645514718324614`*^9}, {3.564551505127215*^9, 
   3.564551511378598*^9}, {3.564551600642709*^9, 3.56455160547827*^9}, {
   3.564551640107458*^9, 3.5645516582436132`*^9}, 3.564551733734226*^9, {
   3.5645526750522842`*^9, 3.5645526920780373`*^9}, {3.564674168014702*^9, 
   3.564674186969385*^9}, {3.564674228509976*^9, 3.56467426817317*^9}, {
   3.5646790631543427`*^9, 3.564679063753525*^9}, {3.564716612311399*^9, 
   3.564716630132557*^9}, {3.564719212072977*^9, 3.564719214576417*^9}, 
   3.5647265408315496`*^9, 3.564727061399127*^9, {3.5771606417016*^9, 
   3.57716065858703*^9}}],

Cell["\<\
We gather all the rules for matter below. This function is used in he \
function which automatize the whole process. Otherwise the user is free to \
build himself the rules which he thinks should be used for the splitting of \
the perturbation of matter feld (essentially the velocity).\
\>", "Text",
 CellChangeTimes->{{3.563742085009038*^9, 3.5637421598141413`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SplitMatter", "[", 
     RowBox[{"uf_", ",", "duf_", ",", "normvector_", ",", 
      RowBox[{"h_", "?", "InducedMetricQ"}], ",", 
      RowBox[{"gauge_", "?", "GaugeQ"}], ",", 
      RowBox[{"order_", "?", "IntegerQ"}], ",", 
      RowBox[{"tiltvalue_:", "\"\<NotTilted\>\""}]}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"DefTensorQ", "[", 
           RowBox[{"\[Rho]", "[", "uf", "]"}], "]"}], "]"}], "||", 
         RowBox[{"Not", "[", 
          RowBox[{"DefTensorQ", "[", "duf", "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<** Warning: The perturbed velocity, or the fields required to \
parameterize the splitting of matter fields perturbations splitting  were not \
previously defined **\>\"", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{
         "Print", "[", 
          "\"\<** DefMatterFields is called to build the perturbation of the \
vector field and the projected fields needed for future splitting **\>\"", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"DefMatterFields", "[", 
          RowBox[{"uf", ",", "duf", ",", "h"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Switch", "[", 
       RowBox[{"tiltvalue", ",", "\"\<Tilted\>\"", ",", "\[IndentingNewLine]", 
        RowBox[{"AllRulesFromProjectedRule", "[", 
         RowBox[{"uf", ",", "normvector", ",", 
          RowBox[{"RulesVelocitySpatial", "[", 
           RowBox[{
           "h", ",", "uf", ",", "duf", ",", "normvector", ",", "gauge", ",", 
            "order", ",", "True"}], "]"}], ",", "h", ",", "order"}], "]"}], 
        ",", "\[IndentingNewLine]", "\"\<NotTilted\>\"", ",", 
        RowBox[{"AllRulesFromProjectedRule", "[", 
         RowBox[{"uf", ",", "normvector", ",", 
          RowBox[{"RulesVelocitySpatial", "[", 
           RowBox[{
           "h", ",", "uf", ",", "duf", ",", "normvector", ",", "gauge", ",", 
            "order", ",", "False"}], "]"}], ",", "h", ",", "order"}], "]"}]}],
        "]"}]}], ")"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"SplitMatter", ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "7"}], "}"}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Protect", "[", "SplitMatter", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.563520778834778*^9, 3.563520790311762*^9}, {
   3.5635216677833*^9, 3.563521702283216*^9}, {3.5635237345013857`*^9, 
   3.563523814717505*^9}, {3.5635238570251617`*^9, 3.56352421272322*^9}, {
   3.563524248111458*^9, 3.563524259098538*^9}, {3.5635242914137373`*^9, 
   3.563524298198615*^9}, {3.5635243332385406`*^9, 3.5635243699872313`*^9}, {
   3.563524428806451*^9, 3.563524437860033*^9}, {3.5635244755672703`*^9, 
   3.5635248598578777`*^9}, {3.5635248921221848`*^9, 3.563525003299048*^9}, {
   3.5635410451624117`*^9, 3.5635410815073557`*^9}, {3.5635411898341503`*^9, 
   3.563541310378499*^9}, {3.5635413779484243`*^9, 3.5635413846098003`*^9}, {
   3.563541571424362*^9, 3.563541582232092*^9}, {3.563541635873334*^9, 
   3.563541638195838*^9}, {3.5635417058491592`*^9, 3.563541753615587*^9}, {
   3.5635417860021*^9, 3.563541795980151*^9}, {3.563541853530245*^9, 
   3.563541856003132*^9}, {3.5635423632021008`*^9, 3.563542419859194*^9}, {
   3.56354294718682*^9, 3.56354298831872*^9}, {3.563543019395944*^9, 
   3.563543061169029*^9}, {3.563545021661408*^9, 3.563545057571978*^9}, {
   3.563545159347065*^9, 3.5635452069264727`*^9}, {3.563545333934032*^9, 
   3.563545362366396*^9}, {3.563545666179039*^9, 3.563545670721554*^9}, {
   3.563545782467217*^9, 3.563545787559348*^9}, {3.5635459874628487`*^9, 
   3.563545988486166*^9}, {3.563546101404894*^9, 3.5635461265370083`*^9}, {
   3.56354617426959*^9, 3.5635462274312897`*^9}, {3.563556427563561*^9, 
   3.56355643439174*^9}, {3.5635564806499567`*^9, 3.563556497583392*^9}, 
   3.5635574795401154`*^9, {3.563558362357111*^9, 3.563558415086349*^9}, {
   3.563558506548587*^9, 3.56355863985538*^9}, {3.563558675814044*^9, 
   3.563558722709284*^9}, {3.563558790702795*^9, 3.563558952730062*^9}, {
   3.563559031285396*^9, 3.5635590349021072`*^9}, {3.563559274286127*^9, 
   3.563559296514781*^9}, 3.563559406592966*^9, {3.563560060441709*^9, 
   3.5635600743807287`*^9}, {3.563560710547267*^9, 3.563560725208477*^9}, {
   3.563560802161806*^9, 3.563560936485051*^9}, {3.5635610118351393`*^9, 
   3.5635610243661747`*^9}, {3.563561216462905*^9, 3.5635612237965612`*^9}, {
   3.5635613018326893`*^9, 3.563561302975378*^9}, {3.563561391090199*^9, 
   3.563561459427946*^9}, {3.563561518416789*^9, 3.563561548045063*^9}, 
   3.5635616874848547`*^9, {3.563561907286665*^9, 3.563561911533354*^9}, {
   3.563561997188102*^9, 3.563562011283951*^9}, 3.563562069658807*^9, {
   3.563562266788005*^9, 3.5635622677450953`*^9}, {3.563562703222294*^9, 
   3.563562713219388*^9}, {3.563567659593308*^9, 3.5635676774372377`*^9}, {
   3.563567717071747*^9, 3.563567749331966*^9}, {3.5635678999689407`*^9, 
   3.563567921609177*^9}, {3.563568042765244*^9, 3.563568068780161*^9}, {
   3.563568252996604*^9, 3.5635682744390907`*^9}, {3.563594304255591*^9, 
   3.563594308815859*^9}, {3.563605573004096*^9, 3.563605619312428*^9}, {
   3.563605674652079*^9, 3.563605679977083*^9}, {3.563605954386462*^9, 
   3.563606192434142*^9}, {3.563606812324347*^9, 3.5636068189053087`*^9}, {
   3.563606978369554*^9, 3.563606980470789*^9}, {3.563607321914282*^9, 
   3.56360733209051*^9}, {3.563607373107593*^9, 3.56360737611777*^9}, {
   3.563607463344499*^9, 3.563607609244001*^9}, {3.56360880690938*^9, 
   3.563608812737124*^9}, 3.563610056641364*^9, {3.56361068314062*^9, 
   3.5636107171743383`*^9}, {3.563610768836444*^9, 3.5636107751890583`*^9}, {
   3.5636108446380577`*^9, 3.5636108616786737`*^9}, {3.563616115379212*^9, 
   3.56361616798389*^9}, {3.563738208666972*^9, 3.563738220726568*^9}, {
   3.563738260851533*^9, 3.563738298420342*^9}, {3.5638664255585337`*^9, 
   3.563866428391988*^9}, {3.563866566356636*^9, 3.563866588367742*^9}, {
   3.5645501194058867`*^9, 3.564550128906547*^9}, {3.5645506768766403`*^9, 
   3.564550678834361*^9}, {3.5645529645730457`*^9, 3.564552967851325*^9}, {
   3.564725344846931*^9, 3.5647253693436337`*^9}, 3.5647265418705273`*^9, 
   3.564727018553434*^9, 3.564727067684202*^9, {3.565093530791664*^9, 
   3.565093531606676*^9}, {3.566316848851377*^9, 3.566316849754333*^9}, {
   3.5691325776628027`*^9, 3.569132579001238*^9}, {3.5693295149887743`*^9, 
   3.569329527466066*^9}}],

Cell[BoxData[
 RowBox[{"SetNumberOfArguments", "[", 
  RowBox[{"SplitMatter", ",", 
   RowBox[{"{", 
    RowBox[{"6", ",", "7"}], "}"}]}], "]"}]], "Output",
 CellChangeTimes->{3.56913239421173*^9, 3.56923031359042*^9, 
  3.569340255110979*^9, 3.569340517334474*^9, 3.5693407340119762`*^9, 
  3.569418997688978*^9, 3.569578895735487*^9}],

Cell[BoxData[
 RowBox[{"{", "\<\"SplitMatter\"\>", "}"}]], "Output",
 CellChangeTimes->{3.56913239421173*^9, 3.56923031359042*^9, 
  3.569340255110979*^9, 3.569340517334474*^9, 3.5693407340119762`*^9, 
  3.569418997688978*^9, 3.569578895736926*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[StyleBox["End private and package",
 FontColor->RGBColor[0, 0, 1]]], "Subsubsection",
 CellChangeTimes->{{3.562553693206647*^9, 3.562553693990636*^9}, {
  3.563742183044922*^9, 3.563742184076734*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"On", "[", 
   RowBox[{"RuleDelayed", "::", "rhs"}], "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562717402728662*^9, 3.562717404718198*^9}, {
   3.5631132772316723`*^9, 3.563113278682024*^9}, 3.563113316860664*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"End", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"EndPackage", "[", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.562561781004174*^9, 3.5625617822602377`*^9}, {
  3.5626464389902573`*^9, 3.562646440815069*^9}}],

Cell[BoxData["\<\"xAct`xPand`Private`\"\>"], "Output",
 CellChangeTimes->{3.56264714186425*^9, 3.562650554116909*^9, 
  3.563199233646983*^9, 3.5634611063753138`*^9, 3.563772961762188*^9, 
  3.56377306078372*^9, 3.563773885020627*^9, 3.5637739366497793`*^9, 
  3.5637739965482273`*^9, 3.5683127619743567`*^9, 3.5683128718179817`*^9, 
  3.56831291839465*^9, 3.5691323942779827`*^9, 3.5692303136418877`*^9, 
  3.569340255242181*^9, 3.5693405173770523`*^9, 3.569340734095573*^9, 
  3.56941899773982*^9, 3.569578895802348*^9}]
}, Open  ]]
}, Closed]]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1224, 756},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
ShowSelection->True,
Magnification->1,
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (November 20, \
2012)",
StyleDefinitions->FrontEnd`FileName[{"Creative"}, "PastelColor.nb", 
  CharacterEncoding -> "UTF-8"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[567, 22, 1328, 53, 79, "Title",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1920, 79, 163, 4, 39, "Subsection",
 InitializationCell->True],
Cell[2086, 85, 2521, 39, 83, "Text",
 InitializationCell->True],
Cell[4610, 126, 3182, 75, 233, "Text",
 InitializationCell->True],
Cell[7795, 203, 1449, 29, 100, "Text",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[9269, 236, 136, 2, 25, "Subsubsection"],
Cell[CellGroupData[{
Cell[9430, 242, 52, 1, 38, "Input"],
Cell[9485, 245, 1878, 29, 38, "Output"]
}, Open  ]],
Cell[11378, 277, 1473, 25, 38, "Input",
 InitializationCell->True],
Cell[12854, 304, 856, 20, 56, "Input",
 InitializationCell->True],
Cell[13713, 326, 131, 2, 29, "Text"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[13893, 334, 322, 6, 35, "Subsection",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[14240, 344, 150, 2, 25, "Subsubsection"],
Cell[14393, 348, 3379, 71, 308, "Input",
 InitializationCell->True],
Cell[17775, 421, 131, 2, 26, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[17943, 428, 108, 1, 19, "Subsubsection"],
Cell[18054, 431, 1383, 42, 444, "Input",
 InitializationCell->True],
Cell[19440, 475, 131, 2, 29, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[19608, 482, 132, 2, 19, "Subsubsection"],
Cell[19743, 486, 160, 5, 47, "Text"],
Cell[19906, 493, 474, 11, 38, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[20405, 508, 123, 1, 38, "Input"],
Cell[20531, 511, 327, 4, 38, "Output"]
}, Open  ]],
Cell[20873, 518, 116, 4, 47, "Text"],
Cell[CellGroupData[{
Cell[21014, 526, 803, 19, 73, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[21842, 549, 184, 3, 21, "Print"],
Cell[22029, 554, 457, 11, 22, "Print"],
Cell[22489, 567, 208, 3, 22, "Print"],
Cell[22700, 572, 163, 2, 22, "Print"],
Cell[22866, 576, 146, 2, 21, "Print"],
Cell[23015, 580, 187, 3, 21, "Print"],
Cell[23205, 585, 461, 11, 22, "Print"],
Cell[23669, 598, 206, 3, 22, "Print"],
Cell[23878, 603, 187, 3, 21, "Print"],
Cell[24068, 608, 459, 11, 22, "Print"],
Cell[24530, 621, 254, 4, 22, "Print"],
Cell[24787, 627, 426, 10, 22, "Print"],
Cell[25216, 639, 511, 11, 22, "Print"],
Cell[25730, 652, 612, 11, 22, "Print"],
Cell[26345, 665, 570, 11, 22, "Print"],
Cell[26918, 678, 588, 11, 22, "Print"],
Cell[27509, 691, 547, 12, 22, "Print"]
}, Open  ]],
Cell[28071, 706, 557, 8, 38, "Output"]
}, Open  ]],
Cell[28643, 717, 167, 6, 47, "Text"],
Cell[28813, 725, 1184, 33, 107, "Input",
 InitializationCell->True],
Cell[30000, 760, 85, 4, 47, "Text"],
Cell[CellGroupData[{
Cell[30110, 768, 941, 21, 73, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[31076, 793, 1951, 28, 21, "Print"],
Cell[33030, 823, 2218, 35, 22, "Print"],
Cell[35251, 860, 1988, 28, 22, "Print"]
}, Open  ]]
}, Open  ]],
Cell[37266, 892, 327, 7, 47, "Text"],
Cell[37596, 901, 1746, 29, 294, "Input",
 InitializationCell->True],
Cell[39345, 932, 125, 4, 47, "Text"],
Cell[CellGroupData[{
Cell[39495, 940, 880, 20, 141, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[40400, 964, 326, 5, 21, "Print"],
Cell[40729, 971, 483, 7, 38, "Print"],
Cell[41215, 980, 326, 5, 21, "Print"]
}, Open  ]]
}, Open  ]],
Cell[41568, 989, 156, 5, 47, "Text"],
Cell[CellGroupData[{
Cell[41749, 998, 38, 0, 38, "Input"],
Cell[41790, 1000, 1791, 27, 38, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[43618, 1032, 34, 0, 38, "Input"],
Cell[43655, 1034, 414, 6, 38, "Output"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[44118, 1046, 205, 3, 19, "Subsubsection"],
Cell[44326, 1051, 149, 5, 47, "Text"],
Cell[44478, 1058, 378, 10, 56, "Input",
 InitializationCell->True],
Cell[44859, 1070, 171, 5, 47, "Text"],
Cell[CellGroupData[{
Cell[45055, 1079, 72, 1, 38, "Input"],
Cell[45130, 1082, 1800, 28, 38, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[46967, 1115, 33, 0, 38, "Input"],
Cell[47003, 1117, 1548, 22, 38, "Output"]
}, Open  ]],
Cell[48566, 1142, 131, 2, 29, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[48734, 1149, 266, 3, 19, "Subsubsection"],
Cell[49003, 1154, 384, 14, 191, "Text"],
Cell[49390, 1170, 78, 4, 47, "Text"],
Cell[49471, 1176, 1390, 29, 175, "Input",
 InitializationCell->True],
Cell[50864, 1207, 153, 5, 49, "Text"],
Cell[51020, 1214, 6250, 108, 726, "Input",
 InitializationCell->True],
Cell[57273, 1324, 205, 6, 49, "Text"],
Cell[57481, 1332, 10522, 193, 1086, "Input",
 InitializationCell->True],
Cell[68006, 1527, 150, 5, 47, "Text"],
Cell[68159, 1534, 39817, 640, 3266, "Input",
 InitializationCell->True],
Cell[107979, 2176, 281, 7, 47, "Text"],
Cell[108263, 2185, 2774, 48, 243, "Input",
 InitializationCell->True],
Cell[111040, 2235, 1758, 29, 119, "Text"],
Cell[112801, 2266, 11001, 171, 918, "Input",
 InitializationCell->True],
Cell[123805, 2439, 8937, 138, 651, "Input",
 InitializationCell->True],
Cell[132745, 2579, 10620, 159, 957, "Input",
 InitializationCell->True],
Cell[143368, 2740, 12851, 200, 1808, "Input",
 InitializationCell->True],
Cell[156222, 2942, 8706, 137, 972, "Input",
 InitializationCell->True],
Cell[164931, 3081, 350, 7, 49, "Text"],
Cell[165284, 3090, 2460, 56, 345, "Input",
 InitializationCell->True],
Cell[167747, 3148, 279, 7, 47, "Text"],
Cell[CellGroupData[{
Cell[168051, 3159, 2409, 47, 192, "Input",
 InitializationCell->True],
Cell[170463, 3208, 396, 5, 38, "Output"]
}, Open  ]],
Cell[170874, 3216, 255, 6, 47, "Text"],
Cell[CellGroupData[{
Cell[171154, 3226, 7066, 116, 455, "Input",
 InitializationCell->True],
Cell[178223, 3344, 390, 5, 38, "Output"]
}, Open  ]],
Cell[178628, 3352, 131, 2, 29, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[178796, 3359, 162, 2, 25, "Subsubsection"],
Cell[CellGroupData[{
Cell[178983, 3365, 277, 5, 38, "Input",
 InitializationCell->True],
Cell[179263, 3372, 1765, 25, 70, "Output"]
}, Open  ]],
Cell[181043, 3400, 131, 2, 29, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[181211, 3407, 399, 5, 19, "Subsubsection"],
Cell[181613, 3414, 3706, 73, 158, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[185344, 3491, 288, 4, 38, "Input"],
Cell[185635, 3497, 2383, 38, 124, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[188055, 3540, 38, 0, 38, "Input"],
Cell[188096, 3542, 1822, 27, 38, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[189955, 3574, 34, 0, 38, "Input"],
Cell[189992, 3576, 1579, 22, 38, "Output"]
}, Open  ]],
Cell[191586, 3601, 131, 2, 29, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[191754, 3608, 255, 3, 25, "Subsubsection"],
Cell[192012, 3613, 4705, 98, 396, "Input",
 InitializationCell->True],
Cell[196720, 3713, 305, 7, 47, "Text"],
Cell[197028, 3722, 348, 10, 38, "Input",
 InitializationCell->True],
Cell[197379, 3734, 163, 5, 47, "Text"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[197591, 3745, 422, 8, 35, "Subsection",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[198038, 3757, 159, 2, 25, "Subsubsection"],
Cell[198200, 3761, 450, 10, 101, "Text"],
Cell[198653, 3773, 227, 6, 47, "Text"],
Cell[198883, 3781, 16199, 343, 702, "Input",
 InitializationCell->True],
Cell[215085, 4126, 225, 6, 47, "Text"],
Cell[215313, 4134, 8664, 186, 430, "Input",
 InitializationCell->True],
Cell[223980, 4322, 286, 7, 47, "Text"],
Cell[224269, 4331, 2499, 47, 107, "Input",
 InitializationCell->True],
Cell[226771, 4380, 241, 6, 47, "Text"],
Cell[227015, 4388, 11137, 263, 685, "Input",
 InitializationCell->True],
Cell[238155, 4653, 131, 2, 29, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[238323, 4660, 214, 3, 19, "Subsubsection"],
Cell[238540, 4665, 2458, 62, 226, "Input",
 InitializationCell->True],
Cell[241001, 4729, 1641, 38, 107, "Input",
 InitializationCell->True],
Cell[242645, 4769, 2063, 52, 124, "Input",
 InitializationCell->True],
Cell[244711, 4823, 2522, 63, 209, "Input",
 InitializationCell->True],
Cell[247236, 4888, 1844, 44, 141, "Input",
 InitializationCell->True],
Cell[249083, 4934, 8464, 236, 396, "Input",
 InitializationCell->True],
Cell[257550, 5172, 131, 2, 29, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[257718, 5179, 312, 5, 25, "Subsubsection"],
Cell[258033, 5186, 548, 12, 101, "Text"],
Cell[258584, 5200, 132, 5, 47, "Text"],
Cell[258719, 5207, 2755, 58, 158, "Input",
 InitializationCell->True],
Cell[261477, 5267, 160, 5, 47, "Text"],
Cell[261640, 5274, 14521, 299, 1229, "Input",
 InitializationCell->True],
Cell[276164, 5575, 219, 6, 49, "Text"],
Cell[276386, 5583, 165040, 3445, 8401, "Input",
 InitializationCell->True],
Cell[441429, 9030, 275, 6, 47, "Text"],
Cell[441707, 9038, 112057, 2394, 6795, "Input",
 InitializationCell->True],
Cell[553767, 11434, 131, 2, 29, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[553935, 11441, 354, 5, 24, "Subsubsection"],
Cell[554292, 11448, 602, 11, 68, "Text"],
Cell[554897, 11461, 1284, 25, 40, "Input",
 InitializationCell->True],
Cell[556184, 11488, 2019, 55, 155, "Input",
 InitializationCell->True],
Cell[558206, 11545, 5212, 118, 307, "Input",
 InitializationCell->True],
Cell[563421, 11665, 202341, 4172, 7931, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[765799, 15842, 283, 5, 25, "Subsubsection"],
Cell[766085, 15849, 12723, 255, 770, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[778833, 16108, 12446, 251, 702, "Input",
 InitializationCell->True],
Cell[791282, 16361, 340, 7, 38, "Output"]
}, Open  ]],
Cell[791637, 16371, 52922, 1162, 1637, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[844596, 17538, 172, 2, 19, "Subsubsection"],
Cell[844771, 17542, 9411, 221, 685, "Input",
 InitializationCell->True],
Cell[854185, 17765, 1588, 34, 56, "Input",
 InitializationCell->True],
Cell[855776, 17801, 12837, 254, 617, "Input",
 InitializationCell->True],
Cell[868616, 18057, 4942, 125, 362, "Input",
 InitializationCell->True],
Cell[873561, 18184, 6458, 154, 379, "Input",
 InitializationCell->True],
Cell[880022, 18340, 20669, 400, 702, "Input",
 InitializationCell->True],
Cell[900694, 18742, 10499, 241, 804, "Input",
 InitializationCell->True],
Cell[911196, 18985, 10607, 154, 38, "Input",
 InitializationCell->True],
Cell[921806, 19141, 22931, 420, 991, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[944774, 19566, 259, 5, 25, "Subsubsection"],
Cell[945036, 19573, 15683, 349, 906, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[960756, 19927, 236, 3, 19, "Subsubsection"],
Cell[960995, 19932, 9650, 162, 107, "Input",
 InitializationCell->True],
Cell[970648, 20096, 11979, 230, 226, "Input",
 InitializationCell->True],
Cell[982630, 20328, 478, 9, 65, "Text"],
Cell[983111, 20339, 26517, 493, 1178, "Input",
 InitializationCell->True],
Cell[1009631, 20834, 140, 1, 29, "Text"],
Cell[1009774, 20837, 5181, 117, 277, "Input",
 InitializationCell->True],
Cell[1014958, 20956, 16033, 286, 396, "Input",
 InitializationCell->True],
Cell[1030994, 21244, 8512, 124, 38, "Input",
 InitializationCell->True],
Cell[1039509, 21370, 257, 5, 29, "Text"],
Cell[1039769, 21377, 19764, 357, 600, "Input",
 InitializationCell->True],
Cell[1059536, 21736, 210, 4, 29, "Text"],
Cell[1059749, 21742, 19791, 336, 295, "Input",
 InitializationCell->True],
Cell[1079543, 22080, 63561, 1190, 2929, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[1143141, 23275, 280, 3, 25, "Subsubsection"],
Cell[1143424, 23280, 221, 4, 29, "Text"],
Cell[CellGroupData[{
Cell[1143670, 23288, 16596, 301, 600, "Input",
 InitializationCell->True],
Cell[1160269, 23591, 347, 7, 38, "Output"],
Cell[1160619, 23600, 259, 4, 38, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1160927, 23610, 172, 2, 25, "Subsubsection"],
Cell[1161102, 23614, 124, 1, 29, "Text"],
Cell[1161229, 23617, 10784, 249, 396, "Input",
 InitializationCell->True],
Cell[1172016, 23868, 121, 1, 29, "Text"],
Cell[1172140, 23871, 5488, 132, 243, "Input",
 InitializationCell->True],
Cell[1177631, 24005, 726, 18, 90, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[1178394, 24028, 426, 6, 25, "Subsubsection"],
Cell[1178823, 24036, 700, 12, 83, "Text"],
Cell[1179526, 24050, 20457, 408, 1025, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[1200020, 24463, 224, 4, 25, "Subsubsection"],
Cell[1200247, 24469, 132, 1, 29, "Text"],
Cell[1200382, 24472, 14091, 282, 345, "Input",
 InitializationCell->True],
Cell[1214476, 24756, 171, 4, 29, "Text"],
Cell[1214650, 24762, 11770, 225, 566, "Input",
 InitializationCell->True],
Cell[1226423, 24989, 378, 6, 47, "Text"],
Cell[CellGroupData[{
Cell[1226826, 24999, 6741, 113, 243, "Input",
 InitializationCell->True],
Cell[1233570, 25114, 336, 7, 38, "Output"],
Cell[1233909, 25123, 248, 4, 38, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[1234206, 25133, 214, 3, 25, "Subsubsection"],
Cell[1234423, 25138, 277, 6, 38, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1234725, 25148, 258, 5, 56, "Input",
 InitializationCell->True],
Cell[1234986, 25155, 522, 7, 38, "Output"]
}, Open  ]]
}, Closed]]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
